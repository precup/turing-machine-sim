function run(){var saved=getURLParam("saved"),submit_pset=getURLParam("submit_pset"),submit_problem=getURLParam("submit_problem"),pset=getURLParam("pset"),problem=getURLParam("problem"),charSet=getURLParam("charset"),mode=getURLParam("type"),tapeSet=getURLParam("tapeSet");if(submit_pset&&submit_pset){var submit_pset=parseInt(submit_pset),submit_problem=parseInt(submit_problem);gServer.loadSubmission(submit_pset,submit_problem,function(err,data){if(err)gErrorMenu.displayError("Could not connect to server; load failed",!0);else{var automata=JSON.parse(data[0].automata);reload(automata)}})}else null==saved?buildGraph(pset,problem,charSet,mode,tapeSet):gServer.listSaved(function(err,data){var found=!1;data.forEach(function(elem,index,arr){elem.name===saved&&(found=!0)}),found?gServer.load(saved,function(err,automata){return err?void gErrorMenu.displayError("Could not connect to server; load failed",!0):(gServer.name=saved,void reload(automata))}):gErrorMenu.displayError("Could not connect to server; load failed",!0)})}function reload(automata){var loadedCharSet=automata.meta.charSet,loadedPset=automata.meta.pset,loadedProblem=automata.meta.problem,loadedMode=automata.meta.mode,loadedTapeSet=automata.meta.tapeSet;buildGraph(loadedPset,loadedProblem,loadedCharSet,loadedMode,loadedTapeSet),gGraph.load(automata),gGraph.draw()}function buildGraph(pset,problem,charSet,mode,tapeSet){gBehaviors.init(),gGraph.init(pset,problem,charSet,mode,tapeSet)}function Queue(){var a=[],b=0;this.getLength=function(){return a.length-b},this.isEmpty=function(){return 0==a.length},this.enqueue=function(b){a.push(b)},this.dequeue=function(){if(0!=a.length){var c=a[b];return 2*++b>=a.length&&(a=a.slice(b),b=0),c}},this.peek=function(){return 0<a.length?a[b]:void 0}}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function run(){var a=getURLParam("saved"),b=getURLParam("submit_pset"),c=getURLParam("submit_problem"),d=getURLParam("pset"),e=getURLParam("problem"),f=getURLParam("charset"),g=getURLParam("type"),h=getURLParam("tapeSet");if(b&&b){var b=parseInt(b),c=parseInt(c);gServer.loadSubmission(b,c,function(a,b){if(a)gErrorMenu.displayError("Could not connect to server; load failed",!0);else{var c=JSON.parse(b[0].automata);reload(c)}})}else null==a?buildGraph(d,e,f,g,h):gServer.listSaved(function(b,c){var d=!1;c.forEach(function(b,c,e){b.name===a&&(d=!0)}),d?gServer.load(a,function(b,c){return b?void gErrorMenu.displayError("Could not connect to server; load failed",!0):(gServer.name=a,void reload(c))}):gErrorMenu.displayError("Could not connect to server; load failed",!0)})}function reload(a){var b=a.meta.charSet,c=a.meta.pset,d=a.meta.problem,e=a.meta.mode,f=a.meta.tapeSet;buildGraph(c,d,b,e,f),gGraph.load(a),gGraph.draw()}function buildGraph(a,b,c,d,e){gBehaviors.init(),gGraph.init(a,b,c,d,e)}function Queue(){var a=[],b=0;this.getLength=function(){return a.length-b},this.isEmpty=function(){return 0==a.length},this.enqueue=function(b){a.push(b)},this.dequeue=function(){if(0!=a.length){var c=a[b];return 2*++b>=a.length&&(a=a.slice(b),b=0),c}},this.peek=function(){return 0<a.length?a[b]:void 0}}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function run(){var a=getURLParam("saved"),b=getURLParam("submit_pset"),c=getURLParam("submit_problem"),d=getURLParam("pset"),e=getURLParam("problem"),f=getURLParam("charset"),g=getURLParam("type"),h=getURLParam("tapeSet");if(b&&b){var b=parseInt(b),c=parseInt(c);gServer.loadSubmission(b,c,function(a,b){if(a)gErrorMenu.displayError("Could not connect to server; load failed",!0);else{var c=JSON.parse(b[0].automata);reload(c)}})}else null==a?buildGraph(d,e,f,g,h):gServer.listSaved(function(b,c){var d=!1;c.forEach(function(b,c,e){b.name===a&&(d=!0)}),d?gServer.load(a,function(b,c){return b?void gErrorMenu.displayError("Could not connect to server; load failed",!0):(gServer.name=a,void reload(c))}):gErrorMenu.displayError("Could not connect to server; load failed",!0)})}function reload(a){var b=a.meta.charSet,c=a.meta.pset,d=a.meta.problem,e=a.meta.mode,f=a.meta.tapeSet;buildGraph(c,d,b,e,f),gGraph.load(a),gGraph.draw()}function buildGraph(a,b,c,d,e){gBehaviors.init(),gGraph.init(a,b,c,d,e)}function Queue(){var a=[],b=0;this.getLength=function(){return a.length-b},this.isEmpty=function(){return 0==a.length},this.enqueue=function(b){a.push(b)},this.dequeue=function(){if(0!=a.length){var c=a[b];return 2*++b>=a.length&&(a=a.slice(b),b=0),c}},this.peek=function(){return 0<a.length?a[b]:void 0}}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function run(){var a=getURLParam("saved"),b=getURLParam("submit_pset"),c=getURLParam("submit_problem"),d=getURLParam("pset"),e=getURLParam("problem"),f=getURLParam("charset"),g=getURLParam("type"),h=getURLParam("tapeSet");if(b&&b){var b=parseInt(b),c=parseInt(c);gServer.loadSubmission(b,c,function(a,b){if(a)gErrorMenu.displayError("Could not connect to server; load failed",!0);else{var c=JSON.parse(b[0].automata);reload(c)}})}else null==a?buildGraph(d,e,f,g,h):gServer.listSaved(function(b,c){var d=!1;c.forEach(function(b,c,e){b.name===a&&(d=!0)}),d?gServer.load(a,function(b,c){return b?void gErrorMenu.displayError("Could not connect to server; load failed",!0):(gServer.name=a,void reload(c))}):gErrorMenu.displayError("Could not connect to server; load failed",!0)})}function reload(a){var b=a.meta.charSet,c=a.meta.pset,d=a.meta.problem,e=a.meta.mode,f=a.meta.tapeSet;buildGraph(c,d,b,e,f),gGraph.load(a),gGraph.draw()}function buildGraph(a,b,c,d,e){gBehaviors.init(),gGraph.init(a,b,c,d,e)}function Queue(){var a=[],b=0;this.getLength=function(){return a.length-b},this.isEmpty=function(){return 0==a.length},this.enqueue=function(b){a.push(b)},this.dequeue=function(){if(0!=a.length){var c=a[b];return 2*++b>=a.length&&(a=a.slice(b),b=0),c}},this.peek=function(){return 0<a.length?a[b]:void 0}}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function run(){var a=getURLParam("saved"),b=getURLParam("submit_pset"),c=getURLParam("submit_problem"),d=getURLParam("pset"),e=getURLParam("problem"),f=getURLParam("charset"),g=getURLParam("type"),h=getURLParam("tapeSet");if(b&&b){var b=parseInt(b),c=parseInt(c);gServer.loadSubmission(b,c,function(a,b){if(a)gErrorMenu.displayError("Could not connect to server; load failed",!0);else{var c=JSON.parse(b[0].automata);reload(c)}})}else null==a?buildGraph(d,e,f,g,h):gServer.listSaved(function(b,c){var d=!1;c.forEach(function(b,c,e){b.name===a&&(d=!0)}),d?gServer.load(a,function(b,c){return b?void gErrorMenu.displayError("Could not connect to server; load failed",!0):(gServer.name=a,void reload(c))}):gErrorMenu.displayError("Could not connect to server; load failed",!0)})}function reload(a){var b=a.meta.charSet,c=a.meta.pset,d=a.meta.problem,e=a.meta.mode,f=a.meta.tapeSet;buildGraph(c,d,b,e,f),gGraph.load(a),gGraph.draw()}function buildGraph(a,b,c,d,e){gBehaviors.init(),gGraph.init(a,b,c,d,e)}function Queue(){var a=[],b=0;this.getLength=function(){return a.length-b},this.isEmpty=function(){return 0==a.length},this.enqueue=function(b){a.push(b)},this.dequeue=function(){if(0!=a.length){var c=a[b];return 2*++b>=a.length&&(a=a.slice(b),b=0),c}},this.peek=function(){return 0<a.length?a[b]:void 0}}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function run(){var a=getURLParam("saved"),b=getURLParam("submit_pset"),c=getURLParam("submit_problem"),d=getURLParam("pset"),e=getURLParam("problem"),f=getURLParam("charset"),g=getURLParam("type"),h=getURLParam("tapeSet");if(b&&b){var b=parseInt(b),c=parseInt(c);gServer.loadSubmission(b,c,function(a,b){if(a)gErrorMenu.displayError("Could not connect to server; load failed",!0);else{var c=JSON.parse(b[0].automata);reload(c)}})}else null==a?buildGraph(d,e,f,g,h):gServer.listSaved(function(b,c){var d=!1;c.forEach(function(b,c,e){b.name===a&&(d=!0)}),d?gServer.load(a,function(b,c){return b?void gErrorMenu.displayError("Could not connect to server; load failed",!0):(gServer.name=a,void reload(c))}):gErrorMenu.displayError("Could not connect to server; load failed",!0)})}function reload(a){var b=a.meta.charSet,c=a.meta.pset,d=a.meta.problem,e=a.meta.mode,f=a.meta.tapeSet;buildGraph(c,d,b,e,f),gGraph.load(a),gGraph.draw()}function buildGraph(a,b,c,d,e){gBehaviors.init(),gGraph.init(a,b,c,d,e)}function Queue(){var a=[],b=0;this.getLength=function(){return a.length-b},this.isEmpty=function(){return 0==a.length},this.enqueue=function(b){a.push(b)},this.dequeue=function(){if(0!=a.length){var c=a[b];return 2*++b>=a.length&&(a=a.slice(b),b=0),c}},this.peek=function(){return 0<a.length?a[b]:void 0}}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function getURLParam(a,b){b||(b=location.href),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?null:e[1]}function setURLParam(a,b,c){var d=new RegExp("([?&])"+a+"=.*?(&|$)","i"),e=-1!==c.indexOf("?")?"&":"?";return c.match(d)?c.replace(d,"$1"+a+"="+b+"$2"):c+e+a+"="+b}function intersection(a,b){for(var c="",d=0;d<a.length;d++)-1!=b.indexOf(a[d])&&(c+=a[d]);return c}function sortString(a){return a.split("").sort().join("")}function removeDuplicates(a){for(var b="",c=0;c<a.length;c++)-1==b.indexOf(a[c])&&(b+=a[c]);return b}function getURLParent(){var a=window.location.href,b=a.lastIndexOf("/")+1;return 8>=b?a+="/":a=a.substring(0,b),a}function dist(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function getURLParam(name,url){url||(url=location.href),name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(url);return null==results?null:results[1]}function setURLParam(key,value,url){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=-1!==url.indexOf("?")?"&":"?";return url.match(re)?url.replace(re,"$1"+key+"="+value+"$2"):url+separator+key+"="+value}function intersection(str1,str2){for(var result="",i=0;i<str1.length;i++)-1!=str2.indexOf(str1[i])&&(result+=str1[i]);return result}function sortString(str){return str.split("").sort().join("")}function removeDuplicates(str){for(var result="",i=0;i<str.length;i++)-1==result.indexOf(str[i])&&(result+=str[i]);return result}function getURLParent(){var url=window.location.href,loc=url.lastIndexOf("/")+1;return 8>=loc?url+="/":url=url.substring(0,loc),url}function dist(x1,y1,x2,y2){return Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2))}module.exports=function(grunt){grunt.initConfig({uglify:{my_target:{options:{sourceMap:!0,sourceMapName:"sourceMap.map",mangle:!1},files:{"tm.min.js":["*.js","brush/*.js","graph/*.js","edges/*.js","nodes/*.js","menu/*.js","menu/modal/*.js","simulation/*.js","server/*.js"],"select.min.js":["psets.js","util.js","server/server.js","server/mock.js"]}}}}),grunt.loadNpmTasks("grunt-contrib-uglify"),grunt.registerTask("default",["uglify"])};var gBehaviors={};gBehaviors.init=function(){gBehaviors.handlers={},gBehaviors.configure("edges",["mousedown","mousemove","mouseup","dblclick"]),gBehaviors.configure("nodes",["mousedown","drag","mouseover","mouseout","mouseup","dblclick"]),gBehaviors.configure("lowerNodes",["mousedown","mousemove","mouseover","mouseout"]),gBehaviors.configure("brush",["brushstart","brush"]),gBehaviors.configure("background",["dblclick","mousemove","mouseover","mouseup","mousedown"]),gBehaviors.configure("page",["keyup","keydown"])},gBehaviors.configure=function(type,events){gBehaviors.handlers[type]={},gBehaviors[type]={},events.forEach(function(event){gBehaviors.handlers[type][event]=[],gBehaviors[type][event]=function(data){gBehaviors.handlers[type][event].forEach(function(entry){entry.condition(data)&&entry.action(data)})}})},gBehaviors.addBehavior=function(type,event,condition,action){gBehaviors.handlers[type][event].push({condition:condition,action:action})},gBehaviors.apply=function(type,selection){for(var event in gBehaviors[type])"drag"===event?selection.call(d3.behavior.drag().on("drag",gBehaviors[type][event]).on("dragstart",function(){gNodes.selectionX=0,gNodes.selectionY=0,gNodes.dragging=!0,gEdges.hideTempEdge()}).on("dragend",function(){gNodes.dragging=!1})):selection.on(event,gBehaviors[type][event])};var gCookiesActive=!1;gGraph.initCookie=function(){gCookiesActive&&(gBehaviors.addBehavior("page","keydown",function(){return 76==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){for(var nameEQ="automata=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);0==c.indexOf(nameEQ)&&gGraph.load(JSON.parse(c.substring(nameEQ.length,c.length)))}gGraph.draw()}),gBehaviors.addBehavior("page","keydown",function(){return 83==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){var name="automata",value=JSON.stringify(gGraph.save()),date=new Date;date.setTime(date.getTime()+31536e6);var expires="; expires="+date.toGMTString();document.cookie=name+"="+value+expires+"; path=/"}))};var psets=[{name:"Problem Set 5",problems:[{name:"1.i",charSet:"abc",type:"dfa"},{name:"1.ii",charSet:"ab",type:"dfa"},{name:"1.iii",charSet:"abcdefghijklmnopqrstuvwxyz",type:"dfa"},{name:"1.iv",charSet:"yd",type:"dfa"},{name:"2.i",charSet:"abc",type:"nfa"},{name:"2.ii",charSet:"abcde",type:"nfa"},{name:"2.iii",charSet:"ab",type:"nfa"}]}],psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}];Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}(),gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock),module.exports=function(a){a.initConfig({uglify:{my_target:{options:{sourceMap:!0,sourceMapName:"sourceMap.map"},files:{"tm.min.js":["*.js","brush/*.js","graph/*.js","edges/*.js","nodes/*.js","menu/*.js","menu/modal/*.js","simulation/*.js","server/*.js"],"select.min.js":["psets.js","util.js","server/server.js","server/mock.js"]}}}}),a.loadNpmTasks("grunt-contrib-uglify"),a.registerTask("default",["uglify"])};var gBehaviors={};gBehaviors.init=function(){gBehaviors.handlers={},gBehaviors.configure("edges",["mousedown","mousemove","mouseup","dblclick"]),gBehaviors.configure("nodes",["mousedown","drag","mouseover","mouseout","mouseup","dblclick"]),gBehaviors.configure("lowerNodes",["mousedown","mousemove","mouseover","mouseout"]),gBehaviors.configure("brush",["brushstart","brush"]),gBehaviors.configure("background",["dblclick","mousemove","mouseover","mouseup","mousedown"]),gBehaviors.configure("page",["keyup","keydown"])},gBehaviors.configure=function(a,b){gBehaviors.handlers[a]={},gBehaviors[a]={},b.forEach(function(b){gBehaviors.handlers[a][b]=[],gBehaviors[a][b]=function(c){gBehaviors.handlers[a][b].forEach(function(a){a.condition(c)&&a.action(c)})}})},gBehaviors.addBehavior=function(a,b,c,d){gBehaviors.handlers[a][b].push({condition:c,action:d})},gBehaviors.apply=function(a,b){for(var c in gBehaviors[a])"drag"===c?b.call(d3.behavior.drag().on("drag",gBehaviors[a][c]).on("dragstart",function(){gNodes.selectionX=0,gNodes.selectionY=0,gNodes.dragging=!0,gEdges.hideTempEdge()}).on("dragend",function(){gNodes.dragging=!1})):b.on(c,gBehaviors[a][c])};var gCookiesActive=!1;gGraph.initCookie=function(){gCookiesActive&&(gBehaviors.addBehavior("page","keydown",function(){return 76==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){for(var a="automata=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);0==d.indexOf(a)&&gGraph.load(JSON.parse(d.substring(a.length,d.length)))}gGraph.draw()}),gBehaviors.addBehavior("page","keydown",function(){return 83==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){var a="automata",b=JSON.stringify(gGraph.save()),c=new Date;c.setTime(c.getTime()+31536e6);var d="; expires="+c.toGMTString();document.cookie=a+"="+b+d+"; path=/"}))};var psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}],psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}];Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}(),gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),
window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock),module.exports=function(a){a.initConfig({uglify:{my_target:{options:{sourceMap:!0,sourceMapName:"sourceMap.map"},files:{"tm.min.js":["*.js","edges/*.js","nodes/*.js","menu/*.js","menu/modal/*.js","simulation/*.js","server/*.js"],"select.min.js":["psets.js","util.js","server/server.js","server/mock.js"]}}}}),a.loadNpmTasks("grunt-contrib-uglify"),a.registerTask("default",["uglify"])};var gBehaviors={};gBehaviors.init=function(){gBehaviors.handlers={},gBehaviors.configure("edges",["mousedown","mousemove","mouseup","dblclick"]),gBehaviors.configure("nodes",["mousedown","drag","mouseover","mouseout","mouseup","dblclick"]),gBehaviors.configure("lowerNodes",["mousedown","mousemove","mouseover","mouseout"]),gBehaviors.configure("brush",["brushstart","brush"]),gBehaviors.configure("background",["dblclick","mousemove","mouseover","mouseup","mousedown"]),gBehaviors.configure("page",["keyup","keydown"])},gBehaviors.configure=function(a,b){gBehaviors.handlers[a]={},gBehaviors[a]={},b.forEach(function(b){gBehaviors.handlers[a][b]=[],gBehaviors[a][b]=function(c){gBehaviors.handlers[a][b].forEach(function(a){a.condition(c)&&a.action(c)})}})},gBehaviors.addBehavior=function(a,b,c,d){gBehaviors.handlers[a][b].push({condition:c,action:d})},gBehaviors.apply=function(a,b){for(var c in gBehaviors[a])"drag"===c?b.call(d3.behavior.drag().on("drag",gBehaviors[a][c]).on("dragstart",function(){gNodes.selectionX=0,gNodes.selectionY=0,gNodes.dragging=!0,gEdges.hideTempEdge()}).on("dragend",function(){gNodes.dragging=!1})):b.on(c,gBehaviors[a][c])};var gCookiesActive=!1;gGraph.initCookie=function(){gCookiesActive&&(gBehaviors.addBehavior("page","keydown",function(){return 76==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){for(var a="automata=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);0==d.indexOf(a)&&gGraph.load(JSON.parse(d.substring(a.length,d.length)))}gGraph.draw()}),gBehaviors.addBehavior("page","keydown",function(){return 83==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){var a="automata",b=JSON.stringify(gGraph.save()),c=new Date;c.setTime(c.getTime()+31536e6);var d="; expires="+c.toGMTString();document.cookie=a+"="+b+d+"; path=/"}))};var psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}],psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}];Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}(),gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock),module.exports=function(a){a.initConfig({uglify:{my_target:{options:{sourceMap:!0,sourceMapName:"sourceMap.map"},files:{"tm.min.js":["*.js","edges/*.js","nodes/*.js","menu/*.js","menu/modal/*.js","simulation/*.js","server/*.js"],"select.min.js":["psets.js","util.js","server/server.js","server/mock.js"]}}}}),a.loadNpmTasks("grunt-contrib-uglify"),a.registerTask("default",["uglify"])};var gBehaviors={};gBehaviors.init=function(){gBehaviors.handlers={},gBehaviors.configure("edges",["mousedown","mousemove","mouseup","dblclick"]),gBehaviors.configure("nodes",["mousedown","drag","mouseover","mouseout","mouseup","dblclick"]),gBehaviors.configure("lowerNodes",["mousedown","mousemove","mouseover","mouseout"]),gBehaviors.configure("brush",["brushstart","brush"]),gBehaviors.configure("background",["dblclick","mousemove","mouseover","mouseup","mousedown"]),gBehaviors.configure("page",["keyup","keydown"])},gBehaviors.configure=function(a,b){gBehaviors.handlers[a]={},gBehaviors[a]={},b.forEach(function(b){gBehaviors.handlers[a][b]=[],gBehaviors[a][b]=function(c){gBehaviors.handlers[a][b].forEach(function(a){a.condition(c)&&a.action(c)})}})},gBehaviors.addBehavior=function(a,b,c,d){gBehaviors.handlers[a][b].push({condition:c,action:d})},gBehaviors.apply=function(a,b){for(var c in gBehaviors[a])"drag"===c?b.call(d3.behavior.drag().on("drag",gBehaviors[a][c]).on("dragstart",function(){gNodes.selectionX=0,gNodes.selectionY=0,gNodes.dragging=!0,gEdges.hideTempEdge()}).on("dragend",function(){gNodes.dragging=!1})):b.on(c,gBehaviors[a][c])};var gCookiesActive=!1;gGraph.initCookie=function(){gCookiesActive&&(gBehaviors.addBehavior("page","keydown",function(){return 76==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){for(var a="automata=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);0==d.indexOf(a)&&gGraph.load(JSON.parse(d.substring(a.length,d.length)))}gGraph.draw()}),gBehaviors.addBehavior("page","keydown",function(){return 83==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){var a="automata",b=JSON.stringify(gGraph.save()),c=new Date;c.setTime(c.getTime()+31536e6);var d="; expires="+c.toGMTString();document.cookie=a+"="+b+d+"; path=/"}))};var psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}],psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}];Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}(),gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock),module.exports=function(a){a.initConfig({uglify:{my_target:{options:{sourceMap:!0,sourceMapName:"sourceMap.map"},files:{"tm.min.js":["*.js","edges/*.js","nodes/*.js","menu/*.js","menu/modal/*.js","simulation/*.js","server/*.js"],"select.min.js":["psets.js","util.js","server/server.js","server/mock.js"]}}}}),a.loadNpmTasks("grunt-contrib-uglify"),a.registerTask("default",["uglify"])};var gBehaviors={};gBehaviors.init=function(){gBehaviors.handlers={},gBehaviors.configure("edges",["mousedown","mousemove","mouseup","dblclick"]),gBehaviors.configure("nodes",["mousedown","drag","mouseover","mouseout","mouseup","dblclick"]),gBehaviors.configure("lowerNodes",["mousedown","mousemove","mouseover","mouseout"]),gBehaviors.configure("brush",["brushstart","brush"]),gBehaviors.configure("background",["dblclick","mousemove","mouseover","mouseup","mousedown"]),gBehaviors.configure("page",["keyup","keydown"])},gBehaviors.configure=function(a,b){gBehaviors.handlers[a]={},gBehaviors[a]={},b.forEach(function(b){gBehaviors.handlers[a][b]=[],gBehaviors[a][b]=function(c){gBehaviors.handlers[a][b].forEach(function(a){a.condition(c)&&a.action(c)})}})},gBehaviors.addBehavior=function(a,b,c,d){gBehaviors.handlers[a][b].push({condition:c,action:d})},gBehaviors.apply=function(a,b){for(var c in gBehaviors[a])"drag"===c?b.call(d3.behavior.drag().on("drag",gBehaviors[a][c]).on("dragstart",function(){gNodes.selectionX=0,gNodes.selectionY=0,gNodes.dragging=!0,gEdges.hideTempEdge()}).on("dragend",function(){gNodes.dragging=!1})):b.on(c,gBehaviors[a][c])};var gCookiesActive=!1;gGraph.initCookie=function(){gCookiesActive&&(gBehaviors.addBehavior("page","keydown",function(){return 76==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){for(var a="automata=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);0==d.indexOf(a)&&gGraph.load(JSON.parse(d.substring(a.length,d.length)))}gGraph.draw()}),gBehaviors.addBehavior("page","keydown",function(){return 83==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){var a="automata",b=JSON.stringify(gGraph.save()),c=new Date;c.setTime(c.getTime()+31536e6);var d="; expires="+c.toGMTString();document.cookie=a+"="+b+d+"; path=/"}))};var psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}],psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}];Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}(),gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock),module.exports=function(a){a.initConfig({uglify:{my_target:{options:{sourceMap:!0,sourceMapName:"sourceMap.map"},files:{"tm.min.js":["*.js"],"select.min.js":["psets.js","util.js","server/server.js","server/mock.js"]}}}}),a.loadNpmTasks("grunt-contrib-uglify"),a.registerTask("default",["uglify"])};var gBehaviors={};gBehaviors.init=function(){gBehaviors.handlers={},gBehaviors.configure("edges",["mousedown","mousemove","mouseup","dblclick"]),gBehaviors.configure("nodes",["mousedown","drag","mouseover","mouseout","mouseup","dblclick"]),gBehaviors.configure("lowerNodes",["mousedown","mousemove","mouseover","mouseout"]),gBehaviors.configure("brush",["brushstart","brush"]),gBehaviors.configure("background",["dblclick","mousemove","mouseover","mouseup","mousedown"]),gBehaviors.configure("page",["keyup","keydown"])},gBehaviors.configure=function(a,b){gBehaviors.handlers[a]={},gBehaviors[a]={},b.forEach(function(b){gBehaviors.handlers[a][b]=[],gBehaviors[a][b]=function(c){gBehaviors.handlers[a][b].forEach(function(a){a.condition(c)&&a.action(c)})}})},gBehaviors.addBehavior=function(a,b,c,d){gBehaviors.handlers[a][b].push({condition:c,action:d})},gBehaviors.apply=function(a,b){for(var c in gBehaviors[a])"drag"===c?b.call(d3.behavior.drag().on("drag",gBehaviors[a][c]).on("dragstart",function(){gNodes.selectionX=0,gNodes.selectionY=0,gNodes.dragging=!0,gEdges.hideTempEdge()}).on("dragend",function(){gNodes.dragging=!1})):b.on(c,gBehaviors[a][c])};var gCookiesActive=!1;gGraph.initCookie=function(){gCookiesActive&&(gBehaviors.addBehavior("page","keydown",function(){return 76==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){for(var a="automata=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);0==d.indexOf(a)&&gGraph.load(JSON.parse(d.substring(a.length,d.length)))}gGraph.draw()}),gBehaviors.addBehavior("page","keydown",function(){return 83==d3.event.keyCode&&"none"===d3.select(".overlay").style("display")},function(){var a="automata",b=JSON.stringify(gGraph.save()),c=new Date;c.setTime(c.getTime()+31536e6);var d="; expires="+c.toGMTString();document.cookie=a+"="+b+d+"; path=/"}))};var psets=[{name:"Problem Set 3",problems:[{name:"Problem 1: Bacon ipsum",charSet:"dy",type:"dfa"},{name:"Problem 2: Dolor amet",charSet:"dy",type:"dfa"},{name:"Problem 3: Flank meatloaf",charSet:"dy",type:"nfa"}]},{name:"Problem Set 4",problems:[{name:"Problem 1: Short loin",charSet:"abc",type:"dfa"},{name:"Problem 2: T-bone alcatra",charSet:"abc",type:"dfa"},{name:"Problem 3: Filet mignon",charSet:"abc",type:"dfa"},{name:"Problem 4: Beef leberkas",charSet:"01",type:"nfa"},{name:"Problem 5: Picanha ham",charSet:"01",type:"nfa"},{name:"Problem 6: Pig shoulder",charSet:"01",type:"nfa"}]},{name:"Problem Set 5",problems:[{name:"Problem 3: Chuck shank",charSet:"0123",type:"turing"},{name:"Problem 4: Chicken boudin",charSet:"0123",type:"turing"},{name:"Problem 5: Corned beef",charSet:"0123",type:"turing"}]}];Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}();Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}();gEdges.initDragging=function(){gEdges.dragging=!1,gEdges.startNode=null,gEdges.backupNode=null,gEdges.endNode=null;var a=function(){return!0};gBehaviors.addBehavior("lowerNodes","mouseover",function(){return!gNodes.dragging},gEdges.showTempEdge),gBehaviors.addBehavior("lowerNodes","mousemove",function(){return!gNodes.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("lowerNodes","mousedown",a,gEdges.startDragging),gBehaviors.addBehavior("background","mousedown",function(){if(null==gEdges.startNode)return!1;var a=d3.mouse(d3.select("svg").node()),b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b<=gNodes.SELECTABLE_RADIUS&&b>gNodes.RADIUS},gEdges.startDragging),gBehaviors.addBehavior("nodes","mouseover",function(){return!gEdges.dragging&&gEdges.tempVisible},gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseover",function(){return gEdges.dragging},gEdges.setTempEdgeEnd),gBehaviors.addBehavior("nodes","mouseout",a,gEdges.unsetTempEdgeEnd),gBehaviors.addBehavior("background","mousemove",function(){var a=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){var a=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("background","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mouseup",a,gEdges.hideTempEdge),
gBehaviors.addBehavior("background","mouseup",a,gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseup",function(){return gEdges.dragging},gEdges.addTempEdge)},gEdges.unsetTempEdgeEnd=function(a){null!=gEdges.endNode&&(gEdges.endNode=null,gGraph.draw())},gEdges.setTempEdgeEnd=function(a){gEdges.endNode=a,gGraph.draw()},gEdges.addTempEdge=function(a){gEdges.endNode=null,gEdges.backupNode=null,gEdges.hideTempEdge();var b=gEdges.getEdge(gEdges.startNode,a);null==b&&(gEdges.addEdge(gEdges.startNode,a),b=gEdges.edges[gEdges.edges.length-1]),gGraph.draw(),gEdges.editEdge(b)},gEdges.startDragging=function(){gEdges.dragging=!0},gEdges.hideTempEdge=function(){var a=d3.mouse(d3.select("svg").node()),b=gNodes.SELECTABLE_RADIUS+1;null!=gEdges.backupNode&&(b=Math.sqrt(Math.pow(a[0]-gEdges.backupNode.x,2)+Math.pow(a[1]-gEdges.backupNode.y,2))),null==gEdges.backupNode||b>gNodes.SELECTABLE_RADIUS?(d3.select("path.temp").remove(),gEdges.dragging=!1,gEdges.tempVisible=!1):(gEdges.startNode=gEdges.backupNode,gEdges.dragging=!1,gEdges.drawTempEdge())},gEdges.drawTempEdge=function(){if(null!=gEdges.startNode){if(gNodes.dragging)return d3.select("path.temp").remove(),gEdges.dragging=!1,void(gEdges.tempVisible=!1);var a=d3.mouse(d3.select("svg").node());d3.select("path.temp").remove(),gEdges.initialEdge=d3.select(".miscEdges").append("path").classed("temp",!0).style("marker-end","url(#mouse-arrow)").attr("fill","none").attr("d",function(){return null!=gEdges.endNode?gEdges.customPathFunction(gEdges.startNode,gEdges.endNode):gEdges.customPathFunction(gEdges.startNode,{x:a[0],y:a[1]})}).style("marker-end",function(){return null==gEdges.endNode?"url(#mouse-arrow)":"url(#end-arrow)"})}},gEdges.showTempEdge=function(a){gNodes.dragging||(gEdges.dragging?gEdges.backupNode=a:(gEdges.startNode=a,gEdges.tempVisible=!0,gEdges.drawTempEdge()))};var gEdges={BIDIRECTIONAL_OFFSET:8,LOOP_WIDTH:70,LOOP_HEIGHT:80,LOOP_PEAK:50,LOOP_TEXT_OFFSET:70,TEXT_OFFSET:10,TRANSITION_DY:20,TSPAN_HEIGHT:10,SELECTABLE_WIDTH:25,MARKER_SIZE:30,END_ARROW_OFFSET:36,MOUSE_ARROW_OFFSET:13};gEdges.init=function(){gEdges.lowerG=d3.select("g.edgesLower"),gEdges.upperG=d3.select("g.edges"),gEdges.straightLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),gEdges.curvedLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis"),gEdges.lineFunction=function(a){return a[0].x==a[1].x&&a[0].y==a[1].y?gEdges.curvedLineFunction([{x:a[0].x,y:a[0].y},{x:a[0].x+gEdges.LOOP_PEAK,y:a[0].y-gEdges.LOOP_HEIGHT/2},{x:a[0].x+gEdges.LOOP_WIDTH,y:a[0].y},{x:a[0].x+gEdges.LOOP_PEAK,y:a[0].y+gEdges.LOOP_HEIGHT/2},{x:a[0].x,y:a[0].y}]):gEdges.straightLineFunction(a)},gEdges.customPathFunction=function(a,b){var c={x:a.x,y:a.y},d={x:b.x,y:b.y};return b.id!=a.id&&gEdges.areConnected(b.id,a.id)&&(c=gEdges.offsetPoint(c,a,b,gEdges.BIDIRECTIONAL_OFFSET),d=gEdges.offsetPoint(d,a,b,gEdges.BIDIRECTIONAL_OFFSET)),gEdges.lineFunction([c,d])},gEdges.pathFunction=function(a){return gEdges.customPathFunction(a.source,a.target)},gEdges.buildMarker("end-arrow",gEdges.END_ARROW_OFFSET,"black"),gEdges.buildMarker("mouse-arrow",gEdges.MOUSE_ARROW_OFFSET,"black"),gEdges.edges=[],gEdges.edgeMap={},gEdges.initInitial(),gEdges.initSelection(),gEdges.initDragging(),gEdges.initEditing()},gEdges.addEdge=function(a,b){var c={};c.source=a,c.target=b,c.transitions=[[]],gEdges.edges.push(c),gEdges.edgeMap[a.id].push(b.id)},gEdges.removeEdge=function(a,b){gEdges.edges=gEdges.edges.filter(function(c){return c.source.id!=a.id||c.target.id!=b.id});var c=gEdges.edgeMap[a.id].indexOf(b.id);gEdges.edgeMap[a.id].splice(c,1)},gEdges.addNode=function(a){gEdges.edgeMap[a.id]=[]},gEdges.removeNode=function(a){gEdges.edges=gEdges.edges.filter(function(b){return b.source.id!=a.id&&b.target.id!=a.id});for(var b in gEdges.edgeMap){var c=gEdges.edgeMap[b].indexOf(a.id);gEdges.edgeMap[b].splice(c,1)}delete gEdges.edgeMap[a.id]},gEdges.save=function(){var a={edgeMap:JSON.parse(JSON.stringify(gEdges.edgeMap)),edges:JSON.parse(JSON.stringify(gEdges.edges))};return a.edges.forEach(function(a){a.source=a.source.id,a.target=a.target.id}),a},gEdges.load=function(a){gEdges.edges=a.edges,gEdges.edgeMap=a.edgeMap,gEdges.edges.forEach(function(a){a.source=gNodes.nodes[gNodes.getNodeIndex(a.source)],a.target=gNodes.nodes[gNodes.getNodeIndex(a.target)]})},gEdges.createDOMEdges=function(a,b){gBehaviors.apply("edges",a.append("path").attr("fill","none").classed("lower",!0).classed("transparent",!0)),b=b.append("g"),gBehaviors.apply("edges",b),b.append("path").attr("fill","none").classed("edge",!0),b.append("text")},gEdges.drawDOMEdges=function(a,b){a.attr("d",gEdges.pathFunction),b.select("path").attr("d",gEdges.pathFunction).classed("selected",function(a){return a.selected}).style("marker-end",function(a){return a.selected?"url(#sel-arrow)":"url(#end-arrow)"});var c=b.select("text").selectAll("tspan").data(function(a){return gGraph.mode==gGraph.TM?a.transitions[0]:a.transitions});c.enter().append("tspan"),c.text(gEdges.getEdgeLabel).attr("x",function(a,b,c){var d;return d3.select(this.parentNode).each(function(a,b){d=a}),gEdges.getTextPosition(d.source,d.target,this.parentNode.getBoundingClientRect()).x}).attr("dy",gEdges.TRANSITION_DY),b.select("text").attr("x",function(a){return gEdges.getTextPosition(a.source,a.target,this.getBoundingClientRect()).x}).attr("y",function(a){var b=d3.select(this).selectAll("tspan").size()-1;return gEdges.getTextPosition(a.source,a.target,this.getBoundingClientRect()).y+b*gEdges.TSPAN_HEIGHT}),c.exit().remove(),gEdges.drawInitial()},gEdges.destroyDOMEdges=function(a,b){a.remove(),b.remove()},gEdges.draw=function(){isIE&&(gEdges.lowerG.selectAll("path").remove(),gEdges.upperG.selectAll("g").remove());var a=gEdges.lowerG.selectAll("path").data(gEdges.edges,gEdges.getEdgeId),b=gEdges.upperG.selectAll("g").data(gEdges.edges,gEdges.getEdgeId);gEdges.createDOMEdges(a.enter(),b.enter()),gEdges.drawDOMEdges(a,b),gEdges.destroyDOMEdges(a.exit(),b.exit())},gEdges.areConnected=function(a,b){return null!=gEdges.endNode&&a==gEdges.startNode.id&&b==gEdges.endNode.id||gEdges.edgeMap[a]&&gEdges.edgeMap[a].indexOf(b)>-1},gEdges.getEdgeLabel=function(a){if(gGraph.mode==gGraph.TM){var b=" "==a.from?gSquare:a.from,c=" "==a.to?gSquare:a.to;return b+String.fromCharCode(8594)+c+", "+(1==a.direction?"R":"L")}return gEdges.reduceLabel(a)},gEdges.reduceLabel=function(a){var b=gGraph.charSet,c="";return b.length/2>=a.length?(a.forEach(function(a){c+=a+", "}),0!=c.length&&(c=c.substring(0,c.length-2))):(c=" - ",b.split("").forEach(function(b){-1==a.indexOf(b)&&(c+=b+", ")}),c=6!=c.length?c.substring(0,c.length-2):"",-1!=a.indexOf(gEpsilon)&&(c+=" + "+gEpsilon)),c},gEdges.getEdgeId=function(a){return a.source.id+" "+a.target.id},gEdges.getEdge=function(a,b){var c=null;return gEdges.edges.forEach(function(d){d.source.id==a.id&&d.target.id==b.id&&(c=d)}),c},gEdges.buildMarker=function(a,b,c){d3.select("svg").append("svg:defs").append("svg:marker").attr("id",a).attr("viewBox","0 -50 100 100").attr("refX",b).attr("markerWidth",gEdges.MARKER_SIZE).attr("markerHeight",gEdges.MARKER_SIZE).attr("orient","auto").append("svg:path").attr("d","M 0,-5 L 10,0 L 0,5 z").attr("fill",c).attr("stroke",c).style("pointer-events","none")},gEdges.getTextPosition=function(a,b,c){var d={x:a.x,y:a.y},e={x:b.x,y:b.y};b.id==a.id?(d.x+=gEdges.LOOP_TEXT_OFFSET,d.y-=1,e.x+=gEdges.LOOP_TEXT_OFFSET,e.y+=1):gEdges.areConnected(b.id,a.id)&&(d=gEdges.offsetPoint(d,a,b,gEdges.BIDIRECTIONAL_OFFSET),e=gEdges.offsetPoint(e,a,b,gEdges.BIDIRECTIONAL_OFFSET));var f={x:(d.x+e.x)/2,y:(d.y+e.y)/2},g=Math.bound(Math.atan2(d.y-e.y,d.x-e.x)+Math.PI/2,0,2*Math.PI),h=Math.sqrt(Math.pow(c.height/2,2)+Math.pow(c.width/2,2)),i=g>Math.PI?-1:1,j=g<3*Math.PI/2&&g>=Math.PI/2?-1:1,k=Math.bound(Math.atan2(i*c.height,j*c.width),0,2*Math.PI),l=Math.abs(k-g),m=Math.cos(l)*h;return m+=gEdges.TEXT_OFFSET,{x:f.x+Math.cos(g)*m,y:f.y-c.height+Math.sin(g)*m}},gEdges.offsetPoint=function(a,b,c,d){var e=Math.atan2(b.y-c.y,b.x-c.x),f=e+Math.PI/2;return{x:a.x+Math.cos(f)*d,y:a.y+Math.sin(f)*d}},gEdges.initEditing=function(){gEdges.editedEdge=null,gBehaviors.addBehavior("edges","dblclick",function(){return!0},gEdges.editEdge),d3.select(".edgeChars").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("edgeEntry")})},gEdges.populateTMEdgeModal=function(a){d3.select(".tmEdgeEntry").select(".modal-header").text("Edit Transition "+a.source.name+" "+String.fromCharCode(8594)+" "+a.target.name);for(var b=JSON.parse(JSON.stringify(gEdges.editedEdge.transitions[0])),c=0;c<b.length;c++)" "==b[c].from&&(b[c].from="")," "==b[c].to&&(b[c].to="");gModalMenu.tmEdge.setTmEdgeStates(b)},gEdges.populateEdgeModal=function(a){var b=a.transitions[0].join(""),c=b.length>0&&b[b.length-1]==gEpsilon;c&&(b=b.substring(0,b.length-1)),gModalMenu.setEdgeChars(b),gModalMenu.setEpsilon(c)},gEdges.editEdge=function(a){gEdges.editedEdge=a,gGraph.mode==gGraph.TM?(gEdges.populateTMEdgeModal(a),gModalMenu.open("tmEdgeEntry")):(gEdges.populateEdgeModal(a),gModalMenu.open("edgeEntry")),gModalMenu.open(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),d3.event.stopPropagation()},gEdges.editCancelled=function(){0==gEdges.editedEdge.transitions[0].length&&gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.deleteEditedEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.tmEditComplete=function(){for(var a=gModalMenu.tmEdge.getTmEdgeStates(),b="",c=!1,d=0;d<a.length;d++){if(""==a[d].to&&(a[d].to=" "),""==a[d].from){if(a[d].from=" ",c)return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for blank");c=!0}else if(-1!=b.indexOf(a[d].from))return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for character "+a[d].from);if(b+=a[d].from,1!=intersection(a[d].to,gGraph.tapeSet).length||1!=intersection(a[d].from,gGraph.tapeSet).length)return void gErrorMenu.displayModalError("tmEdgeEntry","Please only use characters in the character set")}if(0==a.length)return void gErrorMenu.displayModalError("tmEdgeEntry","You must define at least one transition");for(var d=0;d<gEdges.edges.length;d++){var e=gEdges.edges[d];if(e.source.id==gEdges.editedEdge.source.id&&e.target.id!=gEdges.editedEdge.target.id){for(var f=0;f<a.length;f++)for(var g=0;g<e.transitions[0].length;g++)a[f].from==e.transitions[0][g].from&&e.transitions[0].splice(g--,1);0==e.transitions[0].length&&gEdges.removeEdge(e.source,e.target)}}gEdges.editedEdge.transitions[0]=a,gEdges.editedEdge=null,gModalMenu.close("tmEdgeEntry"),gGraph.draw(),gGraph.draw()},gEdges.editComplete=function(){var a=removeDuplicates(gModalMenu.getEdgeCharacters().replace(/[\s,]/g,"")),b=intersection(gGraph.charSet,a),c=a;if(a=b,gModalMenu.setEdgeChars(b),a+=gModalMenu.getEpsilon()?gEpsilon:"",b.length!=c.length&&(0==a.length?gErrorMenu.displayModalError("edgeEntry","Ignoring characters that aren't in the alphabet."):gErrorMenu.displayError("Ignoring characters that aren't in the alphabet.")),0==a.length)return void gErrorMenu.displayModalError("edgeEntry","Transitions must take at least one character");var d=a.split("");d.sort();for(var e=0;e<d.length-1;e++)d[e]==d[e+1]&&d.splice(e--,1);if(gGraph.mode==gGraph.DFA){var f=!1;d.forEach(function(a){for(var b=0;b<gEdges.edges.length;b++){var c=gEdges.edges[b];if(c!=gEdges.editedEdge&&c.source==gEdges.editedEdge.source){var d=c.transitions[0].indexOf(a);-1!=d&&(c.transitions[0].splice(d,1),0==c.transitions[0].length&&(gEdges.removeEdge(c.source,c.target),b--,f=!0))}}}),f&&gErrorMenu.displayError("Removed duplicate transitions")}gEdges.editedEdge.transitions[0]=d,gEdges.editedEdge=null,gModalMenu.close("edgeEntry"),gGraph.draw()},gEdges.INITIAL_EDGE_LENGTH=60,gEdges.INITIAL_OVERLAP_RANGE=7,gEdges.INITIAL_OVERLAP_ANGLE=20,gEdges.initInitial=function(){d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none")},gEdges.drawInitial=function(){var a=gNodes.initial;if(null==a)d3.select("path.initial").style("opacity",0);else{var b=0,c=gEdges.INITIAL_EDGE_LENGTH;gEdges.edges.forEach(function(d){var e=Math.min(d.source.x,d.target.x),f=Math.max(d.source.x,d.target.x);if(a.x<=f&&a.x-gEdges.INITIAL_EDGE_LENGTH>=e&&d.target.x-d.source.x!=0){var g=(d.target.y-d.source.y)/(d.target.x-d.source.x),h=d.source.y-g*d.source.x,i=g*(a.x-gEdges.INITIAL_EDGE_LENGTH)+h,j=g*a.x+h;Math.abs(i-a.y)<=gEdges.INITIAL_OVERLAP_RANGE&&Math.abs(j-a.y)<=gEdges.INITIAL_OVERLAP_RANGE&&(c=Math.cos(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,b=Math.sin(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,j>i&&(b*=-1))}}),d3.select("path.initial").style("opacity",1).attr("d",function(){return gEdges.lineFunction([{x:a.x-c,y:a.y-b},{x:a.x,y:a.y}])})}},isIE&&(gEdges.initInitial=function(){},gEdges.drawInitial=function(){d3.select("path.initial").remove();var a=gNodes.initial;null!=a&&d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none").attr("d",function(){return gEdges.lineFunction([{x:a.x-gEdges.INITIAL_EDGE_LENGTH,y:a.y},{x:a.x,y:a.y}])})}),gEdges.SELECTED_COLOR="blue",gEdges.initSelection=function(){gEdges.buildMarker("sel-arrow",gEdges.END_ARROW_OFFSET,gEdges.SELECTED_COLOR),gBehaviors.addBehavior("edges","mousedown",function(){return!0},function(a){gShiftKey||a.selected||(gNodes.deselectAll(),gEdges.deselectAll()),a.selected=!0,gGraph.draw()})},gEdges.deleteSelected=function(){var a=[];gEdges.edges.forEach(function(b){b.selected&&a.push(b)}),a.forEach(function(a){gEdges.removeEdge(a.source,a.target)})},gEdges.deselectAll=function(){gEdges.edges.forEach(function(a){a.selected=!1})},gEdges.selectionIsEmpty=function(){return 0==gEdges.selectionSize()},gEdges.selectionSize=function(){return gEdges.edges.filter(function(a){return a.selected}).length},gNodes.doubleClickInit=function(){gBehaviors.addBehavior("background","dblclick",function(){return!gTableTopMenu.active},function(){var a=d3.mouse(d3.select("svg").node());gNodes.addNode(a[0],a[1]),gNodes.draw()})},gNodes.editInit=function(){gNodes.editedNode=null,gBehaviors.addBehavior("nodes","dblclick",function(){return!0},gNodes.editNode),d3.select(".nodeName").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("nodeEntry")})},gNodes.editNode=function(a){gNodes.editedNode=a,gModalMenu.setNodeName(a.name),gModalMenu.setInitial(null!=gNodes.initial&&a.id==gNodes.initial.id),gModalMenu.setState(a.accept,a.reject),gModalMenu.open("nodeEntry"),d3.event.stopPropagation()},gNodes.editComplete=function(){var a=gModalMenu.getNodeName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayModalError("nodeEntry","State name cannot be blank.");var b=gNodes.getNodeIndexFromName(a);-1==b||gNodes.nodes[b].id==gNodes.editedNode.id?(gNodes.editedNode.accept=gModalMenu.getAccepting(),gNodes.editedNode.reject=gModalMenu.getRejecting(),gModalMenu.getInitial()?gNodes.initial=gNodes.editedNode:null!=gNodes.initial&&gNodes.editedNode.id==gNodes.initial.id&&(gNodes.initial=null),gNodes.editedNode.name=a,gNodes.editedNode=null,gModalMenu.close("nodeEntry"),gGraph.draw()):gErrorMenu.displayModalError("nodeEntry",'State name "'+a+'" is already in use.')},gNodes.deleteEdited=function(){if(null!=gTape.follow&&gTape.follow.id==gNodes.editedNode.id){if(!gTape.done)return void gErrorMenu.displayModalError("nodeEntry","The current state in a running test cannot be deleted");gTestMenu.end()}gNodes.removeByIndex(gNodes.getNodeIndex(gNodes.editedNode.id)),gModalMenu.close("nodeEntry"),gGraph.draw()},gNodes.FORCE_LAYOUT_ITERATIONS=1e5,gNodes.forcedDirectedLayout=function(){var a=[];gNodes.nodes.forEach(function(b){a.push({x:b.x,y:b.y,vx:0,vy:0})});var b=[];gEdges.edges.forEach(function(a){b.push({source:gNodes.getNodeIndex(a.source.id),target:gNodes.getNodeIndex(a.target.id)})});var c=d3.layout.force().nodes(a).links(b).linkDistance(200).charge(-300).gravity(.01).size([gGraph.width-2*gGraph.BUFFER,gGraph.height-2*gGraph.BUFFER]);c.start();for(var d=0;d<gNodes.FORCE_LAYOUT_ITERATIONS;d++)c.tick();c.stop();for(var d=0;d<a.length;d++)gNodes.nodes[d].x=a[d].x,gNodes.nodes[d].y=a[d].y;gNodes.scale()},gNodes.moveSelected=function(a,b){a+=gNodes.selectionX,b+=gNodes.selectionY,gNodes.selectionX=0,gNodes.selectionY=0;var c=function(a){return a.selected},d=function(a){return a.source.selected||a.target.selected};if(gNodes.validMoveX(a)?gNodes.nodes.filter(c).forEach(function(b){b.x+=a}):gNodes.selectionX+=a,gNodes.validMoveY(b)?gNodes.nodes.filter(c).forEach(function(a){a.y+=b}):gNodes.selectionY+=b,isIE)gGraph.draw();else{var e=d3.select("g.nodes").selectAll("g").filter(c),f=d3.select("g.nodesLower").selectAll("circle").filter(c);gNodes.drawDOMNodes(f,e),e=d3.select("g.edges").selectAll("g").filter(d),f=d3.select("g.edgesLower").selectAll("path").filter(d),gEdges.drawDOMEdges(f,e),gEdges.drawInitial(),gTape.draw()}},gNodes.movementInit=function(){gBehaviors.addBehavior("nodes","drag",function(a){return a.selected},function(a){gNodes.moveSelected(d3.event.dx,d3.event.dy)})};var gNodes={SELECTABLE_RADIUS:50,RADIUS:30,INNER_RADIUS:24,STROKE_WIDTH:2,NEW_BUFFER:100,NEW_INCREMENT:100,IE_TEXT_OFFSET:5};gNodes.init=function(){gNodes.lowerG=d3.select("g.nodesLower"),gNodes.upperG=d3.select("g.nodes"),gNodes.nodes=[],gNodes.initial=null,gNodes.selectionInit(),gNodes.movementInit(),gNodes.doubleClickInit(),gNodes.editInit()},gNodes.setInitial=function(){var a=gNodes.nodes.filter(function(a){return a.selected});a.length>0&&(gNodes.initial=a[0])},gNodes.setAccepting=function(a){gNodes.nodes.filter(function(a){return a.selected}).forEach(function(b){b.accept=a})},gNodes.setRejecting=function(a){gNodes.nodes.filter(function(a){return a.selected}).forEach(function(b){b.reject=a})},gNodes.wouldOverlap=function(a,b){var c=!1;return gNodes.nodes.forEach(function(d){c|=dist(a,b,d.x,d.y)<=2*gNodes.RADIUS}),c},gNodes.addNode=function(a,b){var c={};if("undefined"==typeof a){var d=!1;for(c.y=gNodes.NEW_BUFFER;c.y<=gGraph.height-gNodes.NEW_BUFFER&&!d;c.y+=gNodes.NEW_INCREMENT)for(c.x=gNodes.NEW_BUFFER;c.x<=gGraph.width-gNodes.NEW_BUFFER&&!d;c.x+=gNodes.NEW_INCREMENT)d=!gNodes.wouldOverlap(c.x,c.y);c.x-=gNodes.NEW_INCREMENT,c.y-=gNodes.NEW_INCREMENT}else c.x=a,c.y=b;for(var e=0;-1!=gNodes.getNodeIndexFromName("n"+e);)e++;c.id=e,c.name="n"+c.id,c.accept=!1,c.reject=!1,c.selected=!0,gNodes.deselectAll(),gNodes.nodes.push(c),gEdges.addNode(c)},gNodes.setInitialByIndex=function(a){gNodes.initial=gNodes.nodes[a]},gNodes.clearInitial=function(){gNodes.initial=null},gNodes.setAcceptByIndex=function(a,b){gNodes.nodes[a].accept=b},gNodes.setRejectByIndex=function(a,b){gNodes.nodes[a].reject=b},gNodes.removeByIndex=function(a){null!=gTape.follow&&gTape.follow.id==gNodes.nodes[a].id&&gTestMenu.end(),null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[a].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[a]),gNodes.nodes.splice(a,1)},gNodes.removeNodes=function(){if(null!=gTape.follow&&gTape.follow.selected){if(!gTape.done)return gErrorMenu.displayError("The current state in a running test cannot be deleted"),!1;gTestMenu.end()}for(var a=0;a<gNodes.nodes.length;a++)gNodes.nodes[a].selected&&(null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[a].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[a]),gNodes.nodes.splice(a--,1));return!0},gNodes.createDOMNodes=function(a,b){gBehaviors.apply("lowerNodes",a.append("circle").classed("transparent",!0).attr("r",gNodes.SELECTABLE_RADIUS)),b=b.append("g"),gBehaviors.apply("nodes",b.append("circle").classed("outer",!0).attr("r",gNodes.RADIUS)),gBehaviors.apply("nodes",b.append("circle").classed("inner",!0).attr("r",gNodes.INNER_RADIUS)),b.append("text")},gNodes.getSelected=function(){var a=[];return gNodes.nodes.forEach(function(b){b.selected&&a.push(b.name)}),a},gNodes.save=function(){return{nodes:gNodes.nodes,initial:null==gNodes.initial?null:gNodes.initial.id}},gNodes.load=function(a){gNodes.nodes=a.nodes,gNodes.initial=a.initial,null!=gNodes.initial&&(gNodes.initial=gNodes.nodes[gNodes.getNodeIndex(gNodes.initial)]),gNodes.nextId=0,gNodes.nodes.forEach(function(a){gNodes.nextId=Math.max(a.id+1,gNodes.nextId)}),gNodes.scale()},gNodes.scale=function(){if(gNodes.nodes.length>0){for(var a=gNodes.nodes[0].x,b=gNodes.nodes[0].x,c=gNodes.nodes[0].y,d=gNodes.nodes[0].y,e=1;e<gNodes.nodes.length;e++)a=Math.min(a,gNodes.nodes[e].x),b=Math.max(b,gNodes.nodes[e].x),c=Math.min(c,gNodes.nodes[e].y),d=Math.max(d,gNodes.nodes[e].y);var f=a,g=b;(gGraph.BUFFER>a||gGraph.width-gGraph.BUFFER<b)&&(f=gGraph.BUFFER,g=gGraph.width-gGraph.BUFFER);var h=c,i=d;(gGraph.BUFFER>c||gGraph.height-gGraph.BUFFER<d)&&(h=gGraph.BUFFER,i=gGraph.height-gGraph.BUFFER);for(var e=0;e<gNodes.nodes.length;e++){var j=b-a,k=0==j?1:(gNodes.nodes[e].x-a)/j,l=d-c,m=0==l?1:(gNodes.nodes[e].y-c)/l;gNodes.nodes[e].x=f*(1-k)+g*k,gNodes.nodes[e].y=h*(1-m)+i*m}}},gNodes.selectionIsAccepting=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,c.selected&&!c.accept&&(a=!1))}),a&&b},gNodes.selectionIsRejecting=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,c.selected&&!c.reject&&(a=!1))}),a&&b},gNodes.selectionIsNeither=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,(c.accept||c.reject)&&(a=!1))}),a&&b},gNodes.drawDOMNodes=function(a,b){a.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.classed("selected",function(a){return a.selected}).classed("accept",function(a){return a.accept}).classed("reject",function(a){return a.reject}),b.select("circle.inner").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.select("circle.outer").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.select("text").text(function(a){return a.name}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y+(isIE?gNodes.IE_TEXT_OFFSET:0)})},gNodes.destroyDOMNodes=function(a,b){a.remove(),b.remove()},gNodes.draw=function(){if(isIE&&(gNodes.lowerG.selectAll("circle").remove(),gNodes.upperG.selectAll("g").remove()),gNodes.upperG.select(".empty-text").remove(),0==gNodes.nodes.length){var a=isSafari?"Click Add New State to create your first node.":"Double-click to create your first node.";gNodes.upperG.append("text").classed("empty-text",!0).style("font-size",20).style("font-family",'"San Francisco", "Helvetica Neue", "Helvetica", "Arial", sans-serif').style("fill","rgba(0, 0, 0, 0.4)").style("stroke","none").attr("x",gGraph.width/2).attr("y",gGraph.height/2).text(a)}var b=gNodes.lowerG.selectAll("circle").data(gNodes.nodes,function(a){return a.id}),c=gNodes.upperG.selectAll("g").data(gNodes.nodes,function(a){return a.id});gNodes.createDOMNodes(b.enter(),c.enter()),gNodes.drawDOMNodes(b,c),gNodes.destroyDOMNodes(b.exit(),c.exit())},gNodes.validMoveX=function(a){var b=!0;return gNodes.nodes.filter(function(a){return a.selected}).forEach(function(c){b&=c.x+a>=gNodes.RADIUS+gNodes.STROKE_WIDTH||a>=0,b&=c.x+a<=gGraph.width-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=a}),b},gNodes.validMoveY=function(a){var b=!0;return gNodes.nodes.filter(function(a){return a.selected}).forEach(function(c){b&=c.y+a>=gNodes.RADIUS+gNodes.STROKE_WIDTH||a>=0,b&=c.y+a<=gGraph.height-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=a}),b},gNodes.getNodeIndex=function(a){var b=-1;return gNodes.nodes.forEach(function(c,d){c.id==a&&(b=d)}),b},gNodes.getNodeIndexFromName=function(a){var b=-1;return gNodes.nodes.forEach(function(c,d){c.name===a&&(b=d)}),b},gNodes.select=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected=!0},gNodes.deselect=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected=!1},gNodes.toggleSelection=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected^=!0},gNodes.deselectAll=function(){gNodes.nodes.forEach(function(a){a.selected=!1})},gNodes.selectionIsEmpty=function(){return 0==gNodes.selectionSize()},gNodes.selectionSize=function(){return gNodes.nodes.filter(function(a){return a.selected}).length},gNodes.selectionInit=function(){gBehaviors.addBehavior("nodes","mousedown",function(){return!0},function(a){gShiftKey||a.selected||(gNodes.deselectAll(),gEdges.deselectAll()),a.selected=!0,gGraph.draw()}),gBehaviors.addBehavior("brush","brushstart",function(){return!0},function(){gNodes.nodes.forEach(function(a){a.previouslySelected=gShiftKey&&a.selected}),gEdges.deselectAll()}),gBehaviors.addBehavior("brush","brush",function(){return!0},function(){var a=d3.event.target.extent();gNodes.nodes.forEach(function(b){b.selected=b.previouslySelected^(a[0][0]<=b.x&&b.x<a[1][0]&&a[0][1]<=b.y&&b.y<a[1][1])}),gGraph.draw()})},gNodes.GRID_SPACING=150,gNodes.snapToGrid=function(){for(var a=[],b=gNodes.GRID_SPACING;b<=gGraph.width-gNodes.GRID_SPACING;b+=gNodes.GRID_SPACING)for(var c=gNodes.GRID_SPACING;c<=gGraph.height-gNodes.GRID_SPACING;c+=gNodes.GRID_SPACING)a.push({x:b,y:c});var d=[],e=-1;if(gNodes.nodes.forEach(function(a,b){null!=gNodes.initial&&gNodes.initial.id==a.id&&(e=b),d.push({x:a.x,y:a.y,i:b})}),!(a.length<d.length))for(;d.length>0&&a.length>0;){for(var f=-1,g=-1,h=-1,i=0;i<d.length;i++)for(var j=0;j<a.length;j++){var k=Math.pow(d[i].x-a[j].x,2)+Math.pow(d[i].y-a[j].y,2);(-1==h||f>k)&&(g=j,h=i,f=k)}gNodes.nodes[d[h].i].x=a[g].x,gNodes.nodes[d[h].i].y=a[g].y,d.splice(h,1),a.splice(g,1)}};var gErrorMenu={DISPLAY_TIME:2100,FADE_OUT_TIME:400,MAX_ERRORS:3};gErrorMenu.displayMessage=function(a,b,c){var d=d3.select(".errors").append("span").text(a).classed(c,!0);1!=b&&d.transition().delay(gErrorMenu.DISPLAY_TIME).duration(gErrorMenu.FADE_OUT_TIME).ease("cubic").style("opacity",0).remove();var e=d3.select(".errors").selectAll("span").size();d3.select(".errors").selectAll("span").filter(function(a,b){return b<e-gErrorMenu.MAX_ERRORS}).remove()},gErrorMenu.displayError=function(a,b){gErrorMenu.displayMessage(a,b,"error")},gErrorMenu.displayModalError=function(a,b){d3.select("."+a).select(".modal-content").insert("p",":first-child").classed("modal-description",!0).classed("error",!0).text(b)},gErrorMenu.clearModalErrors=function(){d3.selectAll(".modal-description.error").remove()};var gTableMenu={};gTableMenu.updateAll=function(){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split(""),gEdges.edges=[];var b=[];gNodes.nodes.forEach(function(a){gEdges.edgeMap[a.id]=[];var c=[];gNodes.nodes.forEach(function(){c.push(gGraph.mode==gGraph.TM?{}:"")}),b.push(c)});var c=!1,d=!1,e=!1;d3.selectAll("input.gridInput").each(function(a,f){var g=f%2==0||gGraph.mode!=gGraph.TM,h=this.character,i=this.i1;if(g){var j=this.value.split(/[ \t\n\r,]/),k=!1;j.forEach(function(a){var e=gNodes.getNodeIndexFromName(a);-1!=e?(k&&gGraph.mode!=gGraph.NFA?c=!0:gGraph.mode==gGraph.TM?b[i][e][h]={from:h}:b[i][e]+=h,k=!0):""!=a&&(d=!0)})}else{var l=this.value;if(intersection(l,gGraph.tapeSet).length!=l.length)return void(e=!0);var m=-1;for(var n in b[i])if(void 0!=b[i][n][h]){m=n;break}-1!=m&&void 0!=b[i][m][h]&&(b[i][m][h].to=""==l?" ":l)}}),d3.selectAll(".moveRight").each(function(){var a=this.character,c=this.i1,d=this.checked?1:-1,e=-1;for(var f in b[c])if(void 0!=b[c][f][a]){e=f;break}-1!=e&&void 0!=b[c][e][a]&&(b[c][e][a].direction=d)}),c&&gErrorMenu.displayError("Multiple transitions defined for one character, ignoring extras"),d&&gErrorMenu.displayError("Some states entered in the table could not be found, ignoring them"),e&&gErrorMenu.displayError("Some characters were not in the tape language"),b.forEach(function(a,b){a.forEach(function(a,c){var d=[];if(gGraph.mode==gGraph.TM)for(var e in a)d.push(a[e]);if(""!=a&&(gGraph.mode!=gGraph.TM||0!=d.length)){var f=gEdges.getEdge(gNodes.nodes[b],gNodes.nodes[c]);null==f&&(gEdges.addEdge(gNodes.nodes[b],gNodes.nodes[c]),f=gEdges.edges[gEdges.edges.length-1]),-1==gEdges.edgeMap[gNodes.nodes[b].id].indexOf(gNodes.nodes[c].id)&&gEdges.edgeMap[gNodes.nodes[b].id].push(gNodes.nodes[c].id),gGraph.mode==gGraph.TM?f.transitions[0]=d:f.transitions[0]=a.split("").sort()}})})},gTableMenu.init=function(){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split("");var b=d3.select(".tableEditor").insert("tr").selectAll("td").data(a);b.enter().append("td"),b.text(function(a){return" "==a&&gGraph.mode==gGraph.TM?gSquare:a}),b.exit().remove();var c=d3.select(".tableEditor").select("tr");c.insert("td","td").text("Rejects"),c.insert("td","td").text("Accepts"),c.insert("td","td").text("Initial"),c.insert("td","td").text(""),c.append("td").text("Delete")},gTableMenu.draw=function(){if(gTableTopMenu.active){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split("");var b=d3.select(".tableEditor").selectAll("tr").filter(function(a,b){return 0!=b}).data(gNodes.nodes),c=b.enter().append("tr");c.append("td").text(function(a){return a.name}),c.append("td").append("input").attr("type","radio").classed("initialBox",!0).each(function(a){this.checked=null!=gNodes.initial&&gNodes.initial.id==a.id}).on("change",function(a,b){this.checked?gNodes.setInitialByIndex(b):gNodes.clearInitial(),gGraph.draw()}),c.append("td").append("input").attr("type","checkbox").classed("acceptBox",!0).on("change",function(a,b){gNodes.setAcceptByIndex(b,this.checked),this.checked&&gNodes.setRejectByIndex(b,!1),gGraph.draw()}),c.append("td").append("input").attr("type","checkbox").classed("rejectBox",!0).on("change",function(a,b){gNodes.setRejectByIndex(b,this.checked),this.checked&&gNodes.setAcceptByIndex(b,!1),gGraph.draw()}),d3.selectAll(".acceptBox").each(function(a,b){this.checked=gNodes.nodes[b].accept}),d3.selectAll(".rejectBox").each(function(a,b){this.checked=gNodes.nodes[b].reject});var d=b.selectAll("td").filter(function(){return null!=d3.select(this).select("input").filter(function(){return"text"==this.type}).node()}).data(a),e=d.enter().append("td").classed("tm-cell",gGraph.mode==gGraph.TM).each(function(){gGraph.mode==gGraph.TM&&d3.select(this).style("line-height","30px")});e.append("input").attr("type","text").attr("size","10").attr("placeholder","go to").classed("gridInput",!0).each(function(a,b,c){this.character=a,this.i1=c}),e.append("input").attr("type","text").attr("size","10").attr("maxlength","1").attr("placeholder","write").classed("gridInput",!0).each(function(a,b,c){this.character=a,this.i1=c}),e.append("br");var f=e.append("form");f.append("label").text("move:"),f.append("input").attr("type","radio").attr("name","move").attr("checked",!0).classed("moveLeft",!0).each(function(a,b,c){this.character=a,this.i1=c}),f.append("label").text("L"),f.append("input").attr("type","radio").attr("name","move").classed("moveRight",!0).each(function(a,b,c){this.character=a,this.i1=c}),f.append("label").text("R"),d.selectAll("input").each(function(a,b){switch(b){case 0:this.value=gTableMenu.getConnections(gNodes.nodes[this.i1].id,a);break;case 1:var c=gTableMenu.getResult(gNodes.nodes[this.i1].id,a);null!=c&&(this.value=c);break;case 2:var d=gTableMenu.getDirection(gNodes.nodes[this.i1].id,a);0!=d&&(this.checked=-1==d);break;case 3:var d=gTableMenu.getDirection(gNodes.nodes[this.i1].id,a);0!=d&&(this.checked=1==d)}}).on("blur",function(){gTableMenu.updateAll(),gTableMenu.draw()}),d.exit().remove(),c.append("td").append("button").on("click",function(a,b){gNodes.removeByIndex(b),gGraph.draw()}).text("X"),b.exit().remove()}},gTableMenu.getConnections=function(a,b){var c=[];return gEdges.edges.forEach(function(d){gGraph.mode==gGraph.TM?d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&c.push(d.target.name)}):d.source.id==a&&-1!=d.transitions[0].indexOf(b)&&c.push(d.target.name);
}),c.join(", ")},gTableMenu.getDirection=function(a,b){var c=0;return gEdges.edges.forEach(function(d){d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&(c=e.direction)})}),c},gTableMenu.getResult=function(a,b){var c=null;return gEdges.edges.forEach(function(d){d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&(c=" "==e.to?"":e.to)})}),c};var gTableTopMenu={active:!1};gTableTopMenu.swap=function(){gTableTopMenu.active?(d3.select("svg").style("display","inline"),d3.select(".tableEditor, .tableEditorHeader").style("display","none"),d3.selectAll(".nontable").style("display","inline"),d3.selectAll(".nontableblock").style("display","block"),d3.select(".swapButton").text("Switch to Table View"),gTableTopMenu.active=!1,gTableMenu.updateAll()):(d3.select("svg").style("display","none"),d3.select(".tableEditor, .tableEditorHeader").style("display","table"),d3.selectAll(".nontable, .nontableblock").style("display","none"),d3.select(".swapButton").text("Switch to Editor View"),gNodes.deselectAll(),gEdges.deselectAll(),gTableTopMenu.active=!0),gGraph.mode==gGraph.DFA?d3.selectAll(".dfa-hide").style("display","none"):gGraph.mode==gGraph.NFA?d3.selectAll(".nfa-hide").style("display","none"):d3.selectAll(".tm-hide").style("display","none"),gGraph.draw()};var gTestMenu={NUM_CELLS:250,DISPLAY_TIME:4600,FADE_OUT_TIME:400};gTestMenu.init=function(){gTestMenu.reset(),gTestMenu.text="",gTestMenu.backupText="";for(var a=d3.select(".tape-field"),b=0;b<gTestMenu.NUM_CELLS;b++)a.append("input").attr("type","text").classed("tape-char",!0).attr("name","tapeChar[]").attr("maxlength",1).attr("readonly","readonly").on("click",gTestMenu.allowInput);d3.select(".tape-char-input").attr("maxlength",gTestMenu.NUM_CELLS).on("keydown",function(){13==d3.event.keyCode&&(gTestMenu.disallowInput(),gTestMenu.run())}),gTestMenu.disallowInput()},gTestMenu.reset=function(){gTestMenu.setRunning(!1),d3.select(".tape-char-input").node().value=gTestMenu.backupText||"",d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.reset()},gTestMenu.allowInput=function(){gTestMenu.reset(),d3.select(".tape-char-input").node().value=gTestMenu.backupText,d3.selectAll(".tape-char").style("display","none"),d3.select(".tape-char-input").style("display","inline").each(function(){this.focus()})},gTestMenu.disallowInput=function(a){if(gTestMenu.backupText!=intersection(d3.select(".tape-char-input").node().value,gGraph.charSet)){gTestMenu.backupText=d3.select(".tape-char-input").node().value;var b=intersection(gTestMenu.backupText,gGraph.charSet);gTestMenu.backupText.length!=b.length&&gErrorMenu.displayError("Removing characters that aren't in the alphabet."),gTestMenu.backupText=b}gTestMenu.text=void 0==a?gTestMenu.backupText:a,d3.selectAll(".tape-char").style("display","inline").each(function(a,b){this.value=b<gTestMenu.text.length?gTestMenu.text[b]:""}),d3.select(".tape-char-input").style("display","none")},gTestMenu.unsetTransitions=function(){var a=[];if(gGraph.mode==gGraph.DFA){var b=gGraph.save(),c=gSimulator.convert(b);for(var d in c){var e=!1;for(var f in c[d])e|=0==c[d][f].length;e&&a.push(gNodes.nodes[gNodes.getNodeIndex(d)].name)}}return a},gTestMenu.runTests=function(){var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=a.length?gErrorMenu.displayError("The following states have undefined transitions: "+a.join(", ")):gModalMenu.open("testing")},gTestMenu.setRunning=function(a){a?(d3.selectAll(".running").style("display","inline"),d3.select(".runButton").text("Restart")):(d3.selectAll(".running").style("display","none"),d3.select(".runButton").text("Start"))},gTestMenu.run=function(){gTestMenu.reset();var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=a.length?gErrorMenu.displayError("The following states have undefined transitions: "+a.join(", ")):(gTestMenu.setRunning(!0),gTape.show(),gTape.run())},gTestMenu.end=function(){gTestMenu.setRunning(!1),d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.hide()},gTestMenu.step=function(){var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("No initial node is set"):0!=a.length?gErrorMenu.displayError("The following nodes have undefined transitions: "+a.join(", ")):(gTape.show(),gTape.step())};var gTopMenu={MAX_DISPLAYED_STATES:5,SELECTED_TEXT:"Selected states: "};gTopMenu.addNode=function(){gNodes.addNode(),gGraph.draw()},gTopMenu.setState=function(a,b){gNodes.selectionIsEmpty()&&gErrorMenu.displayError("No states are selected"),gNodes.setAccepting(a),gNodes.setRejecting(b),gGraph.draw()},gTopMenu.deleteSelected=function(){gNodes.selectionIsEmpty()&&gEdges.selectionIsEmpty()&&(gErrorMenu.displayError("No states or transitions are selected"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3)),gNodes.removeNodes()&&(gEdges.deleteSelected(),gGraph.draw())},gTopMenu.setInitial=function(){gNodes.selectionIsEmpty()?gErrorMenu.displayError("No states are selected"):gNodes.selectionSize()>1&&gErrorMenu.displayError("Multiple states are selected. Using the first one."),gNodes.setInitial(),gGraph.draw()},gTopMenu.snapToGrid=function(){gNodes.snapToGrid(),gGraph.draw()},gTopMenu.forcedDirectedLayout=function(){gNodes.forcedDirectedLayout(),gGraph.draw()},gTopMenu.loadFromServer=function(){gModalMenu.open("load"),gModalMenu.load.onOpen()},gTopMenu.save=function(){var a=2e3,b=gServer.name;gTopMenu.setSaveButton("Saving..."),!gModalMenu.saveas.isInvalidName(b)&&b?gServer.save(b,function(b,c){b?(gTopMenu.setSaveButton("Failed"),gErrorMenu.displayError("Save failed: couldn't connect to server.")):gTopMenu.setSaveButton("Saved!"),setTimeout(function(){gTopMenu.setSaveButton("Save")},a)}):b?(gErrorMenu.displayError('Saving to invalid name, use "Save As" to change name'),gTopMenu.setSaveButton("Save")):(gErrorMenu.displayError('Please first use "Save As" to give your automaton a name'),gTopMenu.setSaveButton("Save"))},gTopMenu.saveas=function(){gModalMenu.saveas.open()},gTopMenu.submit=function(){null!=gGraph.pset&&gModalMenu.submitModal.setPsetNumber(gGraph.pset),null!=gGraph.problem&&gModalMenu.submitModal.setProblemNumber(gGraph.problem),gModalMenu.open("submit")},gTopMenu.homepage=function(){window.location.href=getURLParent()+"index.html"},gTopMenu.draw=function(){var a="",b=gNodes.getSelected();b.sort();for(var c=0;c<gTopMenu.MAX_DISPLAYED_STATES&&c<b.length;c++)a+=b[c]+", ";a=0==b.length?"None":a.substring(0,a.length-2),b.length>gTopMenu.MAX_DISPLAYED_STATES&&(a+="...");var d=gGraph.mode.toUpperCase();"TM"==d&&(d="Turing Machine");var e=null==gGraph.pset?"":psets[gGraph.pset].name+", ",f=null==gGraph.problem&&null==gGraph.pset?"":psets[gGraph.pset].problems[gGraph.problem].name+", ";d3.select(".current-pset-problem").text(e+f),d3.select(".current-mode").text(d),d3.select(".current-alphabet").text(gGraph.charSet),"tm"===gGraph.mode&&gGraph.tapeSet&&sortString(gGraph.tapeSet)!==sortString(gGraph.charSet)&&(d3.select(".current-tape-set").style("display","inline"),d3.select(".current-tape-set-inner").text(gGraph.tapeSet)),d3.select("#selectedText").text(gTopMenu.SELECTED_TEXT+a),d3.select(".acceptButton").classed("marked",gNodes.selectionIsAccepting()),d3.select(".rejectButton").classed("marked",gNodes.selectionIsRejecting()),d3.selectAll(".neitherButton").classed("marked",gNodes.selectionIsNeither())},gTopMenu.setSaveButton=function(a){d3.select(".saveTopButton").text(a)},gModalMenu.confirm={},gModalMenu.confirm.flag="",gModalMenu.confirm.open=function(){gModalMenu.open("confirm")},gModalMenu.confirm.clickConfirmBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmBtn()},gModalMenu.confirm.clickCancelBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmCancelBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmCancelBtn()},gModalMenu.getEpsilon=function(){return gGraph.mode==gGraph.NFA&&d3.select(".epsilon").node().checked},gModalMenu.setEpsilon=function(a){d3.select(".epsilon").node().checked=a},gModalMenu.addAllEdgeChars=function(){gModalMenu.setEdgeChars(gGraph.charSet),gModalMenu.setEpsilon(!0)},gModalMenu.invertEdgeChars=function(){var a=gGraph.charSet,b=gModalMenu.getEdgeCharacters();for(var c in b)a=a.replace(b[c],"");gModalMenu.setEdgeChars(a),gModalMenu.setEpsilon(!gModalMenu.getEpsilon())},gModalMenu.addRemainingEdgeChars=function(){var a=[],b=gGraph.save(),c=gSimulator.convert(b);for(var d in c[gEdges.editedEdge.source.id])0==c[gEdges.editedEdge.source.id][d].length&&a.push(d);gModalMenu.setEdgeChars(gModalMenu.getEdgeCharacters()+a.join(""))},gModalMenu.setEdgeChars=function(a){d3.select(".edgeChars").node().value=a},gModalMenu.getEdgeCharacters=function(){return d3.select(".edgeChars").node().value},gModalMenu.deleteEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gGraph.draw(),gModalMenu.close("edgeEntry")},gModalMenu.load={},gModalMenu.load.onOpen=function(){gModalMenu.open("load"),gModalMenu.load.setLoadMessage("Gathering saved automata..."),gServer.listSaved(function(a,b){if(a)return gErrorMenu.displayModalError("load","Could not gather saved automata..."),d3.select(".load").selectAll("li").remove(),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3);var c=[];b.forEach(function(a,b,d){c.push(a.name)}),gModalMenu.load.setLoadNames(c)})},gModalMenu.load.onClickLoadBtn=function(){gErrorMenu.clearModalErrors();var a=gModalMenu.load.getLoadName();return a?(gModalMenu.load.setLoadButton("Loading..."),void gServer.load(a,function(b,c){if(b)return void("function"==typeof error_callback&&(gErrorMenu.displayModalError("load","Failed to load"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),gModalMenu.load.setLoadButton("Load")));gServer.changeName(a),gModalMenu.load.setLoadButton("Success!"),gGraph.charSet=c.meta.charSet,gGraph.pset=c.meta.pset,gGraph.problem=c.meta.problem,"tm"===d&&(gGraph.tapeSet=c.meta.tapeSet);var d=c.meta.mode;d!=gGraph.mode&&(window.location.href=getURLParent()+"tm.html?saved="+a),gGraph.load(c),gGraph.draw(),setTimeout(function(){gModalMenu.load.setLoadButton("Load"),gModalMenu.close("load")},300)})):(gErrorMenu.displayModalError("load","No automaton selected"),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3))},gModalMenu.load.setLoadNames=function(a){var b=d3.select(".loadNames").selectAll("li").data(a);b.enter().append("li"),b.classed("selected",!1).classed("load-nothing",!1).text(function(a){return a}).on("click",function(){d3.select(".loadNames").selectAll("li").classed("selected",!1),d3.select(this).classed("selected",!0)}).style("cursor","pointer"),b.exit().remove(),0==a.length&&d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text("Nothing's been saved yet")},gModalMenu.load.getLoadName=function(){var a=d3.select(".loadNames").select("li.selected").node();return null==a?null:encodeURIComponent(d3.select(".loadNames").select("li.selected").text())},gModalMenu.load.setLoadButton=function(a){d3.select(".loadButton").text(a)},gModalMenu.load.setLoadMessage=function(a){d3.select(".loadNames").selectAll("li").remove(),d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text(a)};var gModalMenu={MAX_HEIGHT_PERCENT:.62};gModalMenu.open=function(a){gModalMenu.currentType=a,d3.select("."+a).style("display","inline"),d3.select(".overlay").style("display","inline")},gModalMenu.close=function(a){gErrorMenu.clearModalErrors(),d3.select("."+a).style("display","none"),d3.select(".overlay").style("display","none")},gModalMenu.closeCurrent=function(){gModalMenu.cancel(gModalMenu.currentType)},gModalMenu.submitOnEnter=function(a){13==event.keyCode&&gModalMenu.submit(a)},gModalMenu.submit=function(a){switch(gErrorMenu.clearModalErrors(),a){case"tmEdgeEntry":gEdges.tmEditComplete();break;case"edgeEntry":gEdges.editComplete();break;case"nodeEntry":gNodes.editComplete();break;case"testing":gSimulator.runTests();break;case"saveas":gModalMenu.saveas.clickSaveBtn();break;case"load":gModalMenu.load.onClickLoadBtn();break;case"submit":gModalMenu.submitModal.clickSubmitBtn();break;case"confirm":gModalMenu.confirm.clickConfirmBtn()}},gModalMenu.cancel=function(a){switch(a){case"edgeEntry":gEdges.editCancelled();break;case"confirm":gModalMenu.confirm.clickCancelBtn();break;case"saveas":default:gModalMenu.close(a)}},gModalMenu.getNodeName=function(){return d3.select(".nodeName").node().value},gModalMenu.setNodeName=function(a){d3.select(".nodeName").node().value=a},gModalMenu.setInitial=function(a){d3.select(".nodeInitialCheckbox").node().checked=a},gModalMenu.getInitial=function(){return d3.select(".nodeInitialCheckbox").node().checked},gModalMenu.setState=function(a,b){d3.selectAll(".modalAcceptButton").classed("marked",a),d3.selectAll(".modalNeitherButton").classed("marked",!a&&!b),d3.selectAll(".modalRejectButton").classed("marked",b)},gModalMenu.getAccepting=function(){return d3.select(".modalAcceptButton").classed("marked")},gModalMenu.getRejecting=function(){return d3.select(".modalRejectButton").classed("marked")},gModalMenu.deleteNode=function(){gNodes.deleteEdited()},gModalMenu.saveas={},gModalMenu.saveas.open=function(){gModalMenu.saveas.setSaveName(gServer.name),gModalMenu.open("saveas")},gModalMenu.saveas.clickSaveBtn=function(){gModalMenu.confirm.flag="saveas",gModalMenu.saveas.setSaveButton("Saving...");var a=gModalMenu.saveas.getSaveName();if(gModalMenu.saveas.isInvalidName(a))return gErrorMenu.displayModalError("saveas","Automaton name cannot be blank"),void gModalMenu.saveas.setSaveButton("Save");var b=encodeURIComponent(a);gServer.listSaved(function(a,c){function d(a,b){return a.some(function(a,c,d){return a.name===b})}return a?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.saveas.setSaveButton("Save")):void(d(c,b)?(gModalMenu.close("saveas"),gModalMenu.confirm.open()):gModalMenu.saveas.save(function(){gModalMenu.close("saveas")}))})},gModalMenu.saveas.clickCancelBtn=function(){gModalMenu.cancel("saveas")},gModalMenu.saveas.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("saveas"),gModalMenu.saveas.save(function(){gModalMenu.close("saveas")})},gModalMenu.saveas.clickConfirmCancelBtn=function(){gModalMenu.close("saveas"),gModalMenu.close("confirm"),gModalMenu.saveas.setSaveButton("Save")},gModalMenu.saveas.save=function(){var a=gModalMenu.saveas.getSaveName();gServer.save(a,function(b,c){return b?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.saveas.setSaveButton("Save")):(gServer.changeName(a),gModalMenu.saveas.setSaveButton("Saved!"),void window.setTimeout(function(){gModalMenu.saveas.setSaveButton("Save"),gModalMenu.close("saveas")},1e3))})},gModalMenu.saveas.isInvalidName=function(a){return 0===a.replace(/\s/g,"").length},gModalMenu.saveas.getSaveName=function(){return d3.select(".saveText").node().value},gModalMenu.saveas.setSaveName=function(a){d3.select(".saveText").node().value=decodeURIComponent(a)},gModalMenu.saveas.setSaveButton=function(a){d3.select(".saveButton").text(a)},gModalMenu.submitModal={},gModalMenu.submitModal.init=function(){var a=d3.select(".pset").selectAll("option").data(psets);a.enter().append("option").attr("value",function(a,b){return b}).text(function(a,b){return a.name}),d3.select(".pset").node().selectedIndex=0,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.clickSubmitBtn=function(){function a(a,b,c){return a.some(function(a,d,e){var f=parseInt(a.pset_id),g=parseInt(a.problem_id);return f===b&&g===c})}gModalMenu.confirm.flag="submit";var b=(JSON.stringify(gGraph.save()),gModalMenu.submitModal.getPsetNumber()),c=gModalMenu.submitModal.getProblemNumber();gModalMenu.submitModal.setSubmitButton("Submitting..."),gServer.listSubmissions(function(d,e){return e?(gErrorMenu.displayModalError("submit","Failed to submit"),gModalMenu.submitModal.setSubmitButton("Submit"),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3)):void(a(d,b,c)?(gModalMenu.close("submit"),gModalMenu.confirm.open()):gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")}))})},gModalMenu.submitModal.clickCancelBtn=function(){gModalMenu.cancel("submit"),gErrorMenu.clearModalErrors()},gModalMenu.submitModal.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")})},gModalMenu.submitModal.clickConfirmCancelBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.setSubmitButton("Submit")},gModalMenu.submitModal.changenumbers=function(){var a=d3.select(".pset").node().selectedIndex,b=d3.select(".problem").selectAll("option").data(psets[a].problems);b.enter().append("option"),b.attr("value",function(a){return a.charSet}).text(function(a){return a.name}),b.exit().remove(),d3.select(".problem").node().selectedIndex=0},gModalMenu.submitModal.submit=function(a){var b=JSON.stringify(gGraph.save()),c=gModalMenu.submitModal.getPsetNumber(),d=gModalMenu.submitModal.getProblemNumber();return psets[c].problems[d].type!=gGraph.mode&&"nfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is an NFA, but the problem requires a DFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[c].problems[d].type!=gGraph.mode&&"dfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is a DFA, but the problem requires an NFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[c].problems[d].charSet!=gGraph.charSet?(gErrorMenu.displayModalError("submit","The alphabet for this automaton doesn't match the alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):"tm"===gGraph.mode&&psets[c].problems[d].tapeSet!=gGraph.tapeSet?(gErrorMenu.displayModalError("submit","The tape alphabet for this turing machine doesn't match the tape alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):void gServer.submit(b,c,d,function(b){return b?(gErrorMenu.displayModalError("submit","Failed to submit"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.submitModal.setSubmitButton("Submit")):(gModalMenu.submitModal.setSubmitButton("Success!"),void setTimeout(function(){gModalMenu.submitModal.setSubmitButton("Submit"),a()},1e3))})},gModalMenu.submitModal.getProblemNumber=function(){return d3.select(".problem").node().selectedIndex},gModalMenu.submitModal.getPsetNumber=function(){return d3.select(".pset").node().selectedIndex},gModalMenu.submitModal.setProblemNumber=function(a){d3.select(".problem").node().selectedIndex=a},gModalMenu.submitModal.setPsetNumber=function(a){d3.select(".pset").node().selectedIndex=a,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.setSubmitButton=function(a){d3.select(".submitButton").text(a)},gModalMenu.focusRow=function(a){a=Math.max(a,0);var b=!1;d3.selectAll(".bulkInput").each(function(c,d){d==a&&(this.focus(),b=!0)}),b||gModalMenu.buildRow(!0)},gModalMenu.buildRow=function(a){var b=d3.select(".testingHeader").append("tr");b.append("td").append("input").attr("type","text").classed("bulkInput",!0).each(function(){a&&this.focus()}),b.append("td").append("input").attr("type","radio").classed("bulkAccept",!0),b.append("td").append("input").attr("type","radio").classed("bulkReject",!0),d3.selectAll(".bulkAccept").on("change",function(a,b){gModalMenu.clearReject(b)}),d3.selectAll(".bulkReject").on("change",function(a,b){gModalMenu.clearAccept(b)}),d3.selectAll(".bulkInput").on("keydown",function(a,b){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.focusRow(b+1):38==d3.event.keyCode&&gModalMenu.focusRow(b-1)})},gModalMenu.initBulk=function(){gModalMenu.buildRow(!1),d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.clearReject=function(a){d3.selectAll(".bulkReject").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.clearAccept=function(a){d3.selectAll(".bulkAccept").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.tmEdge={},gModalMenu.tmEdge.focusTmRow=function(a){a=Math.max(a,0);var b=!1;d3.selectAll(".tmEdgeInput").each(function(c,d){d==a&&(this.focus(),b=!0)}),b||gModalMenu.tmEdge.buildTmRow(!0)},gModalMenu.tmEdge.setTmEdgeStates=function(a){0==a.length&&a.push({direction:1,to:"",from:""});for(var b=a.length-d3.selectAll(".tmEdge > tr").size(),c=0;b>c;c++)gModalMenu.tmEdge.buildTmRow(!1);var d=d3.select(".tmEdge").selectAll("tr").filter(function(a,b){return 0!=b}).data(a);d.select("td > .edgeLeft").each(function(a){this.checked=-1==a.direction}),d.select("td > .edgeRight").each(function(a){this.checked=1==a.direction}),d.selectAll("td > .tmEdgeChars").each(function(b,c,d){this.value=1==c?a[d].to:a[d].from}),d.exit().remove()},gModalMenu.tmEdge.getTmEdgeStates=function(){var a=[];return d3.select(".tmEdge").selectAll("tr").filter(function(a,b){return 0!=b}).each(function(){var b={},c=d3.select(this);b.direction=c.select("td > .edgeLeft").node().checked?-1:1,b.from=c.selectAll("td > .tmEdgeChars")[0][0].value,b.to=c.selectAll("td > .tmEdgeChars")[0][1].value,a.push(b)}),a},gModalMenu.tmEdge.buildTmRow=function(a){var b=d3.select(".tmEdge").append("tr");b.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0).each(function(){a&&this.focus()}),b.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0);var c=b.append("td");c.append("input").attr("type","radio").classed("edgeLeft",!0),c.append("label").text(" L "),c.append("input").attr("type","radio").attr("checked",!0).classed("edgeRight",!0),c.append("label").text(" R "),b.append("td").append("button").classed("button-delete",!0).text("X"),gModalMenu.tmEdge.updateTmDeleteButtons(),d3.selectAll(".edgeLeft").on("change",function(a,b){gModalMenu.tmEdge.clearRight(b)}),d3.selectAll(".edgeRight").on("change",function(a,b){gModalMenu.tmEdge.clearLeft(b)}),d3.selectAll(".tmEdgeChars").on("keydown",function(a,b){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.tmEdge.focusTmRow(b+1):38==d3.event.keyCode&&gModalMenu.tmEdge.focusTmRow(b-1)})},gModalMenu.tmEdge.updateTmDeleteButtons=function(){d3.selectAll(".button-delete").on("click",function(a,b){d3.select(".tmEdge").selectAll("tr").filter(function(a,c){return b==c}).remove(),gModalMenu.tmEdge.updateTmDeleteButtons()})},gModalMenu.tmEdge.initTmEdit=function(){d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.tmEdge.clearLeft=function(a){d3.selectAll(".edgeLeft").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.tmEdge.clearRight=function(a){d3.selectAll(".edgeRight").each(function(b,c){c==a&&(this.checked=!1)})},gSimulator.ACCEPT="ACCEPT",gSimulator.REJECT="REJECT",gSimulator.NEITHER="NEITHER",gSimulator.runTests=function(){var a=[],b=!1;d3.selectAll(".bulkInput").each(function(){var c=intersection(this.value,gGraph.charSet);b|=c.length!=this.value.length,this.value=c,a.push({testCase:c,expected:gSimulator.NEITHER})}),d3.selectAll(".bulkAccept").each(function(b,c){this.checked&&(a[c].expected=gSimulator.ACCEPT)}),d3.selectAll(".bulkReject").each(function(b,c){this.checked&&(a[c].expected=gSimulator.REJECT)}),b&&gErrorMenu.displayModalError("testing","Removing characters not in alphabet");var c=[],d=gGraph.save();a.forEach(function(a){c.push({accepted:gSimulator.run(d,a.testCase),input:gSimulator.output,expected:a.expected})});var e=d3.select(".testingResults").selectAll("tr").data(c),f=e.enter().append("tr");f.append("td").attr("width","60%").style("text-align","left"),f.append("td").attr("width","20%").style("text-align","center"),f.append("td").attr("width","20%").style("text-align","center"),e.each(function(a){d3.select(this).selectAll("td").text(function(b,c){switch(c){case 0:return a.accepted==gSimulator.TIMEOUT?"Timed out":a.input;case 1:return a.accepted==gSimulator.TIMEOUT?"-":a.accepted?"A":"R";case 2:if(a.expected===gSimulator.NEITHER||a.accepted==gSimulator.TIMEOUT)return"-";var d=!(a.expected===gSimulator.ACCEPT^a.accepted);return d?"Y":"N"}})}),e.exit().remove()};var gDFASimulator={};gDFASimulator.step=function(a,b,c,d){var e=gSimulator.convert(a);return e[b][c[d]][0]},gDFASimulator.run=function(a,b){gSimulator.output=b;for(var c=gSimulator.convert(a),d=a.nodes.initial,e=0;e<b.length;e++){var f=c[d][b[e]];if(0==f.length)return!1;d=f[0]}for(var e=0;e<a.nodes.nodes.length;e++)if(a.nodes.nodes[e].id==d)return a.nodes.nodes[e].accept;return!1};var gNFASimulator={};gNFASimulator.run=function(a,b){gSimulator.output=b;var c=gSimulator.convert(a),d=new Queue,e={};for(d.enqueue({current:a.nodes.initial,index:0}),e[a.nodes.initial+" 0"]=!0;!d.isEmpty();){var f=d.dequeue();if(f.index==b.length){for(var g=0;g<a.nodes.nodes.length;g++)if(a.nodes.nodes[g].id==f.current&&a.nodes.nodes[g].accept)return!0}else for(var h=c[f.current][b[f.index]],g=0;g<h.length;g++){var i={current:h[g],index:f.index+1};e[i.current+" "+i.index]||(e[i.current+" "+i.index]=!0,d.enqueue(i))}for(var j=c[f.current][gEpsilon],g=0;g<j.length;g++){var i={current:j[g],index:f.index};e[i.current+" "+i.index]||(e[i.current+" "+i.index]=!0,d.enqueue(i))}}return!1};var gSimulator={TIMEOUT:"timeout"};gSimulator.init=function(){var a=gGraph.mode==gGraph.DFA?gDFASimulator:gGraph.mode==gGraph.NFA?gNFASimulator:gTMSimulator;gSimulator.run=a.run,gSimulator.step=a.step},gSimulator.convert=function(a){var b={},c=gGraph.charSet+(gGraph.epsilonEnabled?gEpsilon:"");return a.nodes.nodes.forEach(function(a){b[a.id]={};for(var d=0;d<c.length;d++)b[a.id][c[d]]=[]}),a.edges.edges.forEach(function(a){a.transitions[0].forEach(function(c){b[a.source][c].push(a.target)})}),b};var gTape={SELECT_RADIUS:50};gTape.init=function(){d3.select(".tape").append("circle").style("fill","none").style("stroke","blue").attr("r",gTape.SELECT_RADIUS),gTape.hide(),gTape.done=!0,gTape.running=!1},gTape.run=function(){var a=gTestMenu.text;gTape.done=!1,gTape.running=!0,d3.select(".tape").select("circle").style("stroke","blue"),gTape.input=a.split(""),gTape.index=0,gTape.follow=gTape.current=gNodes.initial,gTape.draw()},gTape.drawResult=function(a){if(!gTape.done){var b="Run finished, "+(a?"accept":"reject")+'ing string "'+gTape.input.join("")+'"';!gTape.follow||gTape.follow.accept||gTape.follow.reject||(b+=" because of a missing transition"),gErrorMenu.displayMessage(b,!1,a?"accepting run-finished":"rejecting run-finished"),gTape.done=!0}},gTape.draw=function(){var a=d3.select(".tape").select("circle");if(gTape.follow){var b=gTape.follow!=gTape.prev&&1==a.style("opacity")?100:0;a.transition().duration(b).attr("cx",gTape.follow.x).attr("cy",gTape.follow.y).style("opacity",1),d3.select(".stepButton").text("Step").node().disabled=!1,gTape.isRejecting()?(a.style("stroke","red"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!1)):gTape.isAccepting()&&(a.style("stroke","green"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!0))}else a.style("opacity",0);var c=gGraph.mode==gGraph.TM?"current-tape-char-solid":"current-tape-char";gTape.running&&gTape.index<=gTape.input.length&&d3.selectAll(".tape-char").classed(c,function(a,b){return d3.select(this).classed(c)||gTape.index!=b||(this.focus(),this.blur()),gTape.index==b}),gTape.prev=gTape.follow},gTape.isAccepting=function(){return gGraph.mode==gGraph.DFA?"undefined"!=typeof gTape.current&&gTape.current.accept&&gTape.index==gTape.input.length:"undefined"!=typeof gTape.current&&gTape.current.accept},gTape.isRejecting=function(){return gGraph.mode==gGraph.DFA?"undefined"==typeof gTape.current||!gTape.current.accept&&gTape.index==gTape.input.length:"undefined"==typeof gTape.current||gTape.current.reject},gTape.show=function(){d3.select(".tape").style("opacity",1)},gTape.reset=function(){gTape.done=!0,gTape.running=!1,gTape.follow=null,gTape.draw()},gTape.hide=function(){gTape.reset(),d3.select(".tape").style("opacity",0)},gTape.step=function(){if(!gTape.running)return void gTape.run();if(!gTape.isRejecting()&&!gTape.isAccepting()){if(gGraph.mode==gGraph.DFA){var a=gDFASimulator.step(gGraph.save(),gTape.current.id,gTape.input,gTape.index++);gTape.current=gNodes.nodes[gNodes.getNodeIndex(a)]}else{var a=gTMSimulator.step(gGraph.save(),gTape.current.id,gTape.input.join(""),gTape.index);gTape.current=gNodes.nodes[gNodes.getNodeIndex(a.initial)],gTape.input=a.input.split(""),gTape.index=a.index,gTestMenu.disallowInput(gTape.input.join(""))}"undefined"!=typeof gTape.current&&(gTape.follow=gTape.current)}gTape.draw()};var gTMSimulator={MAX_ITER:1e5},gBlank=" ",gSquare=String.fromCharCode(9633);gTMSimulator.convert=function(a){var b={},c=gGraph.tapeSet+(gGraph.epsilonEnabled?gEpsilon:"");return a.nodes.nodes.forEach(function(a){b[a.id]={};for(var d=0;d<c.length;d++)b[a.id][c[d]]=null}),a.edges.edges.forEach(function(a){a.transitions[0].forEach(function(c){b[a.source][c.from]=JSON.parse(JSON.stringify(c)),b[a.source][c.from].target=a.target})}),b},gTMSimulator.step=function(a,b,c,d){var e=gTMSimulator.convert(a);return e[b][c[d]],gTMSimulator.stepState(e,{initial:b,input:c,index:d})},gTMSimulator.stepState=function(a,b){var c=b.input;c.length==b.index&&(c+=gBlank);var d=a[b.initial][c[b.index]];if(void 0==d)return{initial:void 0,input:c,index:b.index};var e={initial:d.target,index:b.index+d.direction};for(e.input=c.substring(0,b.index)+d.to+c.substring(b.index+1);e.index<0;)e.index++,e.input=gBlank+e.input;for(;e.index>=e.input.length;)e.input+=gBlank;return e},gTMSimulator.run=function(a,b){for(var c={initial:a.nodes.initial,input:b,index:0},d=gTMSimulator.convert(a),e=0;e<gTMSimulator.MAX_ITER;e++){if(void 0==c.initial)return gSimulator.output=c.input,!1;var f=a.nodes.nodes[gNodes.getNodeIndex(c.initial)];if(f.accept)return gSimulator.output=c.input,!0;if(f.reject)return gSimulator.output=c.input,!1;e<gTMSimulator.MAX_ITER-1&&(c=gTMSimulator.stepState(d,c))}return gSimulator.output=c.input,gSimulator.TIMEOUT};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){
a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock);var gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}},Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}();gEdges.initDragging=function(){gEdges.dragging=!1,gEdges.startNode=null,gEdges.backupNode=null,gEdges.endNode=null;var a=function(){return!0};gBehaviors.addBehavior("lowerNodes","mouseover",function(){return!gNodes.dragging},gEdges.showTempEdge),gBehaviors.addBehavior("lowerNodes","mousemove",function(){return!gNodes.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("lowerNodes","mousedown",a,gEdges.startDragging),gBehaviors.addBehavior("background","mousedown",function(){if(null==gEdges.startNode)return!1;var a=d3.mouse(d3.select("svg").node()),b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b<=gNodes.SELECTABLE_RADIUS&&b>gNodes.RADIUS},gEdges.startDragging),gBehaviors.addBehavior("nodes","mouseover",function(){return!gEdges.dragging&&gEdges.tempVisible},gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseover",function(){return gEdges.dragging},gEdges.setTempEdgeEnd),gBehaviors.addBehavior("nodes","mouseout",a,gEdges.unsetTempEdgeEnd),gBehaviors.addBehavior("background","mousemove",function(){var a=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){var a=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("background","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mouseup",a,gEdges.hideTempEdge),gBehaviors.addBehavior("background","mouseup",a,gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseup",function(){return gEdges.dragging},gEdges.addTempEdge)},gEdges.unsetTempEdgeEnd=function(a){null!=gEdges.endNode&&(gEdges.endNode=null,gGraph.draw())},gEdges.setTempEdgeEnd=function(a){gEdges.endNode=a,gGraph.draw()},gEdges.addTempEdge=function(a){gEdges.endNode=null,gEdges.backupNode=null,gEdges.hideTempEdge();var b=gEdges.getEdge(gEdges.startNode,a);null==b&&(gEdges.addEdge(gEdges.startNode,a),b=gEdges.edges[gEdges.edges.length-1]),gGraph.draw(),gEdges.editEdge(b)},gEdges.startDragging=function(){gEdges.dragging=!0},gEdges.hideTempEdge=function(){var a=d3.mouse(d3.select("svg").node()),b=gNodes.SELECTABLE_RADIUS+1;null!=gEdges.backupNode&&(b=Math.sqrt(Math.pow(a[0]-gEdges.backupNode.x,2)+Math.pow(a[1]-gEdges.backupNode.y,2))),null==gEdges.backupNode||b>gNodes.SELECTABLE_RADIUS?(d3.select("path.temp").remove(),gEdges.dragging=!1,gEdges.tempVisible=!1):(gEdges.startNode=gEdges.backupNode,gEdges.dragging=!1,gEdges.drawTempEdge())},gEdges.drawTempEdge=function(){if(null!=gEdges.startNode){if(gNodes.dragging)return d3.select("path.temp").remove(),gEdges.dragging=!1,void(gEdges.tempVisible=!1);var a=d3.mouse(d3.select("svg").node());d3.select("path.temp").remove(),gEdges.initialEdge=d3.select(".miscEdges").append("path").classed("temp",!0).style("marker-end","url(#mouse-arrow)").attr("fill","none").attr("d",function(){return null!=gEdges.endNode?gEdges.customPathFunction(gEdges.startNode,gEdges.endNode):gEdges.customPathFunction(gEdges.startNode,{x:a[0],y:a[1]})}).style("marker-end",function(){return null==gEdges.endNode?"url(#mouse-arrow)":"url(#end-arrow)"})}},gEdges.showTempEdge=function(a){gNodes.dragging||(gEdges.dragging?gEdges.backupNode=a:(gEdges.startNode=a,gEdges.tempVisible=!0,gEdges.drawTempEdge()))};var gEdges={BIDIRECTIONAL_OFFSET:8,LOOP_WIDTH:70,LOOP_HEIGHT:80,LOOP_PEAK:50,LOOP_TEXT_OFFSET:70,TEXT_OFFSET:10,TRANSITION_DY:20,TSPAN_HEIGHT:10,SELECTABLE_WIDTH:25,MARKER_SIZE:30,END_ARROW_OFFSET:36,MOUSE_ARROW_OFFSET:13};gEdges.init=function(){gEdges.lowerG=d3.select("g.edgesLower"),gEdges.upperG=d3.select("g.edges"),gEdges.straightLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),gEdges.curvedLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis"),gEdges.lineFunction=function(a){return a[0].x==a[1].x&&a[0].y==a[1].y?gEdges.curvedLineFunction([{x:a[0].x,y:a[0].y},{x:a[0].x+gEdges.LOOP_PEAK,y:a[0].y-gEdges.LOOP_HEIGHT/2},{x:a[0].x+gEdges.LOOP_WIDTH,y:a[0].y},{x:a[0].x+gEdges.LOOP_PEAK,y:a[0].y+gEdges.LOOP_HEIGHT/2},{x:a[0].x,y:a[0].y}]):gEdges.straightLineFunction(a)},gEdges.customPathFunction=function(a,b){var c={x:a.x,y:a.y},d={x:b.x,y:b.y};return b.id!=a.id&&gEdges.areConnected(b.id,a.id)&&(c=gEdges.offsetPoint(c,a,b,gEdges.BIDIRECTIONAL_OFFSET),d=gEdges.offsetPoint(d,a,b,gEdges.BIDIRECTIONAL_OFFSET)),gEdges.lineFunction([c,d])},gEdges.pathFunction=function(a){return gEdges.customPathFunction(a.source,a.target)},gEdges.buildMarker("end-arrow",gEdges.END_ARROW_OFFSET,"black"),gEdges.buildMarker("mouse-arrow",gEdges.MOUSE_ARROW_OFFSET,"black"),gEdges.edges=[],gEdges.edgeMap={},gEdges.initInitial(),gEdges.initSelection(),gEdges.initDragging(),gEdges.initEditing()},gEdges.addEdge=function(a,b){var c={};c.source=a,c.target=b,c.transitions=[[]],gEdges.edges.push(c),gEdges.edgeMap[a.id].push(b.id)},gEdges.removeEdge=function(a,b){gEdges.edges=gEdges.edges.filter(function(c){return c.source.id!=a.id||c.target.id!=b.id});var c=gEdges.edgeMap[a.id].indexOf(b.id);gEdges.edgeMap[a.id].splice(c,1)},gEdges.addNode=function(a){gEdges.edgeMap[a.id]=[]},gEdges.removeNode=function(a){gEdges.edges=gEdges.edges.filter(function(b){return b.source.id!=a.id&&b.target.id!=a.id});for(var b in gEdges.edgeMap){var c=gEdges.edgeMap[b].indexOf(a.id);gEdges.edgeMap[b].splice(c,1)}delete gEdges.edgeMap[a.id]},gEdges.save=function(){var a={edgeMap:JSON.parse(JSON.stringify(gEdges.edgeMap)),edges:JSON.parse(JSON.stringify(gEdges.edges))};return a.edges.forEach(function(a){a.source=a.source.id,a.target=a.target.id}),a},gEdges.load=function(a){gEdges.edges=a.edges,gEdges.edgeMap=a.edgeMap,gEdges.edges.forEach(function(a){a.source=gNodes.nodes[gNodes.getNodeIndex(a.source)],a.target=gNodes.nodes[gNodes.getNodeIndex(a.target)]})},gEdges.createDOMEdges=function(a,b){gBehaviors.apply("edges",a.append("path").attr("fill","none").classed("lower",!0).classed("transparent",!0)),b=b.append("g"),gBehaviors.apply("edges",b),b.append("path").attr("fill","none").classed("edge",!0),b.append("text")},gEdges.drawDOMEdges=function(a,b){a.attr("d",gEdges.pathFunction),b.select("path").attr("d",gEdges.pathFunction).classed("selected",function(a){return a.selected}).style("marker-end",function(a){return a.selected?"url(#sel-arrow)":"url(#end-arrow)"});var c=b.select("text").selectAll("tspan").data(function(a){return gGraph.mode==gGraph.TM?a.transitions[0]:a.transitions});c.enter().append("tspan"),c.text(gEdges.getEdgeLabel).attr("x",function(a,b,c){var d;return d3.select(this.parentNode).each(function(a,b){d=a}),gEdges.getTextPosition(d.source,d.target,this.parentNode.getBoundingClientRect()).x}).attr("dy",gEdges.TRANSITION_DY),b.select("text").attr("x",function(a){return gEdges.getTextPosition(a.source,a.target,this.getBoundingClientRect()).x}).attr("y",function(a){var b=d3.select(this).selectAll("tspan").size()-1;return gEdges.getTextPosition(a.source,a.target,this.getBoundingClientRect()).y+b*gEdges.TSPAN_HEIGHT}),c.exit().remove(),gEdges.drawInitial()},gEdges.destroyDOMEdges=function(a,b){a.remove(),b.remove()},gEdges.draw=function(){isIE&&(gEdges.lowerG.selectAll("path").remove(),gEdges.upperG.selectAll("g").remove());var a=gEdges.lowerG.selectAll("path").data(gEdges.edges,gEdges.getEdgeId),b=gEdges.upperG.selectAll("g").data(gEdges.edges,gEdges.getEdgeId);gEdges.createDOMEdges(a.enter(),b.enter()),gEdges.drawDOMEdges(a,b),gEdges.destroyDOMEdges(a.exit(),b.exit())},gEdges.areConnected=function(a,b){return null!=gEdges.endNode&&a==gEdges.startNode.id&&b==gEdges.endNode.id||gEdges.edgeMap[a]&&gEdges.edgeMap[a].indexOf(b)>-1},gEdges.getEdgeLabel=function(a){if(gGraph.mode==gGraph.TM){var b=" "==a.from?gSquare:a.from,c=" "==a.to?gSquare:a.to;return b+String.fromCharCode(8594)+c+", "+(1==a.direction?"R":"L")}return gEdges.reduceLabel(a)},gEdges.reduceLabel=function(a){var b=gGraph.charSet,c="";return b.length/2>=a.length?(a.forEach(function(a){c+=a+", "}),0!=c.length&&(c=c.substring(0,c.length-2))):(c=" - ",b.split("").forEach(function(b){-1==a.indexOf(b)&&(c+=b+", ")}),c=6!=c.length?c.substring(0,c.length-2):"",-1!=a.indexOf(gEpsilon)&&(c+=" + "+gEpsilon)),c},gEdges.getEdgeId=function(a){return a.source.id+" "+a.target.id},gEdges.getEdge=function(a,b){var c=null;return gEdges.edges.forEach(function(d){d.source.id==a.id&&d.target.id==b.id&&(c=d)}),c},gEdges.buildMarker=function(a,b,c){d3.select("svg").append("svg:defs").append("svg:marker").attr("id",a).attr("viewBox","0 -50 100 100").attr("refX",b).attr("markerWidth",gEdges.MARKER_SIZE).attr("markerHeight",gEdges.MARKER_SIZE).attr("orient","auto").append("svg:path").attr("d","M 0,-5 L 10,0 L 0,5 z").attr("fill",c).attr("stroke",c).style("pointer-events","none")},gEdges.getTextPosition=function(a,b,c){var d={x:a.x,y:a.y},e={x:b.x,y:b.y};b.id==a.id?(d.x+=gEdges.LOOP_TEXT_OFFSET,d.y-=1,e.x+=gEdges.LOOP_TEXT_OFFSET,e.y+=1):gEdges.areConnected(b.id,a.id)&&(d=gEdges.offsetPoint(d,a,b,gEdges.BIDIRECTIONAL_OFFSET),e=gEdges.offsetPoint(e,a,b,gEdges.BIDIRECTIONAL_OFFSET));var f={x:(d.x+e.x)/2,y:(d.y+e.y)/2},g=Math.bound(Math.atan2(d.y-e.y,d.x-e.x)+Math.PI/2,0,2*Math.PI),h=Math.sqrt(Math.pow(c.height/2,2)+Math.pow(c.width/2,2)),i=g>Math.PI?-1:1,j=g<3*Math.PI/2&&g>=Math.PI/2?-1:1,k=Math.bound(Math.atan2(i*c.height,j*c.width),0,2*Math.PI),l=Math.abs(k-g),m=Math.cos(l)*h;return m+=gEdges.TEXT_OFFSET,{x:f.x+Math.cos(g)*m,y:f.y-c.height+Math.sin(g)*m}},gEdges.offsetPoint=function(a,b,c,d){var e=Math.atan2(b.y-c.y,b.x-c.x),f=e+Math.PI/2;return{x:a.x+Math.cos(f)*d,y:a.y+Math.sin(f)*d}},gEdges.initEditing=function(){gEdges.editedEdge=null,gBehaviors.addBehavior("edges","dblclick",function(){return!0},gEdges.editEdge),d3.select(".edgeChars").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("edgeEntry")})},gEdges.populateTMEdgeModal=function(a){d3.select(".tmEdgeEntry").select(".modal-header").text("Edit Transition "+a.source.name+" "+String.fromCharCode(8594)+" "+a.target.name);for(var b=JSON.parse(JSON.stringify(gEdges.editedEdge.transitions[0])),c=0;c<b.length;c++)" "==b[c].from&&(b[c].from="")," "==b[c].to&&(b[c].to="");gModalMenu.tmEdge.setTmEdgeStates(b)},gEdges.populateEdgeModal=function(a){var b=a.transitions[0].join(""),c=b.length>0&&b[b.length-1]==gEpsilon;c&&(b=b.substring(0,b.length-1)),gModalMenu.setEdgeChars(b),gModalMenu.setEpsilon(c)},gEdges.editEdge=function(a){gEdges.editedEdge=a,gGraph.mode==gGraph.TM?(gEdges.populateTMEdgeModal(a),gModalMenu.open("tmEdgeEntry")):(gEdges.populateEdgeModal(a),gModalMenu.open("edgeEntry")),gModalMenu.open(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),d3.event.stopPropagation()},gEdges.editCancelled=function(){0==gEdges.editedEdge.transitions[0].length&&gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.deleteEditedEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.tmEditComplete=function(){for(var a=gModalMenu.tmEdge.getTmEdgeStates(),b="",c=!1,d=0;d<a.length;d++){if(""==a[d].to&&(a[d].to=" "),""==a[d].from){if(a[d].from=" ",c)return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for blank");c=!0}else if(-1!=b.indexOf(a[d].from))return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for character "+a[d].from);if(b+=a[d].from,1!=intersection(a[d].to,gGraph.tapeSet).length||1!=intersection(a[d].from,gGraph.tapeSet).length)return void gErrorMenu.displayModalError("tmEdgeEntry","Please only use characters in the character set")}if(0==a.length)return void gErrorMenu.displayModalError("tmEdgeEntry","You must define at least one transition");for(var d=0;d<gEdges.edges.length;d++){var e=gEdges.edges[d];if(e.source.id==gEdges.editedEdge.source.id&&e.target.id!=gEdges.editedEdge.target.id){for(var f=0;f<a.length;f++)for(var g=0;g<e.transitions[0].length;g++)a[f].from==e.transitions[0][g].from&&e.transitions[0].splice(g--,1);0==e.transitions[0].length&&gEdges.removeEdge(e.source,e.target)}}gEdges.editedEdge.transitions[0]=a,gEdges.editedEdge=null,gModalMenu.close("tmEdgeEntry"),gGraph.draw(),gGraph.draw()},gEdges.editComplete=function(){var a=removeDuplicates(gModalMenu.getEdgeCharacters().replace(/[\s,]/g,"")),b=intersection(gGraph.charSet,a),c=a;if(a=b,gModalMenu.setEdgeChars(b),a+=gModalMenu.getEpsilon()?gEpsilon:"",b.length!=c.length&&(0==a.length?gErrorMenu.displayModalError("edgeEntry","Ignoring characters that aren't in the alphabet."):gErrorMenu.displayError("Ignoring characters that aren't in the alphabet.")),0==a.length)return void gErrorMenu.displayModalError("edgeEntry","Transitions must take at least one character");var d=a.split("");d.sort();for(var e=0;e<d.length-1;e++)d[e]==d[e+1]&&d.splice(e--,1);if(gGraph.mode==gGraph.DFA){var f=!1;d.forEach(function(a){for(var b=0;b<gEdges.edges.length;b++){var c=gEdges.edges[b];if(c!=gEdges.editedEdge&&c.source==gEdges.editedEdge.source){var d=c.transitions[0].indexOf(a);-1!=d&&(c.transitions[0].splice(d,1),0==c.transitions[0].length&&(gEdges.removeEdge(c.source,c.target),b--,f=!0))}}}),f&&gErrorMenu.displayError("Removed duplicate transitions")}gEdges.editedEdge.transitions[0]=d,gEdges.editedEdge=null,gModalMenu.close("edgeEntry"),gGraph.draw()},gEdges.INITIAL_EDGE_LENGTH=60,gEdges.INITIAL_OVERLAP_RANGE=7,gEdges.INITIAL_OVERLAP_ANGLE=20,gEdges.initInitial=function(){d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none")},gEdges.drawInitial=function(){var a=gNodes.initial;if(null==a)d3.select("path.initial").style("opacity",0);else{var b=0,c=gEdges.INITIAL_EDGE_LENGTH;gEdges.edges.forEach(function(d){var e=Math.min(d.source.x,d.target.x),f=Math.max(d.source.x,d.target.x);if(a.x<=f&&a.x-gEdges.INITIAL_EDGE_LENGTH>=e&&d.target.x-d.source.x!=0){var g=(d.target.y-d.source.y)/(d.target.x-d.source.x),h=d.source.y-g*d.source.x,i=g*(a.x-gEdges.INITIAL_EDGE_LENGTH)+h,j=g*a.x+h;Math.abs(i-a.y)<=gEdges.INITIAL_OVERLAP_RANGE&&Math.abs(j-a.y)<=gEdges.INITIAL_OVERLAP_RANGE&&(c=Math.cos(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,b=Math.sin(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,j>i&&(b*=-1))}}),d3.select("path.initial").style("opacity",1).attr("d",function(){return gEdges.lineFunction([{x:a.x-c,y:a.y-b},{x:a.x,y:a.y}])})}},isIE&&(gEdges.initInitial=function(){},gEdges.drawInitial=function(){d3.select("path.initial").remove();var a=gNodes.initial;null!=a&&d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none").attr("d",function(){return gEdges.lineFunction([{x:a.x-gEdges.INITIAL_EDGE_LENGTH,y:a.y},{x:a.x,y:a.y}])})}),gEdges.SELECTED_COLOR="blue",gEdges.initSelection=function(){gEdges.buildMarker("sel-arrow",gEdges.END_ARROW_OFFSET,gEdges.SELECTED_COLOR),gBehaviors.addBehavior("edges","mousedown",function(){return!0},function(a){gShiftKey||a.selected||(gNodes.deselectAll(),gEdges.deselectAll()),a.selected=!0,gGraph.draw()})},gEdges.deleteSelected=function(){var a=[];gEdges.edges.forEach(function(b){b.selected&&a.push(b)}),a.forEach(function(a){gEdges.removeEdge(a.source,a.target)})},gEdges.deselectAll=function(){gEdges.edges.forEach(function(a){a.selected=!1})},gEdges.selectionIsEmpty=function(){return 0==gEdges.selectionSize()},gEdges.selectionSize=function(){return gEdges.edges.filter(function(a){return a.selected}).length},gNodes.doubleClickInit=function(){gBehaviors.addBehavior("background","dblclick",function(){return!gTableTopMenu.active},function(){var a=d3.mouse(d3.select("svg").node());gNodes.addNode(a[0],a[1]),gNodes.draw()})},gNodes.editInit=function(){gNodes.editedNode=null,gBehaviors.addBehavior("nodes","dblclick",function(){return!0},gNodes.editNode),d3.select(".nodeName").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("nodeEntry")})},gNodes.editNode=function(a){gNodes.editedNode=a,gModalMenu.setNodeName(a.name),gModalMenu.setInitial(null!=gNodes.initial&&a.id==gNodes.initial.id),gModalMenu.setState(a.accept,a.reject),gModalMenu.open("nodeEntry"),d3.event.stopPropagation()},gNodes.editComplete=function(){var a=gModalMenu.getNodeName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayModalError("nodeEntry","State name cannot be blank.");var b=gNodes.getNodeIndexFromName(a);-1==b||gNodes.nodes[b].id==gNodes.editedNode.id?(gNodes.editedNode.accept=gModalMenu.getAccepting(),gNodes.editedNode.reject=gModalMenu.getRejecting(),gModalMenu.getInitial()?gNodes.initial=gNodes.editedNode:null!=gNodes.initial&&gNodes.editedNode.id==gNodes.initial.id&&(gNodes.initial=null),gNodes.editedNode.name=a,gNodes.editedNode=null,gModalMenu.close("nodeEntry"),gGraph.draw()):gErrorMenu.displayModalError("nodeEntry",'State name "'+a+'" is already in use.')},gNodes.deleteEdited=function(){if(null!=gTape.follow&&gTape.follow.id==gNodes.editedNode.id){if(!gTape.done)return void gErrorMenu.displayModalError("nodeEntry","The current state in a running test cannot be deleted");gTestMenu.end()}gNodes.removeByIndex(gNodes.getNodeIndex(gNodes.editedNode.id)),gModalMenu.close("nodeEntry"),gGraph.draw()},gNodes.FORCE_LAYOUT_ITERATIONS=1e5,gNodes.forcedDirectedLayout=function(){var a=[];gNodes.nodes.forEach(function(b){a.push({x:b.x,y:b.y,vx:0,vy:0})});var b=[];gEdges.edges.forEach(function(a){b.push({source:gNodes.getNodeIndex(a.source.id),target:gNodes.getNodeIndex(a.target.id)})});var c=d3.layout.force().nodes(a).links(b).linkDistance(200).charge(-300).gravity(.01).size([gGraph.width-2*gGraph.BUFFER,gGraph.height-2*gGraph.BUFFER]);c.start();for(var d=0;d<gNodes.FORCE_LAYOUT_ITERATIONS;d++)c.tick();c.stop();for(var d=0;d<a.length;d++)gNodes.nodes[d].x=a[d].x,gNodes.nodes[d].y=a[d].y;gNodes.scale()},gNodes.moveSelected=function(a,b){a+=gNodes.selectionX,b+=gNodes.selectionY,gNodes.selectionX=0,gNodes.selectionY=0;var c=function(a){return a.selected},d=function(a){return a.source.selected||a.target.selected};if(gNodes.validMoveX(a)?gNodes.nodes.filter(c).forEach(function(b){b.x+=a}):gNodes.selectionX+=a,gNodes.validMoveY(b)?gNodes.nodes.filter(c).forEach(function(a){a.y+=b}):gNodes.selectionY+=b,isIE)gGraph.draw();else{var e=d3.select("g.nodes").selectAll("g").filter(c),f=d3.select("g.nodesLower").selectAll("circle").filter(c);gNodes.drawDOMNodes(f,e),e=d3.select("g.edges").selectAll("g").filter(d),f=d3.select("g.edgesLower").selectAll("path").filter(d),gEdges.drawDOMEdges(f,e),gEdges.drawInitial(),gTape.draw()}},gNodes.movementInit=function(){gBehaviors.addBehavior("nodes","drag",function(a){return a.selected},function(a){gNodes.moveSelected(d3.event.dx,d3.event.dy)})};var gNodes={SELECTABLE_RADIUS:50,RADIUS:30,INNER_RADIUS:24,STROKE_WIDTH:2,NEW_BUFFER:100,NEW_INCREMENT:100,IE_TEXT_OFFSET:5};gNodes.init=function(){gNodes.lowerG=d3.select("g.nodesLower"),gNodes.upperG=d3.select("g.nodes"),gNodes.nodes=[],gNodes.initial=null,gNodes.selectionInit(),gNodes.movementInit(),gNodes.doubleClickInit(),gNodes.editInit()},gNodes.setInitial=function(){var a=gNodes.nodes.filter(function(a){return a.selected});a.length>0&&(gNodes.initial=a[0])},gNodes.setAccepting=function(a){gNodes.nodes.filter(function(a){return a.selected}).forEach(function(b){b.accept=a})},gNodes.setRejecting=function(a){gNodes.nodes.filter(function(a){return a.selected}).forEach(function(b){b.reject=a})},gNodes.wouldOverlap=function(a,b){var c=!1;return gNodes.nodes.forEach(function(d){c|=dist(a,b,d.x,d.y)<=2*gNodes.RADIUS}),c},gNodes.addNode=function(a,b){var c={};if("undefined"==typeof a){var d=!1;for(c.y=gNodes.NEW_BUFFER;c.y<=gGraph.height-gNodes.NEW_BUFFER&&!d;c.y+=gNodes.NEW_INCREMENT)for(c.x=gNodes.NEW_BUFFER;c.x<=gGraph.width-gNodes.NEW_BUFFER&&!d;c.x+=gNodes.NEW_INCREMENT)d=!gNodes.wouldOverlap(c.x,c.y);c.x-=gNodes.NEW_INCREMENT,c.y-=gNodes.NEW_INCREMENT}else c.x=a,c.y=b;for(var e=0;-1!=gNodes.getNodeIndexFromName("n"+e);)e++;c.id=e,c.name="n"+c.id,c.accept=!1,c.reject=!1,c.selected=!0,gNodes.deselectAll(),gNodes.nodes.push(c),gEdges.addNode(c)},gNodes.setInitialByIndex=function(a){gNodes.initial=gNodes.nodes[a]},gNodes.clearInitial=function(){gNodes.initial=null},gNodes.setAcceptByIndex=function(a,b){gNodes.nodes[a].accept=b},gNodes.setRejectByIndex=function(a,b){gNodes.nodes[a].reject=b},gNodes.removeByIndex=function(a){null!=gTape.follow&&gTape.follow.id==gNodes.nodes[a].id&&gTestMenu.end(),null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[a].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[a]),gNodes.nodes.splice(a,1)},gNodes.removeNodes=function(){if(null!=gTape.follow&&gTape.follow.selected){if(!gTape.done)return gErrorMenu.displayError("The current state in a running test cannot be deleted"),!1;gTestMenu.end()}for(var a=0;a<gNodes.nodes.length;a++)gNodes.nodes[a].selected&&(null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[a].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[a]),gNodes.nodes.splice(a--,1));return!0},gNodes.createDOMNodes=function(a,b){gBehaviors.apply("lowerNodes",a.append("circle").classed("transparent",!0).attr("r",gNodes.SELECTABLE_RADIUS)),b=b.append("g"),gBehaviors.apply("nodes",b.append("circle").classed("outer",!0).attr("r",gNodes.RADIUS)),gBehaviors.apply("nodes",b.append("circle").classed("inner",!0).attr("r",gNodes.INNER_RADIUS)),b.append("text")},gNodes.getSelected=function(){var a=[];return gNodes.nodes.forEach(function(b){b.selected&&a.push(b.name)}),a},gNodes.save=function(){return{nodes:gNodes.nodes,initial:null==gNodes.initial?null:gNodes.initial.id}},gNodes.load=function(a){gNodes.nodes=a.nodes,gNodes.initial=a.initial,null!=gNodes.initial&&(gNodes.initial=gNodes.nodes[gNodes.getNodeIndex(gNodes.initial)]),gNodes.nextId=0,gNodes.nodes.forEach(function(a){gNodes.nextId=Math.max(a.id+1,gNodes.nextId)}),gNodes.scale()},gNodes.scale=function(){if(gNodes.nodes.length>0){for(var a=gNodes.nodes[0].x,b=gNodes.nodes[0].x,c=gNodes.nodes[0].y,d=gNodes.nodes[0].y,e=1;e<gNodes.nodes.length;e++)a=Math.min(a,gNodes.nodes[e].x),b=Math.max(b,gNodes.nodes[e].x),c=Math.min(c,gNodes.nodes[e].y),d=Math.max(d,gNodes.nodes[e].y);var f=a,g=b;(gGraph.BUFFER>a||gGraph.width-gGraph.BUFFER<b)&&(f=gGraph.BUFFER,g=gGraph.width-gGraph.BUFFER);var h=c,i=d;(gGraph.BUFFER>c||gGraph.height-gGraph.BUFFER<d)&&(h=gGraph.BUFFER,i=gGraph.height-gGraph.BUFFER);for(var e=0;e<gNodes.nodes.length;e++){var j=b-a,k=0==j?1:(gNodes.nodes[e].x-a)/j,l=d-c,m=0==l?1:(gNodes.nodes[e].y-c)/l;gNodes.nodes[e].x=f*(1-k)+g*k,gNodes.nodes[e].y=h*(1-m)+i*m}}},gNodes.selectionIsAccepting=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,c.selected&&!c.accept&&(a=!1))}),a&&b},gNodes.selectionIsRejecting=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,c.selected&&!c.reject&&(a=!1))}),a&&b},gNodes.selectionIsNeither=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,(c.accept||c.reject)&&(a=!1))}),a&&b},gNodes.drawDOMNodes=function(a,b){a.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.classed("selected",function(a){return a.selected}).classed("accept",function(a){return a.accept}).classed("reject",function(a){return a.reject}),b.select("circle.inner").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.select("circle.outer").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.select("text").text(function(a){return a.name}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y+(isIE?gNodes.IE_TEXT_OFFSET:0)})},gNodes.destroyDOMNodes=function(a,b){a.remove(),b.remove()},gNodes.draw=function(){if(isIE&&(gNodes.lowerG.selectAll("circle").remove(),gNodes.upperG.selectAll("g").remove()),gNodes.upperG.select(".empty-text").remove(),0==gNodes.nodes.length){var a=isSafari?"Click Add New State to create your first node.":"Double-click to create your first node.";gNodes.upperG.append("text").classed("empty-text",!0).style("font-size",20).style("font-family",'"San Francisco", "Helvetica Neue", "Helvetica", "Arial", sans-serif').style("fill","rgba(0, 0, 0, 0.4)").style("stroke","none").attr("x",gGraph.width/2).attr("y",gGraph.height/2).text(a)}var b=gNodes.lowerG.selectAll("circle").data(gNodes.nodes,function(a){return a.id}),c=gNodes.upperG.selectAll("g").data(gNodes.nodes,function(a){return a.id});gNodes.createDOMNodes(b.enter(),c.enter()),gNodes.drawDOMNodes(b,c),gNodes.destroyDOMNodes(b.exit(),c.exit())},gNodes.validMoveX=function(a){var b=!0;return gNodes.nodes.filter(function(a){return a.selected}).forEach(function(c){b&=c.x+a>=gNodes.RADIUS+gNodes.STROKE_WIDTH||a>=0,b&=c.x+a<=gGraph.width-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=a}),b},gNodes.validMoveY=function(a){var b=!0;return gNodes.nodes.filter(function(a){return a.selected}).forEach(function(c){b&=c.y+a>=gNodes.RADIUS+gNodes.STROKE_WIDTH||a>=0,b&=c.y+a<=gGraph.height-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=a}),b},gNodes.getNodeIndex=function(a){var b=-1;return gNodes.nodes.forEach(function(c,d){c.id==a&&(b=d)}),b},gNodes.getNodeIndexFromName=function(a){var b=-1;return gNodes.nodes.forEach(function(c,d){c.name===a&&(b=d)}),b},gNodes.select=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected=!0},gNodes.deselect=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected=!1},gNodes.toggleSelection=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected^=!0},gNodes.deselectAll=function(){gNodes.nodes.forEach(function(a){a.selected=!1})},gNodes.selectionIsEmpty=function(){return 0==gNodes.selectionSize()},gNodes.selectionSize=function(){return gNodes.nodes.filter(function(a){return a.selected}).length},gNodes.selectionInit=function(){gBehaviors.addBehavior("nodes","mousedown",function(){return!0},function(a){gShiftKey||a.selected||(gNodes.deselectAll(),gEdges.deselectAll()),a.selected=!0,gGraph.draw()}),gBehaviors.addBehavior("brush","brushstart",function(){return!0},function(){gNodes.nodes.forEach(function(a){a.previouslySelected=gShiftKey&&a.selected}),gEdges.deselectAll()}),gBehaviors.addBehavior("brush","brush",function(){return!0},function(){var a=d3.event.target.extent();gNodes.nodes.forEach(function(b){b.selected=b.previouslySelected^(a[0][0]<=b.x&&b.x<a[1][0]&&a[0][1]<=b.y&&b.y<a[1][1])}),gGraph.draw()})},gNodes.GRID_SPACING=150,gNodes.snapToGrid=function(){for(var a=[],b=gNodes.GRID_SPACING;b<=gGraph.width-gNodes.GRID_SPACING;b+=gNodes.GRID_SPACING)for(var c=gNodes.GRID_SPACING;c<=gGraph.height-gNodes.GRID_SPACING;c+=gNodes.GRID_SPACING)a.push({x:b,y:c});var d=[],e=-1;if(gNodes.nodes.forEach(function(a,b){null!=gNodes.initial&&gNodes.initial.id==a.id&&(e=b),d.push({x:a.x,y:a.y,i:b})}),!(a.length<d.length))for(;d.length>0&&a.length>0;){for(var f=-1,g=-1,h=-1,i=0;i<d.length;i++)for(var j=0;j<a.length;j++){var k=Math.pow(d[i].x-a[j].x,2)+Math.pow(d[i].y-a[j].y,2);(-1==h||f>k)&&(g=j,h=i,f=k)}gNodes.nodes[d[h].i].x=a[g].x,gNodes.nodes[d[h].i].y=a[g].y,d.splice(h,1),a.splice(g,1)}};var gErrorMenu={DISPLAY_TIME:2100,FADE_OUT_TIME:400,MAX_ERRORS:3};gErrorMenu.displayMessage=function(a,b,c){var d=d3.select(".errors").append("span").text(a).classed(c,!0);1!=b&&d.transition().delay(gErrorMenu.DISPLAY_TIME).duration(gErrorMenu.FADE_OUT_TIME).ease("cubic").style("opacity",0).remove();var e=d3.select(".errors").selectAll("span").size();d3.select(".errors").selectAll("span").filter(function(a,b){return b<e-gErrorMenu.MAX_ERRORS}).remove()},gErrorMenu.displayError=function(a,b){gErrorMenu.displayMessage(a,b,"error")},gErrorMenu.displayModalError=function(a,b){d3.select("."+a).select(".modal-content").insert("p",":first-child").classed("modal-description",!0).classed("error",!0).text(b)},gErrorMenu.clearModalErrors=function(){d3.selectAll(".modal-description.error").remove()};var gTableMenu={};gTableMenu.updateAll=function(){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split(""),gEdges.edges=[];var b=[];gNodes.nodes.forEach(function(a){gEdges.edgeMap[a.id]=[];var c=[];gNodes.nodes.forEach(function(){c.push(gGraph.mode==gGraph.TM?{}:"")}),b.push(c)});var c=!1,d=!1,e=!1;d3.selectAll("input.gridInput").each(function(a,f){var g=f%2==0||gGraph.mode!=gGraph.TM,h=this.character,i=this.i1;if(g){var j=this.value.split(/[ \t\n\r,]/),k=!1;j.forEach(function(a){var e=gNodes.getNodeIndexFromName(a);-1!=e?(k&&gGraph.mode!=gGraph.NFA?c=!0:gGraph.mode==gGraph.TM?b[i][e][h]={from:h}:b[i][e]+=h,k=!0):""!=a&&(d=!0)})}else{var l=this.value;if(intersection(l,gGraph.tapeSet).length!=l.length)return void(e=!0);
var m=-1;for(var n in b[i])if(void 0!=b[i][n][h]){m=n;break}-1!=m&&void 0!=b[i][m][h]&&(b[i][m][h].to=""==l?" ":l)}}),d3.selectAll(".moveRight").each(function(){var a=this.character,c=this.i1,d=this.checked?1:-1,e=-1;for(var f in b[c])if(void 0!=b[c][f][a]){e=f;break}-1!=e&&void 0!=b[c][e][a]&&(b[c][e][a].direction=d)}),c&&gErrorMenu.displayError("Multiple transitions defined for one character, ignoring extras"),d&&gErrorMenu.displayError("Some states entered in the table could not be found, ignoring them"),e&&gErrorMenu.displayError("Some characters were not in the tape language"),b.forEach(function(a,b){a.forEach(function(a,c){var d=[];if(gGraph.mode==gGraph.TM)for(var e in a)d.push(a[e]);if(""!=a&&(gGraph.mode!=gGraph.TM||0!=d.length)){var f=gEdges.getEdge(gNodes.nodes[b],gNodes.nodes[c]);null==f&&(gEdges.addEdge(gNodes.nodes[b],gNodes.nodes[c]),f=gEdges.edges[gEdges.edges.length-1]),-1==gEdges.edgeMap[gNodes.nodes[b].id].indexOf(gNodes.nodes[c].id)&&gEdges.edgeMap[gNodes.nodes[b].id].push(gNodes.nodes[c].id),gGraph.mode==gGraph.TM?f.transitions[0]=d:f.transitions[0]=a.split("").sort()}})})},gTableMenu.init=function(){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split("");var b=d3.select(".tableEditor").insert("tr").selectAll("td").data(a);b.enter().append("td"),b.text(function(a){return" "==a&&gGraph.mode==gGraph.TM?gSquare:a}),b.exit().remove();var c=d3.select(".tableEditor").select("tr");c.insert("td","td").text("Rejects"),c.insert("td","td").text("Accepts"),c.insert("td","td").text("Initial"),c.insert("td","td").text(""),c.append("td").text("Delete")},gTableMenu.draw=function(){if(gTableTopMenu.active){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split("");var b=d3.select(".tableEditor").selectAll("tr").filter(function(a,b){return 0!=b}).data(gNodes.nodes),c=b.enter().append("tr");c.append("td").text(function(a){return a.name}),c.append("td").append("input").attr("type","radio").classed("initialBox",!0).each(function(a){this.checked=null!=gNodes.initial&&gNodes.initial.id==a.id}).on("change",function(a,b){this.checked?gNodes.setInitialByIndex(b):gNodes.clearInitial(),gGraph.draw()}),c.append("td").append("input").attr("type","checkbox").classed("acceptBox",!0).on("change",function(a,b){gNodes.setAcceptByIndex(b,this.checked),this.checked&&gNodes.setRejectByIndex(b,!1),gGraph.draw()}),c.append("td").append("input").attr("type","checkbox").classed("rejectBox",!0).on("change",function(a,b){gNodes.setRejectByIndex(b,this.checked),this.checked&&gNodes.setAcceptByIndex(b,!1),gGraph.draw()}),d3.selectAll(".acceptBox").each(function(a,b){this.checked=gNodes.nodes[b].accept}),d3.selectAll(".rejectBox").each(function(a,b){this.checked=gNodes.nodes[b].reject});var d=b.selectAll("td").filter(function(){return null!=d3.select(this).select("input").filter(function(){return"text"==this.type}).node()}).data(a),e=d.enter().append("td").classed("tm-cell",gGraph.mode==gGraph.TM).each(function(){gGraph.mode==gGraph.TM&&d3.select(this).style("line-height","30px")});e.append("input").attr("type","text").attr("size","10").attr("placeholder","go to").classed("gridInput",!0).each(function(a,b,c){this.character=a,this.i1=c}),e.append("input").attr("type","text").attr("size","10").attr("maxlength","1").attr("placeholder","write").classed("gridInput",!0).each(function(a,b,c){this.character=a,this.i1=c}),e.append("br");var f=e.append("form");f.append("label").text("move:"),f.append("input").attr("type","radio").attr("name","move").attr("checked",!0).classed("moveLeft",!0).each(function(a,b,c){this.character=a,this.i1=c}),f.append("label").text("L"),f.append("input").attr("type","radio").attr("name","move").classed("moveRight",!0).each(function(a,b,c){this.character=a,this.i1=c}),f.append("label").text("R"),d.selectAll("input").each(function(a,b){switch(b){case 0:this.value=gTableMenu.getConnections(gNodes.nodes[this.i1].id,a);break;case 1:var c=gTableMenu.getResult(gNodes.nodes[this.i1].id,a);null!=c&&(this.value=c);break;case 2:var d=gTableMenu.getDirection(gNodes.nodes[this.i1].id,a);0!=d&&(this.checked=-1==d);break;case 3:var d=gTableMenu.getDirection(gNodes.nodes[this.i1].id,a);0!=d&&(this.checked=1==d)}}).on("blur",function(){gTableMenu.updateAll(),gTableMenu.draw()}),d.exit().remove(),c.append("td").append("button").on("click",function(a,b){gNodes.removeByIndex(b),gGraph.draw()}).text("X"),b.exit().remove()}},gTableMenu.getConnections=function(a,b){var c=[];return gEdges.edges.forEach(function(d){gGraph.mode==gGraph.TM?d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&c.push(d.target.name)}):d.source.id==a&&-1!=d.transitions[0].indexOf(b)&&c.push(d.target.name)}),c.join(", ")},gTableMenu.getDirection=function(a,b){var c=0;return gEdges.edges.forEach(function(d){d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&(c=e.direction)})}),c},gTableMenu.getResult=function(a,b){var c=null;return gEdges.edges.forEach(function(d){d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&(c=" "==e.to?"":e.to)})}),c};var gTableTopMenu={active:!1};gTableTopMenu.swap=function(){gTableTopMenu.active?(d3.select("svg").style("display","inline"),d3.select(".tableEditor, .tableEditorHeader").style("display","none"),d3.selectAll(".nontable").style("display","inline"),d3.selectAll(".nontableblock").style("display","block"),d3.select(".swapButton").text("Switch to Table View"),gTableTopMenu.active=!1,gTableMenu.updateAll()):(d3.select("svg").style("display","none"),d3.select(".tableEditor, .tableEditorHeader").style("display","table"),d3.selectAll(".nontable, .nontableblock").style("display","none"),d3.select(".swapButton").text("Switch to Editor View"),gNodes.deselectAll(),gEdges.deselectAll(),gTableTopMenu.active=!0),gGraph.mode==gGraph.DFA?d3.selectAll(".dfa-hide").style("display","none"):gGraph.mode==gGraph.NFA?d3.selectAll(".nfa-hide").style("display","none"):d3.selectAll(".tm-hide").style("display","none"),gGraph.draw()};var gTestMenu={NUM_CELLS:250,DISPLAY_TIME:4600,FADE_OUT_TIME:400};gTestMenu.init=function(){gTestMenu.reset(),gTestMenu.text="",gTestMenu.backupText="";for(var a=d3.select(".tape-field"),b=0;b<gTestMenu.NUM_CELLS;b++)a.append("input").attr("type","text").classed("tape-char",!0).attr("name","tapeChar[]").attr("maxlength",1).attr("readonly","readonly").on("click",gTestMenu.allowInput);d3.select(".tape-char-input").attr("maxlength",gTestMenu.NUM_CELLS).on("keydown",function(){13==d3.event.keyCode&&(gTestMenu.disallowInput(),gTestMenu.run())}),gTestMenu.disallowInput()},gTestMenu.reset=function(){gTestMenu.setRunning(!1),d3.select(".tape-char-input").node().value=gTestMenu.backupText||"",d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.reset()},gTestMenu.allowInput=function(){gTestMenu.reset(),d3.select(".tape-char-input").node().value=gTestMenu.backupText,d3.selectAll(".tape-char").style("display","none"),d3.select(".tape-char-input").style("display","inline").each(function(){this.focus()})},gTestMenu.disallowInput=function(a){if(gTestMenu.backupText!=intersection(d3.select(".tape-char-input").node().value,gGraph.charSet)){gTestMenu.backupText=d3.select(".tape-char-input").node().value;var b=intersection(gTestMenu.backupText,gGraph.charSet);gTestMenu.backupText.length!=b.length&&gErrorMenu.displayError("Removing characters that aren't in the alphabet."),gTestMenu.backupText=b}gTestMenu.text=void 0==a?gTestMenu.backupText:a,d3.selectAll(".tape-char").style("display","inline").each(function(a,b){this.value=b<gTestMenu.text.length?gTestMenu.text[b]:""}),d3.select(".tape-char-input").style("display","none")},gTestMenu.unsetTransitions=function(){var a=[];if(gGraph.mode==gGraph.DFA){var b=gGraph.save(),c=gSimulator.convert(b);for(var d in c){var e=!1;for(var f in c[d])e|=0==c[d][f].length;e&&a.push(gNodes.nodes[gNodes.getNodeIndex(d)].name)}}return a},gTestMenu.runTests=function(){var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=a.length?gErrorMenu.displayError("The following states have undefined transitions: "+a.join(", ")):gModalMenu.open("testing")},gTestMenu.setRunning=function(a){a?(d3.selectAll(".running").style("display","inline"),d3.select(".runButton").text("Restart")):(d3.selectAll(".running").style("display","none"),d3.select(".runButton").text("Start"))},gTestMenu.run=function(){gTestMenu.reset();var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=a.length?gErrorMenu.displayError("The following states have undefined transitions: "+a.join(", ")):(gTestMenu.setRunning(!0),gTape.show(),gTape.run())},gTestMenu.end=function(){gTestMenu.setRunning(!1),d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.hide()},gTestMenu.step=function(){var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("No initial node is set"):0!=a.length?gErrorMenu.displayError("The following nodes have undefined transitions: "+a.join(", ")):(gTape.show(),gTape.step())};var gTopMenu={MAX_DISPLAYED_STATES:5,SELECTED_TEXT:"Selected states: "};gTopMenu.addNode=function(){gNodes.addNode(),gGraph.draw()},gTopMenu.setState=function(a,b){gNodes.selectionIsEmpty()&&gErrorMenu.displayError("No states are selected"),gNodes.setAccepting(a),gNodes.setRejecting(b),gGraph.draw()},gTopMenu.deleteSelected=function(){gNodes.selectionIsEmpty()&&gEdges.selectionIsEmpty()&&(gErrorMenu.displayError("No states or transitions are selected"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3)),gNodes.removeNodes()&&(gEdges.deleteSelected(),gGraph.draw())},gTopMenu.setInitial=function(){gNodes.selectionIsEmpty()?gErrorMenu.displayError("No states are selected"):gNodes.selectionSize()>1&&gErrorMenu.displayError("Multiple states are selected. Using the first one."),gNodes.setInitial(),gGraph.draw()},gTopMenu.snapToGrid=function(){gNodes.snapToGrid(),gGraph.draw()},gTopMenu.forcedDirectedLayout=function(){gNodes.forcedDirectedLayout(),gGraph.draw()},gTopMenu.loadFromServer=function(){gModalMenu.open("load"),gModalMenu.load.onOpen()},gTopMenu.save=function(){var a=2e3,b=gServer.name;gTopMenu.setSaveButton("Saving..."),!gModalMenu.saveas.isInvalidName(b)&&b?gServer.save(b,function(b,c){b?(gTopMenu.setSaveButton("Failed"),gErrorMenu.displayError("Save failed: couldn't connect to server.")):gTopMenu.setSaveButton("Saved!"),setTimeout(function(){gTopMenu.setSaveButton("Save")},a)}):b?(gErrorMenu.displayError('Saving to invalid name, use "Save As" to change name'),gTopMenu.setSaveButton("Save")):(gErrorMenu.displayError('Please first use "Save As" to give your automaton a name'),gTopMenu.setSaveButton("Save"))},gTopMenu.saveas=function(){gModalMenu.saveas.open()},gTopMenu.submit=function(){null!=gGraph.pset&&gModalMenu.submitModal.setPsetNumber(gGraph.pset),null!=gGraph.problem&&gModalMenu.submitModal.setProblemNumber(gGraph.problem),gModalMenu.open("submit")},gTopMenu.homepage=function(){window.location.href=getURLParent()+"index.html"},gTopMenu.draw=function(){var a="",b=gNodes.getSelected();b.sort();for(var c=0;c<gTopMenu.MAX_DISPLAYED_STATES&&c<b.length;c++)a+=b[c]+", ";a=0==b.length?"None":a.substring(0,a.length-2),b.length>gTopMenu.MAX_DISPLAYED_STATES&&(a+="...");var d=gGraph.mode.toUpperCase();"TM"==d&&(d="Turing Machine");var e=null==gGraph.pset?"":psets[gGraph.pset].name+", ",f=null==gGraph.problem&&null==gGraph.pset?"":psets[gGraph.pset].problems[gGraph.problem].name+", ";d3.select(".current-pset-problem").text(e+f),d3.select(".current-mode").text(d),d3.select(".current-alphabet").text(gGraph.charSet),"tm"===gGraph.mode&&gGraph.tapeSet&&sortString(gGraph.tapeSet)!==sortString(gGraph.charSet)&&(d3.select(".current-tape-set").style("display","inline"),d3.select(".current-tape-set-inner").text(gGraph.tapeSet)),d3.select("#selectedText").text(gTopMenu.SELECTED_TEXT+a),d3.select(".acceptButton").classed("marked",gNodes.selectionIsAccepting()),d3.select(".rejectButton").classed("marked",gNodes.selectionIsRejecting()),d3.selectAll(".neitherButton").classed("marked",gNodes.selectionIsNeither())},gTopMenu.setSaveButton=function(a){d3.select(".saveTopButton").text(a)},gModalMenu.confirm={},gModalMenu.confirm.flag="",gModalMenu.confirm.open=function(){gModalMenu.open("confirm")},gModalMenu.confirm.clickConfirmBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmBtn()},gModalMenu.confirm.clickCancelBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmCancelBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmCancelBtn()},gModalMenu.getEpsilon=function(){return gGraph.mode==gGraph.NFA&&d3.select(".epsilon").node().checked},gModalMenu.setEpsilon=function(a){d3.select(".epsilon").node().checked=a},gModalMenu.addAllEdgeChars=function(){gModalMenu.setEdgeChars(gGraph.charSet),gModalMenu.setEpsilon(!0)},gModalMenu.invertEdgeChars=function(){var a=gGraph.charSet,b=gModalMenu.getEdgeCharacters();for(var c in b)a=a.replace(b[c],"");gModalMenu.setEdgeChars(a),gModalMenu.setEpsilon(!gModalMenu.getEpsilon())},gModalMenu.addRemainingEdgeChars=function(){var a=[],b=gGraph.save(),c=gSimulator.convert(b);for(var d in c[gEdges.editedEdge.source.id])0==c[gEdges.editedEdge.source.id][d].length&&a.push(d);gModalMenu.setEdgeChars(gModalMenu.getEdgeCharacters()+a.join(""))},gModalMenu.setEdgeChars=function(a){d3.select(".edgeChars").node().value=a},gModalMenu.getEdgeCharacters=function(){return d3.select(".edgeChars").node().value},gModalMenu.deleteEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gGraph.draw(),gModalMenu.close("edgeEntry")},gModalMenu.load={},gModalMenu.load.onOpen=function(){gModalMenu.open("load"),gModalMenu.load.setLoadMessage("Gathering saved automata..."),gServer.listSaved(function(a,b){if(a)return gErrorMenu.displayModalError("load","Could not gather saved automata..."),d3.select(".load").selectAll("li").remove(),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3);var c=[];b.forEach(function(a,b,d){c.push(a.name)}),gModalMenu.load.setLoadNames(c)})},gModalMenu.load.onClickLoadBtn=function(){gErrorMenu.clearModalErrors();var a=gModalMenu.load.getLoadName();return a?(gModalMenu.load.setLoadButton("Loading..."),void gServer.load(a,function(b,c){if(b)return void("function"==typeof error_callback&&(gErrorMenu.displayModalError("load","Failed to load"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),gModalMenu.load.setLoadButton("Load")));gServer.changeName(a),gModalMenu.load.setLoadButton("Success!"),gGraph.charSet=c.meta.charSet,gGraph.pset=c.meta.pset,gGraph.problem=c.meta.problem,"tm"===d&&(gGraph.tapeSet=c.meta.tapeSet);var d=c.meta.mode;d!=gGraph.mode&&(window.location.href=getURLParent()+"tm.html?saved="+a),gGraph.load(c),gGraph.draw(),setTimeout(function(){gModalMenu.load.setLoadButton("Load"),gModalMenu.close("load")},300)})):(gErrorMenu.displayModalError("load","No automaton selected"),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3))},gModalMenu.load.setLoadNames=function(a){var b=d3.select(".loadNames").selectAll("li").data(a);b.enter().append("li"),b.classed("selected",!1).classed("load-nothing",!1).text(function(a){return a}).on("click",function(){d3.select(".loadNames").selectAll("li").classed("selected",!1),d3.select(this).classed("selected",!0)}).style("cursor","pointer"),b.exit().remove(),0==a.length&&d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text("Nothing's been saved yet")},gModalMenu.load.getLoadName=function(){var a=d3.select(".loadNames").select("li.selected").node();return null==a?null:encodeURIComponent(d3.select(".loadNames").select("li.selected").text())},gModalMenu.load.setLoadButton=function(a){d3.select(".loadButton").text(a)},gModalMenu.load.setLoadMessage=function(a){d3.select(".loadNames").selectAll("li").remove(),d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text(a)};var gModalMenu={MAX_HEIGHT_PERCENT:.62};gModalMenu.open=function(a){gModalMenu.currentType=a,d3.select("."+a).style("display","inline"),d3.select(".overlay").style("display","inline")},gModalMenu.close=function(a){gErrorMenu.clearModalErrors(),d3.select("."+a).style("display","none"),d3.select(".overlay").style("display","none")},gModalMenu.closeCurrent=function(){gModalMenu.cancel(gModalMenu.currentType)},gModalMenu.submitOnEnter=function(a){13==event.keyCode&&gModalMenu.submit(a)},gModalMenu.submit=function(a){switch(gErrorMenu.clearModalErrors(),a){case"tmEdgeEntry":gEdges.tmEditComplete();break;case"edgeEntry":gEdges.editComplete();break;case"nodeEntry":gNodes.editComplete();break;case"testing":gSimulator.runTests();break;case"saveas":gModalMenu.saveas.clickSaveBtn();break;case"load":gModalMenu.load.onClickLoadBtn();break;case"submit":gModalMenu.submitModal.clickSubmitBtn();break;case"confirm":gModalMenu.confirm.clickConfirmBtn()}},gModalMenu.cancel=function(a){switch(a){case"edgeEntry":gEdges.editCancelled();break;case"confirm":gModalMenu.confirm.clickCancelBtn();break;case"saveas":default:gModalMenu.close(a)}},gModalMenu.getNodeName=function(){return d3.select(".nodeName").node().value},gModalMenu.setNodeName=function(a){d3.select(".nodeName").node().value=a},gModalMenu.setInitial=function(a){d3.select(".nodeInitialCheckbox").node().checked=a},gModalMenu.getInitial=function(){return d3.select(".nodeInitialCheckbox").node().checked},gModalMenu.setState=function(a,b){d3.selectAll(".modalAcceptButton").classed("marked",a),d3.selectAll(".modalNeitherButton").classed("marked",!a&&!b),d3.selectAll(".modalRejectButton").classed("marked",b)},gModalMenu.getAccepting=function(){return d3.select(".modalAcceptButton").classed("marked")},gModalMenu.getRejecting=function(){return d3.select(".modalRejectButton").classed("marked")},gModalMenu.deleteNode=function(){gNodes.deleteEdited()},gModalMenu.saveas={},gModalMenu.saveas.open=function(){gModalMenu.saveas.setSaveName(gServer.name),gModalMenu.open("saveas")},gModalMenu.saveas.clickSaveBtn=function(){gModalMenu.confirm.flag="saveas",gModalMenu.saveas.setSaveButton("Saving...");var a=gModalMenu.saveas.getSaveName();if(gModalMenu.saveas.isInvalidName(a))return gErrorMenu.displayModalError("saveas","Automaton name cannot be blank"),void gModalMenu.saveas.setSaveButton("Save");var b=encodeURIComponent(a);gServer.listSaved(function(a,c){function d(a,b){return a.some(function(a,c,d){return a.name===b})}return a?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.saveas.setSaveButton("Save")):void(d(c,b)?(gModalMenu.close("saveas"),gModalMenu.confirm.open()):gModalMenu.saveas.save(function(){gModalMenu.close("saveas")}))})},gModalMenu.saveas.clickCancelBtn=function(){gModalMenu.cancel("saveas")},gModalMenu.saveas.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("saveas"),gModalMenu.saveas.save(function(){gModalMenu.close("saveas")})},gModalMenu.saveas.clickConfirmCancelBtn=function(){gModalMenu.close("saveas"),gModalMenu.close("confirm"),gModalMenu.saveas.setSaveButton("Save")},gModalMenu.saveas.save=function(){var a=gModalMenu.saveas.getSaveName();gServer.save(a,function(b,c){return b?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.saveas.setSaveButton("Save")):(gServer.changeName(a),gModalMenu.saveas.setSaveButton("Saved!"),void window.setTimeout(function(){gModalMenu.saveas.setSaveButton("Save"),gModalMenu.close("saveas")},1e3))})},gModalMenu.saveas.isInvalidName=function(a){return 0===a.replace(/\s/g,"").length},gModalMenu.saveas.getSaveName=function(){return d3.select(".saveText").node().value},gModalMenu.saveas.setSaveName=function(a){d3.select(".saveText").node().value=decodeURIComponent(a)},gModalMenu.saveas.setSaveButton=function(a){d3.select(".saveButton").text(a)},gModalMenu.submitModal={},gModalMenu.submitModal.init=function(){var a=d3.select(".pset").selectAll("option").data(psets);a.enter().append("option").attr("value",function(a,b){return b}).text(function(a,b){return a.name}),d3.select(".pset").node().selectedIndex=0,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.clickSubmitBtn=function(){function a(a,b,c){return a.some(function(a,d,e){var f=parseInt(a.pset_id),g=parseInt(a.problem_id);return f===b&&g===c})}gModalMenu.confirm.flag="submit";var b=(JSON.stringify(gGraph.save()),gModalMenu.submitModal.getPsetNumber()),c=gModalMenu.submitModal.getProblemNumber();gModalMenu.submitModal.setSubmitButton("Submitting..."),gServer.listSubmissions(function(d,e){return e?(gErrorMenu.displayModalError("submit","Failed to submit"),gModalMenu.submitModal.setSubmitButton("Submit"),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3)):void(a(d,b,c)?(gModalMenu.close("submit"),gModalMenu.confirm.open()):gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")}))})},gModalMenu.submitModal.clickCancelBtn=function(){gModalMenu.cancel("submit"),gErrorMenu.clearModalErrors()},gModalMenu.submitModal.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")})},gModalMenu.submitModal.clickConfirmCancelBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.setSubmitButton("Submit")},gModalMenu.submitModal.changenumbers=function(){var a=d3.select(".pset").node().selectedIndex,b=d3.select(".problem").selectAll("option").data(psets[a].problems);b.enter().append("option"),b.attr("value",function(a){return a.charSet}).text(function(a){return a.name}),b.exit().remove(),d3.select(".problem").node().selectedIndex=0},gModalMenu.submitModal.submit=function(a){var b=JSON.stringify(gGraph.save()),c=gModalMenu.submitModal.getPsetNumber(),d=gModalMenu.submitModal.getProblemNumber();return psets[c].problems[d].type!=gGraph.mode&&"nfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is an NFA, but the problem requires a DFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[c].problems[d].type!=gGraph.mode&&"dfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is a DFA, but the problem requires an NFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[c].problems[d].charSet!=gGraph.charSet?(gErrorMenu.displayModalError("submit","The alphabet for this automaton doesn't match the alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):"tm"===gGraph.mode&&psets[c].problems[d].tapeSet!=gGraph.tapeSet?(gErrorMenu.displayModalError("submit","The tape alphabet for this turing machine doesn't match the tape alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):void gServer.submit(b,c,d,function(b){return b?(gErrorMenu.displayModalError("submit","Failed to submit"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.submitModal.setSubmitButton("Submit")):(gModalMenu.submitModal.setSubmitButton("Success!"),void setTimeout(function(){gModalMenu.submitModal.setSubmitButton("Submit"),a()},1e3))})},gModalMenu.submitModal.getProblemNumber=function(){return d3.select(".problem").node().selectedIndex},gModalMenu.submitModal.getPsetNumber=function(){return d3.select(".pset").node().selectedIndex},gModalMenu.submitModal.setProblemNumber=function(a){d3.select(".problem").node().selectedIndex=a},gModalMenu.submitModal.setPsetNumber=function(a){d3.select(".pset").node().selectedIndex=a,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.setSubmitButton=function(a){d3.select(".submitButton").text(a)},gModalMenu.focusRow=function(a){a=Math.max(a,0);var b=!1;d3.selectAll(".bulkInput").each(function(c,d){d==a&&(this.focus(),b=!0)}),b||gModalMenu.buildRow(!0)},gModalMenu.buildRow=function(a){var b=d3.select(".testingHeader").append("tr");b.append("td").append("input").attr("type","text").classed("bulkInput",!0).each(function(){a&&this.focus()}),b.append("td").append("input").attr("type","radio").classed("bulkAccept",!0),b.append("td").append("input").attr("type","radio").classed("bulkReject",!0),d3.selectAll(".bulkAccept").on("change",function(a,b){gModalMenu.clearReject(b)}),d3.selectAll(".bulkReject").on("change",function(a,b){gModalMenu.clearAccept(b)}),d3.selectAll(".bulkInput").on("keydown",function(a,b){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.focusRow(b+1):38==d3.event.keyCode&&gModalMenu.focusRow(b-1)})},gModalMenu.initBulk=function(){gModalMenu.buildRow(!1),d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.clearReject=function(a){d3.selectAll(".bulkReject").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.clearAccept=function(a){d3.selectAll(".bulkAccept").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.tmEdge={},gModalMenu.tmEdge.focusTmRow=function(a){a=Math.max(a,0);var b=!1;d3.selectAll(".tmEdgeInput").each(function(c,d){d==a&&(this.focus(),b=!0)}),b||gModalMenu.tmEdge.buildTmRow(!0)},gModalMenu.tmEdge.setTmEdgeStates=function(a){0==a.length&&a.push({direction:1,to:"",from:""});for(var b=a.length-d3.selectAll(".tmEdge > tr").size(),c=0;b>c;c++)gModalMenu.tmEdge.buildTmRow(!1);var d=d3.select(".tmEdge").selectAll("tr").filter(function(a,b){return 0!=b}).data(a);d.select("td > .edgeLeft").each(function(a){this.checked=-1==a.direction}),d.select("td > .edgeRight").each(function(a){this.checked=1==a.direction}),d.selectAll("td > .tmEdgeChars").each(function(b,c,d){this.value=1==c?a[d].to:a[d].from}),d.exit().remove()},gModalMenu.tmEdge.getTmEdgeStates=function(){var a=[];return d3.select(".tmEdge").selectAll("tr").filter(function(a,b){return 0!=b}).each(function(){var b={},c=d3.select(this);b.direction=c.select("td > .edgeLeft").node().checked?-1:1,b.from=c.selectAll("td > .tmEdgeChars")[0][0].value,b.to=c.selectAll("td > .tmEdgeChars")[0][1].value,a.push(b)}),a},gModalMenu.tmEdge.buildTmRow=function(a){var b=d3.select(".tmEdge").append("tr");b.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0).each(function(){a&&this.focus()}),b.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0);var c=b.append("td");c.append("input").attr("type","radio").classed("edgeLeft",!0),c.append("label").text(" L "),c.append("input").attr("type","radio").attr("checked",!0).classed("edgeRight",!0),c.append("label").text(" R "),b.append("td").append("button").classed("button-delete",!0).text("X"),gModalMenu.tmEdge.updateTmDeleteButtons(),d3.selectAll(".edgeLeft").on("change",function(a,b){gModalMenu.tmEdge.clearRight(b)}),d3.selectAll(".edgeRight").on("change",function(a,b){gModalMenu.tmEdge.clearLeft(b)}),d3.selectAll(".tmEdgeChars").on("keydown",function(a,b){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.tmEdge.focusTmRow(b+1):38==d3.event.keyCode&&gModalMenu.tmEdge.focusTmRow(b-1)})},gModalMenu.tmEdge.updateTmDeleteButtons=function(){d3.selectAll(".button-delete").on("click",function(a,b){d3.select(".tmEdge").selectAll("tr").filter(function(a,c){return b==c}).remove(),gModalMenu.tmEdge.updateTmDeleteButtons()})},gModalMenu.tmEdge.initTmEdit=function(){d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.tmEdge.clearLeft=function(a){d3.selectAll(".edgeLeft").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.tmEdge.clearRight=function(a){d3.selectAll(".edgeRight").each(function(b,c){c==a&&(this.checked=!1)})},gSimulator.ACCEPT="ACCEPT",gSimulator.REJECT="REJECT",gSimulator.NEITHER="NEITHER",gSimulator.runTests=function(){var a=[],b=!1;d3.selectAll(".bulkInput").each(function(){var c=intersection(this.value,gGraph.charSet);b|=c.length!=this.value.length,this.value=c,a.push({testCase:c,expected:gSimulator.NEITHER})}),d3.selectAll(".bulkAccept").each(function(b,c){this.checked&&(a[c].expected=gSimulator.ACCEPT)}),d3.selectAll(".bulkReject").each(function(b,c){this.checked&&(a[c].expected=gSimulator.REJECT)}),b&&gErrorMenu.displayModalError("testing","Removing characters not in alphabet");var c=[],d=gGraph.save();a.forEach(function(a){c.push({accepted:gSimulator.run(d,a.testCase),input:gSimulator.output,expected:a.expected})});var e=d3.select(".testingResults").selectAll("tr").data(c),f=e.enter().append("tr");f.append("td").attr("width","60%").style("text-align","left"),f.append("td").attr("width","20%").style("text-align","center"),f.append("td").attr("width","20%").style("text-align","center"),e.each(function(a){d3.select(this).selectAll("td").text(function(b,c){switch(c){case 0:return a.accepted==gSimulator.TIMEOUT?"Timed out":a.input;case 1:return a.accepted==gSimulator.TIMEOUT?"-":a.accepted?"A":"R";case 2:if(a.expected===gSimulator.NEITHER||a.accepted==gSimulator.TIMEOUT)return"-";var d=!(a.expected===gSimulator.ACCEPT^a.accepted);return d?"Y":"N"}})}),e.exit().remove()};var gDFASimulator={};gDFASimulator.step=function(a,b,c,d){var e=gSimulator.convert(a);return e[b][c[d]][0]},gDFASimulator.run=function(a,b){gSimulator.output=b;for(var c=gSimulator.convert(a),d=a.nodes.initial,e=0;e<b.length;e++){var f=c[d][b[e]];if(0==f.length)return!1;d=f[0]}for(var e=0;e<a.nodes.nodes.length;e++)if(a.nodes.nodes[e].id==d)return a.nodes.nodes[e].accept;return!1};var gNFASimulator={};gNFASimulator.run=function(a,b){gSimulator.output=b;var c=gSimulator.convert(a),d=new Queue,e={};for(d.enqueue({current:a.nodes.initial,index:0}),e[a.nodes.initial+" 0"]=!0;!d.isEmpty();){var f=d.dequeue();if(f.index==b.length){for(var g=0;g<a.nodes.nodes.length;g++)if(a.nodes.nodes[g].id==f.current&&a.nodes.nodes[g].accept)return!0}else for(var h=c[f.current][b[f.index]],g=0;g<h.length;g++){var i={current:h[g],index:f.index+1};e[i.current+" "+i.index]||(e[i.current+" "+i.index]=!0,d.enqueue(i))}for(var j=c[f.current][gEpsilon],g=0;g<j.length;g++){var i={current:j[g],index:f.index};e[i.current+" "+i.index]||(e[i.current+" "+i.index]=!0,d.enqueue(i))}}return!1};var gSimulator={TIMEOUT:"timeout"};gSimulator.init=function(){var a=gGraph.mode==gGraph.DFA?gDFASimulator:gGraph.mode==gGraph.NFA?gNFASimulator:gTMSimulator;gSimulator.run=a.run,gSimulator.step=a.step},gSimulator.convert=function(a){var b={},c=gGraph.charSet+(gGraph.epsilonEnabled?gEpsilon:"");return a.nodes.nodes.forEach(function(a){b[a.id]={};for(var d=0;d<c.length;d++)b[a.id][c[d]]=[]}),a.edges.edges.forEach(function(a){a.transitions[0].forEach(function(c){b[a.source][c].push(a.target)})}),b};var gTape={SELECT_RADIUS:50};gTape.init=function(){d3.select(".tape").append("circle").style("fill","none").style("stroke","blue").attr("r",gTape.SELECT_RADIUS),gTape.hide(),gTape.done=!0,gTape.running=!1},gTape.run=function(){var a=gTestMenu.text;gTape.done=!1,gTape.running=!0,d3.select(".tape").select("circle").style("stroke","blue"),gTape.input=a.split(""),gTape.index=0,gTape.follow=gTape.current=gNodes.initial,gTape.draw()},gTape.drawResult=function(a){if(!gTape.done){var b="Run finished, "+(a?"accept":"reject")+'ing string "'+gTape.input.join("")+'"';!gTape.follow||gTape.follow.accept||gTape.follow.reject||(b+=" because of a missing transition"),gErrorMenu.displayMessage(b,!1,a?"accepting run-finished":"rejecting run-finished"),gTape.done=!0}},gTape.draw=function(){var a=d3.select(".tape").select("circle");if(gTape.follow){var b=gTape.follow!=gTape.prev&&1==a.style("opacity")?100:0;
a.transition().duration(b).attr("cx",gTape.follow.x).attr("cy",gTape.follow.y).style("opacity",1),d3.select(".stepButton").text("Step").node().disabled=!1,gTape.isRejecting()?(a.style("stroke","red"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!1)):gTape.isAccepting()&&(a.style("stroke","green"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!0))}else a.style("opacity",0);var c=gGraph.mode==gGraph.TM?"current-tape-char-solid":"current-tape-char";gTape.running&&gTape.index<=gTape.input.length&&d3.selectAll(".tape-char").classed(c,function(a,b){return d3.select(this).classed(c)||gTape.index!=b||(this.focus(),this.blur()),gTape.index==b}),gTape.prev=gTape.follow},gTape.isAccepting=function(){return gGraph.mode==gGraph.DFA?"undefined"!=typeof gTape.current&&gTape.current.accept&&gTape.index==gTape.input.length:"undefined"!=typeof gTape.current&&gTape.current.accept},gTape.isRejecting=function(){return gGraph.mode==gGraph.DFA?"undefined"==typeof gTape.current||!gTape.current.accept&&gTape.index==gTape.input.length:"undefined"==typeof gTape.current||gTape.current.reject},gTape.show=function(){d3.select(".tape").style("opacity",1)},gTape.reset=function(){gTape.done=!0,gTape.running=!1,gTape.follow=null,gTape.draw()},gTape.hide=function(){gTape.reset(),d3.select(".tape").style("opacity",0)},gTape.step=function(){if(!gTape.running)return void gTape.run();if(!gTape.isRejecting()&&!gTape.isAccepting()){if(gGraph.mode==gGraph.DFA){var a=gDFASimulator.step(gGraph.save(),gTape.current.id,gTape.input,gTape.index++);gTape.current=gNodes.nodes[gNodes.getNodeIndex(a)]}else{var a=gTMSimulator.step(gGraph.save(),gTape.current.id,gTape.input.join(""),gTape.index);gTape.current=gNodes.nodes[gNodes.getNodeIndex(a.initial)],gTape.input=a.input.split(""),gTape.index=a.index,gTestMenu.disallowInput(gTape.input.join(""))}"undefined"!=typeof gTape.current&&(gTape.follow=gTape.current)}gTape.draw()};var gTMSimulator={MAX_ITER:1e5},gBlank=" ",gSquare=String.fromCharCode(9633);gTMSimulator.convert=function(a){var b={},c=gGraph.tapeSet+(gGraph.epsilonEnabled?gEpsilon:"");return a.nodes.nodes.forEach(function(a){b[a.id]={};for(var d=0;d<c.length;d++)b[a.id][c[d]]=null}),a.edges.edges.forEach(function(a){a.transitions[0].forEach(function(c){b[a.source][c.from]=JSON.parse(JSON.stringify(c)),b[a.source][c.from].target=a.target})}),b},gTMSimulator.step=function(a,b,c,d){var e=gTMSimulator.convert(a);return e[b][c[d]],gTMSimulator.stepState(e,{initial:b,input:c,index:d})},gTMSimulator.stepState=function(a,b){var c=b.input;c.length==b.index&&(c+=gBlank);var d=a[b.initial][c[b.index]];if(void 0==d)return{initial:void 0,input:c,index:b.index};var e={initial:d.target,index:b.index+d.direction};for(e.input=c.substring(0,b.index)+d.to+c.substring(b.index+1);e.index<0;)e.index++,e.input=gBlank+e.input;for(;e.index>=e.input.length;)e.input+=gBlank;return e},gTMSimulator.run=function(a,b){for(var c={initial:a.nodes.initial,input:b,index:0},d=gTMSimulator.convert(a),e=0;e<gTMSimulator.MAX_ITER;e++){if(void 0==c.initial)return gSimulator.output=c.input,!1;var f=a.nodes.nodes[gNodes.getNodeIndex(c.initial)];if(f.accept)return gSimulator.output=c.input,!0;if(f.reject)return gSimulator.output=c.input,!1;e<gTMSimulator.MAX_ITER-1&&(c=gTMSimulator.stepState(d,c))}return gSimulator.output=c.input,gSimulator.TIMEOUT};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock);var gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}},Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}();gEdges.initDragging=function(){gEdges.dragging=!1,gEdges.startNode=null,gEdges.backupNode=null,gEdges.endNode=null;var a=function(){return!0};gBehaviors.addBehavior("lowerNodes","mouseover",function(){return!gNodes.dragging},gEdges.showTempEdge),gBehaviors.addBehavior("lowerNodes","mousemove",function(){return!gNodes.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("lowerNodes","mousedown",a,gEdges.startDragging),gBehaviors.addBehavior("background","mousedown",function(){if(null==gEdges.startNode)return!1;var a=d3.mouse(d3.select("svg").node()),b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b<=gNodes.SELECTABLE_RADIUS&&b>gNodes.RADIUS},gEdges.startDragging),gBehaviors.addBehavior("nodes","mouseover",function(){return!gEdges.dragging&&gEdges.tempVisible},gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseover",function(){return gEdges.dragging},gEdges.setTempEdgeEnd),gBehaviors.addBehavior("nodes","mouseout",a,gEdges.unsetTempEdgeEnd),gBehaviors.addBehavior("background","mousemove",function(){var a=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){var a=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("background","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mouseup",a,gEdges.hideTempEdge),gBehaviors.addBehavior("background","mouseup",a,gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseup",function(){return gEdges.dragging},gEdges.addTempEdge)},gEdges.unsetTempEdgeEnd=function(a){null!=gEdges.endNode&&(gEdges.endNode=null,gGraph.draw())},gEdges.setTempEdgeEnd=function(a){gEdges.endNode=a,gGraph.draw()},gEdges.addTempEdge=function(a){gEdges.endNode=null,gEdges.backupNode=null,gEdges.hideTempEdge();var b=gEdges.getEdge(gEdges.startNode,a);null==b&&(gEdges.addEdge(gEdges.startNode,a),b=gEdges.edges[gEdges.edges.length-1]),gGraph.draw(),gEdges.editEdge(b)},gEdges.startDragging=function(){gEdges.dragging=!0},gEdges.hideTempEdge=function(){var a=d3.mouse(d3.select("svg").node()),b=gNodes.SELECTABLE_RADIUS+1;null!=gEdges.backupNode&&(b=Math.sqrt(Math.pow(a[0]-gEdges.backupNode.x,2)+Math.pow(a[1]-gEdges.backupNode.y,2))),null==gEdges.backupNode||b>gNodes.SELECTABLE_RADIUS?(d3.select("path.temp").remove(),gEdges.dragging=!1,gEdges.tempVisible=!1):(gEdges.startNode=gEdges.backupNode,gEdges.dragging=!1,gEdges.drawTempEdge())},gEdges.drawTempEdge=function(){if(null!=gEdges.startNode){if(gNodes.dragging)return d3.select("path.temp").remove(),gEdges.dragging=!1,void(gEdges.tempVisible=!1);var a=d3.mouse(d3.select("svg").node());d3.select("path.temp").remove(),gEdges.initialEdge=d3.select(".miscEdges").append("path").classed("temp",!0).style("marker-end","url(#mouse-arrow)").attr("fill","none").attr("d",function(){return null!=gEdges.endNode?gEdges.customPathFunction(gEdges.startNode,gEdges.endNode):gEdges.customPathFunction(gEdges.startNode,{x:a[0],y:a[1]})}).style("marker-end",function(){return null==gEdges.endNode?"url(#mouse-arrow)":"url(#end-arrow)"})}},gEdges.showTempEdge=function(a){gNodes.dragging||(gEdges.dragging?gEdges.backupNode=a:(gEdges.startNode=a,gEdges.tempVisible=!0,gEdges.drawTempEdge()))};var gEdges={BIDIRECTIONAL_OFFSET:8,LOOP_WIDTH:70,LOOP_HEIGHT:80,LOOP_PEAK:50,LOOP_TEXT_OFFSET:70,TEXT_OFFSET:10,TRANSITION_DY:20,TSPAN_HEIGHT:10,SELECTABLE_WIDTH:25,MARKER_SIZE:30,END_ARROW_OFFSET:36,MOUSE_ARROW_OFFSET:13};gEdges.init=function(){gEdges.lowerG=d3.select("g.edgesLower"),gEdges.upperG=d3.select("g.edges"),gEdges.straightLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),gEdges.curvedLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis"),gEdges.lineFunction=function(a){return a[0].x==a[1].x&&a[0].y==a[1].y?gEdges.curvedLineFunction([{x:a[0].x,y:a[0].y},{x:a[0].x+gEdges.LOOP_PEAK,y:a[0].y-gEdges.LOOP_HEIGHT/2},{x:a[0].x+gEdges.LOOP_WIDTH,y:a[0].y},{x:a[0].x+gEdges.LOOP_PEAK,y:a[0].y+gEdges.LOOP_HEIGHT/2},{x:a[0].x,y:a[0].y}]):gEdges.straightLineFunction(a)},gEdges.customPathFunction=function(a,b){var c={x:a.x,y:a.y},d={x:b.x,y:b.y};return b.id!=a.id&&gEdges.areConnected(b.id,a.id)&&(c=gEdges.offsetPoint(c,a,b,gEdges.BIDIRECTIONAL_OFFSET),d=gEdges.offsetPoint(d,a,b,gEdges.BIDIRECTIONAL_OFFSET)),gEdges.lineFunction([c,d])},gEdges.pathFunction=function(a){return gEdges.customPathFunction(a.source,a.target)},gEdges.buildMarker("end-arrow",gEdges.END_ARROW_OFFSET,"black"),gEdges.buildMarker("mouse-arrow",gEdges.MOUSE_ARROW_OFFSET,"black"),gEdges.edges=[],gEdges.edgeMap={},gEdges.initInitial(),gEdges.initSelection(),gEdges.initDragging(),gEdges.initEditing()},gEdges.addEdge=function(a,b){var c={};c.source=a,c.target=b,c.transitions=[[]],gEdges.edges.push(c),gEdges.edgeMap[a.id].push(b.id)},gEdges.removeEdge=function(a,b){gEdges.edges=gEdges.edges.filter(function(c){return c.source.id!=a.id||c.target.id!=b.id});var c=gEdges.edgeMap[a.id].indexOf(b.id);gEdges.edgeMap[a.id].splice(c,1)},gEdges.addNode=function(a){gEdges.edgeMap[a.id]=[]},gEdges.removeNode=function(a){a.id==gEdges.startNode.id&&(gEdges.startNode=null,gEdges.hideTempEdge()),gEdges.edges=gEdges.edges.filter(function(b){return b.source.id!=a.id&&b.target.id!=a.id});for(var b in gEdges.edgeMap){var c=gEdges.edgeMap[b].indexOf(a.id);gEdges.edgeMap[b].splice(c,1)}delete gEdges.edgeMap[a.id]},gEdges.save=function(){var a={edgeMap:JSON.parse(JSON.stringify(gEdges.edgeMap)),edges:JSON.parse(JSON.stringify(gEdges.edges))};return a.edges.forEach(function(a){a.source=a.source.id,a.target=a.target.id}),a},gEdges.load=function(a){gEdges.edges=a.edges,gEdges.edgeMap=a.edgeMap,gEdges.edges.forEach(function(a){a.source=gNodes.nodes[gNodes.getNodeIndex(a.source)],a.target=gNodes.nodes[gNodes.getNodeIndex(a.target)]})},gEdges.createDOMEdges=function(a,b){gBehaviors.apply("edges",a.append("path").attr("fill","none").classed("lower",!0).classed("transparent",!0)),b=b.append("g"),gBehaviors.apply("edges",b),b.append("path").attr("fill","none").classed("edge",!0),b.append("text")},gEdges.drawDOMEdges=function(a,b){a.attr("d",gEdges.pathFunction),b.select("path").attr("d",gEdges.pathFunction).classed("selected",function(a){return a.selected}).style("marker-end",function(a){return a.selected?"url(#sel-arrow)":"url(#end-arrow)"});var c=b.select("text").selectAll("tspan").data(function(a){return gGraph.mode==gGraph.TM?a.transitions[0]:a.transitions});c.enter().append("tspan"),c.text(gEdges.getEdgeLabel).attr("x",function(a,b,c){var d;return d3.select(this.parentNode).each(function(a,b){d=a}),gEdges.getTextPosition(d.source,d.target,this.parentNode.getBoundingClientRect()).x}).attr("dy",gEdges.TRANSITION_DY),b.select("text").attr("x",function(a){return gEdges.getTextPosition(a.source,a.target,this.getBoundingClientRect()).x}).attr("y",function(a){var b=d3.select(this).selectAll("tspan").size()-1;return gEdges.getTextPosition(a.source,a.target,this.getBoundingClientRect()).y+b*gEdges.TSPAN_HEIGHT}),c.exit().remove(),gEdges.drawInitial()},gEdges.destroyDOMEdges=function(a,b){a.remove(),b.remove()},gEdges.draw=function(){isIE&&(gEdges.lowerG.selectAll("path").remove(),gEdges.upperG.selectAll("g").remove());var a=gEdges.lowerG.selectAll("path").data(gEdges.edges,gEdges.getEdgeId),b=gEdges.upperG.selectAll("g").data(gEdges.edges,gEdges.getEdgeId);gEdges.createDOMEdges(a.enter(),b.enter()),gEdges.drawDOMEdges(a,b),gEdges.destroyDOMEdges(a.exit(),b.exit())},gEdges.areConnected=function(a,b){return null!=gEdges.endNode&&a==gEdges.startNode.id&&b==gEdges.endNode.id||gEdges.edgeMap[a]&&gEdges.edgeMap[a].indexOf(b)>-1},gEdges.getEdgeLabel=function(a){if(gGraph.mode==gGraph.TM){var b=" "==a.from?gSquare:a.from,c=" "==a.to?gSquare:a.to;return b+String.fromCharCode(8594)+c+", "+(1==a.direction?"R":"L")}return gEdges.reduceLabel(a)},gEdges.reduceLabel=function(a){var b=gGraph.charSet,c="";return b.length/2>=a.length?(a.forEach(function(a){c+=a+", "}),0!=c.length&&(c=c.substring(0,c.length-2))):(c=" - ",b.split("").forEach(function(b){-1==a.indexOf(b)&&(c+=b+", ")}),c=6!=c.length?c.substring(0,c.length-2):"",-1!=a.indexOf(gEpsilon)&&(c+=" + "+gEpsilon)),c},gEdges.getEdgeId=function(a){return a.source.id+" "+a.target.id},gEdges.getEdge=function(a,b){var c=null;return gEdges.edges.forEach(function(d){d.source.id==a.id&&d.target.id==b.id&&(c=d)}),c},gEdges.buildMarker=function(a,b,c){d3.select("svg").append("svg:defs").append("svg:marker").attr("id",a).attr("viewBox","0 -50 100 100").attr("refX",b).attr("markerWidth",gEdges.MARKER_SIZE).attr("markerHeight",gEdges.MARKER_SIZE).attr("orient","auto").append("svg:path").attr("d","M 0,-5 L 10,0 L 0,5 z").attr("fill",c).attr("stroke",c).style("pointer-events","none")},gEdges.getTextPosition=function(a,b,c){var d={x:a.x,y:a.y},e={x:b.x,y:b.y};b.id==a.id?(d.x+=gEdges.LOOP_TEXT_OFFSET,d.y-=1,e.x+=gEdges.LOOP_TEXT_OFFSET,e.y+=1):gEdges.areConnected(b.id,a.id)&&(d=gEdges.offsetPoint(d,a,b,gEdges.BIDIRECTIONAL_OFFSET),e=gEdges.offsetPoint(e,a,b,gEdges.BIDIRECTIONAL_OFFSET));var f={x:(d.x+e.x)/2,y:(d.y+e.y)/2},g=Math.bound(Math.atan2(d.y-e.y,d.x-e.x)+Math.PI/2,0,2*Math.PI),h=Math.sqrt(Math.pow(c.height/2,2)+Math.pow(c.width/2,2)),i=g>Math.PI?-1:1,j=g<3*Math.PI/2&&g>=Math.PI/2?-1:1,k=Math.bound(Math.atan2(i*c.height,j*c.width),0,2*Math.PI),l=Math.abs(k-g),m=Math.cos(l)*h;return m+=gEdges.TEXT_OFFSET,{x:f.x+Math.cos(g)*m,y:f.y-c.height+Math.sin(g)*m}},gEdges.offsetPoint=function(a,b,c,d){var e=Math.atan2(b.y-c.y,b.x-c.x),f=e+Math.PI/2;return{x:a.x+Math.cos(f)*d,y:a.y+Math.sin(f)*d}},gEdges.initEditing=function(){gEdges.editedEdge=null,gBehaviors.addBehavior("edges","dblclick",function(){return!0},gEdges.editEdge),d3.select(".edgeChars").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("edgeEntry")})},gEdges.populateTMEdgeModal=function(a){d3.select(".tmEdgeEntry").select(".modal-header").text("Edit Transition "+a.source.name+" "+String.fromCharCode(8594)+" "+a.target.name);for(var b=JSON.parse(JSON.stringify(gEdges.editedEdge.transitions[0])),c=0;c<b.length;c++)" "==b[c].from&&(b[c].from="")," "==b[c].to&&(b[c].to="");gModalMenu.tmEdge.setTmEdgeStates(b)},gEdges.populateEdgeModal=function(a){var b=a.transitions[0].join(""),c=b.length>0&&b[b.length-1]==gEpsilon;c&&(b=b.substring(0,b.length-1)),gModalMenu.setEdgeChars(b),gModalMenu.setEpsilon(c)},gEdges.editEdge=function(a){gEdges.editedEdge=a,gGraph.mode==gGraph.TM?(gEdges.populateTMEdgeModal(a),gModalMenu.open("tmEdgeEntry")):(gEdges.populateEdgeModal(a),gModalMenu.open("edgeEntry")),gModalMenu.open(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),d3.event.stopPropagation()},gEdges.editCancelled=function(){0==gEdges.editedEdge.transitions[0].length&&gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.deleteEditedEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.tmEditComplete=function(){for(var a=gModalMenu.tmEdge.getTmEdgeStates(),b="",c=!1,d=0;d<a.length;d++){if(""==a[d].to&&(a[d].to=" "),""==a[d].from){if(a[d].from=" ",c)return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for blank");c=!0}else if(-1!=b.indexOf(a[d].from))return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for character "+a[d].from);if(b+=a[d].from,1!=intersection(a[d].to,gGraph.tapeSet).length||1!=intersection(a[d].from,gGraph.tapeSet).length)return void gErrorMenu.displayModalError("tmEdgeEntry","Please only use characters in the character set")}if(0==a.length)return void gErrorMenu.displayModalError("tmEdgeEntry","You must define at least one transition");for(var d=0;d<gEdges.edges.length;d++){var e=gEdges.edges[d];if(e.source.id==gEdges.editedEdge.source.id&&e.target.id!=gEdges.editedEdge.target.id){for(var f=0;f<a.length;f++)for(var g=0;g<e.transitions[0].length;g++)a[f].from==e.transitions[0][g].from&&e.transitions[0].splice(g--,1);0==e.transitions[0].length&&gEdges.removeEdge(e.source,e.target)}}gEdges.editedEdge.transitions[0]=a,gEdges.editedEdge=null,gModalMenu.close("tmEdgeEntry"),gGraph.draw(),gGraph.draw()},gEdges.editComplete=function(){var a=removeDuplicates(gModalMenu.getEdgeCharacters().replace(/[\s,]/g,"")),b=intersection(gGraph.charSet,a),c=a;if(a=b,gModalMenu.setEdgeChars(b),a+=gModalMenu.getEpsilon()?gEpsilon:"",b.length!=c.length&&(0==a.length?gErrorMenu.displayModalError("edgeEntry","Ignoring characters that aren't in the alphabet."):gErrorMenu.displayError("Ignoring characters that aren't in the alphabet.")),0==a.length)return void gErrorMenu.displayModalError("edgeEntry","Transitions must take at least one character");var d=a.split("");d.sort();for(var e=0;e<d.length-1;e++)d[e]==d[e+1]&&d.splice(e--,1);if(gGraph.mode==gGraph.DFA){var f=!1;d.forEach(function(a){for(var b=0;b<gEdges.edges.length;b++){var c=gEdges.edges[b];if(c!=gEdges.editedEdge&&c.source==gEdges.editedEdge.source){var d=c.transitions[0].indexOf(a);-1!=d&&(c.transitions[0].splice(d,1),0==c.transitions[0].length&&(gEdges.removeEdge(c.source,c.target),b--,f=!0))}}}),f&&gErrorMenu.displayError("Removed duplicate transitions")}gEdges.editedEdge.transitions[0]=d,gEdges.editedEdge=null,gModalMenu.close("edgeEntry"),gGraph.draw()},gEdges.INITIAL_EDGE_LENGTH=60,gEdges.INITIAL_OVERLAP_RANGE=7,gEdges.INITIAL_OVERLAP_ANGLE=20,gEdges.initInitial=function(){d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none")},gEdges.drawInitial=function(){var a=gNodes.initial;if(null==a)d3.select("path.initial").style("opacity",0);else{var b=0,c=gEdges.INITIAL_EDGE_LENGTH;gEdges.edges.forEach(function(d){var e=Math.min(d.source.x,d.target.x),f=Math.max(d.source.x,d.target.x);if(a.x<=f&&a.x-gEdges.INITIAL_EDGE_LENGTH>=e&&d.target.x-d.source.x!=0){var g=(d.target.y-d.source.y)/(d.target.x-d.source.x),h=d.source.y-g*d.source.x,i=g*(a.x-gEdges.INITIAL_EDGE_LENGTH)+h,j=g*a.x+h;Math.abs(i-a.y)<=gEdges.INITIAL_OVERLAP_RANGE&&Math.abs(j-a.y)<=gEdges.INITIAL_OVERLAP_RANGE&&(c=Math.cos(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,b=Math.sin(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,j>i&&(b*=-1))}}),d3.select("path.initial").style("opacity",1).attr("d",function(){return gEdges.lineFunction([{x:a.x-c,y:a.y-b},{x:a.x,y:a.y}])})}},isIE&&(gEdges.initInitial=function(){},gEdges.drawInitial=function(){d3.select("path.initial").remove();var a=gNodes.initial;null!=a&&d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none").attr("d",function(){return gEdges.lineFunction([{x:a.x-gEdges.INITIAL_EDGE_LENGTH,y:a.y},{x:a.x,y:a.y}])})}),gEdges.SELECTED_COLOR="blue",gEdges.initSelection=function(){gEdges.buildMarker("sel-arrow",gEdges.END_ARROW_OFFSET,gEdges.SELECTED_COLOR),gBehaviors.addBehavior("edges","mousedown",function(){return!0},function(a){gShiftKey||a.selected||(gNodes.deselectAll(),gEdges.deselectAll()),a.selected=!0,gGraph.draw()})},gEdges.deleteSelected=function(){var a=[];gEdges.edges.forEach(function(b){b.selected&&a.push(b)}),a.forEach(function(a){gEdges.removeEdge(a.source,a.target)})},gEdges.deselectAll=function(){gEdges.edges.forEach(function(a){a.selected=!1})},gEdges.selectionIsEmpty=function(){return 0==gEdges.selectionSize()},gEdges.selectionSize=function(){return gEdges.edges.filter(function(a){return a.selected}).length},gNodes.doubleClickInit=function(){gBehaviors.addBehavior("background","dblclick",function(){return!gTableTopMenu.active},function(){var a=d3.mouse(d3.select("svg").node());gNodes.addNode(a[0],a[1]),gNodes.draw()})},gNodes.editInit=function(){gNodes.editedNode=null,gBehaviors.addBehavior("nodes","dblclick",function(){return!0},gNodes.editNode),d3.select(".nodeName").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("nodeEntry")})},gNodes.editNode=function(a){gNodes.editedNode=a,gModalMenu.setNodeName(a.name),gModalMenu.setInitial(null!=gNodes.initial&&a.id==gNodes.initial.id),gModalMenu.setState(a.accept,a.reject),gModalMenu.open("nodeEntry"),d3.event.stopPropagation()},gNodes.editComplete=function(){var a=gModalMenu.getNodeName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayModalError("nodeEntry","State name cannot be blank.");var b=gNodes.getNodeIndexFromName(a);-1==b||gNodes.nodes[b].id==gNodes.editedNode.id?(gNodes.editedNode.accept=gModalMenu.getAccepting(),gNodes.editedNode.reject=gModalMenu.getRejecting(),gModalMenu.getInitial()?gNodes.initial=gNodes.editedNode:null!=gNodes.initial&&gNodes.editedNode.id==gNodes.initial.id&&(gNodes.initial=null),gNodes.editedNode.name=a,gNodes.editedNode=null,gModalMenu.close("nodeEntry"),gGraph.draw()):gErrorMenu.displayModalError("nodeEntry",'State name "'+a+'" is already in use.')},gNodes.deleteEdited=function(){if(null!=gTape.follow&&gTape.follow.id==gNodes.editedNode.id){if(!gTape.done)return void gErrorMenu.displayModalError("nodeEntry","The current state in a running test cannot be deleted");gTestMenu.end()}gNodes.removeByIndex(gNodes.getNodeIndex(gNodes.editedNode.id)),gModalMenu.close("nodeEntry"),gGraph.draw()},gNodes.FORCE_LAYOUT_ITERATIONS=1e5,gNodes.forcedDirectedLayout=function(){var a=[];gNodes.nodes.forEach(function(b){a.push({x:b.x,y:b.y,vx:0,vy:0})});var b=[];gEdges.edges.forEach(function(a){b.push({source:gNodes.getNodeIndex(a.source.id),target:gNodes.getNodeIndex(a.target.id)})});var c=d3.layout.force().nodes(a).links(b).linkDistance(200).charge(-300).gravity(.01).size([gGraph.width-2*gGraph.BUFFER,gGraph.height-2*gGraph.BUFFER]);c.start();for(var d=0;d<gNodes.FORCE_LAYOUT_ITERATIONS;d++)c.tick();c.stop();for(var d=0;d<a.length;d++)gNodes.nodes[d].x=a[d].x,gNodes.nodes[d].y=a[d].y;gNodes.scale()},gNodes.moveSelected=function(a,b){a+=gNodes.selectionX,b+=gNodes.selectionY,gNodes.selectionX=0,gNodes.selectionY=0;var c=function(a){return a.selected},d=function(a){return a.source.selected||a.target.selected};if(gNodes.validMoveX(a)?gNodes.nodes.filter(c).forEach(function(b){b.x+=a}):gNodes.selectionX+=a,gNodes.validMoveY(b)?gNodes.nodes.filter(c).forEach(function(a){a.y+=b}):gNodes.selectionY+=b,isIE)gGraph.draw();else{var e=d3.select("g.nodes").selectAll("g").filter(c),f=d3.select("g.nodesLower").selectAll("circle").filter(c);gNodes.drawDOMNodes(f,e),e=d3.select("g.edges").selectAll("g").filter(d),f=d3.select("g.edgesLower").selectAll("path").filter(d),gEdges.drawDOMEdges(f,e),gEdges.drawInitial(),gTape.draw()}},gNodes.movementInit=function(){gBehaviors.addBehavior("nodes","drag",function(a){return a.selected},function(a){gNodes.moveSelected(d3.event.dx,d3.event.dy)})};var gNodes={SELECTABLE_RADIUS:50,RADIUS:30,INNER_RADIUS:24,STROKE_WIDTH:2,NEW_BUFFER:100,NEW_INCREMENT:100,IE_TEXT_OFFSET:5};gNodes.init=function(){gNodes.lowerG=d3.select("g.nodesLower"),gNodes.upperG=d3.select("g.nodes"),gNodes.nodes=[],gNodes.initial=null,gNodes.selectionInit(),gNodes.movementInit(),gNodes.doubleClickInit(),gNodes.editInit()},gNodes.setInitial=function(){var a=gNodes.nodes.filter(function(a){return a.selected});a.length>0&&(gNodes.initial=a[0])},gNodes.setAccepting=function(a){gNodes.nodes.filter(function(a){return a.selected}).forEach(function(b){b.accept=a})},gNodes.setRejecting=function(a){gNodes.nodes.filter(function(a){return a.selected}).forEach(function(b){b.reject=a})},gNodes.wouldOverlap=function(a,b){var c=!1;return gNodes.nodes.forEach(function(d){c|=dist(a,b,d.x,d.y)<=2*gNodes.RADIUS}),c},gNodes.addNode=function(a,b){var c={};if("undefined"==typeof a){var d=!1;for(c.y=gNodes.NEW_BUFFER;c.y<=gGraph.height-gNodes.NEW_BUFFER&&!d;c.y+=gNodes.NEW_INCREMENT)for(c.x=gNodes.NEW_BUFFER;c.x<=gGraph.width-gNodes.NEW_BUFFER&&!d;c.x+=gNodes.NEW_INCREMENT)d=!gNodes.wouldOverlap(c.x,c.y);c.x-=gNodes.NEW_INCREMENT,c.y-=gNodes.NEW_INCREMENT}else c.x=a,c.y=b;for(var e=0;-1!=gNodes.getNodeIndexFromName("n"+e);)e++;c.id=e,c.name="n"+c.id,c.accept=!1,c.reject=!1,c.selected=!0,gNodes.deselectAll(),gNodes.nodes.push(c),gEdges.addNode(c)},gNodes.setInitialByIndex=function(a){gNodes.initial=gNodes.nodes[a]},gNodes.clearInitial=function(){gNodes.initial=null},gNodes.setAcceptByIndex=function(a,b){gNodes.nodes[a].accept=b},gNodes.setRejectByIndex=function(a,b){gNodes.nodes[a].reject=b},gNodes.removeByIndex=function(a){null!=gTape.follow&&gTape.follow.id==gNodes.nodes[a].id&&gTestMenu.end(),null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[a].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[a]),gNodes.nodes.splice(a,1)},gNodes.removeNodes=function(){if(null!=gTape.follow&&gTape.follow.selected){if(!gTape.done)return gErrorMenu.displayError("The current state in a running test cannot be deleted"),!1;gTestMenu.end()}for(var a=0;a<gNodes.nodes.length;a++)gNodes.nodes[a].selected&&(null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[a].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[a]),gNodes.nodes.splice(a--,1));return!0},gNodes.createDOMNodes=function(a,b){gBehaviors.apply("lowerNodes",a.append("circle").classed("transparent",!0).attr("r",gNodes.SELECTABLE_RADIUS)),b=b.append("g"),gBehaviors.apply("nodes",b.append("circle").classed("outer",!0).attr("r",gNodes.RADIUS)),gBehaviors.apply("nodes",b.append("circle").classed("inner",!0).attr("r",gNodes.INNER_RADIUS)),b.append("text")},gNodes.getSelected=function(){var a=[];return gNodes.nodes.forEach(function(b){b.selected&&a.push(b.name)}),a},gNodes.save=function(){return{nodes:gNodes.nodes,initial:null==gNodes.initial?null:gNodes.initial.id}},gNodes.load=function(a){gNodes.nodes=a.nodes,gNodes.initial=a.initial,null!=gNodes.initial&&(gNodes.initial=gNodes.nodes[gNodes.getNodeIndex(gNodes.initial)]),gNodes.nextId=0,gNodes.nodes.forEach(function(a){gNodes.nextId=Math.max(a.id+1,gNodes.nextId)}),gNodes.scale()},gNodes.scale=function(){if(gNodes.nodes.length>0){for(var a=gNodes.nodes[0].x,b=gNodes.nodes[0].x,c=gNodes.nodes[0].y,d=gNodes.nodes[0].y,e=1;e<gNodes.nodes.length;e++)a=Math.min(a,gNodes.nodes[e].x),b=Math.max(b,gNodes.nodes[e].x),c=Math.min(c,gNodes.nodes[e].y),d=Math.max(d,gNodes.nodes[e].y);var f=a,g=b;(gGraph.BUFFER>a||gGraph.width-gGraph.BUFFER<b)&&(f=gGraph.BUFFER,g=gGraph.width-gGraph.BUFFER);var h=c,i=d;(gGraph.BUFFER>c||gGraph.height-gGraph.BUFFER<d)&&(h=gGraph.BUFFER,i=gGraph.height-gGraph.BUFFER);for(var e=0;e<gNodes.nodes.length;e++){var j=b-a,k=0==j?1:(gNodes.nodes[e].x-a)/j,l=d-c,m=0==l?1:(gNodes.nodes[e].y-c)/l;gNodes.nodes[e].x=f*(1-k)+g*k,gNodes.nodes[e].y=h*(1-m)+i*m}}},gNodes.selectionIsAccepting=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,c.selected&&!c.accept&&(a=!1))}),a&&b},gNodes.selectionIsRejecting=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,c.selected&&!c.reject&&(a=!1))}),a&&b},gNodes.selectionIsNeither=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,(c.accept||c.reject)&&(a=!1))}),a&&b},gNodes.drawDOMNodes=function(a,b){a.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.classed("selected",function(a){return a.selected}).classed("accept",function(a){return a.accept}).classed("reject",function(a){return a.reject}),b.select("circle.inner").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.select("circle.outer").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.select("text").text(function(a){return a.name}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y+(isIE?gNodes.IE_TEXT_OFFSET:0)})},gNodes.destroyDOMNodes=function(a,b){a.remove(),
b.remove()},gNodes.draw=function(){if(isIE&&(gNodes.lowerG.selectAll("circle").remove(),gNodes.upperG.selectAll("g").remove()),gNodes.upperG.select(".empty-text").remove(),0==gNodes.nodes.length){var a=isSafari?"Click Add New State to create your first node.":"Double-click to create your first node.";gNodes.upperG.append("text").classed("empty-text",!0).style("font-size",20).style("font-family",'"San Francisco", "Helvetica Neue", "Helvetica", "Arial", sans-serif').style("fill","rgba(0, 0, 0, 0.4)").style("stroke","none").attr("x",gGraph.width/2).attr("y",gGraph.height/2).text(a)}var b=gNodes.lowerG.selectAll("circle").data(gNodes.nodes,function(a){return a.id}),c=gNodes.upperG.selectAll("g").data(gNodes.nodes,function(a){return a.id});gNodes.createDOMNodes(b.enter(),c.enter()),gNodes.drawDOMNodes(b,c),gNodes.destroyDOMNodes(b.exit(),c.exit())},gNodes.validMoveX=function(a){var b=!0;return gNodes.nodes.filter(function(a){return a.selected}).forEach(function(c){b&=c.x+a>=gNodes.RADIUS+gNodes.STROKE_WIDTH||a>=0,b&=c.x+a<=gGraph.width-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=a}),b},gNodes.validMoveY=function(a){var b=!0;return gNodes.nodes.filter(function(a){return a.selected}).forEach(function(c){b&=c.y+a>=gNodes.RADIUS+gNodes.STROKE_WIDTH||a>=0,b&=c.y+a<=gGraph.height-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=a}),b},gNodes.getNodeIndex=function(a){var b=-1;return gNodes.nodes.forEach(function(c,d){c.id==a&&(b=d)}),b},gNodes.getNodeIndexFromName=function(a){var b=-1;return gNodes.nodes.forEach(function(c,d){c.name===a&&(b=d)}),b},gNodes.select=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected=!0},gNodes.deselect=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected=!1},gNodes.toggleSelection=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected^=!0},gNodes.deselectAll=function(){gNodes.nodes.forEach(function(a){a.selected=!1})},gNodes.selectionIsEmpty=function(){return 0==gNodes.selectionSize()},gNodes.selectionSize=function(){return gNodes.nodes.filter(function(a){return a.selected}).length},gNodes.selectionInit=function(){gBehaviors.addBehavior("nodes","mousedown",function(){return!0},function(a){gShiftKey||a.selected||(gNodes.deselectAll(),gEdges.deselectAll()),a.selected=!0,gGraph.draw()}),gBehaviors.addBehavior("brush","brushstart",function(){return!0},function(){gNodes.nodes.forEach(function(a){a.previouslySelected=gShiftKey&&a.selected}),gEdges.deselectAll()}),gBehaviors.addBehavior("brush","brush",function(){return!0},function(){var a=d3.event.target.extent();gNodes.nodes.forEach(function(b){b.selected=b.previouslySelected^(a[0][0]<=b.x&&b.x<a[1][0]&&a[0][1]<=b.y&&b.y<a[1][1])}),gGraph.draw()})},gNodes.GRID_SPACING=150,gNodes.snapToGrid=function(){for(var a=[],b=gNodes.GRID_SPACING;b<=gGraph.width-gNodes.GRID_SPACING;b+=gNodes.GRID_SPACING)for(var c=gNodes.GRID_SPACING;c<=gGraph.height-gNodes.GRID_SPACING;c+=gNodes.GRID_SPACING)a.push({x:b,y:c});var d=[],e=-1;if(gNodes.nodes.forEach(function(a,b){null!=gNodes.initial&&gNodes.initial.id==a.id&&(e=b),d.push({x:a.x,y:a.y,i:b})}),!(a.length<d.length))for(;d.length>0&&a.length>0;){for(var f=-1,g=-1,h=-1,i=0;i<d.length;i++)for(var j=0;j<a.length;j++){var k=Math.pow(d[i].x-a[j].x,2)+Math.pow(d[i].y-a[j].y,2);(-1==h||f>k)&&(g=j,h=i,f=k)}gNodes.nodes[d[h].i].x=a[g].x,gNodes.nodes[d[h].i].y=a[g].y,d.splice(h,1),a.splice(g,1)}};var gErrorMenu={DISPLAY_TIME:2100,FADE_OUT_TIME:400,MAX_ERRORS:3};gErrorMenu.displayMessage=function(a,b,c){var d=d3.select(".errors").append("span").text(a).classed(c,!0);1!=b&&d.transition().delay(gErrorMenu.DISPLAY_TIME).duration(gErrorMenu.FADE_OUT_TIME).ease("cubic").style("opacity",0).remove();var e=d3.select(".errors").selectAll("span").size();d3.select(".errors").selectAll("span").filter(function(a,b){return b<e-gErrorMenu.MAX_ERRORS}).remove()},gErrorMenu.displayError=function(a,b){gErrorMenu.displayMessage(a,b,"error")},gErrorMenu.displayModalError=function(a,b){d3.select("."+a).select(".modal-content").insert("p",":first-child").classed("modal-description",!0).classed("error",!0).text(b)},gErrorMenu.clearModalErrors=function(){d3.selectAll(".modal-description.error").remove()};var gTableMenu={};gTableMenu.updateAll=function(){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split(""),gEdges.edges=[];var b=[];gNodes.nodes.forEach(function(a){gEdges.edgeMap[a.id]=[];var c=[];gNodes.nodes.forEach(function(){c.push(gGraph.mode==gGraph.TM?{}:"")}),b.push(c)});var c=!1,d=!1,e=!1;d3.selectAll("input.gridInput").each(function(a,f){var g=f%2==0||gGraph.mode!=gGraph.TM,h=this.character,i=this.i1;if(g){var j=this.value.split(/[ \t\n\r,]/),k=!1;j.forEach(function(a){var e=gNodes.getNodeIndexFromName(a);-1!=e?(k&&gGraph.mode!=gGraph.NFA?c=!0:gGraph.mode==gGraph.TM?b[i][e][h]={from:h}:b[i][e]+=h,k=!0):""!=a&&(d=!0)})}else{var l=this.value;if(intersection(l,gGraph.tapeSet).length!=l.length)return void(e=!0);var m=-1;for(var n in b[i])if(void 0!=b[i][n][h]){m=n;break}-1!=m&&void 0!=b[i][m][h]&&(b[i][m][h].to=""==l?" ":l)}}),d3.selectAll(".moveRight").each(function(){var a=this.character,c=this.i1,d=this.checked?1:-1,e=-1;for(var f in b[c])if(void 0!=b[c][f][a]){e=f;break}-1!=e&&void 0!=b[c][e][a]&&(b[c][e][a].direction=d)}),c&&gErrorMenu.displayError("Multiple transitions defined for one character, ignoring extras"),d&&gErrorMenu.displayError("Some states entered in the table could not be found, ignoring them"),e&&gErrorMenu.displayError("Some characters were not in the tape language"),b.forEach(function(a,b){a.forEach(function(a,c){var d=[];if(gGraph.mode==gGraph.TM)for(var e in a)d.push(a[e]);if(""!=a&&(gGraph.mode!=gGraph.TM||0!=d.length)){var f=gEdges.getEdge(gNodes.nodes[b],gNodes.nodes[c]);null==f&&(gEdges.addEdge(gNodes.nodes[b],gNodes.nodes[c]),f=gEdges.edges[gEdges.edges.length-1]),-1==gEdges.edgeMap[gNodes.nodes[b].id].indexOf(gNodes.nodes[c].id)&&gEdges.edgeMap[gNodes.nodes[b].id].push(gNodes.nodes[c].id),gGraph.mode==gGraph.TM?f.transitions[0]=d:f.transitions[0]=a.split("").sort()}})})},gTableMenu.init=function(){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split("");var b=d3.select(".tableEditor").insert("tr").selectAll("td").data(a);b.enter().append("td"),b.text(function(a){return" "==a&&gGraph.mode==gGraph.TM?gSquare:a}),b.exit().remove();var c=d3.select(".tableEditor").select("tr");c.insert("td","td").text("Rejects"),c.insert("td","td").text("Accepts"),c.insert("td","td").text("Initial"),c.insert("td","td").text(""),c.append("td").text("Delete")},gTableMenu.draw=function(){if(gTableTopMenu.active){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split("");var b=d3.select(".tableEditor").selectAll("tr").filter(function(a,b){return 0!=b}).data(gNodes.nodes),c=b.enter().append("tr");c.append("td").text(function(a){return a.name}),c.append("td").append("input").attr("type","radio").classed("initialBox",!0).each(function(a){this.checked=null!=gNodes.initial&&gNodes.initial.id==a.id}).on("change",function(a,b){this.checked?gNodes.setInitialByIndex(b):gNodes.clearInitial(),gGraph.draw()}),c.append("td").append("input").attr("type","checkbox").classed("acceptBox",!0).on("change",function(a,b){gNodes.setAcceptByIndex(b,this.checked),this.checked&&gNodes.setRejectByIndex(b,!1),gGraph.draw()}),c.append("td").append("input").attr("type","checkbox").classed("rejectBox",!0).on("change",function(a,b){gNodes.setRejectByIndex(b,this.checked),this.checked&&gNodes.setAcceptByIndex(b,!1),gGraph.draw()}),d3.selectAll(".acceptBox").each(function(a,b){this.checked=gNodes.nodes[b].accept}),d3.selectAll(".rejectBox").each(function(a,b){this.checked=gNodes.nodes[b].reject});var d=b.selectAll("td").filter(function(){return null!=d3.select(this).select("input").filter(function(){return"text"==this.type}).node()}).data(a),e=d.enter().append("td").classed("tm-cell",gGraph.mode==gGraph.TM).each(function(){gGraph.mode==gGraph.TM&&d3.select(this).style("line-height","30px")});e.append("input").attr("type","text").attr("size","10").attr("placeholder","go to").classed("gridInput",!0).each(function(a,b,c){this.character=a,this.i1=c}),e.append("input").attr("type","text").attr("size","10").attr("maxlength","1").attr("placeholder","write").classed("gridInput",!0).each(function(a,b,c){this.character=a,this.i1=c}),e.append("br");var f=e.append("form");f.append("label").text("move:"),f.append("input").attr("type","radio").attr("name","move").attr("checked",!0).classed("moveLeft",!0).each(function(a,b,c){this.character=a,this.i1=c}),f.append("label").text("L"),f.append("input").attr("type","radio").attr("name","move").classed("moveRight",!0).each(function(a,b,c){this.character=a,this.i1=c}),f.append("label").text("R"),d.selectAll("input").each(function(a,b){switch(b){case 0:this.value=gTableMenu.getConnections(gNodes.nodes[this.i1].id,a);break;case 1:var c=gTableMenu.getResult(gNodes.nodes[this.i1].id,a);null!=c&&(this.value=c);break;case 2:var d=gTableMenu.getDirection(gNodes.nodes[this.i1].id,a);0!=d&&(this.checked=-1==d);break;case 3:var d=gTableMenu.getDirection(gNodes.nodes[this.i1].id,a);0!=d&&(this.checked=1==d)}}).on("blur",function(){gTableMenu.updateAll(),gTableMenu.draw()}),d.exit().remove(),c.append("td").append("button").on("click",function(a,b){gNodes.removeByIndex(b),gGraph.draw()}).text("X"),b.exit().remove()}},gTableMenu.getConnections=function(a,b){var c=[];return gEdges.edges.forEach(function(d){gGraph.mode==gGraph.TM?d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&c.push(d.target.name)}):d.source.id==a&&-1!=d.transitions[0].indexOf(b)&&c.push(d.target.name)}),c.join(", ")},gTableMenu.getDirection=function(a,b){var c=0;return gEdges.edges.forEach(function(d){d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&(c=e.direction)})}),c},gTableMenu.getResult=function(a,b){var c=null;return gEdges.edges.forEach(function(d){d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&(c=" "==e.to?"":e.to)})}),c};var gTableTopMenu={active:!1};gTableTopMenu.swap=function(){gTableTopMenu.active?(d3.select("svg").style("display","inline"),d3.select(".tableEditor, .tableEditorHeader").style("display","none"),d3.selectAll(".nontable").style("display","inline"),d3.selectAll(".nontableblock").style("display","block"),d3.select(".swapButton").text("Switch to Table View"),gTableTopMenu.active=!1,gTableMenu.updateAll()):(d3.select("svg").style("display","none"),d3.select(".tableEditor, .tableEditorHeader").style("display","table"),d3.selectAll(".nontable, .nontableblock").style("display","none"),d3.select(".swapButton").text("Switch to Editor View"),gNodes.deselectAll(),gEdges.deselectAll(),gTableTopMenu.active=!0),gGraph.mode==gGraph.DFA?d3.selectAll(".dfa-hide").style("display","none"):gGraph.mode==gGraph.NFA?d3.selectAll(".nfa-hide").style("display","none"):d3.selectAll(".tm-hide").style("display","none"),gGraph.draw()};var gTestMenu={NUM_CELLS:250,DISPLAY_TIME:4600,FADE_OUT_TIME:400};gTestMenu.init=function(){gTestMenu.reset(),gTestMenu.text="",gTestMenu.backupText="";var a=d3.select(".tape-field");gTestMenu.showPlaceholder=!0;for(var b=0;b<gTestMenu.NUM_CELLS;b++)a.append("input").attr("type","text").classed("tape-char",!0).attr("name","tapeChar[]").attr("maxlength",1).attr("readonly","readonly").on("click",gTestMenu.allowInput);d3.select(".tape-char-input").attr("maxlength",gTestMenu.NUM_CELLS).on("keydown",function(){13==d3.event.keyCode&&(gTestMenu.disallowInput(),gTestMenu.run())}),gTestMenu.disallowInput()},gTestMenu.reset=function(){gTestMenu.setRunning(!1),d3.select(".tape-char-input").node().value=gTestMenu.backupText||"",d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.reset()},gTestMenu.allowInput=function(){gTestMenu.showPlaceholder=!1,gTestMenu.reset(),d3.select(".tape-char-input").node().value=gTestMenu.backupText,d3.selectAll(".tape-char").style("display","none"),d3.select(".tape-char-input").style("display","inline").each(function(){this.focus()})},gTestMenu.disallowInput=function(a){if(gTestMenu.backupText!=intersection(d3.select(".tape-char-input").node().value,gGraph.charSet)){gTestMenu.backupText=d3.select(".tape-char-input").node().value;var b=intersection(gTestMenu.backupText,gGraph.charSet);gTestMenu.backupText.length!=b.length&&gErrorMenu.displayError("Removing characters that aren't in the alphabet."),gTestMenu.backupText=b}gTestMenu.text=void 0==a?gTestMenu.backupText:a;var c="Click to enter a test";d3.selectAll(".tape-char").style("display","inline").style("color",gTestMenu.showPlaceholder?"#bbb":"#fff").each(function(a,b){var d=gTestMenu.showPlaceholder?c:gTestMenu.text;this.value=b<d.length?d[b]:""}),d3.select(".tape-char-input").style("display","none")},gTestMenu.unsetTransitions=function(){var a=[];if(gGraph.mode==gGraph.DFA){var b=gGraph.save(),c=gSimulator.convert(b);for(var d in c){var e=!1;for(var f in c[d])e|=0==c[d][f].length;e&&a.push(gNodes.nodes[gNodes.getNodeIndex(d)].name)}}return a},gTestMenu.runTests=function(){var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=a.length?gErrorMenu.displayError("The following states have undefined transitions: "+a.join(", ")):gModalMenu.open("testing")},gTestMenu.setRunning=function(a){a?(d3.selectAll(".running").style("display","inline"),d3.select(".runButton").text("Restart")):(d3.selectAll(".running").style("display","none"),d3.select(".runButton").text("Start"))},gTestMenu.run=function(){gTestMenu.reset();var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=a.length?gErrorMenu.displayError("The following states have undefined transitions: "+a.join(", ")):(gTestMenu.setRunning(!0),gTape.show(),gTape.run())},gTestMenu.end=function(){gTestMenu.setRunning(!1),d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.hide()},gTestMenu.step=function(){var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("No initial node is set"):0!=a.length?gErrorMenu.displayError("The following nodes have undefined transitions: "+a.join(", ")):(gTape.show(),gTape.step())};var gTopMenu={MAX_DISPLAYED_STATES:5,SELECTED_TEXT:"Selected states: "};gTopMenu.addNode=function(){gNodes.addNode(),gGraph.draw()},gTopMenu.setState=function(a,b){gNodes.selectionIsEmpty()&&gErrorMenu.displayError("No states are selected"),gNodes.setAccepting(a),gNodes.setRejecting(b),gGraph.draw()},gTopMenu.deleteSelected=function(){gNodes.selectionIsEmpty()&&gEdges.selectionIsEmpty()&&(gErrorMenu.displayError("No states or transitions are selected"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3)),gNodes.removeNodes()&&(gEdges.deleteSelected(),gGraph.draw())},gTopMenu.setInitial=function(){gNodes.selectionIsEmpty()?gErrorMenu.displayError("No states are selected"):gNodes.selectionSize()>1&&gErrorMenu.displayError("Multiple states are selected. Using the first one."),gNodes.setInitial(),gGraph.draw()},gTopMenu.snapToGrid=function(){gNodes.snapToGrid(),gGraph.draw()},gTopMenu.forcedDirectedLayout=function(){gNodes.forcedDirectedLayout(),gGraph.draw()},gTopMenu.loadFromServer=function(){gModalMenu.open("load"),gModalMenu.load.onOpen()},gTopMenu.save=function(){var a=2e3,b=gServer.name;gTopMenu.setSaveButton("Saving..."),!gModalMenu.saveas.isInvalidName(b)&&b?gServer.save(b,function(b,c){b?(gTopMenu.setSaveButton("Failed"),gErrorMenu.displayError("Save failed: couldn't connect to server.")):gTopMenu.setSaveButton("Saved!"),setTimeout(function(){gTopMenu.setSaveButton("Save")},a)}):b?(gErrorMenu.displayError('Saving to invalid name, use "Save As" to change name'),gTopMenu.setSaveButton("Save")):(gErrorMenu.displayError('Please first use "Save As" to give your automaton a name'),gTopMenu.setSaveButton("Save"))},gTopMenu.saveas=function(){gModalMenu.saveas.open()},gTopMenu.submit=function(){null!=gGraph.pset&&gModalMenu.submitModal.setPsetNumber(gGraph.pset),null!=gGraph.problem&&gModalMenu.submitModal.setProblemNumber(gGraph.problem),gModalMenu.open("submit")},gTopMenu.homepage=function(){window.location.href=getURLParent()+"index.html"},gTopMenu.draw=function(){var a="",b=gNodes.getSelected();b.sort();for(var c=0;c<gTopMenu.MAX_DISPLAYED_STATES&&c<b.length;c++)a+=b[c]+", ";a=0==b.length?"None":a.substring(0,a.length-2),b.length>gTopMenu.MAX_DISPLAYED_STATES&&(a+="...");var d=gGraph.mode.toUpperCase();"TM"==d&&(d="Turing Machine");var e=null==gGraph.pset?"":psets[gGraph.pset].name+", ",f=null==gGraph.problem&&null==gGraph.pset?"":psets[gGraph.pset].problems[gGraph.problem].name+", ";d3.select(".current-pset-problem").text(e+f),d3.select(".current-mode").text(d),d3.select(".current-alphabet").text(gGraph.charSet),"tm"===gGraph.mode&&gGraph.tapeSet&&sortString(gGraph.tapeSet)!==sortString(gGraph.charSet)&&(d3.select(".current-tape-set").style("display","inline"),d3.select(".current-tape-set-inner").text(gGraph.tapeSet)),d3.select("#selectedText").text(gTopMenu.SELECTED_TEXT+a),d3.select(".acceptButton").classed("marked",gNodes.selectionIsAccepting()),d3.select(".rejectButton").classed("marked",gNodes.selectionIsRejecting()),d3.selectAll(".neitherButton").classed("marked",gNodes.selectionIsNeither())},gTopMenu.setSaveButton=function(a){d3.select(".saveTopButton").text(a)},gModalMenu.confirm={},gModalMenu.confirm.flag="",gModalMenu.confirm.open=function(){gModalMenu.open("confirm")},gModalMenu.confirm.clickConfirmBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmBtn()},gModalMenu.confirm.clickCancelBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmCancelBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmCancelBtn()},gModalMenu.getEpsilon=function(){return gGraph.mode==gGraph.NFA&&d3.select(".epsilon").node().checked},gModalMenu.setEpsilon=function(a){d3.select(".epsilon").node().checked=a},gModalMenu.addAllEdgeChars=function(){gModalMenu.setEdgeChars(gGraph.charSet),gModalMenu.setEpsilon(!0)},gModalMenu.invertEdgeChars=function(){var a=gGraph.charSet,b=gModalMenu.getEdgeCharacters();for(var c in b)a=a.replace(b[c],"");gModalMenu.setEdgeChars(a),gModalMenu.setEpsilon(!gModalMenu.getEpsilon())},gModalMenu.addRemainingEdgeChars=function(){var a=[],b=gGraph.save(),c=gSimulator.convert(b);for(var d in c[gEdges.editedEdge.source.id])0==c[gEdges.editedEdge.source.id][d].length&&a.push(d);gModalMenu.setEdgeChars(gModalMenu.getEdgeCharacters()+a.join(""))},gModalMenu.setEdgeChars=function(a){d3.select(".edgeChars").node().value=a},gModalMenu.getEdgeCharacters=function(){return d3.select(".edgeChars").node().value},gModalMenu.deleteEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gGraph.draw(),gModalMenu.close("edgeEntry")},gModalMenu.load={},gModalMenu.load.onOpen=function(){gModalMenu.open("load"),gModalMenu.load.setLoadMessage("Gathering saved automata..."),gServer.listSaved(function(a,b){if(a)return gErrorMenu.displayModalError("load","Could not gather saved automata..."),d3.select(".load").selectAll("li").remove(),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3);var c=[];b.forEach(function(a,b,d){c.push(a.name)}),gModalMenu.load.setLoadNames(c)})},gModalMenu.load.onClickLoadBtn=function(){gErrorMenu.clearModalErrors();var a=gModalMenu.load.getLoadName();return a?(gModalMenu.load.setLoadButton("Loading..."),void gServer.load(a,function(b,c){if(b)return void("function"==typeof error_callback&&(gErrorMenu.displayModalError("load","Failed to load"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),gModalMenu.load.setLoadButton("Load")));gServer.changeName(a),gModalMenu.load.setLoadButton("Success!"),gGraph.charSet=c.meta.charSet,gGraph.pset=c.meta.pset,gGraph.problem=c.meta.problem,"tm"===d&&(gGraph.tapeSet=c.meta.tapeSet);var d=c.meta.mode;d!=gGraph.mode&&(window.location.href=getURLParent()+"tm.html?saved="+a),gGraph.load(c),gGraph.draw(),setTimeout(function(){gModalMenu.load.setLoadButton("Load"),gModalMenu.close("load")},300)})):(gErrorMenu.displayModalError("load","No automaton selected"),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3))},gModalMenu.load.setLoadNames=function(a){var b=d3.select(".loadNames").selectAll("li").data(a);b.enter().append("li"),b.classed("selected",!1).classed("load-nothing",!1).text(function(a){return a}).on("click",function(){d3.select(".loadNames").selectAll("li").classed("selected",!1),d3.select(this).classed("selected",!0)}).style("cursor","pointer"),b.exit().remove(),0==a.length&&d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text("Nothing's been saved yet")},gModalMenu.load.getLoadName=function(){var a=d3.select(".loadNames").select("li.selected").node();return null==a?null:encodeURIComponent(d3.select(".loadNames").select("li.selected").text())},gModalMenu.load.setLoadButton=function(a){d3.select(".loadButton").text(a)},gModalMenu.load.setLoadMessage=function(a){d3.select(".loadNames").selectAll("li").remove(),d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text(a)};var gModalMenu={MAX_HEIGHT_PERCENT:.62};gModalMenu.open=function(a){gModalMenu.currentType=a,d3.select("."+a).style("display","inline"),d3.select(".overlay").style("display","inline")},gModalMenu.close=function(a){gErrorMenu.clearModalErrors(),d3.select("."+a).style("display","none"),d3.select(".overlay").style("display","none")},gModalMenu.closeCurrent=function(){gModalMenu.cancel(gModalMenu.currentType)},gModalMenu.submitOnEnter=function(a){13==event.keyCode&&gModalMenu.submit(a)},gModalMenu.submit=function(a){switch(gErrorMenu.clearModalErrors(),a){case"tmEdgeEntry":gEdges.tmEditComplete();break;case"edgeEntry":gEdges.editComplete();break;case"nodeEntry":gNodes.editComplete();break;case"testing":gSimulator.runTests();break;case"saveas":gModalMenu.saveas.clickSaveBtn();break;case"load":gModalMenu.load.onClickLoadBtn();break;case"submit":gModalMenu.submitModal.clickSubmitBtn();break;case"confirm":gModalMenu.confirm.clickConfirmBtn()}},gModalMenu.cancel=function(a){switch(a){case"edgeEntry":gEdges.editCancelled();break;case"confirm":gModalMenu.confirm.clickCancelBtn();break;case"saveas":default:gModalMenu.close(a)}},gModalMenu.getNodeName=function(){return d3.select(".nodeName").node().value},gModalMenu.setNodeName=function(a){d3.select(".nodeName").node().value=a},gModalMenu.setInitial=function(a){d3.select(".nodeInitialCheckbox").node().checked=a},gModalMenu.getInitial=function(){return d3.select(".nodeInitialCheckbox").node().checked},gModalMenu.setState=function(a,b){d3.selectAll(".modalAcceptButton").classed("marked",a),d3.selectAll(".modalNeitherButton").classed("marked",!a&&!b),d3.selectAll(".modalRejectButton").classed("marked",b)},gModalMenu.getAccepting=function(){return d3.select(".modalAcceptButton").classed("marked")},gModalMenu.getRejecting=function(){return d3.select(".modalRejectButton").classed("marked")},gModalMenu.deleteNode=function(){gNodes.deleteEdited()},gModalMenu.saveas={},gModalMenu.saveas.open=function(){gModalMenu.saveas.setSaveName(gServer.name),gModalMenu.open("saveas")},gModalMenu.saveas.clickSaveBtn=function(){gModalMenu.confirm.flag="saveas",gModalMenu.saveas.setSaveButton("Saving...");var a=gModalMenu.saveas.getSaveName();if(gModalMenu.saveas.isInvalidName(a))return gErrorMenu.displayModalError("saveas","Automaton name cannot be blank"),void gModalMenu.saveas.setSaveButton("Save");var b=encodeURIComponent(a);gServer.listSaved(function(a,c){function d(a,b){return a.some(function(a,c,d){return a.name===b})}return a?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.saveas.setSaveButton("Save")):void(d(c,b)?(gModalMenu.close("saveas"),gModalMenu.confirm.open()):gModalMenu.saveas.save(function(){gModalMenu.close("saveas")}))})},gModalMenu.saveas.clickCancelBtn=function(){gModalMenu.cancel("saveas")},gModalMenu.saveas.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("saveas"),gModalMenu.saveas.save(function(){gModalMenu.close("saveas")})},gModalMenu.saveas.clickConfirmCancelBtn=function(){gModalMenu.close("saveas"),gModalMenu.close("confirm"),gModalMenu.saveas.setSaveButton("Save")},gModalMenu.saveas.save=function(){var a=gModalMenu.saveas.getSaveName();gServer.save(a,function(b,c){return b?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.saveas.setSaveButton("Save")):(gServer.changeName(a),gModalMenu.saveas.setSaveButton("Saved!"),void window.setTimeout(function(){gModalMenu.saveas.setSaveButton("Save"),gModalMenu.close("saveas")},1e3))})},gModalMenu.saveas.isInvalidName=function(a){return 0===a.replace(/\s/g,"").length},gModalMenu.saveas.getSaveName=function(){return d3.select(".saveText").node().value},gModalMenu.saveas.setSaveName=function(a){d3.select(".saveText").node().value=decodeURIComponent(a)},gModalMenu.saveas.setSaveButton=function(a){d3.select(".saveButton").text(a)},gModalMenu.submitModal={},gModalMenu.submitModal.init=function(){var a=d3.select(".pset").selectAll("option").data(psets);a.enter().append("option").attr("value",function(a,b){return b}).text(function(a,b){return a.name}),d3.select(".pset").node().selectedIndex=0,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.clickSubmitBtn=function(){function a(a,b,c){return a.some(function(a,d,e){var f=parseInt(a.pset_id),g=parseInt(a.problem_id);return f===b&&g===c})}gModalMenu.confirm.flag="submit";var b=(JSON.stringify(gGraph.save()),gModalMenu.submitModal.getPsetNumber()),c=gModalMenu.submitModal.getProblemNumber();gModalMenu.submitModal.setSubmitButton("Submitting..."),gServer.listSubmissions(function(d,e){return e?(gErrorMenu.displayModalError("submit","Failed to submit"),gModalMenu.submitModal.setSubmitButton("Submit"),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3)):void(a(d,b,c)?(gModalMenu.close("submit"),gModalMenu.confirm.open()):gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")}))})},gModalMenu.submitModal.clickCancelBtn=function(){gModalMenu.cancel("submit"),gErrorMenu.clearModalErrors()},gModalMenu.submitModal.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")})},gModalMenu.submitModal.clickConfirmCancelBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.setSubmitButton("Submit")},gModalMenu.submitModal.changenumbers=function(){var a=d3.select(".pset").node().selectedIndex,b=d3.select(".problem").selectAll("option").data(psets[a].problems);b.enter().append("option"),b.attr("value",function(a){return a.charSet}).text(function(a){return a.name}),b.exit().remove(),d3.select(".problem").node().selectedIndex=0},gModalMenu.submitModal.submit=function(a){var b=JSON.stringify(gGraph.save()),c=gModalMenu.submitModal.getPsetNumber(),d=gModalMenu.submitModal.getProblemNumber();return psets[c].problems[d].type!=gGraph.mode&&"nfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is an NFA, but the problem requires a DFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[c].problems[d].type!=gGraph.mode&&"dfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is a DFA, but the problem requires an NFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[c].problems[d].charSet!=gGraph.charSet?(gErrorMenu.displayModalError("submit","The alphabet for this automaton doesn't match the alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):"tm"===gGraph.mode&&psets[c].problems[d].tapeSet!=gGraph.tapeSet?(gErrorMenu.displayModalError("submit","The tape alphabet for this turing machine doesn't match the tape alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):void gServer.submit(b,c,d,function(b){return b?(gErrorMenu.displayModalError("submit","Failed to submit"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.submitModal.setSubmitButton("Submit")):(gModalMenu.submitModal.setSubmitButton("Success!"),void setTimeout(function(){gModalMenu.submitModal.setSubmitButton("Submit"),a()},1e3))})},gModalMenu.submitModal.getProblemNumber=function(){return d3.select(".problem").node().selectedIndex},gModalMenu.submitModal.getPsetNumber=function(){return d3.select(".pset").node().selectedIndex},gModalMenu.submitModal.setProblemNumber=function(a){d3.select(".problem").node().selectedIndex=a},gModalMenu.submitModal.setPsetNumber=function(a){d3.select(".pset").node().selectedIndex=a,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.setSubmitButton=function(a){d3.select(".submitButton").text(a)},gModalMenu.focusRow=function(a){a=Math.max(a,0);var b=!1;d3.selectAll(".bulkInput").each(function(c,d){d==a&&(this.focus(),b=!0)}),b||gModalMenu.buildRow(!0)},gModalMenu.buildRow=function(a){var b=d3.select(".testingHeader").append("tr");b.append("td").append("input").attr("type","text").classed("bulkInput",!0).each(function(){a&&this.focus()}),b.append("td").append("input").attr("type","radio").classed("bulkAccept",!0),b.append("td").append("input").attr("type","radio").classed("bulkReject",!0),d3.selectAll(".bulkAccept").on("change",function(a,b){gModalMenu.clearReject(b)}),d3.selectAll(".bulkReject").on("change",function(a,b){gModalMenu.clearAccept(b)}),d3.selectAll(".bulkInput").on("keydown",function(a,b){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.focusRow(b+1):38==d3.event.keyCode&&gModalMenu.focusRow(b-1)})},gModalMenu.initBulk=function(){gModalMenu.buildRow(!1),d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.clearReject=function(a){d3.selectAll(".bulkReject").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.clearAccept=function(a){d3.selectAll(".bulkAccept").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.tmEdge={},gModalMenu.tmEdge.focusTmRow=function(a){a=Math.max(a,0);var b=!1;d3.selectAll(".tmEdgeInput").each(function(c,d){d==a&&(this.focus(),b=!0)}),b||gModalMenu.tmEdge.buildTmRow(!0)},gModalMenu.tmEdge.setTmEdgeStates=function(a){0==a.length&&a.push({direction:1,to:"",from:""});for(var b=a.length-d3.selectAll(".tmEdge > tr").size(),c=0;b>c;c++)gModalMenu.tmEdge.buildTmRow(!1);var d=d3.select(".tmEdge").selectAll("tr").filter(function(a,b){return 0!=b}).data(a);d.select("td > .edgeLeft").each(function(a){this.checked=-1==a.direction}),d.select("td > .edgeRight").each(function(a){this.checked=1==a.direction}),d.selectAll("td > .tmEdgeChars").each(function(b,c,d){this.value=1==c?a[d].to:a[d].from}),d.exit().remove()},gModalMenu.tmEdge.getTmEdgeStates=function(){var a=[];return d3.select(".tmEdge").selectAll("tr").filter(function(a,b){return 0!=b}).each(function(){var b={},c=d3.select(this);b.direction=c.select("td > .edgeLeft").node().checked?-1:1,b.from=c.selectAll("td > .tmEdgeChars")[0][0].value,b.to=c.selectAll("td > .tmEdgeChars")[0][1].value,a.push(b)}),a},gModalMenu.tmEdge.buildTmRow=function(a){var b=d3.select(".tmEdge").append("tr");b.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0).each(function(){a&&this.focus()}),b.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0);var c=b.append("td");c.append("input").attr("type","radio").classed("edgeLeft",!0),
c.append("label").text(" L "),c.append("input").attr("type","radio").attr("checked",!0).classed("edgeRight",!0),c.append("label").text(" R "),b.append("td").append("button").classed("button-delete",!0).text("X"),gModalMenu.tmEdge.updateTmDeleteButtons(),d3.selectAll(".edgeLeft").on("change",function(a,b){gModalMenu.tmEdge.clearRight(b)}),d3.selectAll(".edgeRight").on("change",function(a,b){gModalMenu.tmEdge.clearLeft(b)}),d3.selectAll(".tmEdgeChars").on("keydown",function(a,b){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.tmEdge.focusTmRow(b+1):38==d3.event.keyCode&&gModalMenu.tmEdge.focusTmRow(b-1)})},gModalMenu.tmEdge.updateTmDeleteButtons=function(){d3.selectAll(".button-delete").on("click",function(a,b){d3.select(".tmEdge").selectAll("tr").filter(function(a,c){return b==c}).remove(),gModalMenu.tmEdge.updateTmDeleteButtons()})},gModalMenu.tmEdge.initTmEdit=function(){d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.tmEdge.clearLeft=function(a){d3.selectAll(".edgeLeft").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.tmEdge.clearRight=function(a){d3.selectAll(".edgeRight").each(function(b,c){c==a&&(this.checked=!1)})},gSimulator.ACCEPT="ACCEPT",gSimulator.REJECT="REJECT",gSimulator.NEITHER="NEITHER",gSimulator.runTests=function(){var a=[],b=!1;d3.selectAll(".bulkInput").each(function(){var c=intersection(this.value,gGraph.charSet);b|=c.length!=this.value.length,this.value=c,a.push({testCase:c,expected:gSimulator.NEITHER})}),d3.selectAll(".bulkAccept").each(function(b,c){this.checked&&(a[c].expected=gSimulator.ACCEPT)}),d3.selectAll(".bulkReject").each(function(b,c){this.checked&&(a[c].expected=gSimulator.REJECT)}),b&&gErrorMenu.displayModalError("testing","Removing characters not in alphabet");var c=[],d=gGraph.save();a.forEach(function(a){c.push({accepted:gSimulator.run(d,a.testCase),input:gSimulator.output,expected:a.expected})});var e=d3.select(".testingResults").selectAll("tr").data(c),f=e.enter().append("tr");f.append("td").attr("width","60%").style("text-align","left"),f.append("td").attr("width","20%").style("text-align","center"),f.append("td").attr("width","20%").style("text-align","center"),e.each(function(a){d3.select(this).selectAll("td").text(function(b,c){switch(c){case 0:return a.accepted==gSimulator.TIMEOUT?"Timed out":a.input;case 1:return a.accepted==gSimulator.TIMEOUT?"-":a.accepted?"A":"R";case 2:if(a.expected===gSimulator.NEITHER||a.accepted==gSimulator.TIMEOUT)return"-";var d=!(a.expected===gSimulator.ACCEPT^a.accepted);return d?"Y":"N"}})}),e.exit().remove()};var gDFASimulator={};gDFASimulator.step=function(a,b,c,d){var e=gSimulator.convert(a);return e[b][c[d]][0]},gDFASimulator.run=function(a,b){gSimulator.output=b;for(var c=gSimulator.convert(a),d=a.nodes.initial,e=0;e<b.length;e++){var f=c[d][b[e]];if(0==f.length)return!1;d=f[0]}for(var e=0;e<a.nodes.nodes.length;e++)if(a.nodes.nodes[e].id==d)return a.nodes.nodes[e].accept;return!1};var gNFASimulator={};gNFASimulator.run=function(a,b){gSimulator.output=b;var c=gSimulator.convert(a),d=new Queue,e={};for(d.enqueue({current:a.nodes.initial,index:0}),e[a.nodes.initial+" 0"]=!0;!d.isEmpty();){var f=d.dequeue();if(f.index==b.length){for(var g=0;g<a.nodes.nodes.length;g++)if(a.nodes.nodes[g].id==f.current&&a.nodes.nodes[g].accept)return!0}else for(var h=c[f.current][b[f.index]],g=0;g<h.length;g++){var i={current:h[g],index:f.index+1};e[i.current+" "+i.index]||(e[i.current+" "+i.index]=!0,d.enqueue(i))}for(var j=c[f.current][gEpsilon],g=0;g<j.length;g++){var i={current:j[g],index:f.index};e[i.current+" "+i.index]||(e[i.current+" "+i.index]=!0,d.enqueue(i))}}return!1};var gSimulator={TIMEOUT:"timeout"};gSimulator.init=function(){var a=gGraph.mode==gGraph.DFA?gDFASimulator:gGraph.mode==gGraph.NFA?gNFASimulator:gTMSimulator;gSimulator.run=a.run,gSimulator.step=a.step},gSimulator.convert=function(a){var b={},c=gGraph.charSet+(gGraph.epsilonEnabled?gEpsilon:"");return a.nodes.nodes.forEach(function(a){b[a.id]={};for(var d=0;d<c.length;d++)b[a.id][c[d]]=[]}),a.edges.edges.forEach(function(a){a.transitions[0].forEach(function(c){b[a.source][c].push(a.target)})}),b};var gTape={SELECT_RADIUS:50};gTape.init=function(){d3.select(".tape").append("circle").style("fill","none").style("stroke","blue").attr("r",gTape.SELECT_RADIUS),gTape.hide(),gTape.done=!0,gTape.running=!1},gTape.run=function(){var a=gTestMenu.text;gTape.done=!1,gTape.running=!0,d3.select(".tape").select("circle").style("stroke","blue"),gTape.input=a.split(""),gTape.index=0,gTape.follow=gTape.current=gNodes.initial,gTape.draw()},gTape.drawResult=function(a){if(!gTape.done){var b="Run finished, "+(a?"accept":"reject")+'ing string "'+gTape.input.join("")+'"';!gTape.follow||gTape.follow.accept||gTape.follow.reject||(b+=" because of a missing transition"),gErrorMenu.displayMessage(b,!1,a?"accepting run-finished":"rejecting run-finished"),gTape.done=!0}},gTape.draw=function(){var a=d3.select(".tape").select("circle");if(gTape.follow){var b=gTape.follow!=gTape.prev&&1==a.style("opacity")?100:0;a.transition().duration(b).attr("cx",gTape.follow.x).attr("cy",gTape.follow.y).style("opacity",1),d3.select(".stepButton").text("Step").node().disabled=!1,gTape.isRejecting()?(a.style("stroke","red"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!1)):gTape.isAccepting()&&(a.style("stroke","green"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!0))}else a.style("opacity",0);var c=gGraph.mode==gGraph.TM?"current-tape-char-solid":"current-tape-char";gTape.running&&gTape.index<=gTape.input.length&&d3.selectAll(".tape-char").classed(c,function(a,b){return d3.select(this).classed(c)||gTape.index!=b||(this.focus(),this.blur()),gTape.index==b}),gTape.prev=gTape.follow},gTape.isAccepting=function(){return gGraph.mode==gGraph.DFA?"undefined"!=typeof gTape.current&&gTape.current.accept&&gTape.index==gTape.input.length:"undefined"!=typeof gTape.current&&gTape.current.accept},gTape.isRejecting=function(){return gGraph.mode==gGraph.DFA?"undefined"==typeof gTape.current||!gTape.current.accept&&gTape.index==gTape.input.length:"undefined"==typeof gTape.current||gTape.current.reject},gTape.show=function(){d3.select(".tape").style("opacity",1)},gTape.reset=function(){gTape.done=!0,gTape.running=!1,gTape.follow=null,gTape.draw()},gTape.hide=function(){gTape.reset(),d3.select(".tape").style("opacity",0)},gTape.step=function(){if(!gTape.running)return void gTape.run();if(!gTape.isRejecting()&&!gTape.isAccepting()){if(gGraph.mode==gGraph.DFA){var a=gDFASimulator.step(gGraph.save(),gTape.current.id,gTape.input,gTape.index++);gTape.current=gNodes.nodes[gNodes.getNodeIndex(a)]}else{var a=gTMSimulator.step(gGraph.save(),gTape.current.id,gTape.input.join(""),gTape.index);gTape.current=gNodes.nodes[gNodes.getNodeIndex(a.initial)],gTape.input=a.input.split(""),gTape.index=a.index,gTestMenu.disallowInput(gTape.input.join(""))}"undefined"!=typeof gTape.current&&(gTape.follow=gTape.current)}gTape.draw()};var gTMSimulator={MAX_ITER:1e5},gBlank=" ",gSquare=String.fromCharCode(9633);gTMSimulator.convert=function(a){var b={},c=gGraph.tapeSet+(gGraph.epsilonEnabled?gEpsilon:"");return a.nodes.nodes.forEach(function(a){b[a.id]={};for(var d=0;d<c.length;d++)b[a.id][c[d]]=null}),a.edges.edges.forEach(function(a){a.transitions[0].forEach(function(c){b[a.source][c.from]=JSON.parse(JSON.stringify(c)),b[a.source][c.from].target=a.target})}),b},gTMSimulator.step=function(a,b,c,d){var e=gTMSimulator.convert(a);return e[b][c[d]],gTMSimulator.stepState(e,{initial:b,input:c,index:d})},gTMSimulator.stepState=function(a,b){var c=b.input;c.length==b.index&&(c+=gBlank);var d=a[b.initial][c[b.index]];if(void 0==d)return{initial:void 0,input:c,index:b.index};var e={initial:d.target,index:b.index+d.direction};for(e.input=c.substring(0,b.index)+d.to+c.substring(b.index+1);e.index<0;)e.index++,e.input=gBlank+e.input;for(;e.index>=e.input.length;)e.input+=gBlank;return e},gTMSimulator.run=function(a,b){for(var c={initial:a.nodes.initial,input:b,index:0},d=gTMSimulator.convert(a),e=0;e<gTMSimulator.MAX_ITER;e++){if(void 0==c.initial)return gSimulator.output=c.input,!1;var f=a.nodes.nodes[gNodes.getNodeIndex(c.initial)];if(f.accept)return gSimulator.output=c.input,!0;if(f.reject)return gSimulator.output=c.input,!1;e<gTMSimulator.MAX_ITER-1&&(c=gTMSimulator.stepState(d,c))}return gSimulator.output=c.input,gSimulator.TIMEOUT};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock);var gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}},Math.bound=function(a,b,c){for(var d=c-b;b>a;)a+=d;for(;a>c;)a-=d;return a};var isIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}(),isSafari=function(){var a=navigator.userAgent.toLowerCase();return/safari/.test(a)&&!/chrome/.test(a)}(),gBrush={};gBrush.init=function(){var a=d3.select("g.brush"),b=d3.svg.brush().x(d3.scale.identity().domain([0,gGraph.width])).y(d3.scale.identity().domain([0,gGraph.height])).clamp([!1,!1]).on("brushend",function(){d3.event.target.clear(),d3.select(this).call(d3.event.target)});gBehaviors.apply("brush",b),a.call(b),a.select(".background").style("cursor","default"),a.select(".extent").style("cursor","default")},gGraph.initDelete=function(){gBehaviors.addBehavior("page","keydown",function(){return(46==d3.event.keyCode||8==d3.event.keyCode)&&"none"===d3.select(".overlay").style("display")&&d3.select(".tape-char-input").node()!==document.activeElement&&!gTableTopMenu.active},function(){d3.event.preventDefault(),gNodes.removeNodes()&&(gEdges.deleteSelected(),gGraph.draw())})};var gShiftKey=!1,gEpsilon="",gGraph={HEIGHT_OFFSET:5,BUFFER:100,DFA:"dfa",NFA:"nfa",TM:"tm"};gGraph.init=function(a,b,c,d,e){var f=d3.select("svg");gGraph.width=f.node().getBoundingClientRect().width,gGraph.height=f.node().getBoundingClientRect().height-gGraph.HEIGHT_OFFSET,gGraph.height-=d3.select(".tape-bar").node().getBoundingClientRect().height,f.attr("height",gGraph.height);var g=c;gGraph.problem=b,gGraph.pset=a,gGraph.mode=d,gGraph.mode!=gGraph.NFA&&gGraph.mode!=gGraph.TM&&(gGraph.mode=gGraph.DFA),null==g&&(window.location=getURLParent()+"index.html"),gGraph.charSet=sortString(removeDuplicates(g)),"tm"===d&&(gGraph.tapeSet=sortString(removeDuplicates(e+" "))),gGraph.epsilonEnabled=gGraph.mode==gGraph.NFA,gServer.getSunetid(function(a){gGraph.sunetid=a}),gGraph.mode==gGraph.DFA?d3.selectAll(".dfa-hide").style("display","none"):gGraph.mode==gGraph.NFA?d3.selectAll(".nfa-hide").style("display","none"):(d3.selectAll(".tm-hide").style("display","none"),gGraph.charSet+=" "),gNodes.init(),gEdges.init(),gBrush.init(),gTape.init(),gTestMenu.init(),gModalMenu.initBulk(),gModalMenu.submitModal.init(),gModalMenu.tmEdge.initTmEdit(),gTableMenu.init(),gGraph.initDelete(),gGraph.initCookie(),gSimulator.init(),d3.selectAll(".popup").on("click",function(){d3.event.stopPropagation()}),d3.selectAll(".overlay").on("click",function(){gModalMenu.closeCurrent()}),gBehaviors.addBehavior("page","keydown",function(){return!0},gGraph.keydown),gBehaviors.addBehavior("page","keyup",function(){return!0},gGraph.keyup),gBehaviors.apply("page",d3.select("body")),gBehaviors.apply("background",d3.select("div.gui")),gGraph.draw()},gGraph.keydown=function(){gShiftKey=d3.event.shiftKey||d3.event.metaKey},gGraph.keyup=function(){gShiftKey=d3.event.shiftKey||d3.event.metaKey},gGraph.save=function(){return{nodes:gNodes.save(),edges:gEdges.save(),meta:{charSet:gGraph.charSet,pset:gGraph.pset,problem:gGraph.problem,mode:gGraph.mode,tapeSet:gGraph.tapeSet}}},gGraph.load=function(a){gNodes.load(a.nodes),gEdges.load(a.edges),gTape.reset(),gTestMenu.reset()},gGraph.draw=function(){gNodes.draw(),gEdges.draw(),gTopMenu.draw(),gTableMenu.draw(),gTape.draw()},gGraph.resize=function(){var a=d3.select("svg");gGraph.width=a.node().getBoundingClientRect().width,gGraph.height=a.node().getBoundingClientRect().height,d3.select(".background").attr("width",gGraph.width),d3.select(".background").attr("height",gGraph.height),d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gEdges.initDragging=function(){gEdges.dragging=!1,gEdges.startNode=null,gEdges.backupNode=null,gEdges.endNode=null;var a=function(){return!0};gBehaviors.addBehavior("lowerNodes","mouseover",function(){return!gNodes.dragging},gEdges.showTempEdge),gBehaviors.addBehavior("lowerNodes","mousemove",function(){return!gNodes.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("lowerNodes","mousedown",a,gEdges.startDragging),gBehaviors.addBehavior("background","mousedown",function(){if(null==gEdges.startNode)return!1;var a=d3.mouse(d3.select("svg").node()),b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b<=gNodes.SELECTABLE_RADIUS&&b>gNodes.RADIUS},gEdges.startDragging),gBehaviors.addBehavior("nodes","mouseover",function(){return!gEdges.dragging&&gEdges.tempVisible},gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseover",function(){return gEdges.dragging},gEdges.setTempEdgeEnd),gBehaviors.addBehavior("nodes","mouseout",a,gEdges.unsetTempEdgeEnd),gBehaviors.addBehavior("background","mousemove",function(){var a=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){var a=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var b=Math.sqrt(Math.pow(a[0]-gEdges.startNode.x,2)+Math.pow(a[1]-gEdges.startNode.y,2));return b>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("background","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mouseup",a,gEdges.hideTempEdge),gBehaviors.addBehavior("background","mouseup",a,gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseup",function(){return gEdges.dragging},gEdges.addTempEdge)},gEdges.unsetTempEdgeEnd=function(a){null!=gEdges.endNode&&(gEdges.endNode=null,gGraph.draw())},gEdges.setTempEdgeEnd=function(a){gEdges.endNode=a,gGraph.draw()},gEdges.addTempEdge=function(a){gEdges.endNode=null,gEdges.backupNode=null,gEdges.hideTempEdge();var b=gEdges.getEdge(gEdges.startNode,a);null==b&&(gEdges.addEdge(gEdges.startNode,a),b=gEdges.edges[gEdges.edges.length-1]),gGraph.draw(),gEdges.editEdge(b)},gEdges.startDragging=function(){gEdges.dragging=!0},gEdges.hideTempEdge=function(){var a=d3.mouse(d3.select("svg").node()),b=gNodes.SELECTABLE_RADIUS+1;null!=gEdges.backupNode&&(b=Math.sqrt(Math.pow(a[0]-gEdges.backupNode.x,2)+Math.pow(a[1]-gEdges.backupNode.y,2))),null==gEdges.backupNode||b>gNodes.SELECTABLE_RADIUS?(d3.select("path.temp").remove(),gEdges.dragging=!1,gEdges.tempVisible=!1):(gEdges.startNode=gEdges.backupNode,gEdges.dragging=!1,gEdges.drawTempEdge())},gEdges.drawTempEdge=function(){if(null!=gEdges.startNode){if(gNodes.dragging)return d3.select("path.temp").remove(),gEdges.dragging=!1,void(gEdges.tempVisible=!1);var a=d3.mouse(d3.select("svg").node());d3.select("path.temp").remove(),gEdges.initialEdge=d3.select(".miscEdges").append("path").classed("temp",!0).style("marker-end","url(#mouse-arrow)").attr("fill","none").attr("d",function(){return null!=gEdges.endNode?gEdges.customPathFunction(gEdges.startNode,gEdges.endNode):gEdges.customPathFunction(gEdges.startNode,{x:a[0],y:a[1]})}).style("marker-end",function(){return null==gEdges.endNode?"url(#mouse-arrow)":"url(#end-arrow)"})}},gEdges.showTempEdge=function(a){gNodes.dragging||(gEdges.dragging?gEdges.backupNode=a:(gEdges.startNode=a,gEdges.tempVisible=!0,gEdges.drawTempEdge()))};var gEdges={BIDIRECTIONAL_OFFSET:8,LOOP_WIDTH:70,LOOP_HEIGHT:80,LOOP_PEAK:50,LOOP_TEXT_OFFSET:70,TEXT_OFFSET:10,TRANSITION_DY:20,TSPAN_HEIGHT:10,SELECTABLE_WIDTH:25,MARKER_SIZE:30,END_ARROW_OFFSET:36,MOUSE_ARROW_OFFSET:13};gEdges.init=function(){gEdges.lowerG=d3.select("g.edgesLower"),gEdges.upperG=d3.select("g.edges"),gEdges.straightLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),gEdges.curvedLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis"),gEdges.lineFunction=function(a){return a[0].x==a[1].x&&a[0].y==a[1].y?gEdges.curvedLineFunction([{x:a[0].x,y:a[0].y},{x:a[0].x+gEdges.LOOP_PEAK,y:a[0].y-gEdges.LOOP_HEIGHT/2},{x:a[0].x+gEdges.LOOP_WIDTH,y:a[0].y},{x:a[0].x+gEdges.LOOP_PEAK,y:a[0].y+gEdges.LOOP_HEIGHT/2},{x:a[0].x,y:a[0].y}]):gEdges.straightLineFunction(a)},gEdges.customPathFunction=function(a,b){var c={x:a.x,y:a.y},d={x:b.x,y:b.y};return b.id!=a.id&&gEdges.areConnected(b.id,a.id)&&(c=gEdges.offsetPoint(c,a,b,gEdges.BIDIRECTIONAL_OFFSET),d=gEdges.offsetPoint(d,a,b,gEdges.BIDIRECTIONAL_OFFSET)),gEdges.lineFunction([c,d])},gEdges.pathFunction=function(a){return gEdges.customPathFunction(a.source,a.target)},gEdges.buildMarker("end-arrow",gEdges.END_ARROW_OFFSET,"black"),gEdges.buildMarker("mouse-arrow",gEdges.MOUSE_ARROW_OFFSET,"black"),gEdges.edges=[],gEdges.edgeMap={},gEdges.initInitial(),gEdges.initSelection(),gEdges.initDragging(),gEdges.initEditing()},gEdges.addEdge=function(a,b){var c={};c.source=a,c.target=b,c.transitions=[[]],gEdges.edges.push(c),gEdges.edgeMap[a.id].push(b.id)},gEdges.removeEdge=function(a,b){gEdges.edges=gEdges.edges.filter(function(c){return c.source.id!=a.id||c.target.id!=b.id});var c=gEdges.edgeMap[a.id].indexOf(b.id);gEdges.edgeMap[a.id].splice(c,1)},gEdges.addNode=function(a){gEdges.edgeMap[a.id]=[]},gEdges.removeNode=function(a){a.id==gEdges.startNode.id&&(gEdges.startNode=null,gEdges.hideTempEdge()),gEdges.edges=gEdges.edges.filter(function(b){return b.source.id!=a.id&&b.target.id!=a.id});for(var b in gEdges.edgeMap){var c=gEdges.edgeMap[b].indexOf(a.id);gEdges.edgeMap[b].splice(c,1)}delete gEdges.edgeMap[a.id]},gEdges.save=function(){var a={edgeMap:JSON.parse(JSON.stringify(gEdges.edgeMap)),edges:JSON.parse(JSON.stringify(gEdges.edges))};return a.edges.forEach(function(a){a.source=a.source.id,a.target=a.target.id}),a},gEdges.load=function(a){gEdges.edges=a.edges,gEdges.edgeMap=a.edgeMap,gEdges.edges.forEach(function(a){a.source=gNodes.nodes[gNodes.getNodeIndex(a.source)],a.target=gNodes.nodes[gNodes.getNodeIndex(a.target)]})},gEdges.createDOMEdges=function(a,b){gBehaviors.apply("edges",a.append("path").attr("fill","none").classed("lower",!0).classed("transparent",!0)),b=b.append("g"),gBehaviors.apply("edges",b),b.append("path").attr("fill","none").classed("edge",!0),b.append("text")},gEdges.drawDOMEdges=function(a,b){a.attr("d",gEdges.pathFunction),b.select("path").attr("d",gEdges.pathFunction).classed("selected",function(a){return a.selected}).style("marker-end",function(a){return a.selected?"url(#sel-arrow)":"url(#end-arrow)"});var c=b.select("text").selectAll("tspan").data(function(a){return gGraph.mode==gGraph.TM?a.transitions[0]:a.transitions});c.enter().append("tspan"),c.text(gEdges.getEdgeLabel).attr("x",function(a,b,c){var d;return d3.select(this.parentNode).each(function(a,b){d=a}),gEdges.getTextPosition(d.source,d.target,this.parentNode.getBoundingClientRect()).x}).attr("dy",gEdges.TRANSITION_DY),b.select("text").attr("x",function(a){return gEdges.getTextPosition(a.source,a.target,this.getBoundingClientRect()).x}).attr("y",function(a){var b=d3.select(this).selectAll("tspan").size()-1;return gEdges.getTextPosition(a.source,a.target,this.getBoundingClientRect()).y+b*gEdges.TSPAN_HEIGHT}),c.exit().remove(),gEdges.drawInitial()},gEdges.destroyDOMEdges=function(a,b){a.remove(),b.remove()},gEdges.draw=function(){isIE&&(gEdges.lowerG.selectAll("path").remove(),gEdges.upperG.selectAll("g").remove());var a=gEdges.lowerG.selectAll("path").data(gEdges.edges,gEdges.getEdgeId),b=gEdges.upperG.selectAll("g").data(gEdges.edges,gEdges.getEdgeId);gEdges.createDOMEdges(a.enter(),b.enter()),gEdges.drawDOMEdges(a,b),gEdges.destroyDOMEdges(a.exit(),b.exit())},gEdges.areConnected=function(a,b){return null!=gEdges.endNode&&a==gEdges.startNode.id&&b==gEdges.endNode.id||gEdges.edgeMap[a]&&gEdges.edgeMap[a].indexOf(b)>-1},gEdges.getEdgeLabel=function(a){if(gGraph.mode==gGraph.TM){var b=" "==a.from?gSquare:a.from,c=" "==a.to?gSquare:a.to;return b+String.fromCharCode(8594)+c+", "+(1==a.direction?"R":"L")}return gEdges.reduceLabel(a)},gEdges.reduceLabel=function(a){var b=gGraph.charSet,c="";return b.length/2>=a.length?(a.forEach(function(a){c+=a+", "}),0!=c.length&&(c=c.substring(0,c.length-2))):(c=" - ",b.split("").forEach(function(b){-1==a.indexOf(b)&&(c+=b+", ")}),c=6!=c.length?c.substring(0,c.length-2):"",-1!=a.indexOf(gEpsilon)&&(c+=" + "+gEpsilon)),c},gEdges.getEdgeId=function(a){return a.source.id+" "+a.target.id},gEdges.getEdge=function(a,b){var c=null;return gEdges.edges.forEach(function(d){d.source.id==a.id&&d.target.id==b.id&&(c=d)}),c},gEdges.buildMarker=function(a,b,c){d3.select("svg").append("svg:defs").append("svg:marker").attr("id",a).attr("viewBox","0 -50 100 100").attr("refX",b).attr("markerWidth",gEdges.MARKER_SIZE).attr("markerHeight",gEdges.MARKER_SIZE).attr("orient","auto").append("svg:path").attr("d","M 0,-5 L 10,0 L 0,5 z").attr("fill",c).attr("stroke",c).style("pointer-events","none")},gEdges.getTextPosition=function(a,b,c){var d={x:a.x,y:a.y},e={x:b.x,y:b.y};b.id==a.id?(d.x+=gEdges.LOOP_TEXT_OFFSET,d.y-=1,e.x+=gEdges.LOOP_TEXT_OFFSET,e.y+=1):gEdges.areConnected(b.id,a.id)&&(d=gEdges.offsetPoint(d,a,b,gEdges.BIDIRECTIONAL_OFFSET),e=gEdges.offsetPoint(e,a,b,gEdges.BIDIRECTIONAL_OFFSET));var f={x:(d.x+e.x)/2,y:(d.y+e.y)/2},g=Math.bound(Math.atan2(d.y-e.y,d.x-e.x)+Math.PI/2,0,2*Math.PI),h=Math.sqrt(Math.pow(c.height/2,2)+Math.pow(c.width/2,2)),i=g>Math.PI?-1:1,j=g<3*Math.PI/2&&g>=Math.PI/2?-1:1,k=Math.bound(Math.atan2(i*c.height,j*c.width),0,2*Math.PI),l=Math.abs(k-g),m=Math.cos(l)*h;return m+=gEdges.TEXT_OFFSET,{x:f.x+Math.cos(g)*m,y:f.y-c.height+Math.sin(g)*m}},gEdges.offsetPoint=function(a,b,c,d){var e=Math.atan2(b.y-c.y,b.x-c.x),f=e+Math.PI/2;return{x:a.x+Math.cos(f)*d,y:a.y+Math.sin(f)*d}},gEdges.initEditing=function(){gEdges.editedEdge=null,gBehaviors.addBehavior("edges","dblclick",function(){return!0},gEdges.editEdge),d3.select(".edgeChars").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("edgeEntry")})},gEdges.populateTMEdgeModal=function(a){d3.select(".tmEdgeEntry").select(".modal-header").text("Edit Transition "+a.source.name+" "+String.fromCharCode(8594)+" "+a.target.name);for(var b=JSON.parse(JSON.stringify(gEdges.editedEdge.transitions[0])),c=0;c<b.length;c++)" "==b[c].from&&(b[c].from="")," "==b[c].to&&(b[c].to="");gModalMenu.tmEdge.setTmEdgeStates(b)},gEdges.populateEdgeModal=function(a){var b=a.transitions[0].join(""),c=b.length>0&&b[b.length-1]==gEpsilon;c&&(b=b.substring(0,b.length-1)),gModalMenu.setEdgeChars(b),gModalMenu.setEpsilon(c)},gEdges.editEdge=function(a){gEdges.editedEdge=a,gGraph.mode==gGraph.TM?(gEdges.populateTMEdgeModal(a),gModalMenu.open("tmEdgeEntry")):(gEdges.populateEdgeModal(a),gModalMenu.open("edgeEntry")),gModalMenu.open(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),d3.event.stopPropagation()},gEdges.editCancelled=function(){0==gEdges.editedEdge.transitions[0].length&&gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.deleteEditedEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.tmEditComplete=function(){for(var a=gModalMenu.tmEdge.getTmEdgeStates(),b="",c=!1,d=0;d<a.length;d++){if(""==a[d].to&&(a[d].to=" "),""==a[d].from){if(a[d].from=" ",c)return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for blank");c=!0}else if(-1!=b.indexOf(a[d].from))return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for character "+a[d].from);if(b+=a[d].from,1!=intersection(a[d].to,gGraph.tapeSet).length||1!=intersection(a[d].from,gGraph.tapeSet).length)return void gErrorMenu.displayModalError("tmEdgeEntry","Please only use characters in the character set")}if(0==a.length)return void gErrorMenu.displayModalError("tmEdgeEntry","You must define at least one transition");for(var d=0;d<gEdges.edges.length;d++){var e=gEdges.edges[d];if(e.source.id==gEdges.editedEdge.source.id&&e.target.id!=gEdges.editedEdge.target.id){for(var f=0;f<a.length;f++)for(var g=0;g<e.transitions[0].length;g++)a[f].from==e.transitions[0][g].from&&e.transitions[0].splice(g--,1);0==e.transitions[0].length&&gEdges.removeEdge(e.source,e.target)}}gEdges.editedEdge.transitions[0]=a,gEdges.editedEdge=null,gModalMenu.close("tmEdgeEntry"),gGraph.draw(),gGraph.draw()},gEdges.editComplete=function(){var a=removeDuplicates(gModalMenu.getEdgeCharacters().replace(/[\s,]/g,"")),b=intersection(gGraph.charSet,a),c=a;if(a=b,gModalMenu.setEdgeChars(b),a+=gModalMenu.getEpsilon()?gEpsilon:"",b.length!=c.length&&(0==a.length?gErrorMenu.displayModalError("edgeEntry","Ignoring characters that aren't in the alphabet."):gErrorMenu.displayError("Ignoring characters that aren't in the alphabet.")),0==a.length)return void gErrorMenu.displayModalError("edgeEntry","Transitions must take at least one character");var d=a.split("");d.sort();for(var e=0;e<d.length-1;e++)d[e]==d[e+1]&&d.splice(e--,1);if(gGraph.mode==gGraph.DFA){var f=!1;d.forEach(function(a){for(var b=0;b<gEdges.edges.length;b++){var c=gEdges.edges[b];if(c!=gEdges.editedEdge&&c.source==gEdges.editedEdge.source){var d=c.transitions[0].indexOf(a);-1!=d&&(c.transitions[0].splice(d,1),0==c.transitions[0].length&&(gEdges.removeEdge(c.source,c.target),b--,f=!0))}}}),f&&gErrorMenu.displayError("Removed duplicate transitions")}gEdges.editedEdge.transitions[0]=d,gEdges.editedEdge=null,gModalMenu.close("edgeEntry"),gGraph.draw()},gEdges.INITIAL_EDGE_LENGTH=60,gEdges.INITIAL_OVERLAP_RANGE=7,gEdges.INITIAL_OVERLAP_ANGLE=20,gEdges.initInitial=function(){d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none")},gEdges.drawInitial=function(){var a=gNodes.initial;if(null==a)d3.select("path.initial").style("opacity",0);else{var b=0,c=gEdges.INITIAL_EDGE_LENGTH;gEdges.edges.forEach(function(d){var e=Math.min(d.source.x,d.target.x),f=Math.max(d.source.x,d.target.x);if(a.x<=f&&a.x-gEdges.INITIAL_EDGE_LENGTH>=e&&d.target.x-d.source.x!=0){var g=(d.target.y-d.source.y)/(d.target.x-d.source.x),h=d.source.y-g*d.source.x,i=g*(a.x-gEdges.INITIAL_EDGE_LENGTH)+h,j=g*a.x+h;Math.abs(i-a.y)<=gEdges.INITIAL_OVERLAP_RANGE&&Math.abs(j-a.y)<=gEdges.INITIAL_OVERLAP_RANGE&&(c=Math.cos(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,b=Math.sin(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,j>i&&(b*=-1))}}),d3.select("path.initial").style("opacity",1).attr("d",function(){return gEdges.lineFunction([{x:a.x-c,y:a.y-b},{x:a.x,y:a.y}])})}},isIE&&(gEdges.initInitial=function(){},gEdges.drawInitial=function(){d3.select("path.initial").remove();var a=gNodes.initial;null!=a&&d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none").attr("d",function(){return gEdges.lineFunction([{x:a.x-gEdges.INITIAL_EDGE_LENGTH,y:a.y},{x:a.x,y:a.y}])})}),gEdges.SELECTED_COLOR="blue",gEdges.initSelection=function(){gEdges.buildMarker("sel-arrow",gEdges.END_ARROW_OFFSET,gEdges.SELECTED_COLOR),gBehaviors.addBehavior("edges","mousedown",function(){return!0},function(a){gShiftKey||a.selected||(gNodes.deselectAll(),gEdges.deselectAll()),a.selected=!0,gGraph.draw()})},gEdges.deleteSelected=function(){var a=[];gEdges.edges.forEach(function(b){b.selected&&a.push(b)}),a.forEach(function(a){gEdges.removeEdge(a.source,a.target)})},gEdges.deselectAll=function(){
gEdges.edges.forEach(function(a){a.selected=!1})},gEdges.selectionIsEmpty=function(){return 0==gEdges.selectionSize()},gEdges.selectionSize=function(){return gEdges.edges.filter(function(a){return a.selected}).length},gNodes.doubleClickInit=function(){gBehaviors.addBehavior("background","dblclick",function(){return!gTableTopMenu.active},function(){var a=d3.mouse(d3.select("svg").node());gNodes.addNode(a[0],a[1]),gNodes.draw()})},gNodes.editInit=function(){gNodes.editedNode=null,gBehaviors.addBehavior("nodes","dblclick",function(){return!0},gNodes.editNode),d3.select(".nodeName").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("nodeEntry")})},gNodes.editNode=function(a){gNodes.editedNode=a,gModalMenu.setNodeName(a.name),gModalMenu.setInitial(null!=gNodes.initial&&a.id==gNodes.initial.id),gModalMenu.setState(a.accept,a.reject),gModalMenu.open("nodeEntry"),d3.event.stopPropagation()},gNodes.editComplete=function(){var a=gModalMenu.getNodeName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayModalError("nodeEntry","State name cannot be blank.");var b=gNodes.getNodeIndexFromName(a);-1==b||gNodes.nodes[b].id==gNodes.editedNode.id?(gNodes.editedNode.accept=gModalMenu.getAccepting(),gNodes.editedNode.reject=gModalMenu.getRejecting(),gModalMenu.getInitial()?gNodes.initial=gNodes.editedNode:null!=gNodes.initial&&gNodes.editedNode.id==gNodes.initial.id&&(gNodes.initial=null),gNodes.editedNode.name=a,gNodes.editedNode=null,gModalMenu.close("nodeEntry"),gGraph.draw()):gErrorMenu.displayModalError("nodeEntry",'State name "'+a+'" is already in use.')},gNodes.deleteEdited=function(){if(null!=gTape.follow&&gTape.follow.id==gNodes.editedNode.id){if(!gTape.done)return void gErrorMenu.displayModalError("nodeEntry","The current state in a running test cannot be deleted");gTestMenu.end()}gNodes.removeByIndex(gNodes.getNodeIndex(gNodes.editedNode.id)),gModalMenu.close("nodeEntry"),gGraph.draw()},gNodes.FORCE_LAYOUT_ITERATIONS=1e5,gNodes.forcedDirectedLayout=function(){var a=[];gNodes.nodes.forEach(function(b){a.push({x:b.x,y:b.y,vx:0,vy:0})});var b=[];gEdges.edges.forEach(function(a){b.push({source:gNodes.getNodeIndex(a.source.id),target:gNodes.getNodeIndex(a.target.id)})});var c=d3.layout.force().nodes(a).links(b).linkDistance(200).charge(-300).gravity(.01).size([gGraph.width-2*gGraph.BUFFER,gGraph.height-2*gGraph.BUFFER]);c.start();for(var d=0;d<gNodes.FORCE_LAYOUT_ITERATIONS;d++)c.tick();c.stop();for(var d=0;d<a.length;d++)gNodes.nodes[d].x=a[d].x,gNodes.nodes[d].y=a[d].y;gNodes.scale()},gNodes.moveSelected=function(a,b){a+=gNodes.selectionX,b+=gNodes.selectionY,gNodes.selectionX=0,gNodes.selectionY=0;var c=function(a){return a.selected},d=function(a){return a.source.selected||a.target.selected};if(gNodes.validMoveX(a)?gNodes.nodes.filter(c).forEach(function(b){b.x+=a}):gNodes.selectionX+=a,gNodes.validMoveY(b)?gNodes.nodes.filter(c).forEach(function(a){a.y+=b}):gNodes.selectionY+=b,isIE)gGraph.draw();else{var e=d3.select("g.nodes").selectAll("g").filter(c),f=d3.select("g.nodesLower").selectAll("circle").filter(c);gNodes.drawDOMNodes(f,e),e=d3.select("g.edges").selectAll("g").filter(d),f=d3.select("g.edgesLower").selectAll("path").filter(d),gEdges.drawDOMEdges(f,e),gEdges.drawInitial(),gTape.draw()}},gNodes.movementInit=function(){gBehaviors.addBehavior("nodes","drag",function(a){return a.selected},function(a){gNodes.moveSelected(d3.event.dx,d3.event.dy)})};var gNodes={SELECTABLE_RADIUS:50,RADIUS:30,INNER_RADIUS:24,STROKE_WIDTH:2,NEW_BUFFER:100,NEW_INCREMENT:100,IE_TEXT_OFFSET:5};gNodes.init=function(){gNodes.lowerG=d3.select("g.nodesLower"),gNodes.upperG=d3.select("g.nodes"),gNodes.nodes=[],gNodes.initial=null,gNodes.selectionInit(),gNodes.movementInit(),gNodes.doubleClickInit(),gNodes.editInit()},gNodes.setInitial=function(){var a=gNodes.nodes.filter(function(a){return a.selected});a.length>0&&(gNodes.initial=a[0])},gNodes.setAccepting=function(a){gNodes.nodes.filter(function(a){return a.selected}).forEach(function(b){b.accept=a})},gNodes.setRejecting=function(a){gNodes.nodes.filter(function(a){return a.selected}).forEach(function(b){b.reject=a})},gNodes.wouldOverlap=function(a,b){var c=!1;return gNodes.nodes.forEach(function(d){c|=dist(a,b,d.x,d.y)<=2*gNodes.RADIUS}),c},gNodes.addNode=function(a,b){var c={};if("undefined"==typeof a){var d=!1;for(c.y=gNodes.NEW_BUFFER;c.y<=gGraph.height-gNodes.NEW_BUFFER&&!d;c.y+=gNodes.NEW_INCREMENT)for(c.x=gNodes.NEW_BUFFER;c.x<=gGraph.width-gNodes.NEW_BUFFER&&!d;c.x+=gNodes.NEW_INCREMENT)d=!gNodes.wouldOverlap(c.x,c.y);c.x-=gNodes.NEW_INCREMENT,c.y-=gNodes.NEW_INCREMENT}else c.x=a,c.y=b;for(var e=0;-1!=gNodes.getNodeIndexFromName("n"+e);)e++;c.id=e,c.name="n"+c.id,c.accept=!1,c.reject=!1,c.selected=!0,gNodes.deselectAll(),gNodes.nodes.push(c),gEdges.addNode(c)},gNodes.setInitialByIndex=function(a){gNodes.initial=gNodes.nodes[a]},gNodes.clearInitial=function(){gNodes.initial=null},gNodes.setAcceptByIndex=function(a,b){gNodes.nodes[a].accept=b},gNodes.setRejectByIndex=function(a,b){gNodes.nodes[a].reject=b},gNodes.removeByIndex=function(a){null!=gTape.follow&&gTape.follow.id==gNodes.nodes[a].id&&gTestMenu.end(),null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[a].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[a]),gNodes.nodes.splice(a,1)},gNodes.removeNodes=function(){if(null!=gTape.follow&&gTape.follow.selected){if(!gTape.done)return gErrorMenu.displayError("The current state in a running test cannot be deleted"),!1;gTestMenu.end()}for(var a=0;a<gNodes.nodes.length;a++)gNodes.nodes[a].selected&&(null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[a].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[a]),gNodes.nodes.splice(a--,1));return!0},gNodes.createDOMNodes=function(a,b){gBehaviors.apply("lowerNodes",a.append("circle").classed("transparent",!0).attr("r",gNodes.SELECTABLE_RADIUS)),b=b.append("g"),gBehaviors.apply("nodes",b.append("circle").classed("outer",!0).attr("r",gNodes.RADIUS)),gBehaviors.apply("nodes",b.append("circle").classed("inner",!0).attr("r",gNodes.INNER_RADIUS)),b.append("text")},gNodes.getSelected=function(){var a=[];return gNodes.nodes.forEach(function(b){b.selected&&a.push(b.name)}),a},gNodes.save=function(){return{nodes:gNodes.nodes,initial:null==gNodes.initial?null:gNodes.initial.id}},gNodes.load=function(a){gNodes.nodes=a.nodes,gNodes.initial=a.initial,null!=gNodes.initial&&(gNodes.initial=gNodes.nodes[gNodes.getNodeIndex(gNodes.initial)]),gNodes.nextId=0,gNodes.nodes.forEach(function(a){gNodes.nextId=Math.max(a.id+1,gNodes.nextId)}),gNodes.scale()},gNodes.scale=function(){if(gNodes.nodes.length>0){for(var a=gNodes.nodes[0].x,b=gNodes.nodes[0].x,c=gNodes.nodes[0].y,d=gNodes.nodes[0].y,e=1;e<gNodes.nodes.length;e++)a=Math.min(a,gNodes.nodes[e].x),b=Math.max(b,gNodes.nodes[e].x),c=Math.min(c,gNodes.nodes[e].y),d=Math.max(d,gNodes.nodes[e].y);var f=a,g=b;(gGraph.BUFFER>a||gGraph.width-gGraph.BUFFER<b)&&(f=gGraph.BUFFER,g=gGraph.width-gGraph.BUFFER);var h=c,i=d;(gGraph.BUFFER>c||gGraph.height-gGraph.BUFFER<d)&&(h=gGraph.BUFFER,i=gGraph.height-gGraph.BUFFER);for(var e=0;e<gNodes.nodes.length;e++){var j=b-a,k=0==j?1:(gNodes.nodes[e].x-a)/j,l=d-c,m=0==l?1:(gNodes.nodes[e].y-c)/l;gNodes.nodes[e].x=f*(1-k)+g*k,gNodes.nodes[e].y=h*(1-m)+i*m}}},gNodes.selectionIsAccepting=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,c.selected&&!c.accept&&(a=!1))}),a&&b},gNodes.selectionIsRejecting=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,c.selected&&!c.reject&&(a=!1))}),a&&b},gNodes.selectionIsNeither=function(){var a=!0,b=!1;return gNodes.nodes.forEach(function(c){c.selected&&(b=!0,(c.accept||c.reject)&&(a=!1))}),a&&b},gNodes.drawDOMNodes=function(a,b){a.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.classed("selected",function(a){return a.selected}).classed("accept",function(a){return a.accept}).classed("reject",function(a){return a.reject}),b.select("circle.inner").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.select("circle.outer").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),b.select("text").text(function(a){return a.name}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y+(isIE?gNodes.IE_TEXT_OFFSET:0)})},gNodes.destroyDOMNodes=function(a,b){a.remove(),b.remove()},gNodes.draw=function(){if(isIE&&(gNodes.lowerG.selectAll("circle").remove(),gNodes.upperG.selectAll("g").remove()),gNodes.upperG.select(".empty-text").remove(),0==gNodes.nodes.length){var a=isSafari?"Click Add New State to create your first node.":"Double-click to create your first node.";gNodes.upperG.append("text").classed("empty-text",!0).style("font-size",20).style("font-family",'"San Francisco", "Helvetica Neue", "Helvetica", "Arial", sans-serif').style("fill","rgba(0, 0, 0, 0.4)").style("stroke","none").attr("x",gGraph.width/2).attr("y",gGraph.height/2).text(a)}var b=gNodes.lowerG.selectAll("circle").data(gNodes.nodes,function(a){return a.id}),c=gNodes.upperG.selectAll("g").data(gNodes.nodes,function(a){return a.id});gNodes.createDOMNodes(b.enter(),c.enter()),gNodes.drawDOMNodes(b,c),gNodes.destroyDOMNodes(b.exit(),c.exit())},gNodes.validMoveX=function(a){var b=!0;return gNodes.nodes.filter(function(a){return a.selected}).forEach(function(c){b&=c.x+a>=gNodes.RADIUS+gNodes.STROKE_WIDTH||a>=0,b&=c.x+a<=gGraph.width-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=a}),b},gNodes.validMoveY=function(a){var b=!0;return gNodes.nodes.filter(function(a){return a.selected}).forEach(function(c){b&=c.y+a>=gNodes.RADIUS+gNodes.STROKE_WIDTH||a>=0,b&=c.y+a<=gGraph.height-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=a}),b},gNodes.getNodeIndex=function(a){var b=-1;return gNodes.nodes.forEach(function(c,d){c.id==a&&(b=d)}),b},gNodes.getNodeIndexFromName=function(a){var b=-1;return gNodes.nodes.forEach(function(c,d){c.name===a&&(b=d)}),b},gNodes.select=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected=!0},gNodes.deselect=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected=!1},gNodes.toggleSelection=function(a){gNodes.nodes[gNodes.getNodeIndex(a)].selected^=!0},gNodes.deselectAll=function(){gNodes.nodes.forEach(function(a){a.selected=!1})},gNodes.selectionIsEmpty=function(){return 0==gNodes.selectionSize()},gNodes.selectionSize=function(){return gNodes.nodes.filter(function(a){return a.selected}).length},gNodes.selectionInit=function(){gBehaviors.addBehavior("nodes","mousedown",function(){return!0},function(a){gShiftKey||a.selected||(gNodes.deselectAll(),gEdges.deselectAll()),a.selected=!0,gGraph.draw()}),gBehaviors.addBehavior("brush","brushstart",function(){return!0},function(){gNodes.nodes.forEach(function(a){a.previouslySelected=gShiftKey&&a.selected}),gEdges.deselectAll()}),gBehaviors.addBehavior("brush","brush",function(){return!0},function(){var a=d3.event.target.extent();gNodes.nodes.forEach(function(b){b.selected=b.previouslySelected^(a[0][0]<=b.x&&b.x<a[1][0]&&a[0][1]<=b.y&&b.y<a[1][1])}),gGraph.draw()})},gNodes.GRID_SPACING=150,gNodes.snapToGrid=function(){for(var a=[],b=gNodes.GRID_SPACING;b<=gGraph.width-gNodes.GRID_SPACING;b+=gNodes.GRID_SPACING)for(var c=gNodes.GRID_SPACING;c<=gGraph.height-gNodes.GRID_SPACING;c+=gNodes.GRID_SPACING)a.push({x:b,y:c});var d=[],e=-1;if(gNodes.nodes.forEach(function(a,b){null!=gNodes.initial&&gNodes.initial.id==a.id&&(e=b),d.push({x:a.x,y:a.y,i:b})}),!(a.length<d.length))for(;d.length>0&&a.length>0;){for(var f=-1,g=-1,h=-1,i=0;i<d.length;i++)for(var j=0;j<a.length;j++){var k=Math.pow(d[i].x-a[j].x,2)+Math.pow(d[i].y-a[j].y,2);(-1==h||f>k)&&(g=j,h=i,f=k)}gNodes.nodes[d[h].i].x=a[g].x,gNodes.nodes[d[h].i].y=a[g].y,d.splice(h,1),a.splice(g,1)}};var gErrorMenu={DISPLAY_TIME:2100,FADE_OUT_TIME:400,MAX_ERRORS:3};gErrorMenu.displayMessage=function(a,b,c){var d=d3.select(".errors").append("span").text(a).classed(c,!0);1!=b&&d.transition().delay(gErrorMenu.DISPLAY_TIME).duration(gErrorMenu.FADE_OUT_TIME).ease("cubic").style("opacity",0).remove();var e=d3.select(".errors").selectAll("span").size();d3.select(".errors").selectAll("span").filter(function(a,b){return b<e-gErrorMenu.MAX_ERRORS}).remove()},gErrorMenu.displayError=function(a,b){gErrorMenu.displayMessage(a,b,"error")},gErrorMenu.displayModalError=function(a,b){d3.select("."+a).select(".modal-content").insert("p",":first-child").classed("modal-description",!0).classed("error",!0).text(b)},gErrorMenu.clearModalErrors=function(){d3.selectAll(".modal-description.error").remove()};var gTableMenu={};gTableMenu.updateAll=function(){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split(""),gEdges.edges=[];var b=[];gNodes.nodes.forEach(function(a){gEdges.edgeMap[a.id]=[];var c=[];gNodes.nodes.forEach(function(){c.push(gGraph.mode==gGraph.TM?{}:"")}),b.push(c)});var c=!1,d=!1,e=!1;d3.selectAll("input.gridInput").each(function(a,f){var g=f%2==0||gGraph.mode!=gGraph.TM,h=this.character,i=this.i1;if(g){var j=this.value.split(/[ \t\n\r,]/),k=!1;j.forEach(function(a){var e=gNodes.getNodeIndexFromName(a);-1!=e?(k&&gGraph.mode!=gGraph.NFA?c=!0:gGraph.mode==gGraph.TM?b[i][e][h]={from:h}:b[i][e]+=h,k=!0):""!=a&&(d=!0)})}else{var l=this.value;if(intersection(l,gGraph.tapeSet).length!=l.length)return void(e=!0);var m=-1;for(var n in b[i])if(void 0!=b[i][n][h]){m=n;break}-1!=m&&void 0!=b[i][m][h]&&(b[i][m][h].to=""==l?" ":l)}}),d3.selectAll(".moveRight").each(function(){var a=this.character,c=this.i1,d=this.checked?1:-1,e=-1;for(var f in b[c])if(void 0!=b[c][f][a]){e=f;break}-1!=e&&void 0!=b[c][e][a]&&(b[c][e][a].direction=d)}),c&&gErrorMenu.displayError("Multiple transitions defined for one character, ignoring extras"),d&&gErrorMenu.displayError("Some states entered in the table could not be found, ignoring them"),e&&gErrorMenu.displayError("Some characters were not in the tape language"),b.forEach(function(a,b){a.forEach(function(a,c){var d=[];if(gGraph.mode==gGraph.TM)for(var e in a)d.push(a[e]);if(""!=a&&(gGraph.mode!=gGraph.TM||0!=d.length)){var f=gEdges.getEdge(gNodes.nodes[b],gNodes.nodes[c]);null==f&&(gEdges.addEdge(gNodes.nodes[b],gNodes.nodes[c]),f=gEdges.edges[gEdges.edges.length-1]),-1==gEdges.edgeMap[gNodes.nodes[b].id].indexOf(gNodes.nodes[c].id)&&gEdges.edgeMap[gNodes.nodes[b].id].push(gNodes.nodes[c].id),gGraph.mode==gGraph.TM?f.transitions[0]=d:f.transitions[0]=a.split("").sort()}})})},gTableMenu.init=function(){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split("");var b=d3.select(".tableEditor").insert("tr").selectAll("td").data(a);b.enter().append("td"),b.text(function(a){return" "==a&&gGraph.mode==gGraph.TM?gSquare:a}),b.exit().remove();var c=d3.select(".tableEditor").select("tr");c.insert("td","td").text("Rejects"),c.insert("td","td").text("Accepts"),c.insert("td","td").text("Initial"),c.insert("td","td").text(""),c.append("td").text("Delete")},gTableMenu.draw=function(){if(gTableTopMenu.active){var a=gGraph.charSet;gGraph.epsilonEnabled&&(a+=gEpsilon),gGraph.mode==gGraph.TM&&(a=gGraph.tapeSet),a=a.split("");var b=d3.select(".tableEditor").selectAll("tr").filter(function(a,b){return 0!=b}).data(gNodes.nodes),c=b.enter().append("tr");c.append("td").text(function(a){return a.name}),c.append("td").append("input").attr("type","radio").classed("initialBox",!0).each(function(a){this.checked=null!=gNodes.initial&&gNodes.initial.id==a.id}).on("change",function(a,b){this.checked?gNodes.setInitialByIndex(b):gNodes.clearInitial(),gGraph.draw()}),c.append("td").append("input").attr("type","checkbox").classed("acceptBox",!0).on("change",function(a,b){gNodes.setAcceptByIndex(b,this.checked),this.checked&&gNodes.setRejectByIndex(b,!1),gGraph.draw()}),c.append("td").append("input").attr("type","checkbox").classed("rejectBox",!0).on("change",function(a,b){gNodes.setRejectByIndex(b,this.checked),this.checked&&gNodes.setAcceptByIndex(b,!1),gGraph.draw()}),d3.selectAll(".acceptBox").each(function(a,b){this.checked=gNodes.nodes[b].accept}),d3.selectAll(".rejectBox").each(function(a,b){this.checked=gNodes.nodes[b].reject});var d=b.selectAll("td").filter(function(){return null!=d3.select(this).select("input").filter(function(){return"text"==this.type}).node()}).data(a),e=d.enter().append("td").classed("tm-cell",gGraph.mode==gGraph.TM).each(function(){gGraph.mode==gGraph.TM&&d3.select(this).style("line-height","30px")});e.append("input").attr("type","text").attr("size","10").attr("placeholder","go to").classed("gridInput",!0).each(function(a,b,c){this.character=a,this.i1=c}),e.append("input").attr("type","text").attr("size","10").attr("maxlength","1").attr("placeholder","write").classed("gridInput",!0).each(function(a,b,c){this.character=a,this.i1=c}),e.append("br");var f=e.append("form");f.append("label").text("move:"),f.append("input").attr("type","radio").attr("name","move").attr("checked",!0).classed("moveLeft",!0).each(function(a,b,c){this.character=a,this.i1=c}),f.append("label").text("L"),f.append("input").attr("type","radio").attr("name","move").classed("moveRight",!0).each(function(a,b,c){this.character=a,this.i1=c}),f.append("label").text("R"),d.selectAll("input").each(function(a,b){switch(b){case 0:this.value=gTableMenu.getConnections(gNodes.nodes[this.i1].id,a);break;case 1:var c=gTableMenu.getResult(gNodes.nodes[this.i1].id,a);null!=c&&(this.value=c);break;case 2:var d=gTableMenu.getDirection(gNodes.nodes[this.i1].id,a);0!=d&&(this.checked=-1==d);break;case 3:var d=gTableMenu.getDirection(gNodes.nodes[this.i1].id,a);0!=d&&(this.checked=1==d)}}).on("blur",function(){gTableMenu.updateAll(),gTableMenu.draw()}),d.exit().remove(),c.append("td").append("button").on("click",function(a,b){gNodes.removeByIndex(b),gGraph.draw()}).text("X"),b.exit().remove()}},gTableMenu.getConnections=function(a,b){var c=[];return gEdges.edges.forEach(function(d){gGraph.mode==gGraph.TM?d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&c.push(d.target.name)}):d.source.id==a&&-1!=d.transitions[0].indexOf(b)&&c.push(d.target.name)}),c.join(", ")},gTableMenu.getDirection=function(a,b){var c=0;return gEdges.edges.forEach(function(d){d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&(c=e.direction)})}),c},gTableMenu.getResult=function(a,b){var c=null;return gEdges.edges.forEach(function(d){d.transitions[0].forEach(function(e){d.source.id==a&&e.from==b&&(c=" "==e.to?"":e.to)})}),c};var gTableTopMenu={active:!1};gTableTopMenu.swap=function(){gTableTopMenu.active?(d3.select("svg").style("display","inline"),d3.select(".tableEditor, .tableEditorHeader").style("display","none"),d3.selectAll(".nontable").style("display","inline"),d3.selectAll(".nontableblock").style("display","block"),d3.select(".swapButton").text("Switch to Table View"),gTableTopMenu.active=!1,gTableMenu.updateAll()):(d3.select("svg").style("display","none"),d3.select(".tableEditor, .tableEditorHeader").style("display","table"),d3.selectAll(".nontable, .nontableblock").style("display","none"),d3.select(".swapButton").text("Switch to Editor View"),gNodes.deselectAll(),gEdges.deselectAll(),gTableTopMenu.active=!0),gGraph.mode==gGraph.DFA?d3.selectAll(".dfa-hide").style("display","none"):gGraph.mode==gGraph.NFA?d3.selectAll(".nfa-hide").style("display","none"):d3.selectAll(".tm-hide").style("display","none"),gGraph.draw()};var gTestMenu={NUM_CELLS:250,DISPLAY_TIME:4600,FADE_OUT_TIME:400};gTestMenu.init=function(){gTestMenu.reset(),gTestMenu.text="",gTestMenu.backupText="";var a=d3.select(".tape-field");gTestMenu.showPlaceholder=!0;for(var b=0;b<gTestMenu.NUM_CELLS;b++)a.append("input").attr("type","text").classed("tape-char",!0).attr("name","tapeChar[]").attr("maxlength",1).attr("readonly","readonly").on("click",gTestMenu.allowInput);d3.select(".tape-char-input").attr("maxlength",gTestMenu.NUM_CELLS).on("keydown",function(){13==d3.event.keyCode&&(gTestMenu.disallowInput(),gTestMenu.run())}),gTestMenu.disallowInput()},gTestMenu.reset=function(){gTestMenu.setRunning(!1),d3.select(".tape-char-input").node().value=gTestMenu.backupText||"",d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.reset()},gTestMenu.allowInput=function(){gTestMenu.showPlaceholder=!1,gTestMenu.reset(),d3.select(".tape-char-input").node().value=gTestMenu.backupText,d3.selectAll(".tape-char").style("display","none"),d3.select(".tape-char-input").style("display","inline").each(function(){this.focus()})},gTestMenu.disallowInput=function(a){if(gTestMenu.backupText!=intersection(d3.select(".tape-char-input").node().value,gGraph.charSet)){gTestMenu.backupText=d3.select(".tape-char-input").node().value;var b=intersection(gTestMenu.backupText,gGraph.charSet);gTestMenu.backupText.length!=b.length&&gErrorMenu.displayError("Removing characters that aren't in the alphabet."),gTestMenu.backupText=b}gTestMenu.text=void 0==a?gTestMenu.backupText:a;var c="Click to enter a test";d3.selectAll(".tape-char").style("display","inline").style("color",gTestMenu.showPlaceholder?"#bbb":"#fff").each(function(a,b){var d=gTestMenu.showPlaceholder?c:gTestMenu.text;this.value=b<d.length?d[b]:""}),d3.select(".tape-char-input").style("display","none")},gTestMenu.unsetTransitions=function(){var a=[];if(gGraph.mode==gGraph.DFA){var b=gGraph.save(),c=gSimulator.convert(b);for(var d in c){var e=!1;for(var f in c[d])e|=0==c[d][f].length;e&&a.push(gNodes.nodes[gNodes.getNodeIndex(d)].name)}}return a},gTestMenu.runTests=function(){var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=a.length?gErrorMenu.displayError("The following states have undefined transitions: "+a.join(", ")):gModalMenu.open("testing")},gTestMenu.setRunning=function(a){a?(d3.selectAll(".running").style("display","inline"),d3.select(".runButton").text("Restart")):(d3.selectAll(".running").style("display","none"),d3.select(".runButton").text("Start"))},gTestMenu.run=function(){gTestMenu.reset();var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=a.length?gErrorMenu.displayError("The following states have undefined transitions: "+a.join(", ")):(gTestMenu.setRunning(!0),gTape.show(),gTape.run())},gTestMenu.end=function(){gTestMenu.setRunning(!1),d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.hide()},gTestMenu.step=function(){var a=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("No initial node is set"):0!=a.length?gErrorMenu.displayError("The following nodes have undefined transitions: "+a.join(", ")):(gTape.show(),gTape.step())};var gTopMenu={MAX_DISPLAYED_STATES:5,SELECTED_TEXT:"Selected states: "};gTopMenu.addNode=function(){gNodes.addNode(),gGraph.draw()},gTopMenu.setState=function(a,b){gNodes.selectionIsEmpty()&&gErrorMenu.displayError("No states are selected"),gNodes.setAccepting(a),gNodes.setRejecting(b),gGraph.draw()},gTopMenu.deleteSelected=function(){gNodes.selectionIsEmpty()&&gEdges.selectionIsEmpty()&&(gErrorMenu.displayError("No states or transitions are selected"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3)),gNodes.removeNodes()&&(gEdges.deleteSelected(),gGraph.draw())},gTopMenu.setInitial=function(){gNodes.selectionIsEmpty()?gErrorMenu.displayError("No states are selected"):gNodes.selectionSize()>1&&gErrorMenu.displayError("Multiple states are selected. Using the first one."),gNodes.setInitial(),gGraph.draw()},gTopMenu.snapToGrid=function(){gNodes.snapToGrid(),gGraph.draw()},gTopMenu.forcedDirectedLayout=function(){gNodes.forcedDirectedLayout(),gGraph.draw()},gTopMenu.loadFromServer=function(){gModalMenu.open("load"),gModalMenu.load.onOpen()},gTopMenu.save=function(){var a=2e3,b=gServer.name;gTopMenu.setSaveButton("Saving..."),!gModalMenu.saveas.isInvalidName(b)&&b?gServer.save(b,function(b,c){b?(gTopMenu.setSaveButton("Failed"),gErrorMenu.displayError("Save failed: couldn't connect to server.")):gTopMenu.setSaveButton("Saved!"),setTimeout(function(){gTopMenu.setSaveButton("Save")},a)}):b?(gErrorMenu.displayError('Saving to invalid name, use "Save As" to change name'),gTopMenu.setSaveButton("Save")):(gErrorMenu.displayError('Please first use "Save As" to give your automaton a name'),gTopMenu.setSaveButton("Save"))},gTopMenu.saveas=function(){gModalMenu.saveas.open()},gTopMenu.submit=function(){null!=gGraph.pset&&gModalMenu.submitModal.setPsetNumber(gGraph.pset),null!=gGraph.problem&&gModalMenu.submitModal.setProblemNumber(gGraph.problem),gModalMenu.open("submit")},gTopMenu.homepage=function(){window.location.href=getURLParent()+"index.html"},gTopMenu.draw=function(){var a="",b=gNodes.getSelected();b.sort();for(var c=0;c<gTopMenu.MAX_DISPLAYED_STATES&&c<b.length;c++)a+=b[c]+", ";a=0==b.length?"None":a.substring(0,a.length-2),b.length>gTopMenu.MAX_DISPLAYED_STATES&&(a+="...");var d=gGraph.mode.toUpperCase();"TM"==d&&(d="Turing Machine");var e=null==gGraph.pset?"":psets[gGraph.pset].name+", ",f=null==gGraph.problem&&null==gGraph.pset?"":psets[gGraph.pset].problems[gGraph.problem].name+", ";d3.select(".current-pset-problem").text(e+f),d3.select(".current-mode").text(d),d3.select(".current-alphabet").text(gGraph.charSet),"tm"===gGraph.mode&&gGraph.tapeSet&&sortString(gGraph.tapeSet)!==sortString(gGraph.charSet)&&(d3.select(".current-tape-set").style("display","inline"),d3.select(".current-tape-set-inner").text(gGraph.tapeSet)),d3.select("#selectedText").text(gTopMenu.SELECTED_TEXT+a),d3.select(".acceptButton").classed("marked",gNodes.selectionIsAccepting()),d3.select(".rejectButton").classed("marked",gNodes.selectionIsRejecting()),d3.selectAll(".neitherButton").classed("marked",gNodes.selectionIsNeither())},gTopMenu.setSaveButton=function(a){d3.select(".saveTopButton").text(a)},gModalMenu.confirm={},gModalMenu.confirm.flag="",gModalMenu.confirm.open=function(){gModalMenu.open("confirm")},gModalMenu.confirm.clickConfirmBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmBtn()},gModalMenu.confirm.clickCancelBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmCancelBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmCancelBtn()},gModalMenu.getEpsilon=function(){return gGraph.mode==gGraph.NFA&&d3.select(".epsilon").node().checked},gModalMenu.setEpsilon=function(a){d3.select(".epsilon").node().checked=a},gModalMenu.addAllEdgeChars=function(){gModalMenu.setEdgeChars(gGraph.charSet),gModalMenu.setEpsilon(!0)},gModalMenu.invertEdgeChars=function(){var a=gGraph.charSet,b=gModalMenu.getEdgeCharacters();for(var c in b)a=a.replace(b[c],"");gModalMenu.setEdgeChars(a),gModalMenu.setEpsilon(!gModalMenu.getEpsilon())},gModalMenu.addRemainingEdgeChars=function(){var a=[],b=gGraph.save(),c=gSimulator.convert(b);for(var d in c[gEdges.editedEdge.source.id])0==c[gEdges.editedEdge.source.id][d].length&&a.push(d);gModalMenu.setEdgeChars(gModalMenu.getEdgeCharacters()+a.join(""))},gModalMenu.setEdgeChars=function(a){d3.select(".edgeChars").node().value=a},gModalMenu.getEdgeCharacters=function(){return d3.select(".edgeChars").node().value},gModalMenu.deleteEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gGraph.draw(),gModalMenu.close("edgeEntry")},gModalMenu.load={},gModalMenu.load.onOpen=function(){gModalMenu.open("load"),gModalMenu.load.setLoadMessage("Gathering saved automata..."),gServer.listSaved(function(a,b){if(a)return gErrorMenu.displayModalError("load","Could not gather saved automata..."),d3.select(".load").selectAll("li").remove(),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3);var c=[];b.forEach(function(a,b,d){c.push(a.name)}),gModalMenu.load.setLoadNames(c)})},gModalMenu.load.onClickLoadBtn=function(){gErrorMenu.clearModalErrors();var a=gModalMenu.load.getLoadName();return a?(gModalMenu.load.setLoadButton("Loading..."),void gServer.load(a,function(b,c){if(b)return void("function"==typeof error_callback&&(gErrorMenu.displayModalError("load","Failed to load"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),gModalMenu.load.setLoadButton("Load")));gServer.changeName(a),gModalMenu.load.setLoadButton("Success!"),gGraph.charSet=c.meta.charSet,gGraph.pset=c.meta.pset,gGraph.problem=c.meta.problem,"tm"===d&&(gGraph.tapeSet=c.meta.tapeSet);var d=c.meta.mode;d!=gGraph.mode&&(window.location.href=getURLParent()+"tm.html?saved="+a),gGraph.load(c),gGraph.draw(),setTimeout(function(){gModalMenu.load.setLoadButton("Load"),gModalMenu.close("load")},300)})):(gErrorMenu.displayModalError("load","No automaton selected"),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3))},gModalMenu.load.setLoadNames=function(a){var b=d3.select(".loadNames").selectAll("li").data(a);b.enter().append("li"),b.classed("selected",!1).classed("load-nothing",!1).text(function(a){return a}).on("click",function(){d3.select(".loadNames").selectAll("li").classed("selected",!1),d3.select(this).classed("selected",!0)}).style("cursor","pointer"),b.exit().remove(),0==a.length&&d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text("Nothing's been saved yet")},gModalMenu.load.getLoadName=function(){var a=d3.select(".loadNames").select("li.selected").node();return null==a?null:encodeURIComponent(d3.select(".loadNames").select("li.selected").text())},gModalMenu.load.setLoadButton=function(a){d3.select(".loadButton").text(a)},gModalMenu.load.setLoadMessage=function(a){d3.select(".loadNames").selectAll("li").remove(),d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text(a)};var gModalMenu={MAX_HEIGHT_PERCENT:.62};gModalMenu.open=function(a){gModalMenu.currentType=a,d3.select("."+a).style("display","inline"),d3.select(".overlay").style("display","inline")},gModalMenu.close=function(a){gErrorMenu.clearModalErrors(),d3.select("."+a).style("display","none"),d3.select(".overlay").style("display","none")},gModalMenu.closeCurrent=function(){gModalMenu.cancel(gModalMenu.currentType)},gModalMenu.submitOnEnter=function(a){13==event.keyCode&&gModalMenu.submit(a)},gModalMenu.submit=function(a){switch(gErrorMenu.clearModalErrors(),a){case"tmEdgeEntry":gEdges.tmEditComplete();break;case"edgeEntry":gEdges.editComplete();break;case"nodeEntry":gNodes.editComplete();break;case"testing":gSimulator.runTests();break;case"saveas":gModalMenu.saveas.clickSaveBtn();break;case"load":gModalMenu.load.onClickLoadBtn();break;case"submit":gModalMenu.submitModal.clickSubmitBtn();break;case"confirm":gModalMenu.confirm.clickConfirmBtn()}},gModalMenu.cancel=function(a){switch(a){case"edgeEntry":gEdges.editCancelled();break;case"confirm":gModalMenu.confirm.clickCancelBtn();break;case"saveas":default:gModalMenu.close(a)}},gModalMenu.getNodeName=function(){return d3.select(".nodeName").node().value},gModalMenu.setNodeName=function(a){d3.select(".nodeName").node().value=a},gModalMenu.setInitial=function(a){d3.select(".nodeInitialCheckbox").node().checked=a},gModalMenu.getInitial=function(){return d3.select(".nodeInitialCheckbox").node().checked},gModalMenu.setState=function(a,b){d3.selectAll(".modalAcceptButton").classed("marked",a),d3.selectAll(".modalNeitherButton").classed("marked",!a&&!b),d3.selectAll(".modalRejectButton").classed("marked",b)},gModalMenu.getAccepting=function(){return d3.select(".modalAcceptButton").classed("marked")},gModalMenu.getRejecting=function(){return d3.select(".modalRejectButton").classed("marked")},gModalMenu.deleteNode=function(){gNodes.deleteEdited()},gModalMenu.saveas={},gModalMenu.saveas.open=function(){gModalMenu.saveas.setSaveName(gServer.name),gModalMenu.open("saveas")},gModalMenu.saveas.clickSaveBtn=function(){gModalMenu.confirm.flag="saveas",
gModalMenu.saveas.setSaveButton("Saving...");var a=gModalMenu.saveas.getSaveName();if(gModalMenu.saveas.isInvalidName(a))return gErrorMenu.displayModalError("saveas","Automaton name cannot be blank"),void gModalMenu.saveas.setSaveButton("Save");var b=encodeURIComponent(a);gServer.listSaved(function(a,c){function d(a,b){return a.some(function(a,c,d){return a.name===b})}return a?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.saveas.setSaveButton("Save")):void(d(c,b)?(gModalMenu.close("saveas"),gModalMenu.confirm.open()):gModalMenu.saveas.save(function(){gModalMenu.close("saveas")}))})},gModalMenu.saveas.clickCancelBtn=function(){gModalMenu.cancel("saveas")},gModalMenu.saveas.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("saveas"),gModalMenu.saveas.save(function(){gModalMenu.close("saveas")})},gModalMenu.saveas.clickConfirmCancelBtn=function(){gModalMenu.close("saveas"),gModalMenu.close("confirm"),gModalMenu.saveas.setSaveButton("Save")},gModalMenu.saveas.save=function(){var a=gModalMenu.saveas.getSaveName();gServer.save(a,function(b,c){return b?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.saveas.setSaveButton("Save")):(gServer.changeName(a),gModalMenu.saveas.setSaveButton("Saved!"),void window.setTimeout(function(){gModalMenu.saveas.setSaveButton("Save"),gModalMenu.close("saveas")},1e3))})},gModalMenu.saveas.isInvalidName=function(a){return 0===a.replace(/\s/g,"").length},gModalMenu.saveas.getSaveName=function(){return d3.select(".saveText").node().value},gModalMenu.saveas.setSaveName=function(a){d3.select(".saveText").node().value=decodeURIComponent(a)},gModalMenu.saveas.setSaveButton=function(a){d3.select(".saveButton").text(a)},gModalMenu.submitModal={},gModalMenu.submitModal.init=function(){var a=d3.select(".pset").selectAll("option").data(psets);a.enter().append("option").attr("value",function(a,b){return b}).text(function(a,b){return a.name}),d3.select(".pset").node().selectedIndex=0,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.clickSubmitBtn=function(){function a(a,b,c){return a.some(function(a,d,e){var f=parseInt(a.pset_id),g=parseInt(a.problem_id);return f===b&&g===c})}gModalMenu.confirm.flag="submit";var b=(JSON.stringify(gGraph.save()),gModalMenu.submitModal.getPsetNumber()),c=gModalMenu.submitModal.getProblemNumber();gModalMenu.submitModal.setSubmitButton("Submitting..."),gServer.listSubmissions(function(d,e){return e?(gErrorMenu.displayModalError("submit","Failed to submit"),gModalMenu.submitModal.setSubmitButton("Submit"),void setTimeout(function(){gErrorMenu.clearModalErrors()},3e3)):void(a(d,b,c)?(gModalMenu.close("submit"),gModalMenu.confirm.open()):gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")}))})},gModalMenu.submitModal.clickCancelBtn=function(){gModalMenu.cancel("submit"),gErrorMenu.clearModalErrors()},gModalMenu.submitModal.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")})},gModalMenu.submitModal.clickConfirmCancelBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.setSubmitButton("Submit")},gModalMenu.submitModal.changenumbers=function(){var a=d3.select(".pset").node().selectedIndex,b=d3.select(".problem").selectAll("option").data(psets[a].problems);b.enter().append("option"),b.attr("value",function(a){return a.charSet}).text(function(a){return a.name}),b.exit().remove(),d3.select(".problem").node().selectedIndex=0},gModalMenu.submitModal.submit=function(a){var b=JSON.stringify(gGraph.save()),c=gModalMenu.submitModal.getPsetNumber(),d=gModalMenu.submitModal.getProblemNumber();return psets[c].problems[d].type!=gGraph.mode&&"nfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is an NFA, but the problem requires a DFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[c].problems[d].type!=gGraph.mode&&"dfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is a DFA, but the problem requires an NFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[c].problems[d].charSet!=gGraph.charSet?(gErrorMenu.displayModalError("submit","The alphabet for this automaton doesn't match the alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):"tm"===gGraph.mode&&psets[c].problems[d].tapeSet!=gGraph.tapeSet?(gErrorMenu.displayModalError("submit","The tape alphabet for this turing machine doesn't match the tape alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):void gServer.submit(b,c,d,function(b){return b?(gErrorMenu.displayModalError("submit","Failed to submit"),setTimeout(function(){gErrorMenu.clearModalErrors()},3e3),void gModalMenu.submitModal.setSubmitButton("Submit")):(gModalMenu.submitModal.setSubmitButton("Success!"),void setTimeout(function(){gModalMenu.submitModal.setSubmitButton("Submit"),a()},1e3))})},gModalMenu.submitModal.getProblemNumber=function(){return d3.select(".problem").node().selectedIndex},gModalMenu.submitModal.getPsetNumber=function(){return d3.select(".pset").node().selectedIndex},gModalMenu.submitModal.setProblemNumber=function(a){d3.select(".problem").node().selectedIndex=a},gModalMenu.submitModal.setPsetNumber=function(a){d3.select(".pset").node().selectedIndex=a,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.setSubmitButton=function(a){d3.select(".submitButton").text(a)},gModalMenu.focusRow=function(a){a=Math.max(a,0);var b=!1;d3.selectAll(".bulkInput").each(function(c,d){d==a&&(this.focus(),b=!0)}),b||gModalMenu.buildRow(!0)},gModalMenu.buildRow=function(a){var b=d3.select(".testingHeader").append("tr");b.append("td").append("input").attr("type","text").classed("bulkInput",!0).each(function(){a&&this.focus()}),b.append("td").append("input").attr("type","radio").classed("bulkAccept",!0),b.append("td").append("input").attr("type","radio").classed("bulkReject",!0),d3.selectAll(".bulkAccept").on("change",function(a,b){gModalMenu.clearReject(b)}),d3.selectAll(".bulkReject").on("change",function(a,b){gModalMenu.clearAccept(b)}),d3.selectAll(".bulkInput").on("keydown",function(a,b){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.focusRow(b+1):38==d3.event.keyCode&&gModalMenu.focusRow(b-1)})},gModalMenu.initBulk=function(){gModalMenu.buildRow(!1),d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.clearReject=function(a){d3.selectAll(".bulkReject").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.clearAccept=function(a){d3.selectAll(".bulkAccept").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.tmEdge={},gModalMenu.tmEdge.focusTmRow=function(a){a=Math.max(a,0);var b=!1;d3.selectAll(".tmEdgeInput").each(function(c,d){d==a&&(this.focus(),b=!0)}),b||gModalMenu.tmEdge.buildTmRow(!0)},gModalMenu.tmEdge.setTmEdgeStates=function(a){0==a.length&&a.push({direction:1,to:"",from:""});for(var b=a.length-d3.selectAll(".tmEdge > tr").size(),c=0;b>c;c++)gModalMenu.tmEdge.buildTmRow(!1);var d=d3.select(".tmEdge").selectAll("tr").filter(function(a,b){return 0!=b}).data(a);d.select("td > .edgeLeft").each(function(a){this.checked=-1==a.direction}),d.select("td > .edgeRight").each(function(a){this.checked=1==a.direction}),d.selectAll("td > .tmEdgeChars").each(function(b,c,d){this.value=1==c?a[d].to:a[d].from}),d.exit().remove()},gModalMenu.tmEdge.getTmEdgeStates=function(){var a=[];return d3.select(".tmEdge").selectAll("tr").filter(function(a,b){return 0!=b}).each(function(){var b={},c=d3.select(this);b.direction=c.select("td > .edgeLeft").node().checked?-1:1,b.from=c.selectAll("td > .tmEdgeChars")[0][0].value,b.to=c.selectAll("td > .tmEdgeChars")[0][1].value,a.push(b)}),a},gModalMenu.tmEdge.buildTmRow=function(a){var b=d3.select(".tmEdge").append("tr");b.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0).each(function(){a&&this.focus()}),b.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0);var c=b.append("td");c.append("input").attr("type","radio").classed("edgeLeft",!0),c.append("label").text(" L "),c.append("input").attr("type","radio").attr("checked",!0).classed("edgeRight",!0),c.append("label").text(" R "),b.append("td").append("button").classed("button-delete",!0).text("X"),gModalMenu.tmEdge.updateTmDeleteButtons(),d3.selectAll(".edgeLeft").on("change",function(a,b){gModalMenu.tmEdge.clearRight(b)}),d3.selectAll(".edgeRight").on("change",function(a,b){gModalMenu.tmEdge.clearLeft(b)}),d3.selectAll(".tmEdgeChars").on("keydown",function(a,b){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.tmEdge.focusTmRow(b+1):38==d3.event.keyCode&&gModalMenu.tmEdge.focusTmRow(b-1)})},gModalMenu.tmEdge.updateTmDeleteButtons=function(){d3.selectAll(".button-delete").on("click",function(a,b){d3.select(".tmEdge").selectAll("tr").filter(function(a,c){return b==c}).remove(),gModalMenu.tmEdge.updateTmDeleteButtons()})},gModalMenu.tmEdge.initTmEdit=function(){d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.tmEdge.clearLeft=function(a){d3.selectAll(".edgeLeft").each(function(b,c){c==a&&(this.checked=!1)})},gModalMenu.tmEdge.clearRight=function(a){d3.selectAll(".edgeRight").each(function(b,c){c==a&&(this.checked=!1)})},gSimulator.ACCEPT="ACCEPT",gSimulator.REJECT="REJECT",gSimulator.NEITHER="NEITHER",gSimulator.runTests=function(){var a=[],b=!1;d3.selectAll(".bulkInput").each(function(){var c=intersection(this.value,gGraph.charSet);b|=c.length!=this.value.length,this.value=c,a.push({testCase:c,expected:gSimulator.NEITHER})}),d3.selectAll(".bulkAccept").each(function(b,c){this.checked&&(a[c].expected=gSimulator.ACCEPT)}),d3.selectAll(".bulkReject").each(function(b,c){this.checked&&(a[c].expected=gSimulator.REJECT)}),b&&gErrorMenu.displayModalError("testing","Removing characters not in alphabet");var c=[],d=gGraph.save();a.forEach(function(a){c.push({accepted:gSimulator.run(d,a.testCase),input:gSimulator.output,expected:a.expected})});var e=d3.select(".testingResults").selectAll("tr").data(c),f=e.enter().append("tr");f.append("td").attr("width","60%").style("text-align","left"),f.append("td").attr("width","20%").style("text-align","center"),f.append("td").attr("width","20%").style("text-align","center"),e.each(function(a){d3.select(this).selectAll("td").text(function(b,c){switch(c){case 0:return a.accepted==gSimulator.TIMEOUT?"Timed out":a.input;case 1:return a.accepted==gSimulator.TIMEOUT?"-":a.accepted?"A":"R";case 2:if(a.expected===gSimulator.NEITHER||a.accepted==gSimulator.TIMEOUT)return"-";var d=!(a.expected===gSimulator.ACCEPT^a.accepted);return d?"Y":"N"}})}),e.exit().remove()};var gDFASimulator={};gDFASimulator.step=function(a,b,c,d){var e=gSimulator.convert(a);return e[b][c[d]][0]},gDFASimulator.run=function(a,b){gSimulator.output=b;for(var c=gSimulator.convert(a),d=a.nodes.initial,e=0;e<b.length;e++){var f=c[d][b[e]];if(0==f.length)return!1;d=f[0]}for(var e=0;e<a.nodes.nodes.length;e++)if(a.nodes.nodes[e].id==d)return a.nodes.nodes[e].accept;return!1};var gNFASimulator={};gNFASimulator.run=function(a,b){gSimulator.output=b;var c=gSimulator.convert(a),d=new Queue,e={};for(d.enqueue({current:a.nodes.initial,index:0}),e[a.nodes.initial+" 0"]=!0;!d.isEmpty();){var f=d.dequeue();if(f.index==b.length){for(var g=0;g<a.nodes.nodes.length;g++)if(a.nodes.nodes[g].id==f.current&&a.nodes.nodes[g].accept)return!0}else for(var h=c[f.current][b[f.index]],g=0;g<h.length;g++){var i={current:h[g],index:f.index+1};e[i.current+" "+i.index]||(e[i.current+" "+i.index]=!0,d.enqueue(i))}for(var j=c[f.current][gEpsilon],g=0;g<j.length;g++){var i={current:j[g],index:f.index};e[i.current+" "+i.index]||(e[i.current+" "+i.index]=!0,d.enqueue(i))}}return!1};var gSimulator={TIMEOUT:"timeout"};gSimulator.init=function(){var a=gGraph.mode==gGraph.DFA?gDFASimulator:gGraph.mode==gGraph.NFA?gNFASimulator:gTMSimulator;gSimulator.run=a.run,gSimulator.step=a.step},gSimulator.convert=function(a){var b={},c=gGraph.charSet+(gGraph.epsilonEnabled?gEpsilon:"");return a.nodes.nodes.forEach(function(a){b[a.id]={};for(var d=0;d<c.length;d++)b[a.id][c[d]]=[]}),a.edges.edges.forEach(function(a){a.transitions[0].forEach(function(c){b[a.source][c].push(a.target)})}),b};var gTape={SELECT_RADIUS:50};gTape.init=function(){d3.select(".tape").append("circle").style("fill","none").style("stroke","blue").attr("r",gTape.SELECT_RADIUS),gTape.hide(),gTape.done=!0,gTape.running=!1},gTape.run=function(){var a=gTestMenu.text;gTape.done=!1,gTape.running=!0,d3.select(".tape").select("circle").style("stroke","blue"),gTape.input=a.split(""),gTape.index=0,gTape.follow=gTape.current=gNodes.initial,gTape.draw()},gTape.drawResult=function(a){if(!gTape.done){var b="Run finished, "+(a?"accept":"reject")+'ing string "'+gTape.input.join("")+'"';!gTape.follow||gTape.follow.accept||gTape.follow.reject||(b+=" because of a missing transition"),gErrorMenu.displayMessage(b,!1,a?"accepting run-finished":"rejecting run-finished"),gTape.done=!0}},gTape.draw=function(){var a=d3.select(".tape").select("circle");if(gTape.follow){var b=gTape.follow!=gTape.prev&&1==a.style("opacity")?100:0;a.transition().duration(b).attr("cx",gTape.follow.x).attr("cy",gTape.follow.y).style("opacity",1),d3.select(".stepButton").text("Step").node().disabled=!1,gTape.isRejecting()?(a.style("stroke","red"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!1)):gTape.isAccepting()&&(a.style("stroke","green"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!0))}else a.style("opacity",0);var c=gGraph.mode==gGraph.TM?"current-tape-char-solid":"current-tape-char";gTape.running&&gTape.index<=gTape.input.length&&d3.selectAll(".tape-char").classed(c,function(a,b){return d3.select(this).classed(c)||gTape.index!=b||(this.focus(),this.blur()),gTape.index==b}),gTape.prev=gTape.follow},gTape.isAccepting=function(){return gGraph.mode==gGraph.DFA?"undefined"!=typeof gTape.current&&gTape.current.accept&&gTape.index==gTape.input.length:"undefined"!=typeof gTape.current&&gTape.current.accept},gTape.isRejecting=function(){return gGraph.mode==gGraph.DFA?"undefined"==typeof gTape.current||!gTape.current.accept&&gTape.index==gTape.input.length:"undefined"==typeof gTape.current||gTape.current.reject},gTape.show=function(){d3.select(".tape").style("opacity",1)},gTape.reset=function(){gTape.done=!0,gTape.running=!1,gTape.follow=null,gTape.draw()},gTape.hide=function(){gTape.reset(),d3.select(".tape").style("opacity",0)},gTape.step=function(){if(!gTape.running)return void gTape.run();if(!gTape.isRejecting()&&!gTape.isAccepting()){if(gGraph.mode==gGraph.DFA){var a=gDFASimulator.step(gGraph.save(),gTape.current.id,gTape.input,gTape.index++);gTape.current=gNodes.nodes[gNodes.getNodeIndex(a)]}else{var a=gTMSimulator.step(gGraph.save(),gTape.current.id,gTape.input.join(""),gTape.index);gTape.current=gNodes.nodes[gNodes.getNodeIndex(a.initial)],gTape.input=a.input.split(""),gTape.index=a.index,gTestMenu.disallowInput(gTape.input.join(""))}"undefined"!=typeof gTape.current&&(gTape.follow=gTape.current)}gTape.draw()};var gTMSimulator={MAX_ITER:1e5},gBlank=" ",gSquare=String.fromCharCode(9633);gTMSimulator.convert=function(a){var b={},c=gGraph.tapeSet+(gGraph.epsilonEnabled?gEpsilon:"");return a.nodes.nodes.forEach(function(a){b[a.id]={};for(var d=0;d<c.length;d++)b[a.id][c[d]]=null}),a.edges.edges.forEach(function(a){a.transitions[0].forEach(function(c){b[a.source][c.from]=JSON.parse(JSON.stringify(c)),b[a.source][c.from].target=a.target})}),b},gTMSimulator.step=function(a,b,c,d){var e=gTMSimulator.convert(a);return e[b][c[d]],gTMSimulator.stepState(e,{initial:b,input:c,index:d})},gTMSimulator.stepState=function(a,b){var c=b.input;c.length==b.index&&(c+=gBlank);var d=a[b.initial][c[b.index]];if(void 0==d)return{initial:void 0,input:c,index:b.index};var e={initial:d.target,index:b.index+d.direction};for(e.input=c.substring(0,b.index)+d.to+c.substring(b.index+1);e.index<0;)e.index++,e.input=gBlank+e.input;for(;e.index>=e.input.length;)e.input+=gBlank;return e},gTMSimulator.run=function(a,b){for(var c={initial:a.nodes.initial,input:b,index:0},d=gTMSimulator.convert(a),e=0;e<gTMSimulator.MAX_ITER;e++){if(void 0==c.initial)return gSimulator.output=c.input,!1;var f=a.nodes.nodes[gNodes.getNodeIndex(c.initial)];if(f.accept)return gSimulator.output=c.input,!0;if(f.reject)return gSimulator.output=c.input,!1;e<gTMSimulator.MAX_ITER-1&&(c=gTMSimulator.stepState(d,c))}return gSimulator.output=c.input,gSimulator.TIMEOUT};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var a=gModalMenu.getSaveName();if(0==a.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=a;var b="/api/save.php";gModalMenu.setSaveButton("Saving...");var c=JSON.stringify(gGraph.save()),d={automata:c,name:a};d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").post(JSON.stringify(d),function(a,b){a?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var a=gModalMenu.getLoadName(),b="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(a,b){a&&console.log(a);var c=JSON.parse(b.response);gGraph.load(JSON.parse(c[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var a="/api/submit.php",b=JSON.stringify(gGraph.save()),c=1,d=1,e={automata:b,pset:c,problem:d};d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").post(JSON.stringify(e),function(a,b){a?console.log(a):console.log(b)})},gServerMock.listSubmissions=function(){var a="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+a).header("Content-Type","application/json").get(function(a,b){a?console.log(a):(console.log(b),JSON.parse(b.response))})},gServerMock.loadSubmission=function(){var a=1,b=1,c="/api/loadFromSubmissions.php",d=gServer.url_prefix+c+"?problem="+b+"&pset="+a;d3.xhr(d).header("Content-Type","application/json").get(function(a,b){if(a)console.log(a);else{console.log(b);var c=JSON.parse(b.response),d=JSON.parse(c[0].automata);gGraph.load(d),gGraph.draw()}})},gServerMock.listSaved=function(a){a([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(a){a("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock);var gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(a){var b=setURLParam("saved",a,window.location.href);window.history.pushState({},"",b),gServer.name=a},gServer.save=function(a,b){var c="/api/save.php",d=JSON.stringify(gGraph.save()),e={automata:d,name:a};d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").post(JSON.stringify(e),function(a,c){a?b(a,null):b(a,c)})},gServer.load=function(a,b){var c="/api/loadFromSaved.php?name="+a;d3.xhr(gServer.url_prefix+c).header("Content-Type","application/json").get(function(a,c){var d=JSON.parse(c.response);b(a,JSON.parse(d[0].automata))})},gServer.submit=function(a,b,c,d){var e="/api/submit.php",f={automata:a,pset:b,problem:c},g=JSON.stringify(f);d3.xhr(gServer.url_prefix+e).header("Content-Type","application/json").post(g,function(a,b){d(a)})},gServer.listSubmissions=function(a){var b="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){var d=c?JSON.parse(c.response):null;a(d,b)})}catch(c){console.error("Could not connect to server")}},gServer.loadSubmission=function(a,b,c){var d="/api/loadFromSubmissions.php",e=gServer.url_prefix+d+"?problem="+b+"&pset="+a;d3.xhr(e).header("Content-Type","application/json").get(function(a,b){a?c(a,null):c(a,JSON.parse(b.response))})},gServer.listSaved=function(a){var b="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){b?a(b,null):a(b,JSON.parse(c.response))})}catch(c){console.error("Could not connect to server")}},gServer.getSunetid=function(a){var b="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+b).header("Content-Type","application/json").get(function(b,c){a(b?null:c.response)})}catch(c){console.error("Could not connect to server")}},Math.bound=function(value,min,max){for(var mod=max-min;min>value;)value+=mod;for(;value>max;)value-=mod;return value};var isIE=function(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");if(msie>0)return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10);var trident=ua.indexOf("Trident/");if(trident>0){var rv=ua.indexOf("rv:");return parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10)}var edge=ua.indexOf("Edge/");return edge>0?parseInt(ua.substring(edge+5,ua.indexOf(".",edge)),10):!1}(),isSafari=function(){var uagent=navigator.userAgent.toLowerCase();return/safari/.test(uagent)&&!/chrome/.test(uagent)}(),gBrush={};gBrush.init=function(){var brushG=d3.select("g.brush"),brush=d3.svg.brush().x(d3.scale.identity().domain([0,gGraph.width])).y(d3.scale.identity().domain([0,gGraph.height])).clamp([!1,!1]).on("brushend",function(){d3.event.target.clear(),d3.select(this).call(d3.event.target)});gBehaviors.apply("brush",brush),brushG.call(brush),brushG.select(".background").style("cursor","default"),brushG.select(".extent").style("cursor","default")},gGraph.initDelete=function(){gBehaviors.addBehavior("page","keydown",function(){return(46==d3.event.keyCode||8==d3.event.keyCode)&&"none"===d3.select(".overlay").style("display")&&d3.select(".tape-char-input").node()!==document.activeElement&&!gTableTopMenu.active},function(){d3.event.preventDefault(),gNodes.removeNodes()&&(gEdges.deleteSelected(),gGraph.draw())})};var gShiftKey=!1,gEpsilon="",gGraph={HEIGHT_OFFSET:5,BUFFER:100,DFA:"dfa",NFA:"nfa",TM:"tm"};gGraph.init=function(pset,problem,charSet,mode,tapeSet){var svg=d3.select("svg");gGraph.width=svg.node().getBoundingClientRect().width,gGraph.height=svg.node().getBoundingClientRect().height-gGraph.HEIGHT_OFFSET,gGraph.height-=d3.select(".tape-bar").node().getBoundingClientRect().height,svg.attr("height",gGraph.height);var charSetParam=charSet;gGraph.problem=problem,gGraph.pset=pset,gGraph.mode=mode,gGraph.mode!=gGraph.NFA&&gGraph.mode!=gGraph.TM&&(gGraph.mode=gGraph.DFA),null==charSetParam&&(window.location=getURLParent()+"index.html"),gGraph.charSet=sortString(removeDuplicates(charSetParam)),"tm"===mode&&(gGraph.tapeSet=sortString(removeDuplicates(tapeSet+" "))),gGraph.epsilonEnabled=gGraph.mode==gGraph.NFA,gServer.getSunetid(function(sunetid){gGraph.sunetid=sunetid}),gGraph.mode==gGraph.DFA?d3.selectAll(".dfa-hide").style("display","none"):gGraph.mode==gGraph.NFA?d3.selectAll(".nfa-hide").style("display","none"):(d3.selectAll(".tm-hide").style("display","none"),gGraph.charSet+=" "),gNodes.init(),gEdges.init(),gBrush.init(),gTape.init(),gTestMenu.init(),gModalMenu.initBulk(),gModalMenu.submitModal.init(),gModalMenu.tmEdge.initTmEdit(),gTableMenu.init(),gGraph.initDelete(),gGraph.initCookie(),gSimulator.init(),d3.selectAll(".popup").on("click",function(){d3.event.stopPropagation()}),d3.selectAll(".overlay").on("click",function(){gModalMenu.closeCurrent()}),gBehaviors.addBehavior("page","keydown",function(){return!0},gGraph.keydown),gBehaviors.addBehavior("page","keyup",function(){return!0},gGraph.keyup),gBehaviors.apply("page",d3.select("body")),gBehaviors.apply("background",d3.select("div.gui")),gGraph.draw()},gGraph.keydown=function(){gShiftKey=d3.event.shiftKey||d3.event.metaKey},gGraph.keyup=function(){gShiftKey=d3.event.shiftKey||d3.event.metaKey},gGraph.save=function(){return{nodes:gNodes.save(),edges:gEdges.save(),meta:{charSet:gGraph.charSet,pset:gGraph.pset,problem:gGraph.problem,mode:gGraph.mode,tapeSet:gGraph.tapeSet}}},gGraph.load=function(saveData){gNodes.load(saveData.nodes),gEdges.load(saveData.edges),gTape.reset(),gTestMenu.reset()},gGraph.draw=function(){gNodes.draw(),gEdges.draw(),gTopMenu.draw(),gTableMenu.draw(),gTape.draw()},gGraph.resize=function(){var svg=d3.select("svg");gGraph.width=svg.node().getBoundingClientRect().width,gGraph.height=svg.node().getBoundingClientRect().height,d3.select(".background").attr("width",gGraph.width),d3.select(".background").attr("height",gGraph.height),d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gEdges.initDragging=function(){gEdges.dragging=!1,gEdges.startNode=null,gEdges.backupNode=null,gEdges.endNode=null;var always=function(){return!0};gBehaviors.addBehavior("lowerNodes","mouseover",function(){return!gNodes.dragging},gEdges.showTempEdge),gBehaviors.addBehavior("lowerNodes","mousemove",function(){return!gNodes.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("lowerNodes","mousedown",always,gEdges.startDragging),gBehaviors.addBehavior("background","mousedown",function(){if(null==gEdges.startNode)return!1;var mouse=d3.mouse(d3.select("svg").node()),dist=Math.sqrt(Math.pow(mouse[0]-gEdges.startNode.x,2)+Math.pow(mouse[1]-gEdges.startNode.y,2));return dist<=gNodes.SELECTABLE_RADIUS&&dist>gNodes.RADIUS},gEdges.startDragging),gBehaviors.addBehavior("nodes","mouseover",function(){return!gEdges.dragging&&gEdges.tempVisible},gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseover",function(){return gEdges.dragging},gEdges.setTempEdgeEnd),gBehaviors.addBehavior("nodes","mouseout",always,gEdges.unsetTempEdgeEnd),gBehaviors.addBehavior("background","mousemove",function(){var mouse=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var dist=Math.sqrt(Math.pow(mouse[0]-gEdges.startNode.x,2)+Math.pow(mouse[1]-gEdges.startNode.y,2));return dist>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){var mouse=d3.mouse(d3.select("svg").node());if(gEdges.dragging||!gEdges.tempVisible)return!1;var dist=Math.sqrt(Math.pow(mouse[0]-gEdges.startNode.x,2)+Math.pow(mouse[1]-gEdges.startNode.y,2));return dist>gNodes.SELECTABLE_RADIUS},gEdges.hideTempEdge),gBehaviors.addBehavior("background","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mousemove",function(){return gEdges.dragging},gEdges.drawTempEdge),gBehaviors.addBehavior("edges","mouseup",always,gEdges.hideTempEdge),gBehaviors.addBehavior("background","mouseup",always,gEdges.hideTempEdge),gBehaviors.addBehavior("nodes","mouseup",function(){return gEdges.dragging},gEdges.addTempEdge)},gEdges.unsetTempEdgeEnd=function(endNode){null!=gEdges.endNode&&(gEdges.endNode=null,gGraph.draw())},gEdges.setTempEdgeEnd=function(endNode){gEdges.endNode=endNode,gGraph.draw()},gEdges.addTempEdge=function(endNode){gEdges.endNode=null,gEdges.backupNode=null,gEdges.hideTempEdge();var edge=gEdges.getEdge(gEdges.startNode,endNode);null==edge&&(gEdges.addEdge(gEdges.startNode,endNode),edge=gEdges.edges[gEdges.edges.length-1]),gGraph.draw(),gEdges.editEdge(edge)},gEdges.startDragging=function(){gEdges.dragging=!0},gEdges.hideTempEdge=function(){var mouse=d3.mouse(d3.select("svg").node()),dist=gNodes.SELECTABLE_RADIUS+1;null!=gEdges.backupNode&&(dist=Math.sqrt(Math.pow(mouse[0]-gEdges.backupNode.x,2)+Math.pow(mouse[1]-gEdges.backupNode.y,2))),null==gEdges.backupNode||dist>gNodes.SELECTABLE_RADIUS?(d3.select("path.temp").remove(),gEdges.dragging=!1,gEdges.tempVisible=!1):(gEdges.startNode=gEdges.backupNode,gEdges.dragging=!1,gEdges.drawTempEdge())},gEdges.drawTempEdge=function(){if(null!=gEdges.startNode){if(gNodes.dragging)return d3.select("path.temp").remove(),gEdges.dragging=!1,void(gEdges.tempVisible=!1);var mouse=d3.mouse(d3.select("svg").node());d3.select("path.temp").remove(),gEdges.initialEdge=d3.select(".miscEdges").append("path").classed("temp",!0).style("marker-end","url(#mouse-arrow)").attr("fill","none").attr("d",function(){return null!=gEdges.endNode?gEdges.customPathFunction(gEdges.startNode,gEdges.endNode):gEdges.customPathFunction(gEdges.startNode,{x:mouse[0],y:mouse[1]})}).style("marker-end",function(){return null==gEdges.endNode?"url(#mouse-arrow)":"url(#end-arrow)"})}},gEdges.showTempEdge=function(startNode){gNodes.dragging||(gEdges.dragging?gEdges.backupNode=startNode:(gEdges.startNode=startNode,gEdges.tempVisible=!0,gEdges.drawTempEdge()))};var gEdges={BIDIRECTIONAL_OFFSET:8,LOOP_WIDTH:70,LOOP_HEIGHT:80,LOOP_PEAK:50,LOOP_TEXT_OFFSET:70,TEXT_OFFSET:10,TRANSITION_DY:20,TSPAN_HEIGHT:10,SELECTABLE_WIDTH:25,MARKER_SIZE:30,END_ARROW_OFFSET:36,MOUSE_ARROW_OFFSET:13};gEdges.init=function(){gEdges.lowerG=d3.select("g.edgesLower"),gEdges.upperG=d3.select("g.edges"),gEdges.straightLineFunction=d3.svg.line().x(function(point){return point.x}).y(function(point){return point.y}).interpolate("linear"),gEdges.curvedLineFunction=d3.svg.line().x(function(point){return point.x}).y(function(point){return point.y}).interpolate("basis"),gEdges.lineFunction=function(data){return data[0].x==data[1].x&&data[0].y==data[1].y?gEdges.curvedLineFunction([{x:data[0].x,y:data[0].y},{x:data[0].x+gEdges.LOOP_PEAK,y:data[0].y-gEdges.LOOP_HEIGHT/2},{x:data[0].x+gEdges.LOOP_WIDTH,y:data[0].y},{x:data[0].x+gEdges.LOOP_PEAK,y:data[0].y+gEdges.LOOP_HEIGHT/2},{x:data[0].x,y:data[0].y}]):gEdges.straightLineFunction(data)},gEdges.customPathFunction=function(source,target){var startPoint={x:source.x,y:source.y},endPoint={x:target.x,y:target.y};return target.id!=source.id&&gEdges.areConnected(target.id,source.id)&&(startPoint=gEdges.offsetPoint(startPoint,source,target,gEdges.BIDIRECTIONAL_OFFSET),endPoint=gEdges.offsetPoint(endPoint,source,target,gEdges.BIDIRECTIONAL_OFFSET)),gEdges.lineFunction([startPoint,endPoint])},gEdges.pathFunction=function(edge){return gEdges.customPathFunction(edge.source,edge.target)},gEdges.buildMarker("end-arrow",gEdges.END_ARROW_OFFSET,"black"),gEdges.buildMarker("mouse-arrow",gEdges.MOUSE_ARROW_OFFSET,"black"),gEdges.edges=[],gEdges.edgeMap={},gEdges.initInitial(),gEdges.initSelection(),gEdges.initDragging(),gEdges.initEditing()},gEdges.addEdge=function(source,target){var edge={};edge.source=source,edge.target=target,edge.transitions=[[]],gEdges.edges.push(edge),gEdges.edgeMap[source.id].push(target.id)},gEdges.removeEdge=function(source,target){gEdges.edges=gEdges.edges.filter(function(edge){return edge.source.id!=source.id||edge.target.id!=target.id});var index=gEdges.edgeMap[source.id].indexOf(target.id);gEdges.edgeMap[source.id].splice(index,1)},gEdges.addNode=function(node){gEdges.edgeMap[node.id]=[]},gEdges.removeNode=function(node){node.id==gEdges.startNode.id&&(gEdges.startNode=null,gEdges.hideTempEdge()),gEdges.edges=gEdges.edges.filter(function(edge){return edge.source.id!=node.id&&edge.target.id!=node.id});for(var sourceId in gEdges.edgeMap){var index=gEdges.edgeMap[sourceId].indexOf(node.id);gEdges.edgeMap[sourceId].splice(index,1)}delete gEdges.edgeMap[node.id]},gEdges.save=function(){var saveData={edgeMap:JSON.parse(JSON.stringify(gEdges.edgeMap)),edges:JSON.parse(JSON.stringify(gEdges.edges))};return saveData.edges.forEach(function(edge){edge.source=edge.source.id,edge.target=edge.target.id}),saveData},gEdges.load=function(saveData){gEdges.edges=saveData.edges,gEdges.edgeMap=saveData.edgeMap,gEdges.edges.forEach(function(edge){edge.source=gNodes.nodes[gNodes.getNodeIndex(edge.source)],edge.target=gNodes.nodes[gNodes.getNodeIndex(edge.target)]})},gEdges.createDOMEdges=function(lowerSelection,upperSelection){gBehaviors.apply("edges",lowerSelection.append("path").attr("fill","none").classed("lower",!0).classed("transparent",!0)),upperSelection=upperSelection.append("g"),gBehaviors.apply("edges",upperSelection),upperSelection.append("path").attr("fill","none").classed("edge",!0),
upperSelection.append("text")},gEdges.drawDOMEdges=function(lowerSelection,upperSelection){lowerSelection.attr("d",gEdges.pathFunction),upperSelection.select("path").attr("d",gEdges.pathFunction).classed("selected",function(edge){return edge.selected}).style("marker-end",function(edge){return edge.selected?"url(#sel-arrow)":"url(#end-arrow)"});var tspans=upperSelection.select("text").selectAll("tspan").data(function(edge){return gGraph.mode==gGraph.TM?edge.transitions[0]:edge.transitions});tspans.enter().append("tspan"),tspans.text(gEdges.getEdgeLabel).attr("x",function(d,i2,i1){var actualEdge;return d3.select(this.parentNode).each(function(edge,i){actualEdge=edge}),gEdges.getTextPosition(actualEdge.source,actualEdge.target,this.parentNode.getBoundingClientRect()).x}).attr("dy",gEdges.TRANSITION_DY),upperSelection.select("text").attr("x",function(edge){return gEdges.getTextPosition(edge.source,edge.target,this.getBoundingClientRect()).x}).attr("y",function(edge){var tspanCount=d3.select(this).selectAll("tspan").size()-1;return gEdges.getTextPosition(edge.source,edge.target,this.getBoundingClientRect()).y+tspanCount*gEdges.TSPAN_HEIGHT}),tspans.exit().remove(),gEdges.drawInitial()},gEdges.destroyDOMEdges=function(lowerSelection,upperSelection){lowerSelection.remove(),upperSelection.remove()},gEdges.draw=function(){isIE&&(gEdges.lowerG.selectAll("path").remove(),gEdges.upperG.selectAll("g").remove());var lowerEdges=gEdges.lowerG.selectAll("path").data(gEdges.edges,gEdges.getEdgeId),upperEdges=gEdges.upperG.selectAll("g").data(gEdges.edges,gEdges.getEdgeId);gEdges.createDOMEdges(lowerEdges.enter(),upperEdges.enter()),gEdges.drawDOMEdges(lowerEdges,upperEdges),gEdges.destroyDOMEdges(lowerEdges.exit(),upperEdges.exit())},gEdges.areConnected=function(sourceId,targetId){return null!=gEdges.endNode&&sourceId==gEdges.startNode.id&&targetId==gEdges.endNode.id||gEdges.edgeMap[sourceId]&&gEdges.edgeMap[sourceId].indexOf(targetId)>-1},gEdges.getEdgeLabel=function(transition){if(gGraph.mode==gGraph.TM){var from=" "==transition.from?gSquare:transition.from,to=" "==transition.to?gSquare:transition.to;return from+String.fromCharCode(8594)+to+", "+(1==transition.direction?"R":"L")}return gEdges.reduceLabel(transition)},gEdges.reduceLabel=function(transition){var charSet=gGraph.charSet,text="";return charSet.length/2>=transition.length?(transition.forEach(function(symbol){text+=symbol+", "}),0!=text.length&&(text=text.substring(0,text.length-2))):(text=" - ",charSet.split("").forEach(function(symbol){-1==transition.indexOf(symbol)&&(text+=symbol+", ")}),text=6!=text.length?text.substring(0,text.length-2):"",-1!=transition.indexOf(gEpsilon)&&(text+=" + "+gEpsilon)),text},gEdges.getEdgeId=function(edge){return edge.source.id+" "+edge.target.id},gEdges.getEdge=function(source,target){var targetEdge=null;return gEdges.edges.forEach(function(edge){edge.source.id==source.id&&edge.target.id==target.id&&(targetEdge=edge)}),targetEdge},gEdges.buildMarker=function(id,refX,fill){d3.select("svg").append("svg:defs").append("svg:marker").attr("id",id).attr("viewBox","0 -50 100 100").attr("refX",refX).attr("markerWidth",gEdges.MARKER_SIZE).attr("markerHeight",gEdges.MARKER_SIZE).attr("orient","auto").append("svg:path").attr("d","M 0,-5 L 10,0 L 0,5 z").attr("fill",fill).attr("stroke",fill).style("pointer-events","none")},gEdges.getTextPosition=function(source,target,bbox){var startPoint={x:source.x,y:source.y},endPoint={x:target.x,y:target.y};target.id==source.id?(startPoint.x+=gEdges.LOOP_TEXT_OFFSET,startPoint.y-=1,endPoint.x+=gEdges.LOOP_TEXT_OFFSET,endPoint.y+=1):gEdges.areConnected(target.id,source.id)&&(startPoint=gEdges.offsetPoint(startPoint,source,target,gEdges.BIDIRECTIONAL_OFFSET),endPoint=gEdges.offsetPoint(endPoint,source,target,gEdges.BIDIRECTIONAL_OFFSET));var midpoint={x:(startPoint.x+endPoint.x)/2,y:(startPoint.y+endPoint.y)/2},theta=Math.bound(Math.atan2(startPoint.y-endPoint.y,startPoint.x-endPoint.x)+Math.PI/2,0,2*Math.PI),dist=Math.sqrt(Math.pow(bbox.height/2,2)+Math.pow(bbox.width/2,2)),hc=theta>Math.PI?-1:1,wc=theta<3*Math.PI/2&&theta>=Math.PI/2?-1:1,dtheta=Math.bound(Math.atan2(hc*bbox.height,wc*bbox.width),0,2*Math.PI),ttheta=Math.abs(dtheta-theta),q=Math.cos(ttheta)*dist;return q+=gEdges.TEXT_OFFSET,{x:midpoint.x+Math.cos(theta)*q,y:midpoint.y-bbox.height+Math.sin(theta)*q}},gEdges.offsetPoint=function(point,orig,perp,distance){var angle=Math.atan2(orig.y-perp.y,orig.x-perp.x),rotatedAngle=angle+Math.PI/2;return{x:point.x+Math.cos(rotatedAngle)*distance,y:point.y+Math.sin(rotatedAngle)*distance}},gEdges.initEditing=function(){gEdges.editedEdge=null,gBehaviors.addBehavior("edges","dblclick",function(){return!0},gEdges.editEdge),d3.select(".edgeChars").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("edgeEntry")})},gEdges.populateTMEdgeModal=function(edge){d3.select(".tmEdgeEntry").select(".modal-header").text("Edit Transition "+edge.source.name+" "+String.fromCharCode(8594)+" "+edge.target.name);for(var states=JSON.parse(JSON.stringify(gEdges.editedEdge.transitions[0])),i=0;i<states.length;i++)" "==states[i].from&&(states[i].from="")," "==states[i].to&&(states[i].to="");gModalMenu.tmEdge.setTmEdgeStates(states)},gEdges.populateEdgeModal=function(edge){var chars=edge.transitions[0].join(""),epsilon=chars.length>0&&chars[chars.length-1]==gEpsilon;epsilon&&(chars=chars.substring(0,chars.length-1)),gModalMenu.setEdgeChars(chars),gModalMenu.setEpsilon(epsilon)},gEdges.editEdge=function(edge){gEdges.editedEdge=edge,gGraph.mode==gGraph.TM?(gEdges.populateTMEdgeModal(edge),gModalMenu.open("tmEdgeEntry")):(gEdges.populateEdgeModal(edge),gModalMenu.open("edgeEntry")),gModalMenu.open(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),d3.event.stopPropagation()},gEdges.editCancelled=function(){0==gEdges.editedEdge.transitions[0].length&&gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.deleteEditedEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gEdges.editedEdge=null,gModalMenu.close(gGraph.mode==gGraph.TM?"tmEdgeEntry":"edgeEntry"),gGraph.draw()},gEdges.tmEditComplete=function(){for(var states=gModalMenu.tmEdge.getTmEdgeStates(),charsUsed="",emptyUsed=!1,i=0;i<states.length;i++){if(""==states[i].to&&(states[i].to=" "),""==states[i].from){if(states[i].from=" ",emptyUsed)return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for blank");emptyUsed=!0}else if(-1!=charsUsed.indexOf(states[i].from))return void gErrorMenu.displayModalError("tmEdgeEntry","Only one transition can be defined for character "+states[i].from);if(charsUsed+=states[i].from,1!=intersection(states[i].to,gGraph.tapeSet).length||1!=intersection(states[i].from,gGraph.tapeSet).length)return void gErrorMenu.displayModalError("tmEdgeEntry","Please only use characters in the character set")}if(0==states.length)return void gErrorMenu.displayModalError("tmEdgeEntry","You must define at least one transition");for(var i=0;i<gEdges.edges.length;i++){var edge=gEdges.edges[i];if(edge.source.id==gEdges.editedEdge.source.id&&edge.target.id!=gEdges.editedEdge.target.id){for(var k=0;k<states.length;k++)for(var j=0;j<edge.transitions[0].length;j++)states[k].from==edge.transitions[0][j].from&&edge.transitions[0].splice(j--,1);0==edge.transitions[0].length&&gEdges.removeEdge(edge.source,edge.target)}}gEdges.editedEdge.transitions[0]=states,gEdges.editedEdge=null,gModalMenu.close("tmEdgeEntry"),gGraph.draw(),gGraph.draw()},gEdges.editComplete=function(){var chars=removeDuplicates(gModalMenu.getEdgeCharacters().replace(/[\s,]/g,"")),legal=intersection(gGraph.charSet,chars),oldChars=chars;if(chars=legal,gModalMenu.setEdgeChars(legal),chars+=gModalMenu.getEpsilon()?gEpsilon:"",legal.length!=oldChars.length&&(0==chars.length?gErrorMenu.displayModalError("edgeEntry","Ignoring characters that aren't in the alphabet."):gErrorMenu.displayError("Ignoring characters that aren't in the alphabet.")),0==chars.length)return void gErrorMenu.displayModalError("edgeEntry","Transitions must take at least one character");var transitions=chars.split("");transitions.sort();for(var i=0;i<transitions.length-1;i++)transitions[i]==transitions[i+1]&&transitions.splice(i--,1);if(gGraph.mode==gGraph.DFA){var removed=!1;transitions.forEach(function(transition){for(var i=0;i<gEdges.edges.length;i++){var edge=gEdges.edges[i];if(edge!=gEdges.editedEdge&&edge.source==gEdges.editedEdge.source){var index=edge.transitions[0].indexOf(transition);-1!=index&&(edge.transitions[0].splice(index,1),0==edge.transitions[0].length&&(gEdges.removeEdge(edge.source,edge.target),i--,removed=!0))}}}),removed&&gErrorMenu.displayError("Removed duplicate transitions")}gEdges.editedEdge.transitions[0]=transitions,gEdges.editedEdge=null,gModalMenu.close("edgeEntry"),gGraph.draw()},gEdges.INITIAL_EDGE_LENGTH=60,gEdges.INITIAL_OVERLAP_RANGE=7,gEdges.INITIAL_OVERLAP_ANGLE=20,gEdges.initInitial=function(){d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none")},gEdges.drawInitial=function(){var initialNode=gNodes.initial;if(null==initialNode)d3.select("path.initial").style("opacity",0);else{var yOffset=0,xOffset=gEdges.INITIAL_EDGE_LENGTH;gEdges.edges.forEach(function(edge){var lx=Math.min(edge.source.x,edge.target.x),rx=Math.max(edge.source.x,edge.target.x);if(initialNode.x<=rx&&initialNode.x-gEdges.INITIAL_EDGE_LENGTH>=lx&&edge.target.x-edge.source.x!=0){var m=(edge.target.y-edge.source.y)/(edge.target.x-edge.source.x),b=edge.source.y-m*edge.source.x,ly=m*(initialNode.x-gEdges.INITIAL_EDGE_LENGTH)+b,ry=m*initialNode.x+b;Math.abs(ly-initialNode.y)<=gEdges.INITIAL_OVERLAP_RANGE&&Math.abs(ry-initialNode.y)<=gEdges.INITIAL_OVERLAP_RANGE&&(xOffset=Math.cos(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,yOffset=Math.sin(Math.PI/180*gEdges.INITIAL_OVERLAP_ANGLE)*gEdges.INITIAL_EDGE_LENGTH,ry>ly&&(yOffset*=-1))}}),d3.select("path.initial").style("opacity",1).attr("d",function(){return gEdges.lineFunction([{x:initialNode.x-xOffset,y:initialNode.y-yOffset},{x:initialNode.x,y:initialNode.y}])})}},isIE&&(gEdges.initInitial=function(){},gEdges.drawInitial=function(){d3.select("path.initial").remove();var initialNode=gNodes.initial;null!=initialNode&&d3.select(".miscEdges").append("path").classed("initial",!0).style("marker-end","url(#end-arrow)").attr("fill","none").attr("d",function(){return gEdges.lineFunction([{x:initialNode.x-gEdges.INITIAL_EDGE_LENGTH,y:initialNode.y},{x:initialNode.x,y:initialNode.y}])})}),gEdges.SELECTED_COLOR="blue",gEdges.initSelection=function(){gEdges.buildMarker("sel-arrow",gEdges.END_ARROW_OFFSET,gEdges.SELECTED_COLOR),gBehaviors.addBehavior("edges","mousedown",function(){return!0},function(edge){gShiftKey||edge.selected||(gNodes.deselectAll(),gEdges.deselectAll()),edge.selected=!0,gGraph.draw()})},gEdges.deleteSelected=function(){var selected=[];gEdges.edges.forEach(function(edge){edge.selected&&selected.push(edge)}),selected.forEach(function(edge){gEdges.removeEdge(edge.source,edge.target)})},gEdges.deselectAll=function(){gEdges.edges.forEach(function(edge){edge.selected=!1})},gEdges.selectionIsEmpty=function(){return 0==gEdges.selectionSize()},gEdges.selectionSize=function(){return gEdges.edges.filter(function(edge){return edge.selected}).length},gNodes.doubleClickInit=function(){gBehaviors.addBehavior("background","dblclick",function(){return!gTableTopMenu.active},function(){var mouse=d3.mouse(d3.select("svg").node());gNodes.addNode(mouse[0],mouse[1]),gNodes.draw()})},gNodes.editInit=function(){gNodes.editedNode=null,gBehaviors.addBehavior("nodes","dblclick",function(){return!0},gNodes.editNode),d3.select(".nodeName").on("keypress",function(){13==d3.event.keyCode&&gModalMenu.submit("nodeEntry")})},gNodes.editNode=function(node){gNodes.editedNode=node,gModalMenu.setNodeName(node.name),gModalMenu.setInitial(null!=gNodes.initial&&node.id==gNodes.initial.id),gModalMenu.setState(node.accept,node.reject),gModalMenu.open("nodeEntry"),d3.event.stopPropagation()},gNodes.editComplete=function(){var name=gModalMenu.getNodeName();if(0==name.replace(/\s/g,"").length)return void gErrorMenu.displayModalError("nodeEntry","State name cannot be blank.");var index=gNodes.getNodeIndexFromName(name);-1==index||gNodes.nodes[index].id==gNodes.editedNode.id?(gNodes.editedNode.accept=gModalMenu.getAccepting(),gNodes.editedNode.reject=gModalMenu.getRejecting(),gModalMenu.getInitial()?gNodes.initial=gNodes.editedNode:null!=gNodes.initial&&gNodes.editedNode.id==gNodes.initial.id&&(gNodes.initial=null),gNodes.editedNode.name=name,gNodes.editedNode=null,gModalMenu.close("nodeEntry"),gGraph.draw()):gErrorMenu.displayModalError("nodeEntry",'State name "'+name+'" is already in use.')},gNodes.deleteEdited=function(){if(null!=gTape.follow&&gTape.follow.id==gNodes.editedNode.id){if(!gTape.done)return void gErrorMenu.displayModalError("nodeEntry","The current state in a running test cannot be deleted");gTestMenu.end()}gNodes.removeByIndex(gNodes.getNodeIndex(gNodes.editedNode.id)),gModalMenu.close("nodeEntry"),gGraph.draw()},gNodes.FORCE_LAYOUT_ITERATIONS=1e5,gNodes.forcedDirectedLayout=function(){var nodes=[];gNodes.nodes.forEach(function(node){nodes.push({x:node.x,y:node.y,vx:0,vy:0})});var edges=[];gEdges.edges.forEach(function(edge){edges.push({source:gNodes.getNodeIndex(edge.source.id),target:gNodes.getNodeIndex(edge.target.id)})});var force=d3.layout.force().nodes(nodes).links(edges).linkDistance(200).charge(-300).gravity(.01).size([gGraph.width-2*gGraph.BUFFER,gGraph.height-2*gGraph.BUFFER]);force.start();for(var i=0;i<gNodes.FORCE_LAYOUT_ITERATIONS;i++)force.tick();force.stop();for(var i=0;i<nodes.length;i++)gNodes.nodes[i].x=nodes[i].x,gNodes.nodes[i].y=nodes[i].y;gNodes.scale()},gNodes.moveSelected=function(dx,dy){dx+=gNodes.selectionX,dy+=gNodes.selectionY,gNodes.selectionX=0,gNodes.selectionY=0;var nodeIsSelected=function(node){return node.selected},edgeIsSelected=function(edge){return edge.source.selected||edge.target.selected};if(gNodes.validMoveX(dx)?gNodes.nodes.filter(nodeIsSelected).forEach(function(node){node.x+=dx}):gNodes.selectionX+=dx,gNodes.validMoveY(dy)?gNodes.nodes.filter(nodeIsSelected).forEach(function(node){node.y+=dy}):gNodes.selectionY+=dy,isIE)gGraph.draw();else{var upperG=d3.select("g.nodes").selectAll("g").filter(nodeIsSelected),lowerG=d3.select("g.nodesLower").selectAll("circle").filter(nodeIsSelected);gNodes.drawDOMNodes(lowerG,upperG),upperG=d3.select("g.edges").selectAll("g").filter(edgeIsSelected),lowerG=d3.select("g.edgesLower").selectAll("path").filter(edgeIsSelected),gEdges.drawDOMEdges(lowerG,upperG),gEdges.drawInitial(),gTape.draw()}},gNodes.movementInit=function(){gBehaviors.addBehavior("nodes","drag",function(node){return node.selected},function(node){gNodes.moveSelected(d3.event.dx,d3.event.dy)})};var gNodes={SELECTABLE_RADIUS:50,RADIUS:30,INNER_RADIUS:24,STROKE_WIDTH:2,NEW_BUFFER:100,NEW_INCREMENT:100,IE_TEXT_OFFSET:5};gNodes.init=function(){gNodes.lowerG=d3.select("g.nodesLower"),gNodes.upperG=d3.select("g.nodes"),gNodes.nodes=[],gNodes.initial=null,gNodes.selectionInit(),gNodes.movementInit(),gNodes.doubleClickInit(),gNodes.editInit()},gNodes.setInitial=function(){var selected=gNodes.nodes.filter(function(node){return node.selected});selected.length>0&&(gNodes.initial=selected[0])},gNodes.setAccepting=function(accepting){gNodes.nodes.filter(function(node){return node.selected}).forEach(function(node){node.accept=accepting})},gNodes.setRejecting=function(rejecting){gNodes.nodes.filter(function(node){return node.selected}).forEach(function(node){node.reject=rejecting})},gNodes.wouldOverlap=function(x,y){var overlaps=!1;return gNodes.nodes.forEach(function(node){overlaps|=dist(x,y,node.x,node.y)<=2*gNodes.RADIUS}),overlaps},gNodes.addNode=function(x,y){var node={};if("undefined"==typeof x){var foundPosition=!1;for(node.y=gNodes.NEW_BUFFER;node.y<=gGraph.height-gNodes.NEW_BUFFER&&!foundPosition;node.y+=gNodes.NEW_INCREMENT)for(node.x=gNodes.NEW_BUFFER;node.x<=gGraph.width-gNodes.NEW_BUFFER&&!foundPosition;node.x+=gNodes.NEW_INCREMENT)foundPosition=!gNodes.wouldOverlap(node.x,node.y);node.x-=gNodes.NEW_INCREMENT,node.y-=gNodes.NEW_INCREMENT}else node.x=x,node.y=y;for(var nextId=0;-1!=gNodes.getNodeIndexFromName("n"+nextId);)nextId++;node.id=nextId,node.name="n"+node.id,node.accept=!1,node.reject=!1,node.selected=!0,gNodes.deselectAll(),gNodes.nodes.push(node),gEdges.addNode(node)},gNodes.setInitialByIndex=function(index){gNodes.initial=gNodes.nodes[index]},gNodes.clearInitial=function(){gNodes.initial=null},gNodes.setAcceptByIndex=function(index,accept){gNodes.nodes[index].accept=accept},gNodes.setRejectByIndex=function(index,reject){gNodes.nodes[index].reject=reject},gNodes.removeByIndex=function(index){null!=gTape.follow&&gTape.follow.id==gNodes.nodes[index].id&&gTestMenu.end(),null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[index].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[index]),gNodes.nodes.splice(index,1)},gNodes.removeNodes=function(){if(null!=gTape.follow&&gTape.follow.selected){if(!gTape.done)return gErrorMenu.displayError("The current state in a running test cannot be deleted"),!1;gTestMenu.end()}for(var i=0;i<gNodes.nodes.length;i++)gNodes.nodes[i].selected&&(null!=gNodes.initial&&gNodes.initial.id==gNodes.nodes[i].id&&(gNodes.initial=null),gEdges.removeNode(gNodes.nodes[i]),gNodes.nodes.splice(i--,1));return!0},gNodes.createDOMNodes=function(lowerSelection,upperSelection){gBehaviors.apply("lowerNodes",lowerSelection.append("circle").classed("transparent",!0).attr("r",gNodes.SELECTABLE_RADIUS)),upperSelection=upperSelection.append("g"),gBehaviors.apply("nodes",upperSelection.append("circle").classed("outer",!0).attr("r",gNodes.RADIUS)),gBehaviors.apply("nodes",upperSelection.append("circle").classed("inner",!0).attr("r",gNodes.INNER_RADIUS)),upperSelection.append("text")},gNodes.getSelected=function(){var selected=[];return gNodes.nodes.forEach(function(node){node.selected&&selected.push(node.name)}),selected},gNodes.save=function(){return{nodes:gNodes.nodes,initial:null==gNodes.initial?null:gNodes.initial.id}},gNodes.load=function(saveData){gNodes.nodes=saveData.nodes,gNodes.initial=saveData.initial,null!=gNodes.initial&&(gNodes.initial=gNodes.nodes[gNodes.getNodeIndex(gNodes.initial)]),gNodes.nextId=0,gNodes.nodes.forEach(function(node){gNodes.nextId=Math.max(node.id+1,gNodes.nextId)}),gNodes.scale()},gNodes.scale=function(){if(gNodes.nodes.length>0){for(var xMin=gNodes.nodes[0].x,xMax=gNodes.nodes[0].x,yMin=gNodes.nodes[0].y,yMax=gNodes.nodes[0].y,i=1;i<gNodes.nodes.length;i++)xMin=Math.min(xMin,gNodes.nodes[i].x),xMax=Math.max(xMax,gNodes.nodes[i].x),yMin=Math.min(yMin,gNodes.nodes[i].y),yMax=Math.max(yMax,gNodes.nodes[i].y);var leftBound=xMin,rightBound=xMax;(gGraph.BUFFER>xMin||gGraph.width-gGraph.BUFFER<xMax)&&(leftBound=gGraph.BUFFER,rightBound=gGraph.width-gGraph.BUFFER);var topBound=yMin,bottomBound=yMax;(gGraph.BUFFER>yMin||gGraph.height-gGraph.BUFFER<yMax)&&(topBound=gGraph.BUFFER,bottomBound=gGraph.height-gGraph.BUFFER);for(var i=0;i<gNodes.nodes.length;i++){var xDenom=xMax-xMin,xPercent=0==xDenom?1:(gNodes.nodes[i].x-xMin)/xDenom,yDenom=yMax-yMin,yPercent=0==yDenom?1:(gNodes.nodes[i].y-yMin)/yDenom;gNodes.nodes[i].x=leftBound*(1-xPercent)+rightBound*xPercent,gNodes.nodes[i].y=topBound*(1-yPercent)+bottomBound*yPercent}}},gNodes.selectionIsAccepting=function(){var accepting=!0,selectionExists=!1;return gNodes.nodes.forEach(function(node){node.selected&&(selectionExists=!0,node.selected&&!node.accept&&(accepting=!1))}),accepting&&selectionExists},gNodes.selectionIsRejecting=function(){var rejecting=!0,selectionExists=!1;return gNodes.nodes.forEach(function(node){node.selected&&(selectionExists=!0,node.selected&&!node.reject&&(rejecting=!1))}),rejecting&&selectionExists},gNodes.selectionIsNeither=function(){var neither=!0,selectionExists=!1;return gNodes.nodes.forEach(function(node){node.selected&&(selectionExists=!0,(node.accept||node.reject)&&(neither=!1))}),neither&&selectionExists},gNodes.drawDOMNodes=function(lowerSelection,upperSelection){lowerSelection.attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}),upperSelection.classed("selected",function(d){return d.selected}).classed("accept",function(d){return d.accept}).classed("reject",function(d){return d.reject}),upperSelection.select("circle.inner").attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}),upperSelection.select("circle.outer").attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}),upperSelection.select("text").text(function(d){return d.name}).attr("x",function(d){return d.x}).attr("y",function(d){return d.y+(isIE?gNodes.IE_TEXT_OFFSET:0)})},gNodes.destroyDOMNodes=function(lowerSelection,upperSelection){lowerSelection.remove(),upperSelection.remove()},gNodes.draw=function(){if(isIE&&(gNodes.lowerG.selectAll("circle").remove(),gNodes.upperG.selectAll("g").remove()),gNodes.upperG.select(".empty-text").remove(),0==gNodes.nodes.length){var emptyText=isSafari?"Click Add New State to create your first node.":"Double-click to create your first node.";gNodes.upperG.append("text").classed("empty-text",!0).style("font-size",20).style("font-family",'"San Francisco", "Helvetica Neue", "Helvetica", "Arial", sans-serif').style("fill","rgba(0, 0, 0, 0.4)").style("stroke","none").attr("x",gGraph.width/2).attr("y",gGraph.height/2).text(emptyText)}var lowerNodes=gNodes.lowerG.selectAll("circle").data(gNodes.nodes,function(d){return d.id}),upperNodes=gNodes.upperG.selectAll("g").data(gNodes.nodes,function(d){return d.id});gNodes.createDOMNodes(lowerNodes.enter(),upperNodes.enter()),gNodes.drawDOMNodes(lowerNodes,upperNodes),gNodes.destroyDOMNodes(lowerNodes.exit(),upperNodes.exit())},gNodes.validMoveX=function(dx){var valid=!0;return gNodes.nodes.filter(function(node){return node.selected}).forEach(function(node){valid&=node.x+dx>=gNodes.RADIUS+gNodes.STROKE_WIDTH||dx>=0,valid&=node.x+dx<=gGraph.width-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=dx}),valid},gNodes.validMoveY=function(dy){var valid=!0;return gNodes.nodes.filter(function(node){return node.selected}).forEach(function(node){valid&=node.y+dy>=gNodes.RADIUS+gNodes.STROKE_WIDTH||dy>=0,valid&=node.y+dy<=gGraph.height-gNodes.RADIUS-gNodes.STROKE_WIDTH||0>=dy}),valid},gNodes.getNodeIndex=function(id){var index=-1;return gNodes.nodes.forEach(function(node,i){node.id==id&&(index=i)}),index},gNodes.getNodeIndexFromName=function(name){var index=-1;return gNodes.nodes.forEach(function(node,i){node.name===name&&(index=i)}),index},gNodes.select=function(id){gNodes.nodes[gNodes.getNodeIndex(id)].selected=!0},gNodes.deselect=function(id){gNodes.nodes[gNodes.getNodeIndex(id)].selected=!1},gNodes.toggleSelection=function(id){gNodes.nodes[gNodes.getNodeIndex(id)].selected^=!0},gNodes.deselectAll=function(){gNodes.nodes.forEach(function(node){node.selected=!1})},gNodes.selectionIsEmpty=function(){return 0==gNodes.selectionSize()},gNodes.selectionSize=function(){return gNodes.nodes.filter(function(node){return node.selected}).length},gNodes.selectionInit=function(){gBehaviors.addBehavior("nodes","mousedown",function(){return!0},function(node){gShiftKey||node.selected||(gNodes.deselectAll(),gEdges.deselectAll()),node.selected=!0,gGraph.draw()}),gBehaviors.addBehavior("brush","brushstart",function(){return!0},function(){gNodes.nodes.forEach(function(node){node.previouslySelected=gShiftKey&&node.selected}),gEdges.deselectAll()}),gBehaviors.addBehavior("brush","brush",function(){return!0},function(){var extent=d3.event.target.extent();gNodes.nodes.forEach(function(node){node.selected=node.previouslySelected^(extent[0][0]<=node.x&&node.x<extent[1][0]&&extent[0][1]<=node.y&&node.y<extent[1][1])}),gGraph.draw()})},gNodes.GRID_SPACING=150,gNodes.snapToGrid=function(){for(var points=[],x=gNodes.GRID_SPACING;x<=gGraph.width-gNodes.GRID_SPACING;x+=gNodes.GRID_SPACING)for(var y=gNodes.GRID_SPACING;y<=gGraph.height-gNodes.GRID_SPACING;y+=gNodes.GRID_SPACING)points.push({x:x,y:y});var nodes=[],initial=-1;if(gNodes.nodes.forEach(function(node,i){null!=gNodes.initial&&gNodes.initial.id==node.id&&(initial=i),nodes.push({x:node.x,y:node.y,i:i})}),!(points.length<nodes.length))for(;nodes.length>0&&points.length>0;){for(var bestDist=-1,bestPoint=-1,bestNode=-1,i=0;i<nodes.length;i++)for(var j=0;j<points.length;j++){var dist=Math.pow(nodes[i].x-points[j].x,2)+Math.pow(nodes[i].y-points[j].y,2);(-1==bestNode||bestDist>dist)&&(bestPoint=j,bestNode=i,bestDist=dist)}gNodes.nodes[nodes[bestNode].i].x=points[bestPoint].x,gNodes.nodes[nodes[bestNode].i].y=points[bestPoint].y,nodes.splice(bestNode,1),points.splice(bestPoint,1)}};var gErrorMenu={DISPLAY_TIME:2100,FADE_OUT_TIME:400,MAX_ERRORS:3};gErrorMenu.displayMessage=function(message,persistent,className){var selection=d3.select(".errors").append("span").text(message).classed(className,!0);1!=persistent&&selection.transition().delay(gErrorMenu.DISPLAY_TIME).duration(gErrorMenu.FADE_OUT_TIME).ease("cubic").style("opacity",0).remove();var errors=d3.select(".errors").selectAll("span").size();d3.select(".errors").selectAll("span").filter(function(junk,i){return i<errors-gErrorMenu.MAX_ERRORS}).remove()},gErrorMenu.displayError=function(message,persistent){gErrorMenu.displayMessage(message,persistent,"error")},gErrorMenu.displayModalError=function(modal,message){d3.select("."+modal).select(".modal-content").insert("p",":first-child").classed("modal-description",!0).classed("error",!0).text(message)},gErrorMenu.clearModalErrors=function(){d3.selectAll(".modal-description.error").remove()};var gTableMenu={};gTableMenu.updateAll=function(){var charSet=gGraph.charSet;gGraph.epsilonEnabled&&(charSet+=gEpsilon),gGraph.mode==gGraph.TM&&(charSet=gGraph.tapeSet),charSet=charSet.split(""),gEdges.edges=[];var map=[];gNodes.nodes.forEach(function(node){gEdges.edgeMap[node.id]=[];var arr=[];gNodes.nodes.forEach(function(){arr.push(gGraph.mode==gGraph.TM?{}:"")}),map.push(arr)});var extraNames=!1,badNames=!1,badChars=!1;d3.selectAll("input.gridInput").each(function(junk,i){var isName=i%2==0||gGraph.mode!=gGraph.TM,character=this.character,i1=this.i1;if(isName){var nodes=this.value.split(/[ \t\n\r,]/),foundOne=!1;nodes.forEach(function(nodeName){var nodeIndex=gNodes.getNodeIndexFromName(nodeName);-1!=nodeIndex?(foundOne&&gGraph.mode!=gGraph.NFA?extraNames=!0:gGraph.mode==gGraph.TM?map[i1][nodeIndex][character]={from:character}:map[i1][nodeIndex]+=character,foundOne=!0):""!=nodeName&&(badNames=!0)})}else{var to=this.value;if(intersection(to,gGraph.tapeSet).length!=to.length)return void(badChars=!0);var nodeIndex=-1;for(var prop in map[i1])if(void 0!=map[i1][prop][character]){nodeIndex=prop;break}-1!=nodeIndex&&void 0!=map[i1][nodeIndex][character]&&(map[i1][nodeIndex][character].to=""==to?" ":to)}}),d3.selectAll(".moveRight").each(function(){var character=this.character,i1=this.i1,direction=this.checked?1:-1,nodeIndex=-1;for(var prop in map[i1])if(void 0!=map[i1][prop][character]){nodeIndex=prop;break}-1!=nodeIndex&&void 0!=map[i1][nodeIndex][character]&&(map[i1][nodeIndex][character].direction=direction)}),extraNames&&gErrorMenu.displayError("Multiple transitions defined for one character, ignoring extras"),badNames&&gErrorMenu.displayError("Some states entered in the table could not be found, ignoring them"),badChars&&gErrorMenu.displayError("Some characters were not in the tape language"),map.forEach(function(row,i1){row.forEach(function(transitions,i2){var transitionsArray=[];if(gGraph.mode==gGraph.TM)for(var prop in transitions)transitionsArray.push(transitions[prop]);if(""!=transitions&&(gGraph.mode!=gGraph.TM||0!=transitionsArray.length)){var edge=gEdges.getEdge(gNodes.nodes[i1],gNodes.nodes[i2]);null==edge&&(gEdges.addEdge(gNodes.nodes[i1],gNodes.nodes[i2]),edge=gEdges.edges[gEdges.edges.length-1]),-1==gEdges.edgeMap[gNodes.nodes[i1].id].indexOf(gNodes.nodes[i2].id)&&gEdges.edgeMap[gNodes.nodes[i1].id].push(gNodes.nodes[i2].id),gGraph.mode==gGraph.TM?edge.transitions[0]=transitionsArray:edge.transitions[0]=transitions.split("").sort()}})})},gTableMenu.init=function(){var charSet=gGraph.charSet;gGraph.epsilonEnabled&&(charSet+=gEpsilon),gGraph.mode==gGraph.TM&&(charSet=gGraph.tapeSet),charSet=charSet.split("");var header=d3.select(".tableEditor").insert("tr").selectAll("td").data(charSet);header.enter().append("td"),header.text(function(inputChar){return" "==inputChar&&gGraph.mode==gGraph.TM?gSquare:inputChar}),header.exit().remove();var headerTr=d3.select(".tableEditor").select("tr");headerTr.insert("td","td").text("Rejects"),headerTr.insert("td","td").text("Accepts"),headerTr.insert("td","td").text("Initial"),headerTr.insert("td","td").text(""),headerTr.append("td").text("Delete")},gTableMenu.draw=function(){if(gTableTopMenu.active){var charSet=gGraph.charSet;gGraph.epsilonEnabled&&(charSet+=gEpsilon),gGraph.mode==gGraph.TM&&(charSet=gGraph.tapeSet),charSet=charSet.split("");var table=d3.select(".tableEditor").selectAll("tr").filter(function(junk,i){return 0!=i}).data(gNodes.nodes),newRows=table.enter().append("tr");newRows.append("td").text(function(node){return node.name}),newRows.append("td").append("input").attr("type","radio").classed("initialBox",!0).each(function(node){this.checked=null!=gNodes.initial&&gNodes.initial.id==node.id}).on("change",function(node,i){this.checked?gNodes.setInitialByIndex(i):gNodes.clearInitial(),gGraph.draw()}),newRows.append("td").append("input").attr("type","checkbox").classed("acceptBox",!0).on("change",function(node,i){gNodes.setAcceptByIndex(i,this.checked),this.checked&&gNodes.setRejectByIndex(i,!1),gGraph.draw()}),newRows.append("td").append("input").attr("type","checkbox").classed("rejectBox",!0).on("change",function(node,i){gNodes.setRejectByIndex(i,this.checked),this.checked&&gNodes.setAcceptByIndex(i,!1),gGraph.draw()}),d3.selectAll(".acceptBox").each(function(junk,i){this.checked=gNodes.nodes[i].accept}),d3.selectAll(".rejectBox").each(function(junk,i){this.checked=gNodes.nodes[i].reject});var rows=table.selectAll("td").filter(function(){return null!=d3.select(this).select("input").filter(function(){return"text"==this.type}).node()}).data(charSet),td=rows.enter().append("td").classed("tm-cell",gGraph.mode==gGraph.TM).each(function(){gGraph.mode==gGraph.TM&&d3.select(this).style("line-height","30px")});td.append("input").attr("type","text").attr("size","10").attr("placeholder","go to").classed("gridInput",!0).each(function(character,i2,i1){this.character=character,this.i1=i1}),td.append("input").attr("type","text").attr("size","10").attr("maxlength","1").attr("placeholder","write").classed("gridInput",!0).each(function(character,i2,i1){this.character=character,this.i1=i1}),td.append("br");var form=td.append("form");form.append("label").text("move:"),form.append("input").attr("type","radio").attr("name","move").attr("checked",!0).classed("moveLeft",!0).each(function(character,i2,i1){this.character=character,this.i1=i1}),form.append("label").text("L"),form.append("input").attr("type","radio").attr("name","move").classed("moveRight",!0).each(function(character,i2,i1){this.character=character,this.i1=i1}),form.append("label").text("R"),rows.selectAll("input").each(function(character,i2){switch(i2){case 0:this.value=gTableMenu.getConnections(gNodes.nodes[this.i1].id,character);break;case 1:var result=gTableMenu.getResult(gNodes.nodes[this.i1].id,character);null!=result&&(this.value=result);break;case 2:var direction=gTableMenu.getDirection(gNodes.nodes[this.i1].id,character);0!=direction&&(this.checked=-1==direction);break;case 3:var direction=gTableMenu.getDirection(gNodes.nodes[this.i1].id,character);0!=direction&&(this.checked=1==direction)}}).on("blur",function(){gTableMenu.updateAll(),gTableMenu.draw()}),rows.exit().remove(),newRows.append("td").append("button").on("click",function(node,i){
gNodes.removeByIndex(i),gGraph.draw()}).text("X"),table.exit().remove()}},gTableMenu.getConnections=function(source,character){var nodes=[];return gEdges.edges.forEach(function(edge){gGraph.mode==gGraph.TM?edge.transitions[0].forEach(function(state){edge.source.id==source&&state.from==character&&nodes.push(edge.target.name)}):edge.source.id==source&&-1!=edge.transitions[0].indexOf(character)&&nodes.push(edge.target.name)}),nodes.join(", ")},gTableMenu.getDirection=function(source,character){var direction=0;return gEdges.edges.forEach(function(edge){edge.transitions[0].forEach(function(state){edge.source.id==source&&state.from==character&&(direction=state.direction)})}),direction},gTableMenu.getResult=function(source,character){var result=null;return gEdges.edges.forEach(function(edge){edge.transitions[0].forEach(function(state){edge.source.id==source&&state.from==character&&(result=" "==state.to?"":state.to)})}),result};var gTableTopMenu={active:!1};gTableTopMenu.swap=function(){gTableTopMenu.active?(d3.select("svg").style("display","inline"),d3.select(".tableEditor, .tableEditorHeader").style("display","none"),d3.selectAll(".nontable").style("display","inline"),d3.selectAll(".nontableblock").style("display","block"),d3.select(".swapButton").text("Switch to Table View"),gTableTopMenu.active=!1,gTableMenu.updateAll()):(d3.select("svg").style("display","none"),d3.select(".tableEditor, .tableEditorHeader").style("display","table"),d3.selectAll(".nontable, .nontableblock").style("display","none"),d3.select(".swapButton").text("Switch to Editor View"),gNodes.deselectAll(),gEdges.deselectAll(),gTableTopMenu.active=!0),gGraph.mode==gGraph.DFA?d3.selectAll(".dfa-hide").style("display","none"):gGraph.mode==gGraph.NFA?d3.selectAll(".nfa-hide").style("display","none"):d3.selectAll(".tm-hide").style("display","none"),gGraph.draw()};var gTestMenu={NUM_CELLS:250,DISPLAY_TIME:4600,FADE_OUT_TIME:400};gTestMenu.init=function(){gTestMenu.reset(),gTestMenu.text="",gTestMenu.backupText="";var tape=d3.select(".tape-field");gTestMenu.showPlaceholder=!0;for(var i=0;i<gTestMenu.NUM_CELLS;i++)tape.append("input").attr("type","text").classed("tape-char",!0).attr("name","tapeChar[]").attr("maxlength",1).attr("readonly","readonly").on("click",gTestMenu.allowInput);d3.select(".tape-char-input").attr("maxlength",gTestMenu.NUM_CELLS).on("keydown",function(){13==d3.event.keyCode&&(gTestMenu.disallowInput(),gTestMenu.run())}),gTestMenu.disallowInput()},gTestMenu.reset=function(){gTestMenu.setRunning(!1),d3.select(".tape-char-input").node().value=gTestMenu.backupText||"",d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.reset()},gTestMenu.allowInput=function(){gTestMenu.showPlaceholder=!1,gTestMenu.reset(),d3.select(".tape-char-input").node().value=gTestMenu.backupText,d3.selectAll(".tape-char").style("display","none"),d3.select(".tape-char-input").style("display","inline").each(function(){this.focus()})},gTestMenu.disallowInput=function(text){if(gTestMenu.backupText!=intersection(d3.select(".tape-char-input").node().value,gGraph.charSet)){gTestMenu.backupText=d3.select(".tape-char-input").node().value;var legal=intersection(gTestMenu.backupText,gGraph.charSet);gTestMenu.backupText.length!=legal.length&&gErrorMenu.displayError("Removing characters that aren't in the alphabet."),gTestMenu.backupText=legal}gTestMenu.text=void 0==text?gTestMenu.backupText:text;var displayString="Click to enter a test";d3.selectAll(".tape-char").style("display","inline").style("color",gTestMenu.showPlaceholder?"#bbb":"#fff").each(function(junk,i){var text=gTestMenu.showPlaceholder?displayString:gTestMenu.text;this.value=i<text.length?text[i]:""}),d3.select(".tape-char-input").style("display","none")},gTestMenu.unsetTransitions=function(){var missing=[];if(gGraph.mode==gGraph.DFA){var graph=gGraph.save(),table=gSimulator.convert(graph);for(var nodeId in table){var hasMissing=!1;for(var character in table[nodeId])hasMissing|=0==table[nodeId][character].length;hasMissing&&missing.push(gNodes.nodes[gNodes.getNodeIndex(nodeId)].name)}}return missing},gTestMenu.runTests=function(){var unset=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=unset.length?gErrorMenu.displayError("The following states have undefined transitions: "+unset.join(", ")):gModalMenu.open("testing")},gTestMenu.setRunning=function(running){running?(d3.selectAll(".running").style("display","inline"),d3.select(".runButton").text("Restart")):(d3.selectAll(".running").style("display","none"),d3.select(".runButton").text("Start"))},gTestMenu.run=function(){gTestMenu.reset();var unset=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("This automaton doesn't have a start state."):0!=unset.length?gErrorMenu.displayError("The following states have undefined transitions: "+unset.join(", ")):(gTestMenu.setRunning(!0),gTape.show(),gTape.run())},gTestMenu.end=function(){gTestMenu.setRunning(!1),d3.selectAll(".current-tape-char").classed("current-tape-char",!1),d3.selectAll(".current-tape-char-solid").classed("current-tape-char-solid",!1),gTestMenu.disallowInput(),gTape.hide()},gTestMenu.step=function(){var unset=gTestMenu.unsetTransitions();null==gNodes.initial?gErrorMenu.displayError("No initial node is set"):0!=unset.length?gErrorMenu.displayError("The following nodes have undefined transitions: "+unset.join(", ")):(gTape.show(),gTape.step())};var gTopMenu={MAX_DISPLAYED_STATES:5,SELECTED_TEXT:"Selected states: "};gTopMenu.addNode=function(){gNodes.addNode(),gGraph.draw()},gTopMenu.setState=function(accepting,rejecting){gNodes.selectionIsEmpty()&&gErrorMenu.displayError("No states are selected"),gNodes.setAccepting(accepting),gNodes.setRejecting(rejecting),gGraph.draw()},gTopMenu.deleteSelected=function(){gNodes.selectionIsEmpty()&&gEdges.selectionIsEmpty()&&gErrorMenu.displayError("No states or transitions are selected"),gNodes.removeNodes()&&(gEdges.deleteSelected(),gGraph.draw())},gTopMenu.setInitial=function(){gNodes.selectionIsEmpty()?gErrorMenu.displayError("No states are selected"):gNodes.selectionSize()>1&&gErrorMenu.displayError("Multiple states are selected. Using the first one."),gNodes.setInitial(),gGraph.draw()},gTopMenu.snapToGrid=function(){gNodes.snapToGrid(),gGraph.draw()},gTopMenu.forcedDirectedLayout=function(){gNodes.forcedDirectedLayout(),gGraph.draw()},gTopMenu.loadFromServer=function(){gModalMenu.open("load"),gModalMenu.load.onOpen()},gTopMenu.save=function(){var BUTTON_TIMEOUT=2e3,name=gServer.name;gTopMenu.setSaveButton("Saving..."),!gModalMenu.saveas.isInvalidName(name)&&name?gServer.save(name,function(err,data){err?(gTopMenu.setSaveButton("Failed"),gErrorMenu.displayError("Save failed: couldn't connect to server.")):gTopMenu.setSaveButton("Saved!"),setTimeout(function(){gTopMenu.setSaveButton("Save")},BUTTON_TIMEOUT)}):name?(gErrorMenu.displayError('Saving to invalid name, use "Save As" to change name'),gTopMenu.setSaveButton("Save")):(gErrorMenu.displayError('Please first use "Save As" to give your automaton a name'),gTopMenu.setSaveButton("Save"))},gTopMenu.saveas=function(){gModalMenu.saveas.open()},gTopMenu.submit=function(){null!=gGraph.pset&&gModalMenu.submitModal.setPsetNumber(gGraph.pset),null!=gGraph.problem&&gModalMenu.submitModal.setProblemNumber(gGraph.problem),gModalMenu.open("submit")},gTopMenu.homepage=function(){window.location.href=getURLParent()+"index.html"},gTopMenu.draw=function(){var selectedText="",selected=gNodes.getSelected();selected.sort();for(var i=0;i<gTopMenu.MAX_DISPLAYED_STATES&&i<selected.length;i++)selectedText+=selected[i]+", ";selectedText=0==selected.length?"None":selectedText.substring(0,selectedText.length-2),selected.length>gTopMenu.MAX_DISPLAYED_STATES&&(selectedText+="...");var mode=gGraph.mode.toUpperCase();"TM"==mode&&(mode="Turing Machine");var pset=null==gGraph.pset?"":psets[gGraph.pset].name+", ",problem=null==gGraph.problem&&null==gGraph.pset?"":psets[gGraph.pset].problems[gGraph.problem].name+", ";d3.select(".current-pset-problem").text(pset+problem),d3.select(".current-mode").text(mode),d3.select(".current-alphabet").text(gGraph.charSet),"tm"===gGraph.mode&&gGraph.tapeSet&&sortString(gGraph.tapeSet)!==sortString(gGraph.charSet)&&(d3.select(".current-tape-set").style("display","inline"),d3.select(".current-tape-set-inner").text(gGraph.tapeSet)),d3.select("#selectedText").text(gTopMenu.SELECTED_TEXT+selectedText),d3.select(".acceptButton").classed("marked",gNodes.selectionIsAccepting()),d3.select(".rejectButton").classed("marked",gNodes.selectionIsRejecting()),d3.selectAll(".neitherButton").classed("marked",gNodes.selectionIsNeither())},gTopMenu.setSaveButton=function(text){d3.select(".saveTopButton").text(text)},gModalMenu.confirm={},gModalMenu.confirm.flag="",gModalMenu.confirm.open=function(){gModalMenu.open("confirm")},gModalMenu.confirm.clickConfirmBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmBtn()},gModalMenu.confirm.clickCancelBtn=function(){"submit"===gModalMenu.confirm.flag?gModalMenu.submitModal.clickConfirmCancelBtn():"saveas"===gModalMenu.confirm.flag&&gModalMenu.saveas.clickConfirmCancelBtn()},gModalMenu.getEpsilon=function(){return gGraph.mode==gGraph.NFA&&d3.select(".epsilon").node().checked},gModalMenu.setEpsilon=function(included){d3.select(".epsilon").node().checked=included},gModalMenu.addAllEdgeChars=function(){gModalMenu.setEdgeChars(gGraph.charSet),gModalMenu.setEpsilon(!0)},gModalMenu.invertEdgeChars=function(){var chars=gGraph.charSet,badChars=gModalMenu.getEdgeCharacters();for(var badChar in badChars)chars=chars.replace(badChars[badChar],"");gModalMenu.setEdgeChars(chars),gModalMenu.setEpsilon(!gModalMenu.getEpsilon())},gModalMenu.addRemainingEdgeChars=function(){var missing=[],graph=gGraph.save(),table=gSimulator.convert(graph);for(var character in table[gEdges.editedEdge.source.id])0==table[gEdges.editedEdge.source.id][character].length&&missing.push(character);gModalMenu.setEdgeChars(gModalMenu.getEdgeCharacters()+missing.join(""))},gModalMenu.setEdgeChars=function(chars){d3.select(".edgeChars").node().value=chars},gModalMenu.getEdgeCharacters=function(){return d3.select(".edgeChars").node().value},gModalMenu.deleteEdge=function(){gEdges.removeEdge(gEdges.editedEdge.source,gEdges.editedEdge.target),gGraph.draw(),gModalMenu.close("edgeEntry")},gModalMenu.load={},gModalMenu.load.onOpen=function(){gModalMenu.open("load"),gModalMenu.load.setLoadMessage("Gathering saved automata..."),gServer.listSaved(function(err,data){if(err)return gErrorMenu.displayModalError("load","Could not gather saved automata..."),void d3.select(".load").selectAll("li").remove();var names=[];data.forEach(function(elem,index,arr){names.push(elem.name)}),gModalMenu.load.setLoadNames(names)})},gModalMenu.load.onClickLoadBtn=function(){gErrorMenu.clearModalErrors();var name=gModalMenu.load.getLoadName();return name?(gModalMenu.load.setLoadButton("Loading..."),void gServer.load(name,function(err,automata){if(err)return gErrorMenu.displayModalError("load","Failed to load"),void gModalMenu.load.setLoadButton("Load");gServer.changeName(name),gModalMenu.load.setLoadButton("Success!"),gGraph.charSet=automata.meta.charSet,gGraph.pset=automata.meta.pset,gGraph.problem=automata.meta.problem,"tm"===mode&&(gGraph.tapeSet=automata.meta.tapeSet);var mode=automata.meta.mode;mode!=gGraph.mode&&(window.location.href=getURLParent()+"tm.html?saved="+name),gGraph.load(automata),gGraph.draw(),setTimeout(function(){gModalMenu.load.setLoadButton("Load"),gModalMenu.close("load")},300)})):void gErrorMenu.displayModalError("load","No automaton selected")},gModalMenu.load.clickCancelBtn=function(){gErrorMenu.clearModalErrors(),gModalMenu.close("load")},gModalMenu.load.setLoadNames=function(names){var lis=d3.select(".loadNames").selectAll("li").data(names);lis.enter().append("li"),lis.classed("selected",!1).classed("load-nothing",!1).text(function(name){return name}).on("click",function(){d3.select(".loadNames").selectAll("li").classed("selected",!1),d3.select(this).classed("selected",!0)}).style("cursor","pointer"),lis.exit().remove(),0==names.length&&d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text("Nothing's been saved yet")},gModalMenu.load.getLoadName=function(){var node=d3.select(".loadNames").select("li.selected").node();return null==node?null:encodeURIComponent(d3.select(".loadNames").select("li.selected").text())},gModalMenu.load.setLoadButton=function(text){d3.select(".loadButton").text(text)},gModalMenu.load.setLoadMessage=function(message){d3.select(".loadNames").selectAll("li").remove(),d3.select(".loadNames").append("li").classed("load-nothing",!0).append("p").classed("modal-description",!0).text(message)};var gModalMenu={MAX_HEIGHT_PERCENT:.62};gModalMenu.open=function(type){gModalMenu.currentType=type,d3.select("."+type).style("display","inline"),d3.select(".overlay").style("display","inline")},gModalMenu.close=function(type){gErrorMenu.clearModalErrors(),d3.select("."+type).style("display","none"),d3.select(".overlay").style("display","none")},gModalMenu.closeCurrent=function(){gModalMenu.cancel(gModalMenu.currentType)},gModalMenu.submitOnEnter=function(type){13==event.keyCode&&gModalMenu.submit(type)},gModalMenu.submit=function(type){switch(gErrorMenu.clearModalErrors(),type){case"tmEdgeEntry":gEdges.tmEditComplete();break;case"edgeEntry":gEdges.editComplete();break;case"nodeEntry":gNodes.editComplete();break;case"testing":gSimulator.runTests();break;case"saveas":gModalMenu.saveas.clickSaveBtn();break;case"load":gModalMenu.load.onClickLoadBtn();break;case"submit":gModalMenu.submitModal.clickSubmitBtn();break;case"confirm":gModalMenu.confirm.clickConfirmBtn()}},gModalMenu.cancel=function(type){switch(type){case"edgeEntry":gEdges.editCancelled();break;case"confirm":gModalMenu.confirm.clickCancelBtn();break;case"saveas":gModalMenu.saveas.clickCancelBtn();break;case"load":gModalMenu.load.clickCancelBtn();break;default:gModalMenu.close(type)}},gModalMenu.getNodeName=function(){return d3.select(".nodeName").node().value},gModalMenu.setNodeName=function(name){d3.select(".nodeName").node().value=name},gModalMenu.setInitial=function(initial){d3.select(".nodeInitialCheckbox").node().checked=initial},gModalMenu.getInitial=function(){return d3.select(".nodeInitialCheckbox").node().checked},gModalMenu.setState=function(accept,reject){d3.selectAll(".modalAcceptButton").classed("marked",accept),d3.selectAll(".modalNeitherButton").classed("marked",!accept&&!reject),d3.selectAll(".modalRejectButton").classed("marked",reject)},gModalMenu.getAccepting=function(){return d3.select(".modalAcceptButton").classed("marked")},gModalMenu.getRejecting=function(){return d3.select(".modalRejectButton").classed("marked")},gModalMenu.deleteNode=function(){gNodes.deleteEdited()},gModalMenu.saveas={},gModalMenu.saveas.open=function(){gModalMenu.saveas.setSaveName(gServer.name),gModalMenu.open("saveas")},gModalMenu.saveas.clickSaveBtn=function(){gModalMenu.confirm.flag="saveas",gModalMenu.saveas.setSaveButton("Saving...");var rawName=gModalMenu.saveas.getSaveName();if(gModalMenu.saveas.isInvalidName(rawName))return gErrorMenu.displayModalError("saveas","Automaton name cannot be blank"),void gModalMenu.saveas.setSaveButton("Save");var name=encodeURIComponent(rawName);gServer.listSaved(function(err,data){function isPreviouslySaved(list,name){return list.some(function(elem,index,arr){return elem.name===name})}return err?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),void gModalMenu.saveas.setSaveButton("Save")):void(isPreviouslySaved(data,name)?(gModalMenu.close("saveas"),gModalMenu.confirm.open()):gModalMenu.saveas.save(function(){gModalMenu.close("saveas")}))})},gModalMenu.saveas.clickCancelBtn=function(){gErrorMenu.clearModalErrors(),gModalMenu.close("saveas")},gModalMenu.saveas.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("saveas"),gModalMenu.saveas.save(function(){gModalMenu.close("saveas")})},gModalMenu.saveas.clickConfirmCancelBtn=function(){gModalMenu.close("saveas"),gModalMenu.close("confirm"),gModalMenu.saveas.setSaveButton("Save")},gModalMenu.saveas.save=function(){var name=gModalMenu.saveas.getSaveName();gServer.save(name,function(err,data){return err?(gErrorMenu.displayModalError("saveas","Save failed: couldn't connect to server."),void gModalMenu.saveas.setSaveButton("Save")):(gServer.changeName(name),gModalMenu.saveas.setSaveButton("Saved!"),void window.setTimeout(function(){gModalMenu.saveas.setSaveButton("Save"),gModalMenu.close("saveas")},1e3))})},gModalMenu.saveas.isInvalidName=function(name){return 0===name.replace(/\s/g,"").length},gModalMenu.saveas.getSaveName=function(){return d3.select(".saveText").node().value},gModalMenu.saveas.setSaveName=function(name){d3.select(".saveText").node().value=decodeURIComponent(name)},gModalMenu.saveas.setSaveButton=function(text){d3.select(".saveButton").text(text)},gModalMenu.submitModal={},gModalMenu.submitModal.init=function(){var psetSelect=d3.select(".pset").selectAll("option").data(psets);psetSelect.enter().append("option").attr("value",function(pset,i){return i}).text(function(pset,i){return pset.name}),d3.select(".pset").node().selectedIndex=0,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.clickSubmitBtn=function(){function isPreviouslySaved(list,pset,problem){return list.some(function(elem,index,arr){var cur_pset_id=parseInt(elem.pset_id),cur_problem_id=parseInt(elem.problem_id);return cur_pset_id===pset&&cur_problem_id===problem})}gModalMenu.confirm.flag="submit";var pset=(JSON.stringify(gGraph.save()),gModalMenu.submitModal.getPsetNumber()),problem=gModalMenu.submitModal.getProblemNumber();gModalMenu.submitModal.setSubmitButton("Submitting..."),gServer.listSubmissions(function(data,err){return err?(gErrorMenu.displayModalError("submit","Failed to submit"),void gModalMenu.submitModal.setSubmitButton("Submit")):void(isPreviouslySaved(data,pset,problem)?(gModalMenu.close("submit"),gModalMenu.confirm.open()):gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")}))})},gModalMenu.submitModal.clickCancelBtn=function(){gModalMenu.cancel("submit"),gErrorMenu.clearModalErrors()},gModalMenu.submitModal.clickConfirmBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.submit(function(){gModalMenu.close("submit")})},gModalMenu.submitModal.clickConfirmCancelBtn=function(){gModalMenu.close("confirm"),gModalMenu.open("submit"),gModalMenu.submitModal.setSubmitButton("Submit")},gModalMenu.submitModal.changenumbers=function(){var psetNum=d3.select(".pset").node().selectedIndex,problemSelect=d3.select(".problem").selectAll("option").data(psets[psetNum].problems);problemSelect.enter().append("option"),problemSelect.attr("value",function(problem){return problem.charSet}).text(function(problem){return problem.name}),problemSelect.exit().remove(),d3.select(".problem").node().selectedIndex=0},gModalMenu.submitModal.submit=function(done){var automata=JSON.stringify(gGraph.save()),pset=gModalMenu.submitModal.getPsetNumber(),problem=gModalMenu.submitModal.getProblemNumber();return psets[pset].problems[problem].type!=gGraph.mode&&"nfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is an NFA, but the problem requires a DFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[pset].problems[problem].type!=gGraph.mode&&"dfa"==gGraph.mode?(gErrorMenu.displayModalError("submit","This automaton is a DFA, but the problem requires an NFA."),void gModalMenu.submitModal.setSubmitButton("Submit")):psets[pset].problems[problem].charSet!=gGraph.charSet?(gErrorMenu.displayModalError("submit","The alphabet for this automaton doesn't match the alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):"tm"===gGraph.mode&&psets[pset].problems[problem].tapeSet!=gGraph.tapeSet?(gErrorMenu.displayModalError("submit","The tape alphabet for this turing machine doesn't match the tape alphabet for that problem."),void gModalMenu.submitModal.setSubmitButton("Submit")):void gServer.submit(automata,pset,problem,function(err){return err?(gErrorMenu.displayModalError("submit","Failed to submit"),void gModalMenu.submitModal.setSubmitButton("Submit")):(gModalMenu.submitModal.setSubmitButton("Success!"),void setTimeout(function(){gModalMenu.submitModal.setSubmitButton("Submit"),done()},1e3))})},gModalMenu.submitModal.getProblemNumber=function(){return d3.select(".problem").node().selectedIndex},gModalMenu.submitModal.getPsetNumber=function(){return d3.select(".pset").node().selectedIndex},gModalMenu.submitModal.setProblemNumber=function(index){d3.select(".problem").node().selectedIndex=index},gModalMenu.submitModal.setPsetNumber=function(index){d3.select(".pset").node().selectedIndex=index,gModalMenu.submitModal.changenumbers()},gModalMenu.submitModal.setSubmitButton=function(text){d3.select(".submitButton").text(text)},gModalMenu.focusRow=function(index){index=Math.max(index,0);var focused=!1;d3.selectAll(".bulkInput").each(function(junk,i){i==index&&(this.focus(),focused=!0)}),focused||gModalMenu.buildRow(!0)},gModalMenu.buildRow=function(focus){var row=d3.select(".testingHeader").append("tr");row.append("td").append("input").attr("type","text").classed("bulkInput",!0).each(function(){focus&&this.focus()}),row.append("td").append("input").attr("type","radio").classed("bulkAccept",!0),row.append("td").append("input").attr("type","radio").classed("bulkReject",!0),d3.selectAll(".bulkAccept").on("change",function(junk,i){gModalMenu.clearReject(i)}),d3.selectAll(".bulkReject").on("change",function(junk,i){gModalMenu.clearAccept(i)}),d3.selectAll(".bulkInput").on("keydown",function(junk,i){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.focusRow(i+1):38==d3.event.keyCode&&gModalMenu.focusRow(i-1)})},gModalMenu.initBulk=function(){gModalMenu.buildRow(!1),d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.clearReject=function(index){d3.selectAll(".bulkReject").each(function(junk,i){i==index&&(this.checked=!1)})},gModalMenu.clearAccept=function(index){d3.selectAll(".bulkAccept").each(function(junk,i){i==index&&(this.checked=!1)})},gModalMenu.tmEdge={},gModalMenu.tmEdge.focusTmRow=function(index){index=Math.max(index,0);var focused=!1;d3.selectAll(".tmEdgeInput").each(function(junk,i){i==index&&(this.focus(),focused=!0)}),focused||gModalMenu.tmEdge.buildTmRow(!0)},gModalMenu.tmEdge.setTmEdgeStates=function(states){0==states.length&&states.push({direction:1,to:"",from:""});for(var newRows=states.length-d3.selectAll(".tmEdge > tr").size(),i=0;newRows>i;i++)gModalMenu.tmEdge.buildTmRow(!1);var rows=d3.select(".tmEdge").selectAll("tr").filter(function(junk,i){return 0!=i}).data(states);rows.select("td > .edgeLeft").each(function(state){this.checked=-1==state.direction}),rows.select("td > .edgeRight").each(function(state){this.checked=1==state.direction}),rows.selectAll("td > .tmEdgeChars").each(function(junk,i2,i1){this.value=1==i2?states[i1].to:states[i1].from}),rows.exit().remove()},gModalMenu.tmEdge.getTmEdgeStates=function(){var states=[];return d3.select(".tmEdge").selectAll("tr").filter(function(junk,i){return 0!=i}).each(function(){var state={},row=d3.select(this);state.direction=row.select("td > .edgeLeft").node().checked?-1:1,state.from=row.selectAll("td > .tmEdgeChars")[0][0].value,state.to=row.selectAll("td > .tmEdgeChars")[0][1].value,states.push(state)}),states},gModalMenu.tmEdge.buildTmRow=function(focus){var row=d3.select(".tmEdge").append("tr");row.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0).each(function(){focus&&this.focus()}),row.append("td").append("input").attr("type","text").attr("size",2).attr("maxlength",1).classed("tmEdgeChars",!0);var radioTd=row.append("td");radioTd.append("input").attr("type","radio").classed("edgeLeft",!0),radioTd.append("label").text(" L "),radioTd.append("input").attr("type","radio").attr("checked",!0).classed("edgeRight",!0),radioTd.append("label").text(" R "),row.append("td").append("button").classed("button-delete",!0).text("X"),gModalMenu.tmEdge.updateTmDeleteButtons(),d3.selectAll(".edgeLeft").on("change",function(junk,i){gModalMenu.tmEdge.clearRight(i)}),d3.selectAll(".edgeRight").on("change",function(junk,i){gModalMenu.tmEdge.clearLeft(i)}),d3.selectAll(".tmEdgeChars").on("keydown",function(junk,i){13==d3.event.keyCode||40==d3.event.keyCode?gModalMenu.tmEdge.focusTmRow(i+1):38==d3.event.keyCode&&gModalMenu.tmEdge.focusTmRow(i-1)})},gModalMenu.tmEdge.updateTmDeleteButtons=function(){d3.selectAll(".button-delete").on("click",function(junk,i){d3.select(".tmEdge").selectAll("tr").filter(function(junk2,i2){return i==i2}).remove(),gModalMenu.tmEdge.updateTmDeleteButtons()})},gModalMenu.tmEdge.initTmEdit=function(){d3.select(".modal-content").attr("max-height",gGraph.height*gModalMenu.MAX_HEIGHT_PERCENT)},gModalMenu.tmEdge.clearLeft=function(index){d3.selectAll(".edgeLeft").each(function(junk,i){i==index&&(this.checked=!1)})},gModalMenu.tmEdge.clearRight=function(index){d3.selectAll(".edgeRight").each(function(junk,i){i==index&&(this.checked=!1)})},gSimulator.ACCEPT="ACCEPT",gSimulator.REJECT="REJECT",gSimulator.NEITHER="NEITHER",gSimulator.runTests=function(){var inputs=[],illegalsExist=!1;d3.selectAll(".bulkInput").each(function(){var test=intersection(this.value,gGraph.charSet);illegalsExist|=test.length!=this.value.length,this.value=test,inputs.push({testCase:test,expected:gSimulator.NEITHER})}),d3.selectAll(".bulkAccept").each(function(junk,i){this.checked&&(inputs[i].expected=gSimulator.ACCEPT)}),d3.selectAll(".bulkReject").each(function(junk,i){this.checked&&(inputs[i].expected=gSimulator.REJECT)}),illegalsExist&&gErrorMenu.displayModalError("testing","Removing characters not in alphabet");var results=[],graph=gGraph.save();inputs.forEach(function(input){results.push({accepted:gSimulator.run(graph,input.testCase),input:gSimulator.output,expected:input.expected})});var rows=d3.select(".testingResults").selectAll("tr").data(results),entered=rows.enter().append("tr");entered.append("td").attr("width","60%").style("text-align","left"),entered.append("td").attr("width","20%").style("text-align","center"),entered.append("td").attr("width","20%").style("text-align","center"),rows.each(function(result){d3.select(this).selectAll("td").text(function(junk,i){switch(i){case 0:return result.accepted==gSimulator.TIMEOUT?"Timed out":result.input;case 1:return result.accepted==gSimulator.TIMEOUT?"-":result.accepted?"A":"R";case 2:if(result.expected===gSimulator.NEITHER||result.accepted==gSimulator.TIMEOUT)return"-";var correct=!(result.expected===gSimulator.ACCEPT^result.accepted);return correct?"Y":"N"}})}),rows.exit().remove()};var gDFASimulator={};gDFASimulator.step=function(graph,initial,input,index){var transitionTable=gSimulator.convert(graph);return transitionTable[initial][input[index]][0]},gDFASimulator.run=function(graph,input){gSimulator.output=input;for(var transitionTable=gSimulator.convert(graph),current=graph.nodes.initial,i=0;i<input.length;i++){var choices=transitionTable[current][input[i]];if(0==choices.length)return!1;current=choices[0]}for(var i=0;i<graph.nodes.nodes.length;i++)if(graph.nodes.nodes[i].id==current)return graph.nodes.nodes[i].accept;return!1};var gNFASimulator={};gNFASimulator.run=function(graph,input){gSimulator.output=input;var transitionTable=gSimulator.convert(graph),queue=new Queue,used={};for(queue.enqueue({current:graph.nodes.initial,index:0}),used[graph.nodes.initial+" 0"]=!0;!queue.isEmpty();){var entry=queue.dequeue();if(entry.index==input.length){for(var i=0;i<graph.nodes.nodes.length;i++)if(graph.nodes.nodes[i].id==entry.current&&graph.nodes.nodes[i].accept)return!0}else for(var choices=transitionTable[entry.current][input[entry.index]],i=0;i<choices.length;i++){var newEntry={current:choices[i],index:entry.index+1};used[newEntry.current+" "+newEntry.index]||(used[newEntry.current+" "+newEntry.index]=!0,queue.enqueue(newEntry))}for(var epsilons=transitionTable[entry.current][gEpsilon],i=0;i<epsilons.length;i++){var newEntry={current:epsilons[i],index:entry.index};used[newEntry.current+" "+newEntry.index]||(used[newEntry.current+" "+newEntry.index]=!0,queue.enqueue(newEntry))}}return!1};var gSimulator={TIMEOUT:"timeout"};gSimulator.init=function(){var simulator=gGraph.mode==gGraph.DFA?gDFASimulator:gGraph.mode==gGraph.NFA?gNFASimulator:gTMSimulator;gSimulator.run=simulator.run,gSimulator.step=simulator.step},gSimulator.convert=function(graph){var transitionTable={},charSet=gGraph.charSet+(gGraph.epsilonEnabled?gEpsilon:"");return graph.nodes.nodes.forEach(function(node){transitionTable[node.id]={};for(var i=0;i<charSet.length;i++)transitionTable[node.id][charSet[i]]=[]}),graph.edges.edges.forEach(function(edge){edge.transitions[0].forEach(function(input){transitionTable[edge.source][input].push(edge.target)})}),transitionTable};var gTape={SELECT_RADIUS:50};gTape.init=function(){d3.select(".tape").append("circle").style("fill","none").style("stroke","blue").attr("r",gTape.SELECT_RADIUS),gTape.hide(),gTape.done=!0,gTape.running=!1},gTape.run=function(){var input=gTestMenu.text;gTape.done=!1,gTape.running=!0,d3.select(".tape").select("circle").style("stroke","blue"),gTape.input=input.split(""),gTape.index=0,gTape.follow=gTape.current=gNodes.initial,gTape.draw()},gTape.drawResult=function(accepted){if(!gTape.done){var message="Run finished, "+(accepted?"accept":"reject")+'ing string "'+gTape.input.join("")+'"';!gTape.follow||gTape.follow.accept||gTape.follow.reject||(message+=" because of a missing transition"),gErrorMenu.displayMessage(message,!1,accepted?"accepting run-finished":"rejecting run-finished"),gTape.done=!0}},gTape.draw=function(){var circle=d3.select(".tape").select("circle");if(gTape.follow){var duration=gTape.follow!=gTape.prev&&1==circle.style("opacity")?100:0;circle.transition().duration(duration).attr("cx",gTape.follow.x).attr("cy",gTape.follow.y).style("opacity",1),d3.select(".stepButton").text("Step").node().disabled=!1,gTape.isRejecting()?(circle.style("stroke","red"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!1)):gTape.isAccepting()&&(circle.style("stroke","green"),d3.select(".stepButton").text("Completed").node().disabled=!0,gTape.drawResult(!0))}else circle.style("opacity",0);var currentTapeClass=gGraph.mode==gGraph.TM?"current-tape-char-solid":"current-tape-char";gTape.running&&gTape.index<=gTape.input.length&&d3.selectAll(".tape-char").classed(currentTapeClass,function(junk,i){return d3.select(this).classed(currentTapeClass)||gTape.index!=i||(this.focus(),this.blur()),gTape.index==i}),gTape.prev=gTape.follow},gTape.isAccepting=function(){return gGraph.mode==gGraph.DFA?"undefined"!=typeof gTape.current&&gTape.current.accept&&gTape.index==gTape.input.length:"undefined"!=typeof gTape.current&&gTape.current.accept},gTape.isRejecting=function(){return gGraph.mode==gGraph.DFA?"undefined"==typeof gTape.current||!gTape.current.accept&&gTape.index==gTape.input.length:"undefined"==typeof gTape.current||gTape.current.reject},gTape.show=function(){d3.select(".tape").style("opacity",1)},gTape.reset=function(){gTape.done=!0,gTape.running=!1,gTape.follow=null,gTape.draw()},gTape.hide=function(){gTape.reset(),d3.select(".tape").style("opacity",0)},gTape.step=function(){if(!gTape.running)return void gTape.run();if(!gTape.isRejecting()&&!gTape.isAccepting()){if(gGraph.mode==gGraph.DFA){var next=gDFASimulator.step(gGraph.save(),gTape.current.id,gTape.input,gTape.index++);gTape.current=gNodes.nodes[gNodes.getNodeIndex(next)]}else{var next=gTMSimulator.step(gGraph.save(),gTape.current.id,gTape.input.join(""),gTape.index);
gTape.current=gNodes.nodes[gNodes.getNodeIndex(next.initial)],gTape.input=next.input.split(""),gTape.index=next.index,gTestMenu.disallowInput(gTape.input.join(""))}"undefined"!=typeof gTape.current&&(gTape.follow=gTape.current)}gTape.draw()};var gTMSimulator={MAX_ITER:1e5},gBlank=" ",gSquare=String.fromCharCode(9633);gTMSimulator.convert=function(graph){var transitionTable={},charSet=gGraph.tapeSet+(gGraph.epsilonEnabled?gEpsilon:"");return graph.nodes.nodes.forEach(function(node){transitionTable[node.id]={};for(var i=0;i<charSet.length;i++)transitionTable[node.id][charSet[i]]=null}),graph.edges.edges.forEach(function(edge){edge.transitions[0].forEach(function(input){transitionTable[edge.source][input.from]=JSON.parse(JSON.stringify(input)),transitionTable[edge.source][input.from].target=edge.target})}),transitionTable},gTMSimulator.step=function(graph,initial,input,index){var transitionTable=gTMSimulator.convert(graph);transitionTable[initial][input[index]];return gTMSimulator.stepState(transitionTable,{initial:initial,input:input,index:index})},gTMSimulator.stepState=function(table,state){var input=state.input;input.length==state.index&&(input+=gBlank);var transition=table[state.initial][input[state.index]];if(void 0==transition)return{initial:void 0,input:input,index:state.index};var result={initial:transition.target,index:state.index+transition.direction};for(result.input=input.substring(0,state.index)+transition.to+input.substring(state.index+1);result.index<0;)result.index++,result.input=gBlank+result.input;for(;result.index>=result.input.length;)result.input+=gBlank;return result},gTMSimulator.run=function(graph,input){for(var state={initial:graph.nodes.initial,input:input,index:0},transitionTable=gTMSimulator.convert(graph),i=0;i<gTMSimulator.MAX_ITER;i++){if(void 0==state.initial)return gSimulator.output=state.input,!1;var current=graph.nodes.nodes[gNodes.getNodeIndex(state.initial)];if(current.accept)return gSimulator.output=state.input,!0;if(current.reject)return gSimulator.output=state.input,!1;i<gTMSimulator.MAX_ITER-1&&(state=gTMSimulator.stepState(transitionTable,state))}return gSimulator.output=state.input,gSimulator.TIMEOUT};var gServerMock={};gServerMock.url_prefix="/class/cs103/cgi-bin/restricted",gServerMock.name="automata",gServerMock.save=function(){var name=gModalMenu.getSaveName();if(0==name.replace(/\s/g,"").length)return void gErrorMenu.displayError("Automata name cannot be blank");gServer.name=name;var save_url="/api/save.php";gModalMenu.setSaveButton("Saving...");var stringGraph=JSON.stringify(gGraph.save()),pack={automata:stringGraph,name:name};d3.xhr(gServer.url_prefix+save_url).header("Content-Type","application/json").post(JSON.stringify(pack),function(err,rawData){err?gModalMenu.setSaveButton("Failed"):gModalMenu.setSaveButton("Saved!"),window.setTimeout(function(){gModalMenu.setSaveButton("Save"),gModalMenu.close("save")},1e3)})},gServerMock.load=function(){var selected=gModalMenu.getLoadName(),get_url="/api/loadFromSaved.php?name="+selected;d3.xhr(gServer.url_prefix+get_url).header("Content-Type","application/json").get(function(err,data){err&&console.log(err);var json_data=JSON.parse(data.response);gGraph.load(JSON.parse(json_data[0].automata)),gGraph.draw(),gModalMenu.close("load")})},gServerMock.submit=function(){var submit_url="/api/submit.php",automata=JSON.stringify(gGraph.save()),pset=1,problem=1,pack={automata:automata,pset:pset,problem:problem};d3.xhr(gServer.url_prefix+submit_url).header("Content-Type","application/json").post(JSON.stringify(pack),function(err,rawData){err?console.log(err):console.log(rawData)})},gServerMock.listSubmissions=function(){var listSubmissions_url="/api/listSubmissions.php";d3.xhr(gServer.url_prefix+listSubmissions_url).header("Content-Type","application/json").get(function(err,rawData){if(err)console.log(err);else{console.log(rawData);JSON.parse(rawData.response)}})},gServerMock.loadSubmission=function(){var pset=1,problem=1,loadFromSubmissions_url="/api/loadFromSubmissions.php",full_url=gServer.url_prefix+loadFromSubmissions_url+"?problem="+problem+"&pset="+pset;d3.xhr(full_url).header("Content-Type","application/json").get(function(err,rawData){if(err)console.log(err);else{console.log(rawData);var data=JSON.parse(rawData.response),automata=JSON.parse(data[0].automata);gGraph.load(automata),gGraph.draw()}})},gServerMock.listSaved=function(callback){callback([{name:"test1"},{name:"test2"}])},gServerMock.getSunetid=function(callback){callback("mprecup")},null!=getURLParam("mock")&&(gServer=gServerMock);var gServer={};gServer.url_prefix="/class/cs103/cgi-bin/restricted",gServer.name="",gServer.changeName=function(name){var new_url=setURLParam("saved",name,window.location.href);window.history.pushState({},"",new_url),gServer.name=name},gServer.save=function(name,callback){var save_url="/api/save.php",stringGraph=JSON.stringify(gGraph.save()),pack={automata:stringGraph,name:name};d3.xhr(gServer.url_prefix+save_url).header("Content-Type","application/json").post(JSON.stringify(pack),function(err,rawData){err?callback(err,null):callback(err,rawData)})},gServer.load=function(selected,callback){var get_url="/api/loadFromSaved.php?name="+selected;d3.xhr(gServer.url_prefix+get_url).header("Content-Type","application/json").get(function(err,res){var json_data=JSON.parse(res.response);callback(err,JSON.parse(json_data[0].automata))})},gServer.submit=function(automata,pset,problem,callback){var submit_url="/api/submit.php",pack={automata:automata,pset:pset,problem:problem},packed=JSON.stringify(pack);d3.xhr(gServer.url_prefix+submit_url).header("Content-Type","application/json").post(packed,function(err,rawData){callback(err)})},gServer.listSubmissions=function(callback){var listSubmissions_url="/api/listSubmissions.php";try{d3.xhr(gServer.url_prefix+listSubmissions_url).header("Content-Type","application/json").get(function(err,rawData){var data=rawData?JSON.parse(rawData.response):null;callback(data,err)})}catch(err){console.error("Could not connect to server")}},gServer.loadSubmission=function(pset,problem,callback){var loadFromSubmissions_url="/api/loadFromSubmissions.php",full_url=gServer.url_prefix+loadFromSubmissions_url+"?problem="+problem+"&pset="+pset;d3.xhr(full_url).header("Content-Type","application/json").get(function(err,rawData){err?callback(err,null):callback(err,JSON.parse(rawData.response))})},gServer.listSaved=function(callback){var listSaved_url="/api/listSaved.php";try{d3.xhr(gServer.url_prefix+listSaved_url).header("Content-Type","application/json").get(function(err,data){err?callback(err,null):callback(err,JSON.parse(data.response))})}catch(err){console.error("Could not connect to server")}},gServer.getSunetid=function(callback){var getSunetid_url="/api/getSunetid.php";try{d3.xhr(gServer.url_prefix+getSunetid_url).header("Content-Type","application/json").get(function(err,data){callback(err?null:data.response)})}catch(err){console.error("Could not connect to server")}};
//# sourceMappingURL=sourceMap.map